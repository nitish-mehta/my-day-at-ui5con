/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/IconPool","./AvatarRenderer","jquery.sap.keycodes"],function(t,e,i,a,s){"use strict";var r=e.AvatarType;var o=e.AvatarImageFitType;var n=e.AvatarSize;var p=e.AvatarShape;var l=i.extend("sap.f.Avatar",{metadata:{library:"sap.f",properties:{src:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},initials:{type:"string",group:"Data",defaultValue:null},displayShape:{type:"sap.f.AvatarShape",group:"Appearance",defaultValue:p.Circle},displaySize:{type:"sap.f.AvatarSize",group:"Appearance",defaultValue:n.S},customDisplaySize:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"3rem"},customFontSize:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"1.125rem"},imageFitType:{type:"sap.f.AvatarImageFitType",group:"Appearance",defaultValue:o.Cover}},aggregations:{detailBox:{type:"sap.m.LightBox",multiple:false,bindable:"bindable"}},events:{press:{}},designtime:"sap/f/designtime/Avatar.designtime"}});l.DEFAULT_CIRCLE_PLACEHOLDER="sap-icon://person-placeholder";l.DEFAULT_SQUARE_PLACEHOLDER="sap-icon://product";l.prototype.init=function(){this._sActualType=null;this._bIsDefaultIcon=true};l.prototype.exit=function(){if(this._icon){this._icon.destroy()}if(this._fnLightBoxOpen){this._fnLightBoxOpen=null}};l.prototype.setDetailBox=function(t){var e=this.getDetailBox();if(t){if(t===e){return this}if(e){this.detachPress(this._fnLightBoxOpen,e)}this._fnLightBoxOpen=t.open;this.attachPress(this._fnLightBoxOpen,t)}else if(this._fnLightBoxOpen){this.detachPress(this._fnLightBoxOpen,e);this._fnLightBoxOpen=null}return this.setAggregation("detailBox",t)};l.prototype.clone=function(){var t=i.prototype.clone.apply(this,arguments),e=t.getDetailBox();if(e){t.detachPress(this._fnLightBoxOpen,this.getDetailBox());t._fnLightBoxOpen=e.open;t.attachPress(t._fnLightBoxOpen,e)}return t};l.prototype.attachPress=function(){Array.prototype.unshift.apply(arguments,["press"]);i.prototype.attachEvent.apply(this,arguments);if(this.hasListeners("press")){this.$().attr("tabindex","0");this.$().attr("role","button")}return this};l.prototype.detachPress=function(){Array.prototype.unshift.apply(arguments,["press"]);i.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners("press")){this.$().removeAttr("tabindex");this.$().removeAttr("role")}return this};l.prototype.ontap=function(){this.firePress({})};l.prototype.onkeyup=function(e){if(e.which===t.sap.KeyCodes.SPACE||e.which===t.sap.KeyCodes.ENTER){this.firePress({});e.stopPropagation()}};l.prototype._areInitialsValid=function(e){var i=/^[a-zA-Z]{1,2}$/;if(!i.test(e)){t.sap.log.warning("Initials should consist of only 1 or 2 latin letters",this);this._sActualType=r.Icon;this._bIsDefaultIcon=true;return false}return true};l.prototype._validateSrc=function(t){if(a.isIconURI(t)){this._sActualType=r.Icon;this._bIsDefaultIcon=false}else{this._sActualType=r.Image}return this};l.prototype._getActualDisplayType=function(){var e=this.getSrc(),i=this.getInitials();if(e){this._validateSrc(e)}else if(i&&this._areInitialsValid(i)){this._sActualType=r.Initials}else{t.sap.log.warning("No src and initials were provided",this);this._sActualType=r.Icon;this._bIsDefaultIcon=true}return this._sActualType};l.prototype._getDefaultIconPath=function(t){var e=null;if(t===p.Circle){e=l.DEFAULT_CIRCLE_PLACEHOLDER}else if(t===p.Square){e=l.DEFAULT_SQUARE_PLACEHOLDER}return e};l.prototype._getIcon=function(){var t=this.getSrc(),e=this.getDisplayShape();if(this._bIsDefaultIcon){t=this._getDefaultIconPath(e)}if(!this._icon){this._icon=a.createControlByURI({alt:"Image placeholder",src:t})}else if(this._icon.getSrc()!==t){this._icon.setSrc(t)}return this._icon};l.prototype._getEscapedSrc=function(){var t=this.getSrc();if(!t){return""}return t.replace(/'/g,"\\'")};l.prototype.getAccessibilityInfo=function(){var t=this.hasListeners("press");if(!t){return null}return{role:t?"button":"img",type:sap.ui.getCore().getLibraryResourceBundle("sap.f").getText(t?"ACC_CTR_TYPE_BUTTON":"ACC_CTR_TYPE_IMAGE"),focusable:t}};return l});