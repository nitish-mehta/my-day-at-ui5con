/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/m/InstanceManager","sap/f/FlexibleColumnLayout","sap/ui/base/Object","sap/ui/core/routing/History"],function(e,t,i,o,a){"use strict";var n=o.extend("sap.f.routing.TargetHandler",{constructor:function(e){this._aQueue=[];this._oNavigationOrderPromise=Promise.resolve();if(e===undefined){this._bCloseDialogs=true}else{this._bCloseDialogs=!!e}}});n.prototype.setCloseDialogs=function(e){this._bCloseDialogs=!!e;return this};n.prototype.getCloseDialogs=function(){return this._bCloseDialogs};n.prototype.addNavigation=function(e){this._aQueue.push(e)};n.prototype.navigate=function(e){var t=this._createResultingNavigations(e.navigationIdentifier),i=false,o=this._getDirection(e),a;while(t.length){a=this._applyNavigationResult(t.shift().oParams,o);i=i||a}if(i){this._closeDialogs()}};n.prototype._chainNavigation=function(e){this._oNavigationOrderPromise=this._oNavigationOrderPromise.then(e);return this._oNavigationOrderPromise};n.prototype._getDirection=function(e){var t=e.viewLevel,i=a.getInstance(),o=false;if(e.direction==="Backwards"){o=true}else if(isNaN(t)||isNaN(this._iCurrentViewLevel)||t===this._iCurrentViewLevel){if(e.askHistory){o=i.getDirection()==="Backwards"}}else{o=t<this._iCurrentViewLevel}this._iCurrentViewLevel=t;return o};n.prototype._createResultingNavigations=function(e){var t,i,o,a,n=[],s;while(this._aQueue.length){i=this._aQueue.shift();o=i.targetControl;a={oContainer:o,oParams:i};for(t=0;t<n.length;t++){s=n[t];if(s.oContainer!==o){continue}}n.push(a)}return n};n.prototype._applyNavigationResult=function(t,o){var a=t.targetControl,n=t.eventData,s=t.transition||"",r=t.transitionParameters,l=t.view.getId(),u,g=a instanceof i,f=false;if(g){u=[a.getCurrentBeginColumnPage(),a.getCurrentMidColumnPage(),a.getCurrentEndColumnPage()];f=u.some(function(e){return e&&e.getId()===l})}if(f){e.sap.log.info("navigation to view with id: "+l+" is skipped since it already is displayed by its targetControl","sap.f.routing.TargetHandler");return false}e.sap.log.info("navigation to view with id: "+l+" the targetControl is "+a.getId()+" backwards is "+o);if(o){a._safeBackToPage(l,s,n,r)}else{a.to(l,s,n,r)}return true};n.prototype._closeDialogs=function(){if(!this._bCloseDialogs){return}if(t.hasOpenPopover()){t.closeAllPopovers()}if(t.hasOpenDialog()){t.closeAllDialogs()}if(t.hasOpenLightBox()){t.closeAllLightBoxes()}};return n});