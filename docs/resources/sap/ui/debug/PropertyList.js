/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define("sap/ui/debug/PropertyList",["jquery.sap.global","sap/ui/base/DataType","sap/ui/base/EventProvider","sap/ui/core/Element","sap/ui/core/ElementMetadata","jquery.sap.strings","jquery.sap.encoder"],function(jQuery,DataType,EventProvider,Element,ElementMetadata){"use strict";var PropertyList=EventProvider.extend("sap.ui.debug.PropertyList",{constructor:function(e,t,i){EventProvider.apply(this,arguments);this.oWindow=t;this.oParentDomRef=i;this.oCore=e;this.bEmbedded=top.window==t;this.mProperties={};var r=this;jQuery(i).bind("click",function(e){r.onclick(e)}).bind("focusin",function(e){r.onfocus(e)}).bind("keydown",function(e){r.onkeydown(e)});if(!this.bEmbedded){jQuery(i).bind("mouseover",function(e){r.onmouseover(e)}).bind("mouseout",function(e){r.onmouseout(e)})}this.oParentDomRef.style.border="solid 1px gray";this.oParentDomRef.style.padding="2px"}});PropertyList.prototype.exit=function(){jQuery(this.oParentDomRef).unbind()};PropertyList.prototype.update=function(e){var t=e.getParameter("controlId");this.oParentDomRef.innerHTML="";var i=this.oCore.byId(t);if(!i){this.oParentDomRef.innerHTML="Please select a valid control";return}if(!i.getMetadata||!i.getMetadata()){this.oParentDomRef.innerHTML="Control does not provide Metadata.";return}this.mProperties={};var r=i.getMetadata(),o=[];o.push("<span data-sap-ui-quickhelp='"+this._calcHelpId(r)+"'>Type : "+r.getName()+"</span><br >");o.push("Id : "+i.getId()+"<br >");o.push("<button id='sap-debug-propertylist-apply' sap-id='"+t+"' style='border:solid 1px gray;background-color:#d0d0d0;font-size:8pt;'>Apply Changes</button>");if(!this.bEmbedded){o.push("<div id='sap-ui-quickhelp' style='position:fixed;display:none;padding:5px;background-color:rgb(200,220,231);border:1px solid gray;overflow:hidden'>Help</div>")}o.push("<div style='border-bottom:1px solid gray'>&nbsp;</div><table cellspacing='1' style='font-size:8pt;width:100%;table-layout:fixed'>");while(r instanceof ElementMetadata){var s=r.getProperties();var p=false;if(!jQuery.isEmptyObject(s)){if(!p&&r!==i.getMetadata()){o.push('<tr><td colspan="2">BaseType: ');o.push(r.getName());o.push("</td></tr>");p=true}this.printProperties(o,i,s)}var s=this.getAggregationsAsProperties(r);if(!jQuery.isEmptyObject(s)){if(!p&&r!==i.getMetadata()){o.push('<tr><td colspan="2">BaseType: ');o.push(r.getName());o.push("</td></tr>");p=true}this.printProperties(o,i,s)}r=r.getParent()}o.push("</table>");this.oParentDomRef.innerHTML=o.join("");this.mHelpDocs={}};PropertyList.prototype.getAggregationsAsProperties=function(e){function t(e){if(!e){return false}if(e.indexOf("[]")>0){e=e.substring(e.indexOf("[]"))}if(e==="boolean"||e==="string"||e==="int"||e==="float"){return true}if(e==="void"){return false}return false}var i={};for(var r in e.getAggregations()){var o=e.getAggregations()[r];if(o.altTypes&&o.altTypes[0]&&t(o.altTypes[0])){i[r]={name:r,type:o.altTypes[0],_oParent:o._oParent}}}return i};PropertyList.prototype.printProperties=function(e,t,i,r){for(var o in i){var s=o,p=i[o].type,a=t["get"+s];if(!a){s=jQuery.sap.charToUpperCase(s,0)}var n=t["get"+s]();e.push("<tr><td>");this.mProperties[s]=p;e.push("<span data-sap-ui-quickhelp='",this._calcHelpId(i[o]._oParent,o),"' >",s,"</span>");e.push("</td><td>");var u="";if(p=="string"||p=="int"||p=="float"||jQuery.sap.endsWith(p,"[]")){var l="";if(n===null){l="color:#a5a5a5;";n="(null)"}else if(n instanceof Element){l="color:#a5a5a5;";if(Array.isArray(n)){n=n.join(", ")}else{n=n.toString()}u=' title="This aggregation currently references an Element. You can set a '+p+' value instead"'}e.push("<input type='text' style='width:100%;font-size:8pt;background-color:#f5f5f5;"+l+"' value='"+jQuery.sap.encodeHTML(""+n)+"'"+u+" sap-name='"+s+"'/>")}else if(p=="boolean"){e.push("<input type='checkbox' sap-name='"+s+"' ");if(n==true){e.push("checked='checked'")}e.push("/>")}else if(p!="void"){var d=jQuery.sap.getObject(p);if(!d||d instanceof DataType){e.push("<input type='text' style='width:100%;font-size:8pt;background-color:#f5f5f5;' value='"+jQuery.sap.encodeHTML(""+n)+"'"+u+" sap-name='"+s+"'/>")}else{e.push("<select style='width:100%;font-size:8pt;background-color:#f5f5f5;' sap-name='"+s+"'>");p=p.replace("/",".");for(var c in d){e.push("<option ");if(c==n){e.push(" selected ")}e.push("value='"+p+"."+c+"'>");e.push(c);e.push("</option>")}e.push("</select>")}}else{e.push("&nbsp;")}e.push("</td></tr>")}};PropertyList.prototype.onkeydown=function(e){if(e.keyCode==13){this.applyChanges("sap-debug-propertylist-apply")}};PropertyList.prototype.onclick=function(e){var t=e.target;if(t.id=="sap-debug-propertylist-apply"){this.applyChanges("sap-debug-propertylist-apply")}};PropertyList.prototype.onfocus=function(e){var t=e.target;if(t.tagName==="INPUT"&&t.getAttribute("sap-name")){if(t.style.color==="#a5a5a5"){t.style.color="";t.value=""}}};PropertyList.prototype.applyChanges=function(sId){var oSource=this.oParentDomRef.ownerDocument.getElementById(sId),sControlId=oSource.getAttribute("sap-id"),oControl=this.oCore.byId(sControlId),aInput=oSource.parentNode.getElementsByTagName("INPUT"),aSelect=oSource.parentNode.getElementsByTagName("SELECT"),oMethod;for(var i=0;i<aInput.length;i++){var oInput=aInput[i],sName=oInput.getAttribute("sap-name");oMethod=oControl["set"+sName];if(!oMethod){sName=jQuery.sap.charToUpperCase(sName,0)}if(oControl["set"+sName]){var oType=DataType.getType(this.mProperties[sName]);var vValue=this.mProperties[sName]==="boolean"?oInput.checked:oType.parseValue(oInput.value);if(oType.isValid(vValue)&&vValue!=="(null)"){oControl["set"+sName](vValue)}}}for(var i=0;i<aSelect.length;i++){var oSelect=aSelect[i],sName=oSelect.getAttribute("sap-name");oMethod=oControl["set"+sName];if(!oMethod){sName=jQuery.sap.charToUpperCase(sName,0)}var oValue=null;if(oSelect.value){eval("oValue = "+oSelect.value);oControl["set"+sName](oValue)}}this.oCore.applyChanges()};PropertyList.prototype.showQuickHelp=function(e){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var t=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(t){this.sCurrentHelpId=e.getAttribute("data-sap-ui-quickhelp");var i=jQuery(e).rect();t.style.left=i.left+40+10+"px";t.style.top=i.top-40+"px";t.style.display="block";t.style.opacity="0.2";t.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=20)";if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{t.innerHTML="<b>Quickhelp</b> for "+this.sCurrentHelpId+" is being retrieved...";this.sCurrentHelpDoc=this.sCurrentHelpId;this.sCurrentHelpDocPart=undefined;if(this.sCurrentHelpId.indexOf("#")>=0){this.sCurrentHelpDoc=this.sCurrentHelpId.substring(0,this.sCurrentHelpId.indexOf("#"));this.sCurrentHelpDocPart=this.sCurrentHelpId.substring(this.sCurrentHelpId.indexOf("#")+1)}var r=this.oWindow.jQuery.sap.getModulePath(this.sCurrentHelpDoc,".control");var o=this;jQuery.ajax({url:r,dataType:"xml",error:function(e,t){o.receiveQuickHelp(undefined)},success:function(e){o.receiveQuickHelp(e)}});this.oQuickHelpTimer=setTimeout(function(){o.hideQuickHelp()},2e3)}}};PropertyList.prototype.receiveQuickHelp=function(e){if(e){var t=e.getElementsByTagName("control")[0];if(t){var i=function(e,t){var i=[];var r=e.firstChild;while(r){if(t===r.nodeName){i.push(r)}r=r.nextSibling}return i};var r=i(t,"name");var o="";if(r[0]){o=r[0].text||r[0].textContent}var s=i(t,"documentation");if(s[0]){if(o&&s[0]){var p=[];p.push("<div style='font-size:10pt;font-weight:bold;padding:5px 0px;margin-bottom:5px;border-bottom:1px solid gray'>",o.replace("/","."),"</div>");p.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");this.mHelpDocs[this.sCurrentHelpDoc]=p.join("")}}var a=i(t,"properties");if(a[0]){a=i(a[0],"property")}for(var n=0,u=a.length;n<u;n++){var l=a[n];var o=l.getAttribute("name");var d=l.getAttribute("type")||"string";var c=l.getAttribute("defaultValue")||"empty/undefined";var s=i(l,"documentation");if(o&&s[0]){var p=[];p.push("<div style='font-size:10pt;font-weight:bold;padding:3px 0px;margin-bottom:3px;border-bottom:1px solid gray'>",o,"</div>");p.push("<div style='padding:2px 0px;'><i><strong>Type</strong></i>: ",d,"</div>");p.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");p.push("<div style='padding:2px 0px;'><i><strong>Default Value</strong></i>: ",c,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]=p.join("")}}var a=i(t,"aggregations");if(a[0]){a=i(a[0],"aggregation")}for(var n=0,u=a.length;n<u;n++){var l=a[n];var o=l.getAttribute("name");var d=l.getAttribute("type")||"sap.ui.core/Control";var c=l.getAttribute("defaultValue")||"empty/undefined";var s=i(l,"documentation");if(o&&s[0]&&!this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]){var p=[];p.push("<div style='font-size:10pt;font-weight:bold;padding:3px 0px;margin-bottom:3px;border-bottom:1px solid gray'>",o,"</div>");p.push("<div style='padding:2px 0px;'><i><strong>Type</strong></i>: ",d,"</div>");p.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");p.push("<div style='padding:2px 0px;'><i><strong>Default Value</strong></i>: ",c,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]=p.join("")}}}if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{this.updateQuickHelp(undefined,0)}}else{this.updateQuickHelp(undefined,0)}};PropertyList.prototype.updateQuickHelp=function(e,t){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){if(!e){i.innerHTML="<i>No quick help...</i>";i.style.display="none"}else{i.innerHTML=e;var r=this;this.oQuickHelpTimer=setTimeout(function(){r.hideQuickHelp()},t)}}};PropertyList.prototype.hideQuickHelp=function(){var e=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(e){e.style.display="none"}this.bMovedOverTooltip=false};PropertyList.prototype._calcHelpId=function(e,t){var i=e.getName();if(t){i=i+"#"+t}return i};PropertyList.prototype._isChildOfQuickHelp=function(e){while(e){if(e.id==="sap-ui-quickhelp"){return true}e=e.parentNode}return false};PropertyList.prototype.onmouseover=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=true;var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){i.style.opacity="";i.style.filter=""}}else if(t.getAttribute("data-sap-ui-quickhelp")){this.showQuickHelp(t)}};PropertyList.prototype.onmouseout=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=false;var i=this;this.oQuickHelpTimer=setTimeout(function(){i.hideQuickHelp()},50)}else if(t.getAttribute("data-sap-ui-quickhelp")){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}if(!this.bMovedOverTooltip){var i=this;this.oQuickHelpTimer=setTimeout(function(){i.hideQuickHelp()},800)}}};return PropertyList});