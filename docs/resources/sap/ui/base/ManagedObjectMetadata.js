/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./DataType","./Metadata"],function(t,e,i){"use strict";var r=function(t,e){i.apply(this,arguments)};r.prototype=Object.create(i.prototype);var n=Object.prototype.hasOwnProperty;function s(t){return t.charAt(0).toUpperCase()+t.slice(1)}var o=/(children|ies|ves|oes|ses|ches|shes|xes|s)$/i;var a={children:-3,ies:"y",ves:"f",oes:-2,ses:-2,ches:-2,shes:-2,xes:-2,s:-1};function g(t){return t.replace(o,function(t,e){var i=a[e.toLowerCase()];return typeof i==="string"?i:e.slice(0,i)})}function u(e,i){return function(){t.sap.log.warning("Usage of deprecated feature: "+i);return e.apply(this,arguments)}}function l(t,e){var i=null;for(var r in e){if(n.call(e,r)&&typeof t[r]==="undefined"){i=i||{};i[r]=e[r]}}return i}var p={SPECIAL_SETTING:-1,PROPERTY:0,SINGLE_AGGREGATION:1,MULTIPLE_AGGREGATION:2,SINGLE_ASSOCIATION:3,MULTIPLE_ASSOCIATION:4,EVENT:5};r._guessSingularName=g;function h(t,e,i){i=typeof i!=="object"?{type:i}:i;this.name=e;this.type=i.type||"any";this.visibility=i.visibility||"public";this.defaultValue=i.defaultValue;this.appData=l(this,i);this._oParent=t;this._sUID="special:"+e;this._iKind=p.SPECIAL_SETTING}function f(t,e,i){i=typeof i!=="object"?{type:i}:i;this.name=e;this.type=i.type||"string";this.group=i.group||"Misc";this.defaultValue=i.defaultValue!==null?i.defaultValue:null;this.bindable=!!i.bindable;this.deprecated=!!i.deprecated||false;this.visibility="public";this.selector=typeof i.selector==="string"?i.selector:null;this.appData=l(this,i);this._oParent=t;this._sUID=e;this._iKind=p.PROPERTY;var r=s(e);this._sMutator="set"+r;this._sGetter="get"+r;if(this.bindable){this._sBind="bind"+r;this._sUnbind="unbind"+r}else{this._sBind=this._sUnbind=undefined}this._oType=null}f.prototype.generate=function(t){var e=this,i=e.name;t(e._sGetter,function(){return this.getProperty(i)});t(e._sMutator,function(t){this.setProperty(i,t);return this},e);if(e.bindable){t(e._sBind,function(t,e,r){this.bindProperty(i,t,e,r);return this},e);t(e._sUnbind,function(t){this.unbindProperty(i,t);return this})}};f.prototype.getType=function(){return this._oType||(this._oType=e.getType(this.type))};f.prototype.getDefaultValue=function(){var t=this.defaultValue,i;if(t===null){i=this.getType();if(i instanceof e){t=i.getDefaultValue()}}return t};f.prototype.get=function(t){return t[this._sGetter]()};f.prototype.set=function(t,e){return t[this._sMutator](e)};function c(t,e,i){i=typeof i!=="object"?{type:i}:i;this.name=e;this.type=i.type||"sap.ui.core.Control";this.altTypes=i.altTypes||undefined;this.multiple=typeof i.multiple==="boolean"?i.multiple:true;this.singularName=this.multiple?i.singularName||g(e):undefined;this.bindable=!!i.bindable;this.deprecated=i.deprecated||false;this.visibility=i.visibility||"public";this.selector=i.selector||null;this.forwarding=i.forwarding;this._doesNotRequireFactory=!!i._doesNotRequireFactory;this.appData=l(this,i);this._oParent=t;this._sUID="aggregation:"+e;this._iKind=this.multiple?p.MULTIPLE_AGGREGATION:p.SINGLE_AGGREGATION;this._oForwarder=this.forwarding?new d(this):undefined;var r=s(e);this._sGetter="get"+r;if(this.multiple){var n=s(this.singularName);this._sMutator="add"+n;this._sInsertMutator="insert"+n;this._sRemoveMutator="remove"+n;this._sRemoveAllMutator="removeAll"+r;this._sIndexGetter="indexOf"+n;this._sUpdater="update"+r;this._sRefresher="refresh"+r}else{this._sMutator="set"+r;this._sInsertMutator=this._sRemoveMutator=this._sRemoveAllMutator=this._sIndexGetter=this._sUpdater=this._sRefresher=undefined}this._sDestructor="destroy"+r;if(this.bindable){this._sBind="bind"+r;this._sUnbind="unbind"+r}else{this._sBind=this._sUnbind=undefined}}c.prototype.generate=function(t){var e=this,i=e.name;if(!e.multiple){t(e._sGetter,function(){return this.getAggregation(i)});t(e._sMutator,function(t){this.setAggregation(i,t);return this},e)}else{t(e._sGetter,function(){return this.getAggregation(i,[])});t(e._sMutator,function(t){this.addAggregation(i,t);return this},e);t(e._sInsertMutator,function(t,e){this.insertAggregation(i,t,e);return this},e);t(e._sRemoveMutator,function(t){return this.removeAggregation(i,t)});t(e._sRemoveAllMutator,function(){return this.removeAllAggregation(i)});t(e._sIndexGetter,function(t){return this.indexOfAggregation(i,t)})}t(e._sDestructor,function(){this.destroyAggregation(i);return this});if(e.bindable){t(e._sBind,function(t,e,r,n){this.bindAggregation(i,t,e,r,n);return this},e);t(e._sUnbind,function(t){this.unbindAggregation(i,t);return this})}};c.prototype.getType=function(){return this._oType||(this._oType=e.getType(this.type))};c.prototype.get=function(t){return t[this._sGetter]()};c.prototype.set=function(t,e){return t[this._sMutator](e)};c.prototype.add=function(t,e){return t[this._sMutator](e)};c.prototype.insert=function(t,e,i){return t[this._sInsertMutator](e,i)};c.prototype.remove=function(t,e){return t[this._sRemoveMutator](e)};c.prototype.removeAll=function(t){return t[this._sRemoveAllMutator]()};c.prototype.indexOf=function(t,e){return t[this._sIndexGetter](e)};c.prototype.destroy=function(t){return t[this._sDestructor]()};function d(t){var e=t.forwarding;this.aggregation=t;this.targetAggregationName=e.aggregation;this.forwardBinding=e.forwardBinding;this.targetAggregationInfo=null;if(e.getter){if(typeof e.getter==="function"){this._getTarget=e.getter}else{this._getTarget=function(t){return function(){return this[t]()}}(e.getter)}}else if(e.idSuffix){this._getTarget=function(t){return function(){return sap.ui.getCore().byId(this.getId()+t)}}(e.idSuffix)}else{throw new Error("Either getter or idSuffix must be given for forwarding the aggregation "+t.name+" to the aggregation "+e.aggregation+" in "+t._oParent.getName())}}d.prototype._getTargetAggregationInfo=function(t){var e=this.targetAggregationInfo;if(!e){e=this.targetAggregationInfo=t.getMetadata().getAggregation(this.targetAggregationName);if(!e){throw new Error("Target aggregation "+this.targetAggregationName+" not found on "+t)}if(this.aggregation.multiple!==e.multiple){throw new Error("Aggregation "+this.aggregation+" (multiple: "+this.aggregation.multiple+") cannot be forwarded to aggregation "+this.targetAggregationName+" (multiple: "+e.multiple+")")}}return e};d.prototype.getTarget=function(t){var e=this._getTarget.call(t);this._getTargetAggregationInfo(e);return e};d.prototype.get=function(t){var e=this.getTarget(t);if(e){return this.targetAggregationInfo.get(e)}else{return this.targetAggregationInfo.multiple?[]:null}};d.prototype.indexOf=function(t,e){var i=this.getTarget(t);return this.targetAggregationInfo.multiple?this.targetAggregationInfo.indexOf(i,e):i.indexOfAggregation(this.targetAggregationName,e)};d.prototype.set=function(t,e){var i=this.getTarget(t);r.addAPIParentInfo(e,t,this.aggregation.name);this.targetAggregationInfo.set(i,e);return t};d.prototype.add=function(t,e){var i=this.getTarget(t);r.addAPIParentInfo(e,t,this.aggregation.name);this.targetAggregationInfo.add(i,e);return t};d.prototype.insert=function(t,e,i){var n=this.getTarget(t);r.addAPIParentInfo(e,t,this.aggregation.name);this.targetAggregationInfo.insert(n,e,i);return t};function m(t,e){while(t&&t!==e){t=t.oParent}return!!t}r.addAPIParentInfo=function(t,e,i){if(!t){return}var r={parent:e,aggregationName:i};if(!t.aAPIParentInfos){t.aAPIParentInfos=[r]}else{var n=t.aAPIParentInfos[t.aAPIParentInfos.length-1];if(n&&!m(e,n.parent)){t.aAPIParentInfos=[]}t.aAPIParentInfos.push(r)}};d.prototype.remove=function(t,e){var i=this.getTarget(t);var r=this.targetAggregationInfo.remove(i,e);if(r){r.aAPIParentInfos.pop()}return r};d.prototype.removeAll=function(t){var e=this.getTarget(t);var i=this.targetAggregationInfo.removeAll(e);for(var r=0;r<i.length;r++){if(i[r].aAPIParentInfos){i[r].aAPIParentInfos.pop()}}return i};d.prototype.destroy=function(t){var e=this.getTarget(t);this.targetAggregationInfo.destroy(e);return t};function _(t,e,i){i=typeof i!=="object"?{type:i}:i;this.name=e;this.type=i.type||"sap.ui.core.Control";this.multiple=i.multiple||false;this.singularName=this.multiple?i.singularName||g(e):undefined;this.deprecated=i.deprecated||false;this.visibility="public";this.appData=l(this,i);this._oParent=t;this._sUID="association:"+e;this._iKind=this.multiple?p.MULTIPLE_ASSOCIATION:p.SINGLE_ASSOCIATION;var r=s(e);this._sGetter="get"+r;if(this.multiple){var n=s(this.singularName);this._sMutator="add"+n;this._sRemoveMutator="remove"+n;this._sRemoveAllMutator="removeAll"+r}else{this._sMutator="set"+r;this._sRemoveMutator=this._sRemoveAllMutator=undefined}}_.prototype.generate=function(e){var i=this,r=i.name;if(!i.multiple){e(i._sGetter,function(){return this.getAssociation(r)});e(i._sMutator,function(t){this.setAssociation(r,t);return this},i)}else{e(i._sGetter,function(){return this.getAssociation(r,[])});e(i._sMutator,function(t){this.addAssociation(r,t);return this},i);e(i._sRemoveMutator,function(t){return this.removeAssociation(r,t)});e(i._sRemoveAllMutator,function(){return this.removeAllAssociation(r)});if(r!==i.singularName){e("removeAll"+s(i.singularName),function(){t.sap.log.warning("Usage of deprecated method "+i._oParent.getName()+".prototype."+"removeAll"+s(i.singularName)+","+" use method "+i._sRemoveAllMutator+" (plural) instead.");return this[i._sRemoveAllMutator]()})}}};_.prototype.getType=function(){return this._oType||(this._oType=e.getType(this.type))};_.prototype.get=function(t){return t[this._sGetter]()};_.prototype.set=function(t,e){return t[this._sMutator](e)};_.prototype.remove=function(t,e){return t[this._sRemoveMutator](e)};_.prototype.removeAll=function(t){return t[this._sRemoveAllMutator]()};function y(t,e,i){this.name=e;this.allowPreventDefault=i.allowPreventDefault||false;this.deprecated=i.deprecated||false;this.visibility="public";this.allowPreventDefault=!!i.allowPreventDefault;this.enableEventBubbling=!!i.enableEventBubbling;this.appData=l(this,i);this._oParent=t;this._sUID="event:"+e;this._iKind=p.EVENT;var r=s(e);this._sMutator="attach"+r;this._sDetachMutator="detach"+r;this._sTrigger="fire"+r}y.prototype.generate=function(t){var e=this,i=e.name,r=e.allowPreventDefault,n=e.enableEventBubbling;t(e._sMutator,function(t,e,r){this.attachEvent(i,t,e,r);return this},e);t(e._sDetachMutator,function(t,e){this.detachEvent(i,t,e);return this});t(e._sTrigger,function(t){return this.fireEvent(i,t,r,n)})};y.prototype.attach=function(t,e,i,r){return t[this._sMutator](e,i,r)};y.prototype.detach=function(t,e,i){return t[this._sDetachMutator](e,i)};y.prototype.fire=function(t,e,i,r){return t[this._sTrigger](e,i,r)};r.prototype.metaFactorySpecialSetting=h;r.prototype.metaFactoryProperty=f;r.prototype.metaFactoryAggregation=c;r.prototype.metaFactoryAssociation=_;r.prototype.metaFactoryEvent=y;r.prototype.applySettings=function(t){var e=this,r=t.metadata;i.prototype.applySettings.call(this,t);function s(t,i){var r={},s;if(t){for(s in t){if(n.call(t,s)){r[s]=new i(e,s,t[s])}}}return r}function o(t,e){var i={},r;for(r in t){if(e===(t[r].visibility==="public")){i[r]=t[r]}}return i}var a=/([a-z][^.]*(?:\.[a-z][^.]*)*)\./;function g(t){var e=a.exec(t);return e&&e[1]||""}this._sLibraryName=r.library||g(this.getName());this._mSpecialSettings=s(r.specialSettings,this.metaFactorySpecialSetting);this._mProperties=s(r.properties,this.metaFactoryProperty);var u=s(r.aggregations,this.metaFactoryAggregation);this._mAggregations=o(u,true);this._mPrivateAggregations=o(u,false);this._sDefaultAggregation=r.defaultAggregation||null;this._sDefaultProperty=r.defaultProperty||null;this._mAssociations=s(r.associations,this.metaFactoryAssociation);this._mEvents=s(r.events,this.metaFactoryEvent);this._oDesignTime=t.metadata["designtime"]||t.metadata["designTime"];if(t.metadata.__version>1){this.generateAccessors()}};r.prototype.afterApplySettings=function(){i.prototype.afterApplySettings.call(this);var e=this.getParent();if(e instanceof r){this._mAllEvents=t.extend({},e._mAllEvents,this._mEvents);this._mAllProperties=t.extend({},e._mAllProperties,this._mProperties);this._mAllPrivateAggregations=t.extend({},e._mAllPrivateAggregations,this._mPrivateAggregations);this._mAllAggregations=t.extend({},e._mAllAggregations,this._mAggregations);this._mAllAssociations=t.extend({},e._mAllAssociations,this._mAssociations);this._sDefaultAggregation=this._sDefaultAggregation||e._sDefaultAggregation;this._sDefaultProperty=this._sDefaultProperty||e._sDefaultProperty;this._mAllSpecialSettings=t.extend({},e._mAllSpecialSettings,this._mSpecialSettings)}else{this._mAllEvents=this._mEvents;this._mAllProperties=this._mProperties;this._mAllPrivateAggregations=this._mPrivateAggregations;this._mAllAggregations=this._mAggregations;this._mAllAssociations=this._mAssociations;this._mAllSpecialSettings=this._mSpecialSettings}};r.Kind=p;r.prototype.getLibraryName=function(){return this._sLibraryName};r.prototype.addProperty=function(t,e){var i=this._mProperties[t]=new f(this,t,e);if(!this._mAllProperties[t]){this._mAllProperties[t]=i}};r.prototype.hasProperty=function(t){return!!this._mAllProperties[t]};r.prototype.getProperty=function(t){var e=this._mAllProperties[t];return typeof e==="object"?e:undefined};r.prototype.getProperties=function(){return this._mProperties};r.prototype.getAllProperties=function(){return this._mAllProperties};r.prototype.hasAggregation=function(t){return!!this._mAllAggregations[t]};r.prototype.getAggregation=function(t){t=t||this._sDefaultAggregation;var e=t?this._mAllAggregations[t]:undefined;return typeof e==="object"?e:undefined};r.prototype.getAggregations=function(){return this._mAggregations};r.prototype.getAllAggregations=function(){return this._mAllAggregations};r.prototype.getAllPrivateAggregations=function(){return this._mAllPrivateAggregations};r.prototype.getManagedAggregation=function(t){t=t||this._sDefaultAggregation;var e=t?this._mAllAggregations[t]||this._mAllPrivateAggregations[t]:undefined;return typeof e==="object"?e:undefined};r.prototype.getDefaultAggregationName=function(){return this._sDefaultAggregation};r.prototype.getDefaultAggregation=function(){return this.getAggregation()};r.prototype.forwardAggregation=function(t,e){var i=this.getAggregation(t);if(!i){throw new Error("aggregation "+t+" does not exist")}if(!e||!e.aggregation||!(e.idSuffix||e.getter)||e.idSuffix&&e.getter){throw new Error("an 'mOptions' object with 'aggregation' property and either 'idSuffix' or 'getter' property (but not both) must be given"+" but does not exist")}if(i._oParent===this){i.forwarding=e;i._oForwarder=new d(i)}else{i=new this.metaFactoryAggregation(this,t,{type:i.type,altTypes:i.altTypes,multiple:i.multiple,singularName:i.singularName,bindable:i.bindable,deprecated:i.deprecated,visibility:i.visibility,selector:i.selector,forwarding:e});this._mAggregations[t]=this._mAllAggregations[t]=i}};r.prototype.getAggregationForwarder=function(t){var e=this._mAllAggregations[t];return e?e._oForwarder:undefined};r.prototype.getDefaultPropertyName=function(){return this._sDefaultProperty};r.prototype.getDefaultProperty=function(){return this.getProperty(this.getDefaultPropertyName())};r.prototype.getPropertyLikeSetting=function(t){var e=this._mAllProperties[t];if(typeof e==="object"){return e}e=this._mAllAggregations[t];return typeof e==="object"&&e.altTypes&&e.altTypes.length>0?e:undefined};r.prototype.hasAssociation=function(t){return!!this._mAllAssociations[t]};r.prototype.getAssociation=function(t){var e=this._mAllAssociations[t];return typeof e==="object"?e:undefined};r.prototype.getAssociations=function(){return this._mAssociations};r.prototype.getAllAssociations=function(){return this._mAllAssociations};r.prototype.hasEvent=function(t){return!!this._mAllEvents[t]};r.prototype.getEvent=function(t){var e=this._mAllEvents[t];return typeof e==="object"?e:undefined};r.prototype.getEvents=function(){return this._mEvents};r.prototype.getAllEvents=function(){return this._mAllEvents};r.prototype.addSpecialSetting=function(t,e){var i=new h(this,t,e);this._mSpecialSettings[t]=i;if(!this._mAllSpecialSettings[t]){this._mAllSpecialSettings[t]=i}};r.prototype.hasSpecialSetting=function(t){return!!this._mAllSpecialSettings[t]};r.prototype.getPropertyDefaults=function(){var e=this._mDefaults;if(e){return e}if(this.getParent()instanceof r){e=t.extend({},this.getParent().getPropertyDefaults())}else{e={}}for(var i in this._mProperties){e[i]=this._mProperties[i].getDefaultValue()}this._mDefaults=e;return e};r.prototype.createPropertyBag=function(){if(!this._fnPropertyBagFactory){this._fnPropertyBagFactory=function t(){};this._fnPropertyBagFactory.prototype=this.getPropertyDefaults()}return new this._fnPropertyBagFactory};r.prototype._enrichChildInfos=function(){t.sap.log.error("obsolete call to ManagedObjectMetadata._enrichChildInfos. This private method will be deleted soon")};r.prototype.getJSONKeys=function(){if(this._mJSONKeys){return this._mJSONKeys}var t={},e={};function i(i){var r,n,s;for(r in i){n=i[r];s=t[r];if(!s||n._iKind<s._iKind){t[r]=e[r]=n}e[n._sUID]=n}}i(this._mAllSpecialSettings);i(this.getAllProperties());i(this.getAllAggregations());i(this.getAllAssociations());i(this.getAllEvents());this._mJSONKeys=e;this._mAllSettings=t;return this._mJSONKeys};r.prototype.getAllSettings=function(){if(!this._mAllSettings){this.getJSONKeys()}return this._mAllSettings};r.prototype.removeUnknownSettings=function(e){t.sap.assert(e==null||typeof e==="object","mSettings must be null or an object");if(e==null){return e}var i=this.getJSONKeys(),r={},s;for(s in e){if(n.call(i,s)){r[s]=e[s]}}return r};r.prototype.generateAccessors=function(){var t=this.getClass().prototype,e=this.getName()+".",i=this._aPublicMethods,r;function n(r,n,s){if(!t[r]){t[r]=s&&s.deprecated?u(n,e+s.name):n}i.push(r)}for(r in this._mProperties){this._mProperties[r].generate(n)}for(r in this._mAggregations){this._mAggregations[r].generate(n)}for(r in this._mAssociations){this._mAssociations[r].generate(n)}for(r in this._mEvents){this._mEvents[r].generate(n)}};function A(e){var i=e.getLibraryName(),r=sap.ui.getCore().getConfiguration().getPreload(),n=sap.ui.getCore().getLoadedLibraries()[i];if(n&&n.designtime){var s;if(r==="async"||r==="sync"){s=t.sap._loadJSResourceAsync(n.designtime.replace(/\.designtime$/,"-preload.designtime.js"),true)}else{s=Promise.resolve()}return new Promise(function(t){s.then(function(){sap.ui.require([n.designtime],function(e){t(e)})})})}return Promise.resolve(null)}function v(e){if(t.isPlainObject(e._oDesignTime)||!e._oDesignTime){return Promise.resolve(e._oDesignTime||{})}return new Promise(function(i){var r;if(typeof e._oDesignTime==="string"){r=e._oDesignTime}else{r=t.sap.getResourceName(e.getName(),".designtime")}A(e).then(function(t){sap.ui.require([r],function(n){n.designtimeModule=r;e._oDesignTime=n;n._oLib=t;i(n)})})})}function P(e){var i=e instanceof t.sap.getObject("sap.ui.base.ManagedObject")&&typeof e.data==="function"&&e.data("sap-ui-custom-settings")&&e.data("sap-ui-custom-settings")["sap.ui.dt"]&&e.data("sap-ui-custom-settings")["sap.ui.dt"].designtime;if(typeof i==="string"){return new Promise(function(t){sap.ui.require([i],function(e){t(e)})})}else{return Promise.resolve({})}}function b(e,i){var r=e;if("default"in e){r=t.sap.extend(true,{},e.default,i!=="default"&&e[i]||null)}return r}r.prototype.loadDesignTime=function(e,i){i=typeof i==="string"&&i||"default";var n=P(e);if(!this._oDesignTimePromise){var s;var o=this.getParent();if(o instanceof r){s=o.loadDesignTime(null,i)}else{s=Promise.resolve({})}this._oDesignTimePromise=v(this).then(function(e){return s.then(function(r){return t.sap.extend(true,{},b(r,i),b(e,i),{designtimeModule:e.designtimeModule||undefined,_oLib:e._oLib})})})}return Promise.all([n,this._oDesignTimePromise]).then(function(e){var r=e[0],n=e[1];return t.sap.extend(true,{},n,b(r||{},i))})};var I={},T;function S(e){t.sap.assert(!/[0-9]+$/.exec(e),"AutoId Prefixes must not end with numbers");e=(T||(T=sap.ui.getCore().getConfiguration().getUIDPrefix()))+e;var i=I[e]||0;I[e]=i+1;return e+i}r.uid=S;r.prototype.uid=function(){var t=this._sUIDToken;if(typeof t!=="string"){t=this.getName();t=t.slice(t.lastIndexOf(".")+1);t=t.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").slice(-1)[0];t=this._sUIDToken=t.replace(/([^A-Za-z0-9-_.:])|([0-9]+$)/g,"").toLowerCase()}return S(t)};var D;r.isGeneratedId=function(e){T=T||sap.ui.getCore().getConfiguration().getUIDPrefix();D=D||new RegExp("(^|-{1,3})"+t.sap.escapeRegExp(T));return D.test(e)};return r},true);