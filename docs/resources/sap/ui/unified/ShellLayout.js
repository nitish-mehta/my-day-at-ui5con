/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/core/Control","sap/ui/core/Popup","sap/ui/core/theming/Parameters","./SplitContainer","./library","./ShellLayoutRenderer","jquery.sap.dom","jquery.sap.script"],function(t,e,n,i,r,o,s,a){"use strict";var u=n.extend("sap.ui.unified.ShellLayout",{metadata:{library:"sap.ui.unified",properties:{showPane:{type:"boolean",group:"Appearance",defaultValue:false},headerHiding:{type:"boolean",group:"Appearance",defaultValue:false},headerVisible:{type:"boolean",group:"Appearance",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content",forwarding:{idSuffix:"-container",aggregation:"content"}},paneContent:{type:"sap.ui.core.Control",multiple:true,singularName:"paneContent",forwarding:{idSuffix:"-container",aggregation:"secondaryContent"}},header:{type:"sap.ui.core.Control",multiple:false},canvasSplitContainer:{type:"sap.ui.unified.SplitContainer",multiple:false,visibility:"hidden"},curtainSplitContainer:{type:"sap.ui.unified.SplitContainer",multiple:false,visibility:"hidden"}}}});u._SIDEPANE_WIDTH_PHONE=208;u._SIDEPANE_WIDTH_TABLET=208;u._SIDEPANE_WIDTH_DESKTOP=240;u._HEADER_ALWAYS_VISIBLE=true;u._HEADER_AUTO_CLOSE=true;u._HEADER_TOUCH_TRESHOLD=15;if(e.browser.chrome&&e.browser.version<36){u._HEADER_TOUCH_TRESHOLD=10}u.prototype.init=function(){this._rtl=sap.ui.getCore().getConfiguration().getRTL();this._animation=sap.ui.getCore().getConfiguration().getAnimation();this._showHeader=true;this._showCurtain=false;this._iHeaderHidingDelay=3e3;this._useStrongBG=false;this._cont=new o(this.getId()+"-container");this._cont._bRootContent=true;if(sap.ui.getCore().getConfiguration().getAccessibility()){var t=this;this._cont.addEventDelegate({onAfterRendering:function(){t._cont.$("canvas").attr("role","main");t._cont.$("pane").attr("role","complementary")}})}this.setAggregation("canvasSplitContainer",this._cont,true);this._curtCont=new o(this.getId()+"-curt-container");this._curtCont._bRootContent=true;this.setAggregation("curtainSplitContainer",this._curtCont,true);this._setSidePaneWidth();e.media.attachHandler(this._handleMediaChange,this,e.media.RANGESETS.SAP_STANDARD);e.resize.attachHandler(this._handleResizeChange,this)};u.prototype.exit=function(){e.media.detachHandler(this._handleMediaChange,this,e.media.RANGESETS.SAP_STANDARD);e.resize.detachHandler(this._handleResizeChange,this);delete this._cont;delete this._curtCont};u.prototype.onAfterRendering=function(){var e=this;function n(n){var i=t.event.fix(n);if(t.sap.containsOrEquals(e.getDomRef("hdr"),i.target)){e._timedHideHeader(i.type==="focus")}}if(window.addEventListener&&!u._HEADER_ALWAYS_VISIBLE){var i=this.getDomRef("hdr");i.addEventListener("focus",n,true);i.addEventListener("blur",n,true)}this._refreshAfterRendering()};u.prototype.onThemeChanged=function(){this._refreshAfterRendering()};u.prototype.onfocusin=function(e){var n=this.getId();if(e.target.id===n+"-curt-focusDummyOut"){t.sap.focus(this.$("hdrcntnt").firstFocusableDomRef())}else if(e.target.id===n+"-main-focusDummyOut"){t.sap.focus(this.$("curtcntnt").firstFocusableDomRef())}};(function(){function t(t){if(t._startY===undefined||t._currY===undefined){return}var e=t._currY-t._startY;if(Math.abs(e)>u._HEADER_TOUCH_TRESHOLD){t._doShowHeader(e>0);t._startY=t._currY}}if(e.support.touch){u._HEADER_ALWAYS_VISIBLE=false;u.prototype.ontouchstart=function(t){this._startY=t.touches[0].pageY;if(this._startY>2*48){this._startY=undefined}this._currY=this._startY};u.prototype.ontouchend=function(e){t(this);this._startY=undefined;this._currY=undefined};u.prototype.ontouchcancel=u.prototype.ontouchend;u.prototype.ontouchmove=function(e){this._currY=e.touches[0].pageY;t(this)}}})();u.prototype.setHeaderHiding=function(t){t=!!t;return this._mod(function(e){return this.setProperty("headerHiding",t,e)},function(){this._doShowHeader(!t?true:this._showHeader)})};u.prototype.setHeaderHidingDelay=function(t){this._iHeaderHidingDelay=t;return this};u.prototype.getHeaderHidingDelay=function(){return this._iHeaderHidingDelay};u.prototype.getShowPane=function(){return this._cont.getShowSecondaryContent()};u.prototype.setShowPane=function(t){this._cont.setShowSecondaryContent(t);this.setProperty("showPane",!!t,true);return this};u.prototype.setShowCurtainPane=function(t){this._curtCont.setShowSecondaryContent(t);return this};u.prototype.getShowCurtainPane=function(){return this._curtCont.getShowSecondaryContent()};u.prototype.setHeaderVisible=function(t){t=!!t;this.setProperty("headerVisible",t,true);this.$().toggleClass("sapUiUfdShellNoHead",!t);return this};u.prototype.setShowCurtain=function(t){t=!!t;return this._mod(function(e){this._showCurtain=t;return this},function(){this.$("main-focusDummyOut").attr("tabindex",t?0:-1);this.$().toggleClass("sapUiUfdShellCurtainHidden",!t).toggleClass("sapUiUfdShellCurtainVisible",t);if(t){var e=i.getNextZIndex();this.$("curt").css("z-index",e+1);this.$("hdr").css("z-index",e+3);this.$("brand").css("z-index",e+7);this.$().toggleClass("sapUiUfdShellCurtainClosed",false)}this._timedCurtainClosed(t);this._doShowHeader(true)})};u.prototype.getShowCurtain=function(){return this._showCurtain};u.prototype.setHeader=function(t){this.setAggregation("header",t,true);t=this.getHeader();if(this.getDomRef()){if(!t){this.$("hdrcntnt").html("")}else{var e=sap.ui.getCore().createRenderManager();e.renderControl(t);e.flush(this.getDomRef("hdrcntnt"));e.destroy()}}return this};u.prototype.destroyHeader=function(){this.destroyAggregation("header",true);this.$("hdrcntnt").html("");return this};u.prototype.getCurtainContent=function(){return this._curtCont.getContent()};u.prototype.insertCurtainContent=function(t,e){this._curtCont.insertContent(t,e);return this};u.prototype.addCurtainContent=function(t){this._curtCont.addContent(t);return this};u.prototype.removeCurtainContent=function(t){return this._curtCont.removeContent(t)};u.prototype.removeAllCurtainContent=function(){return this._curtCont.removeAllContent()};u.prototype.destroyCurtainContent=function(){this._curtCont.destroyContent();return this};u.prototype.indexOfCurtainContent=function(t){return this._curtCont.indexOfCurtainContent(t)};u.prototype.getCurtainPaneContent=function(){return this._curtCont.getSecondaryContent()};u.prototype.insertCurtainPaneContent=function(t,e){this._curtCont.insertSecondaryContent(t,e);return this};u.prototype.addCurtainPaneContent=function(t){this._curtCont.addSecondaryContent(t);return this};u.prototype.removeCurtainPaneContent=function(t){return this._curtCont.removeSecondaryContent(t)};u.prototype.removeAllCurtainPaneContent=function(){return this._curtCont.removeAllSecondaryContent()};u.prototype.destroyCurtainPaneContent=function(){this._curtCont.destroySecondaryContent();return this};u.prototype.indexOfCurtainPaneContent=function(t){return this._curtCont.indexOfSecondaryContent(t)};u.prototype._setStrongBackground=function(t){this._useStrongBG=!!t;this.$("strgbg").toggleClass("sapUiStrongBackgroundColor",this._useStrongBG)};u.prototype._mod=function(t,e){var n=!!this.getDomRef();var i=t.apply(this,[n]);if(n&&e){if(e instanceof s._ContentRenderer){e.render()}else{e.apply(this)}}return i};u.prototype._doShowHeader=function(e){var n=this._showHeader;this._showHeader=this._isHeaderHidingActive()?!!e:true;this.$().toggleClass("sapUiUfdShellHeadHidden",!this._showHeader).toggleClass("sapUiUfdShellHeadVisible",this._showHeader);if(this._showHeader){this._timedHideHeader()}if(n!=this._showHeader&&this._isHeaderHidingActive()){t.sap.delayedCall(500,this,function(){try{var e=document.createEvent("UIEvents");e.initUIEvent("resize",true,false,window,0);window.dispatchEvent(e)}catch(e){t.sap.log.error(e)}})}};u.prototype._timedHideHeader=function(e){if(this._headerHidingTimer){t.sap.clearDelayedCall(this._headerHidingTimer);this._headerHidingTimer=null}if(e||!u._HEADER_AUTO_CLOSE||!this._isHeaderHidingActive()||this._iHeaderHidingDelay<=0){return}this._headerHidingTimer=t.sap.delayedCall(this._iHeaderHidingDelay,this,function(){if(this._isHeaderHidingActive()&&this._iHeaderHidingDelay>0&&!t.sap.containsOrEquals(this.getDomRef("hdr"),document.activeElement)){this._doShowHeader(false)}})};u.prototype._timedCurtainClosed=function(n){if(this._curtainClosedTimer){t.sap.clearDelayedCall(this._curtainClosedTimer);this._curtainClosedTimer=null}if(n){return}var i=parseInt(r.get("_sap_ui_unified_ShellLayout_AnimDuration"),10);if(!this._animation||e.browser.internet_explorer&&e.browser.version<10){i=0}this._curtainClosedTimer=t.sap.delayedCall(i,this,function(){this._curtainClosedTimer=null;this.$("curt").css("z-index","");this.$("hdr").css("z-index","");this.$("brand").css("z-index","");this.$().toggleClass("sapUiUfdShellCurtainClosed",true)})};u.prototype._isHeaderHidingActive=function(){if(u._HEADER_ALWAYS_VISIBLE||this.getShowCurtain()||!this.getHeaderHiding()||s._iNumberOfOpenedShellOverlays>0||!this.getHeaderVisible()){return false}return true};u.prototype._refreshCSSWorkaround=function(){if(!e.browser.webkit||!e.support.touch){return}if(this._cssWorkaroundTimer){t.sap.clearDelayedCall(this._cssWorkaroundTimer);this._cssWorkaroundTimer=null}this.$("css").remove();this._cssWorkaroundTimer=t.sap.delayedCall(10,this,function(){this._cssWorkaroundTimer=null;t.sap.log.debug("sap.ui.unified.ShellLayout: CSS Workaround applied.");t("head").append("<link type='text/css' rel='stylesheet' id='"+this.getId()+"-css' href='data:text/css;base64,LnNhcFVpVWZkU2hlbGxDaHJvbWVSZXBhaW50e291dGxpbmUtY29sb3I6aW5pdGlhbDt9'/>");this._cssWorkaroundTimer=t.sap.delayedCall(100,this,function(){this.$("css").remove()})})};u.prototype._setSidePaneWidth=function(t){if(!t){t=e.media.getCurrentRange(e.media.RANGESETS.SAP_STANDARD).name}var n=u["_SIDEPANE_WIDTH_"+t.toUpperCase()]+"px";this._cont.setSecondaryContentSize(n);this._curtCont.setSecondaryContentSize(n)};u.prototype._handleMediaChange=function(t){if(!this.getDomRef()){return false}this._setSidePaneWidth(t.name)};u.prototype._handleResizeChange=function(t){};u.prototype._refreshAfterRendering=function(){var t=this.getDomRef();if(!t){return false}this._repaint(t);this._timedHideHeader();return true};u.prototype._repaint=function(t){if(e.browser.webkit){var n=t.style.display;t.style.display="none";t.offsetHeight;t.style.display=n;this._refreshCSSWorkaround()}};u.prototype._getSearchWidth=function(){return-1};return u});