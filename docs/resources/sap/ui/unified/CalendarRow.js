/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","sap/ui/core/date/UniversalDate","./library","sap/ui/core/InvisibleText","sap/ui/core/format/DateFormat","sap/ui/core/ResizeHandler","sap/ui/core/Locale","./CalendarRowRenderer"],function(e,t,i,a,n,s,r,o,p,l,u,g){"use strict";var h=r.CalendarDayType;var d=r.CalendarAppointmentVisualization;var f=r.GroupAppointmentsMode;var c=r.CalendarIntervalType;var v=t.extend("sap.ui.unified.CalendarRow",{metadata:{library:"sap.ui.unified",properties:{startDate:{type:"object",group:"Data"},intervals:{type:"int",group:"Appearance",defaultValue:12},intervalType:{type:"sap.ui.unified.CalendarIntervalType",group:"Appearance",defaultValue:c.Hour},showSubIntervals:{type:"boolean",group:"Appearance",defaultValue:false},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},nonWorkingDays:{type:"int[]",group:"Misc",defaultValue:null},nonWorkingHours:{type:"int[]",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},checkResize:{type:"boolean",group:"Behavior",defaultValue:true},updateCurrentTime:{type:"boolean",group:"Behavior",defaultValue:true},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:f.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:d.Standard}},aggregations:{appointments:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"appointment"},intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"intervalHeader"},groupAppointments:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"groupAppointment",visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},startDateChange:{},leaveRow:{parameters:{type:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"}}}}}});v.prototype.init=function(){this._bRTL=sap.ui.getCore().getConfiguration().getRTL();this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");this._oFormatAria=p.getDateTimeInstance({pattern:"EEEE dd/MM/YYYY 'at' HH:mm:ss a"});this._iHoursMinDelta=1;this._iDaysMinDelta=30;this._iMonthsMinDelta=720;this._aVisibleAppointments=[];this._aVisibleIntervalHeaders=[];this.setStartDate(new Date);this._resizeProxy=e.proxy(this.handleResize,this);this.aSelectedAppointments=[];this._fnCustomSortedAppointments=undefined};v.prototype.exit=function(){if(this._sResizeListener){l.deregister(this._sResizeListener);this._sResizeListener=undefined}if(this._sUpdateCurrentTime){e.sap.clearDelayedCall(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}this._fnCustomSortedAppointments=undefined};v.prototype.onBeforeRendering=function(){C.call(this);A.call(this);S.call(this);if(this._sUpdateCurrentTime){e.sap.clearDelayedCall(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}};v.prototype.onAfterRendering=function(){M.call(this);this.updateCurrentTimeVisualization();if(this.getCheckResize()&&!this._sResizeListener){this._sResizeListener=l.register(this,this._resizeProxy)}};v.prototype.onThemeChanged=function(e){if(this.getDomRef()){for(var t=0;t<this._aVisibleAppointments.length;t++){var i=this._aVisibleAppointments[t];i.level=-1}this.handleResize(e)}};v.prototype.invalidate=function(e){if(e&&e instanceof sap.ui.unified.CalendarAppointment){var i=false;for(var a=0;a<this._aVisibleAppointments.length;a++){if(this._aVisibleAppointments[a].appointment==e){i=true;break}}if(i){this._aVisibleAppointments=[]}}t.prototype.invalidate.apply(this,arguments)};v.prototype.setStartDate=function(e){if(!e){e=new Date}n._checkJSDateObject(e);var t=e.getFullYear();n._checkYearInValidRange(t);this.setProperty("startDate",e);return this};v.prototype._getStartDate=function(){if(!this._oUTCStartDate){this._oUTCStartDate=n._createUniversalUTCDate(this.getStartDate(),undefined,true)}return this._oUTCStartDate};v.prototype.setIntervalType=function(e){this.setProperty("intervalType",e);this._aVisibleAppointments=[];return this};v.prototype.setGroupAppointmentsMode=function(e){this.setProperty("groupAppointmentsMode",e);this._aVisibleAppointments=[];return this};v.prototype.setAppointmentsReducedHeight=function(e){this.setProperty("appointmentsReducedHeight",e);this._aVisibleAppointments=[];return this};v.prototype._getAppointmentReducedHeight=function(e){var t=false;if(!i.system.phone&&this.getAppointmentsReducedHeight()&&!e.getText()){t=true}return t};v.prototype.onfocusin=function(t){if(e(t.target).hasClass("sapUiCalendarApp")){V.call(this,t.target.id)}else{var i=this._getVisibleAppointments();var a=false;var n;for(var s=0;s<i.length;s++){n=i[s].appointment;if(e.sap.containsOrEquals(n.getDomRef(),t.target)){a=true;n.focus();break}}if(!a){n=this.getFocusedAppointment();if(n){n.focus()}}}};v.prototype.applyFocusInfo=function(e){if(this._sFocusedAppointmentId){this.getFocusedAppointment().focus()}return this};v.prototype.onsapleft=function(t){if(e(t.target).hasClass("sapUiCalendarApp")){E.call(this,this._bRTL,1)}t.preventDefault();t.stopPropagation()};v.prototype.onsapright=function(t){if(e(t.target).hasClass("sapUiCalendarApp")){E.call(this,!this._bRTL,1)}t.preventDefault();t.stopPropagation()};v.prototype.onsapup=function(e){this.fireLeaveRow({type:e.type})};v.prototype.onsapdown=function(e){this.fireLeaveRow({type:e.type})};v.prototype.onsaphome=function(e){L.call(this,e);e.preventDefault();e.stopPropagation()};v.prototype.onsapend=function(e){L.call(this,e);e.preventDefault();e.stopPropagation()};v.prototype.onsapselect=function(t){var i=this._getVisibleAppointments();for(var a=0;a<i.length;a++){var n=i[a].appointment;if(e.sap.containsOrEquals(n.getDomRef(),t.target)){I.call(this,n,!t.ctrlKey);break}}t.stopPropagation();t.preventDefault()};v.prototype.ontap=function(t){var i=this.$("Apps").children(".sapUiCalendarRowAppsInt");var a=0;var n=false;for(a=0;a<i.length;a++){var s=i[a];if(!this._isOneMonthIntervalOnSmallSizes()&&e.sap.containsOrEquals(s,t.target)){n=true;break}}if(n){z.call(this,a,t.target)}else{this.onsapselect(t)}};v.prototype.onsapselectmodifiers=function(e){this.onsapselect(e)};v.prototype.handleResize=function(e){if(e&&e.size&&e.size.width<=0){return this}var t=this.$("DummyApp");t.css("display","");M.call(this);return this};v.prototype.updateCurrentTimeVisualization=function(){var t=this.$("Now");var i=n._createUniversalUTCDate(new Date,undefined,true);var a=this.getIntervals();var s=this.getIntervalType();var r=this._getStartDate();var o=r.getTime();var p=this._oUTCEndDate;var l=p.getTime();this._sUpdateCurrentTime=undefined;if(i.getTime()<=l&&i.getTime()>=o){var u=y.call(this,s,a,r,p,o,i);var g=0;if(this._bRTL){t.css("right",u+"%")}else{t.css("left",u+"%")}t.css("display","");if(this.getUpdateCurrentTime()){switch(s){case c.Hour:g=6e4;break;case c.Day:case c.Week:case c.OneMonth:g=18e5;break;default:g=-1;break}if(g>0){this._sUpdateCurrentTime=e.sap.delayedCall(g,this,this.updateCurrentTimeVisualization)}}}else{t.css("display","none")}return this};v.prototype.getFocusedAppointment=function(){var e=this._getAppointmentsSorted();var t=this.getAggregation("groupAppointments",[]);var i;var a=0;for(a=0;a<t.length;a++){if(t[a].getId()==this._sFocusedAppointmentId){i=t[a];break}}if(!i){for(a=0;a<e.length;a++){if(e[a].getId()==this._sFocusedAppointmentId){i=e[a];break}}}return i};v.prototype.focusAppointment=function(e){if(!e||!(e instanceof sap.ui.unified.CalendarAppointment)){throw new Error("Appointment must be a CalendarAppointment; "+this)}var t=e.getId();if(this._sFocusedAppointmentId!=t){V.call(this,t)}else{e.focus()}return this};v.prototype.focusNearestAppointment=function(e){n._checkJSDateObject(e);var t=this._getAppointmentsSorted();var i;var a;var s;for(var r=0;r<t.length;r++){i=t[r];if(i.getStartDate()>e){if(r>0){a=t[r-1]}else{a=i}break}}if(i){if(a&&Math.abs(i.getStartDate()-e)>=Math.abs(a.getStartDate()-e)){s=a}else{s=i}this.focusAppointment(s)}return this};v.prototype._getVisibleAppointments=function(){return this._aVisibleAppointments};v.prototype._getVisibleIntervalHeaders=function(){return this._aVisibleIntervalHeaders};v.prototype._getNonWorkingDays=function(){var t=this.getNonWorkingDays();if(!t){var i=T.call(this);var a=i.getWeekendStart();var n=i.getWeekendEnd();t=[];for(var s=0;s<=6;s++){if(a<=n&&s>=a&&s<=n||a>n&&(s>=a||s<=n)){t.push(s)}}}else if(!e.isArray(t)){t=[]}return t};v.prototype._isOneMonthIntervalOnSmallSizes=function(){return this.getIntervalType()===c.OneMonth&&this.getIntervals()===1};v.prototype._getAppointmentsSorted=function(){var e=this.getAppointments(),t=F;e.sort(this._fnCustomSortedAppointments?this._fnCustomSortedAppointments:t);return e};v.prototype._setCustomAppointmentsSorterCallback=function(e){this._fnCustomSortedAppointments=e;this.invalidate()};function m(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale}function T(){if(!this._oLocaleData){var e=m.call(this);var t=new u(e);this._oLocaleData=a.getInstance(t)}return this._oLocaleData}function C(){var e=this.getStartDate();var t;var i=this.getIntervals();var a=this.getIntervalType();this._oUTCStartDate=U.call(this,e);switch(a){case c.Hour:t=new s(this._oUTCStartDate.getTime());t.setUTCHours(t.getUTCHours()+i);this._iMinDelta=this._iHoursMinDelta;break;case c.Day:case c.Week:case c.OneMonth:t=new s(this._oUTCStartDate.getTime());t.setUTCDate(t.getUTCDate()+i);this._iMinDelta=this._iDaysMinDelta;break;case c.Month:t=new s(this._oUTCStartDate.getTime());t.setUTCMonth(t.getUTCMonth()+i);this._iMinDelta=this._iMonthsMinDelta;break;default:throw new Error("Unknown IntervalType: "+a+"; "+this)}t.setUTCMilliseconds(-1);this._iRowSize=t.getTime()-this._oUTCStartDate.getTime();this._iIntervalSize=Math.floor(this._iRowSize/i);this._oUTCEndDate=t}function U(e){var t=this.getIntervalType();var i=n._createUniversalUTCDate(e,undefined,true);switch(t){case c.Hour:i.setUTCMinutes(0);i.setUTCSeconds(0);i.setUTCMilliseconds(0);break;case c.Day:case c.Week:case c.OneMonth:i.setUTCHours(0);i.setUTCMinutes(0);i.setUTCSeconds(0);i.setUTCMilliseconds(0);break;case c.Month:i.setUTCDate(1);i.setUTCHours(0);i.setUTCMinutes(0);i.setUTCSeconds(0);i.setUTCMilliseconds(0);break;default:throw new Error("Unknown IntervalType: "+t+"; "+this)}return i}function _(){return i.system.phone||this.getGroupAppointmentsMode()===f.Collapsed}function A(){var e=this._getAppointmentsSorted();var t;var i;var a;var r=this.getIntervals();var o=this.getIntervalType();var p=this._getStartDate();var l=p.getTime();var u=this._oUTCEndDate;var g=u.getTime();var h=[];var d=false;var f=0;var v=0;var m=_.call(this);this.destroyAggregation("groupAppointments",true);for(f=0;f<e.length;f++){t=e[f];var T=n._createUniversalUTCDate(t.getStartDate(),undefined,true);T.setUTCSeconds(0);T.setUTCMilliseconds(0);var C=t.getEndDate()?n._createUniversalUTCDate(t.getEndDate(),undefined,true):n._createUniversalUTCDate(new Date(864e12),undefined,true);C.setUTCSeconds(0);C.setUTCMilliseconds(0);var U=false;if(T.getTime()<l&&C.getTime()>=l){T=new s(l);U=true}if(C.getTime()>g&&T.getTime()<=g){C=new s(g);U=true}var A=T.getUTCHours()*60+T.getUTCMinutes();T.setUTCMinutes(T.getUTCMinutes()-A%this._iMinDelta);var S=(C.getTime()-T.getTime())/6e4;if(U&&S==0){continue}var M=0;var I=0;var w=-1;i=undefined;a=undefined;if(T&&T.getTime()<=g&&C&&C.getTime()>=l){if(m&&o==c.Month&&C.getTime()-T.getTime()<6048e5){i=D.call(this,T,t,o,r,p,u,l,h);var H=n._createUniversalUTCDate(i.getEndDate(),undefined,true);if(C.getTime()>H.getTime()){a=D.call(this,C,t,o,r,p,u,l,h)}}M=y.call(this,o,r,p,u,l,T);I=b.call(this,o,r,p,u,l,C);if(i){i._iBegin=M;i._iEnd=I;i._iLevel=w;if(a){a._iBegin=M;a._iEnd=I;a._iLevel=w}continue}h.push({appointment:t,begin:M,end:I,calculatedEnd:I,level:w});if(this._sFocusedAppointmentId&&this._sFocusedAppointmentId==t.getId()){d=true}}}var k=this.getAggregation("groupAppointments",[]);if(k.length>0){for(f=0;f<h.length;f++){t=h[f];if(t.appointment._aAppointments&&t.appointment._aAppointments.length<=1){i=t.appointment;var R=false;if(i._aAppointments.length==0){R=true}else{for(v=0;v<h.length;v++){if(h[v].appointment==i._aAppointments[0]){R=true;break}}}if(!R){for(v=0;v<k.length;v++){a=k[v];if(i!=a){for(var V=0;V<a._aAppointments.length;V++){if(i._aAppointments[0]==a._aAppointments[V]){a._aAppointments.splice(V,1);if(a._aAppointments.length==1){this.removeAggregation("groupAppointments",a);a.destroy();k=this.getAggregation("groupAppointments",[])}else{a.setProperty("title",a._aAppointments.length,true)}break}}}}t.begin=i._iBegin;t.end=i._iEnd;t.calculatedEnd=i._iEnd;t.level=i._iLevel;t.appointment=i._aAppointments[0]}else{h.splice(f,1);f--}this.removeAggregation("groupAppointments",i);i.destroy();k=this.getAggregation("groupAppointments",[])}}}if(!d){if(h.length>0){this._sFocusedAppointmentId=h[0].appointment.getId()}else{this._sFocusedAppointmentId=undefined}}this._aVisibleAppointments=h;return this._aVisibleAppointments}function D(e,t,i,a,r,o,p,l){var u=this.getAggregation("groupAppointments",[]);var g;var d=T.call(this);var f=d.getFirstDayOfWeek();var c=e.getUTCDay();var v=new s(e.getTime());v.setUTCHours(0);v.setUTCMinutes(0);v.setUTCSeconds(0);v.setUTCMilliseconds(0);if(f<=c){v.setDate(v.getDate()-(c-f))}else{v.setDate(v.getDate()-(7-c-f))}for(var m=0;m<u.length;m++){g=u[m];var C=n._createUniversalUTCDate(g.getStartDate(),undefined,true);if(C.getTime()==v.getTime()){break}g=undefined}if(!g){var U=new s(v.getTime());U.setDate(U.getDate()+7);U.setMilliseconds(-1);g=new sap.ui.unified.CalendarAppointment(this.getId()+"-Group"+u.length,{type:t.getType(),startDate:n._createLocalDate(new Date(v.getTime()),true),endDate:n._createLocalDate(new Date(U.getTime()),true)});g._aAppointments=[];this.addAggregation("groupAppointments",g,true);var _=y.call(this,i,a,r,o,p,v);var A=b.call(this,i,a,r,o,p,U);l.push({appointment:g,begin:_,end:A,calculatedEnd:A,level:-1})}g._aAppointments.push(t);if(g.getType()!=h.None&&g.getType()!=t.getType()){g.setType(h.None)}g.setProperty("title",g._aAppointments.length,true);return g}function y(e,t,i,a,n,r){var o=0;if(e!=c.Month){o=100*(r.getTime()-n)/this._iRowSize}else{var p=new s(r.getTime());p.setUTCDate(1);p.setUTCHours(0);p.setUTCMinutes(0);p.setUTCSeconds(0);p.setUTCMilliseconds(0);var l=new s(p.getTime());l.setUTCMonth(l.getUTCMonth()+1);l.setMilliseconds(-1);var u=l.getTime()-p.getTime();var g=(p.getUTCFullYear()-i.getUTCFullYear())*12+p.getUTCMonth()-i.getUTCMonth();o=100*g/t+100*(r.getTime()-p.getTime())/u/t}if(o<0){o=0}o=Math.round(o*1e5)/1e5;return o}function b(e,t,i,a,n,r){var o=0;if(e!=c.Month){o=100-100*(r.getTime()-n)/this._iRowSize}else{var p=new s(r.getTime());p.setUTCDate(1);p.setUTCHours(0);p.setUTCMinutes(0);p.setUTCSeconds(0);p.setUTCMilliseconds(0);var l=new s(p.getTime());l.setUTCMonth(l.getUTCMonth()+1);l.setMilliseconds(-1);var u=l.getTime()-p.getTime();var g=(p.getUTCFullYear()-i.getUTCFullYear())*12+p.getUTCMonth()-i.getUTCMonth();o=100-(100*g/t+100*(r.getTime()-p.getTime())/u/t)}if(o<0){o=0}o=Math.round(o*1e5)/1e5;return o}function S(){var e=[];if(this.getShowIntervalHeaders()){var t=this.getIntervalHeaders();var i;var a=this.getIntervals();var r=this.getIntervalType();var o=this._getStartDate();var p=o.getTime();var l=this._oUTCEndDate;var u=l.getTime();var g=0;var h=0;for(g=0;g<t.length;g++){i=t[g];var d=n._createUniversalUTCDate(i.getStartDate(),undefined,true);d.setUTCSeconds(0);d.setUTCMilliseconds(0);var f=i.getEndDate()?n._createUniversalUTCDate(i.getEndDate(),undefined,true):n._createUniversalUTCDate(new Date(864e12),undefined,true);f.setUTCSeconds(0);f.setUTCMilliseconds(0);if(d&&d.getTime()<=u&&f&&f.getTime()>=p){var v=new s(o.getTime());var m=new s(o.getTime());m.setUTCMinutes(m.getUTCMinutes()-1);var T=-1;var C=-1;for(h=0;h<a;h++){switch(r){case c.Hour:m.setUTCHours(m.getUTCHours()+1);if(h>0){v.setUTCHours(v.getUTCHours()+1)}break;case c.Day:case c.Week:case c.OneMonth:m.setUTCDate(m.getUTCDate()+1);if(h>0){v.setUTCDate(v.getUTCDate()+1)}break;case c.Month:m.setUTCDate(1);m.setUTCMonth(m.getUTCMonth()+2);m.setUTCDate(0);if(h>0){v.setUTCMonth(v.getUTCMonth()+1)}break;default:throw new Error("Unknown IntervalType: "+r+"; "+this)}if(d&&d.getTime()<=v.getTime()&&f&&f.getTime()>=m.getTime()){if(T<0){T=h}C=h}}if(T>=0){e.push({interval:T,appointment:i,last:C})}}}}this._aVisibleIntervalHeaders=e;return this._aVisibleIntervalHeaders}function M(){if(this._isOneMonthIntervalOnSmallSizes()){return}var t=this.$("Apps");var a=t.innerWidth();if(a<=0){return}var n=this.$("DummyApp");var s=n.outerHeight(true);if(s<=0){return}var r=n.outerWidth();var o=r/a*100;var p=Math.ceil(1e3*o)/1e3;var l;var u;var g=0;var h=0;var d=0;var f=!i.system.phone&&this.getAppointmentsReducedHeight();if(this.getShowIntervalHeaders()&&(this.getShowEmptyIntervalHeaders()||this._getVisibleIntervalHeaders().length>0)){g=e(this.$("AppsInt0").children(".sapUiCalendarRowAppsIntHead")[0]).outerHeight(true)}for(d=0;d<this._aVisibleAppointments.length;d++){l=this._aVisibleAppointments[d];u=l.appointment.$();var c=Math.floor(1e3*(100-l.calculatedEnd-l.begin))/1e3;var v=false;if(c<p){l.end=100-l.begin-o;if(l.end<0){l.end=0}l.level=-1;v=true;u.addClass("sapUiCalendarAppSmall")}else if(u.hasClass("sapUiCalendarAppSmall")){l.end=l.calculatedEnd;v=true;u.removeClass("sapUiCalendarAppSmall")}if(v){if(this._bRTL){u.css("left",l.end+"%")}else{u.css("right",l.end+"%")}}}for(d=0;d<this._aVisibleAppointments.length;d++){l=this._aVisibleAppointments[d];u=l.appointment.$();var m={};var T=f&&!this._getAppointmentReducedHeight(l.appointment);if(l.level<0){for(var C=0;C<this._aVisibleAppointments.length;C++){var U=this._aVisibleAppointments[C];if(l!=U&&l.begin<Math.floor(1e3*(100-U.end))/1e3&&Math.floor(1e3*(100-l.end))/1e3>U.begin&&U.level>=0){if(m[U.level]){m[U.level]++}else{m[U.level]=1}if(f&&!this._getAppointmentReducedHeight(U.appointment)){if(m[U.level+1]){m[U.level+1]++}else{m[U.level+1]=1}}}}l.level=0;while(m[l.level]||T&&m[l.level+1]){l.level++}u.attr("data-sap-level",l.level)}u.css("top",s*l.level+g+"px");var _=l.level;if(T){_++}if(h<_){h=_}}h++;s=s*h+g;if(!this.getHeight()){t.outerHeight(s)}else{var A=this.$("Apps").children(".sapUiCalendarRowAppsInt");for(d=0;d<A.length;d++){var D=e(A[d]);D.outerHeight(s)}}n.css("display","none")}function I(t,i){var a=0;var n;var s;var r;var p;var l=o.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED");if(i){var u=this.getAppointments();var g=this.getAggregation("groupAppointments",[]);e.merge(u,g);for(a=0;a<u.length;a++){n=u[a];if(n.getId()!==t.getId()&&n.getSelected()){n.setProperty("selected",false,true);n.$().removeClass("sapUiCalendarAppSel");for(var a=0;a<this.aSelectedAppointments.length;a++){if(this.aSelectedAppointments[a]!==n.getId()){this.aSelectedAppointments.splice(a)}}s=n.$().attr("aria-labelledby");r=s?s.replace(l,""):"";n.$().attr("aria-labelledby",r)}}}if(t.getSelected()){t.setProperty("selected",false,true);t.$().removeClass("sapUiCalendarAppSel");this.aSelectedAppointments=this.aSelectedAppointments.filter(function(e){return e!==t.getId()});k(this,i)}else{t.setProperty("selected",true,true);t.$().addClass("sapUiCalendarAppSel");k(this,i);this.aSelectedAppointments.push(t.getId())}p=t.$().attr("aria-labelledby")+" "+l;t.$().attr("aria-labelledby",p);if(t._aAppointments){for(a=0;a<t._aAppointments.length;a++){n=t._aAppointments[a];n.setProperty("selected",true,true);p=n.$().attr("aria-labelledby")+" "+l;n.$().attr("aria-labelledby",p)}this.fireSelect({appointments:t._aAppointments,multiSelect:!i,domRefId:t.getId()})}else{this.fireSelect({appointment:t,multiSelect:!i,domRefId:t.getId()})}}function w(e){var t=H.call(this);if(t){t["_onRow"+e]()}}function H(){var e=this;while(e.getParent()!==null){if(e.getMetadata().getName()==="sap.m.PlanningCalendar"){return e}e=e.getParent()}}function k(e,t){if(t){w.call(e,"DeselectAppointment")}}function R(e){var t=this.getAggregation("groupAppointments",[]);var i;var a=false;for(var n=0;n<t.length;n++){var s=t[n]._aAppointments;for(var r=0;r<s.length;r++){if(s[r].getId()==e){i=t[n];a=true;break}}if(a){break}}return i}function V(t){if(this._sFocusedAppointmentId!=t){var i=this._getAppointmentsSorted();var a=this._aVisibleAppointments;var s;var r=0;s=R.call(this,t);if(s){t=s.getId();s=undefined}for(r=0;r<a.length;r++){if(a[r].appointment.getId()==t){s=a[r].appointment;break}}if(s){var o=this.getFocusedAppointment().$();var p=s.$();this._sFocusedAppointmentId=s.getId();o.attr("tabindex","-1");p.attr("tabindex","0");p.focus()}else{for(r=0;r<i.length;r++){if(i[r].getId()==t){s=i[r];break}}if(s){this._sFocusedAppointmentId=s.getId();var l=U.call(this,s.getStartDate());this.setStartDate(n._createLocalDate(l,true));if(!e.sap.containsOrEquals(this.getDomRef(),document.activeElement)){e.sap.delayedCall(0,this,function(){this.getFocusedAppointment().focus()})}this.fireStartDateChange()}}}}function E(e,t){var i=this._sFocusedAppointmentId;var a=this._getAppointmentsSorted();var n=this.getAggregation("groupAppointments",[]);var s;var r=0;var o=0;for(o=0;o<n.length;o++){if(n[o].getId()==i){var p=n[o]._aAppointments;if(e){i=p[p.length-1].getId()}else{i=p[0].getId()}break}}for(o=0;o<a.length;o++){if(a[o].getId()==i){r=o;break}}if(e){r=r+t}else{r=r-t}if(r<0){r=0}else if(r>=a.length){r=a.length-1}s=a[r];V.call(this,s.getId())}function L(e){var t=this._getAppointmentsSorted();var i;var a=new s(this._getStartDate());var r=new s(this._oUTCEndDate);var o=this.getIntervalType();var p;var l;a.setUTCHours(0);r.setUTCHours(0);r.setUTCMinutes(0);r.setUTCSeconds(0);switch(o){case c.Hour:r.setUTCDate(r.getUTCDate()+1);r.setUTCMilliseconds(-1);break;case c.Day:case c.Week:case c.OneMonth:a.setUTCDate(1);r.setUTCMonth(r.getUTCMonth()+1);r.setUTCDate(1);r.setUTCMilliseconds(-1);break;case c.Month:a.setUTCMonth(0);a.setUTCDate(1);r.setUTCFullYear(r.getUTCFullYear()+1);r.setUTCMonth(1);r.setUTCDate(1);r.setUTCMilliseconds(-1);break;default:throw new Error("Unknown IntervalType: "+o+"; "+this)}var u=n._createLocalDate(a,true);var g=n._createLocalDate(r,true);for(var h=0;h<t.length;h++){if(t[h].getStartDate()>=u&&t[h].getStartDate()<=g){i=t[h];p=i.getId();if(e.type=="saphome"){break}}else if(t[h].getStartDate()>g){break}}l=R.call(this,p);if(l){i=l;p=i.getId()}if(p&&p!=this._sFocusedAppointmentId){V.call(this,p)}else if(e._bPlanningCalendar&&i){i.focus()}else{this.fireLeaveRow({type:e.type})}}function z(t,i){var a=this.getIntervalType();var r=this._getStartDate();var o=new s(r.getTime());var p;var l=false;var u=0;var g=0;if(e(i).hasClass("sapUiCalendarRowAppsSubInt")){l=true;var h=e(e(i).parent()).children(".sapUiCalendarRowAppsSubInt");g=h.length;for(u=0;u<g;u++){var d=h[u];if(d==i){break}}}switch(a){case c.Hour:o.setUTCHours(o.getUTCHours()+t);if(l){o.setUTCMinutes(o.getUTCMinutes()+u*60/g);p=new s(o.getTime());p.setUTCMinutes(p.getUTCMinutes()+60/g)}else{p=new s(o.getTime());p.setUTCHours(p.getUTCHours()+1)}break;case c.Day:case c.Week:case c.OneMonth:o.setUTCDate(o.getUTCDate()+t);if(l){o.setUTCHours(o.getUTCHours()+u*24/g);p=new s(o.getTime());p.setUTCHours(p.getUTCHours()+24/g)}else{p=new s(o.getTime());p.setUTCDate(p.getUTCDate()+1)}break;case c.Month:o.setUTCMonth(o.getUTCMonth()+t);if(l){o.setUTCDate(o.getUTCDate()+u);p=new s(o.getTime());p.setUTCDate(p.getUTCDate()+1)}else{p=new s(o.getTime());p.setUTCMonth(p.getUTCMonth()+1)}break;default:throw new Error("Unknown IntervalType: "+a+"; "+this)}p.setUTCMilliseconds(p.getUTCMilliseconds()-1);o=n._createLocalDate(o,true);p=n._createLocalDate(p,true);this.fireIntervalSelect({startDate:o,endDate:p,subInterval:l})}function F(e,t){var i=e.getStartDate()-t.getStartDate();if(i==0){i=t.getEndDate()-e.getEndDate()}return i}return v});