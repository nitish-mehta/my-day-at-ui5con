/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","./calendar/Header","./calendar/TimesRow","./calendar/DatesRow","./calendar/MonthPicker","./calendar/YearPicker","sap/ui/core/date/UniversalDate","./library","sap/ui/core/format/DateFormat","sap/ui/Device","sap/ui/core/Locale","sap/ui/core/library","./CalendarTimeIntervalRenderer"],function(e,t,a,i,s,o,r,n,g,h,l,c,u,D,d,f){"use strict";var p=d.CalendarType;var _=t.extend("sap.ui.unified.CalendarTimeInterval",{metadata:{library:"sap.ui.unified",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},startDate:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},items:{type:"int",group:"Appearance",defaultValue:12},intervalMinutes:{type:"int",group:"Appearance",defaultValue:60},pickerPopup:{type:"boolean",group:"Appearance",defaultValue:false},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},header:{type:"sap.ui.unified.calendar.Header",multiple:false,visibility:"hidden"},timesRow:{type:"sap.ui.unified.calendar.TimesRow",multiple:false,visibility:"hidden"},datesRow:{type:"sap.ui.unified.calendar.Month",multiple:false,visibility:"hidden"},monthPicker:{type:"sap.ui.unified.calendar.MonthPicker",multiple:false,visibility:"hidden"},yearPicker:{type:"sap.ui.unified.calendar.YearPicker",multiple:false,visibility:"hidden"},calendarPicker:{type:"sap.ui.unified.Calendar",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},cancel:{},startDateChange:{}}}});_.prototype.init=function(){this._iMode=0;this._oYearFormat=c.getDateInstance({format:"y"});this.data("sap-ui-fastnavgroup","true",true);this._oMinDate=new h(new Date(Date.UTC(1,0,1)));this._oMinDate.getJSDate().setUTCFullYear(1);this._oMaxDate=new h(new Date(Date.UTC(9999,11,31,23,59,59)));this._initializeHeader();this._initializeTimesRow();this._initilizeMonthPicker();this._initilizeYearPicker();this.setPickerPopup(false);this._iItemsHead=15};_.prototype._initializeHeader=function(){var e=new s(this.getId()+"--Head");e.attachEvent("pressPrevious",this._handlePrevious,this);e.attachEvent("pressNext",this._handleNext,this);this.setAggregation("header",e)};_.prototype._initializeTimesRow=function(){var e=new o(this.getId()+"--TimesRow");e.attachEvent("focus",B,this);e.attachEvent("select",E,this);e._bNoThemeChange=true;this.setAggregation("timesRow",e)};_.prototype._initilizeMonthPicker=function(){this.setAggregation("monthPicker",this._createMonthPicker())};_.prototype._initilizeYearPicker=function(){this.setAggregation("yearPicker",this._createYearPicker())};_.prototype._createDatesRow=function(){var e=new r(this.getId()+"--DatesRow",{days:18,selectedDates:[new sap.ui.unified.DateRange(this.getId()+"--Range")]});e.attachEvent("focus",V,this);e.attachEvent("select",O,this);e._bNoThemeChange=true;e.getIntervalSelection=function(){return this.getProperty("intervalSelection")};e.getSingleSelection=function(){return this.getProperty("singleSelection")};e.getSelectedDates=function(){return this.getAggregation("selectedDates",[])};e.getSpecialDates=function(){return this.getAggregation("specialDates",[])};e.getAriaLabelledBy=function(){return this.getAssociation("ariaLabelledBy",[])};return e};_.prototype._createMonthPicker=function(){var e=new n(this.getId()+"--MP",{columns:0,months:6});e.attachEvent("select",H,this);e._bNoThemeChange=true;e.attachEvent("pageChange",W,this);return e};_.prototype._createYearPicker=function(){var e=new g(this.getId()+"--YP",{columns:0,years:6});e.attachEvent("select",$,this);e.attachEvent("pageChange",X,this);e._oMinDate.setYear(this._oMinDate.getUTCFullYear());e._oMaxDate.setYear(this._oMaxDate.getUTCFullYear());return e};_.prototype.exit=function(){if(this._sInvalidateContent){e.sap.clearDelayedCall(this._sInvalidateContent)}};_.prototype.onBeforeRendering=function(){var e=this.getAggregation("timesRow");var t=this._getFocusedDate();b.call(this);e.displayDate(i._createLocalDate(t,true))};_.prototype._getCalendarPicker=function(){var t=this.getAggregation("calendarPicker");if(!t){t=new sap.ui.unified.Calendar(this.getId()+"--Cal",{});t.setPopupMode(true);t.attachEvent("select",J,this);t.attachEvent("cancel",function(t){this._oPopup.close();e.sap.focus(this.getAggregation("header").getDomRef("B1"))},this);this.setAggregation("calendarPicker",t)}return t};_.prototype.setStartDate=function(t){i._checkJSDateObject(t);if(e.sap.equal(this.getStartDate(),t)){return this}var a=t.getFullYear();i._checkYearInValidRange(a);var s=this.getMinDate();if(s&&t.getTime()<s.getTime()){e.sap.log.warning("startDate < minDate -> minDate as startDate set",this);t=new Date(s)}var o=this.getMaxDate();if(o&&t.getTime()>o.getTime()){e.sap.log.warning("startDate > maxDate -> maxDate as startDate set",this);t=new Date(o)}this.setProperty("startDate",t,true);var r=this.getAggregation("timesRow");r.setStartDate(t);this._oUTCStartDate=new h(r._getStartDate().getTime());b.call(this);var n=i._createLocalDate(this._getFocusedDate(),true);if(!r.checkDateFocusable(n)){this._setFocusedDate(this._oUTCStartDate);r.displayDate(t)}return this};_.prototype.invalidate=function(a){if(!this._bDateRangeChanged&&(!a||!(a instanceof sap.ui.unified.DateRange))){if(!a||!(a instanceof r||a instanceof n||a instanceof g||a instanceof s)){t.prototype.invalidate.apply(this,arguments)}}else if(this.getDomRef()&&this._iMode==0&&!this._sInvalidateContent){this._sInvalidateContent=e.sap.delayedCall(0,this,z)}};_.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("selectedDates");return e};_.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("selectedDates");return e};_.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("specialDates");return e};_.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("specialDates");return e};_.prototype.setIntervalMinutes=function(e){if(e>=720){throw new Error("Only intervals < 720 minutes are allowed; "+this)}if(1440%e>0){throw new Error("A day must be divisible by the interval size; "+this)}this.setProperty("intervalMinutes",e,false);var t=this.getAggregation("timesRow");var a=i._createLocalDate(this._getFocusedDate(),true);if(!t.checkDateFocusable(a)){var s=m.call(this);this._setFocusedDate(s);t.setDate(i._createLocalDate(s,true))}return this};_.prototype.setLocale=function(e){if(this._sLocale!=e){this._sLocale=e;this._oLocaleData=undefined;this.invalidate()}return this};_.prototype.getLocale=function(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};_.prototype._getFocusedDate=function(){if(!this._oFocusedDate){C.call(this)}return this._oFocusedDate};_.prototype._setFocusedDate=function(e){if(!(e instanceof h)){throw new Error("Date must be a UniversalDate object "+this)}this._oFocusedDate=new h(e.getTime())};_.prototype.focusDate=function(e){var t=false;var a=this.getAggregation("timesRow");if(!a.checkDateFocusable(e)){var s=i._createUniversalUTCDate(e,undefined,true);j.call(this,s);t=true}S.call(this,e,false);if(t){this.fireStartDateChange()}return this};_.prototype.displayDate=function(e){S.call(this,e,true);return this};_.prototype.setItems=function(e){this.setProperty("items",e,true);e=this._getItems();var t=this.getAggregation("timesRow");t.setItems(e);var a=i._createLocalDate(this._getFocusedDate(),true);if(!t.checkDateFocusable(a)){var s=m.call(this);this._setFocusedDate(s);t.setDate(i._createLocalDate(s,true))}if(!this.getPickerPopup()){var o=this.getAggregation("datesRow");var r=Math.floor(e*1.5);if(r>31){r=31}o.setDays(r);var n=this.getAggregation("monthPicker");var g=Math.floor(e/2);if(g>12){g=12}n.setMonths(g);var h=this.getAggregation("yearPicker");var l=Math.floor(e/2);if(l>20){l=20}h.setYears(l)}b.call(this);if(this.getDomRef()){if(this._getShowItemHeader()){this.$().addClass("sapUiCalIntHead")}else{this.$().removeClass("sapUiCalIntHead")}}return this};_.prototype._getItems=function(){var e=this.getItems();if(u.system.phone&&e>6){return 6}else{return e}};_.prototype._getLocaleData=function(){if(!this._oLocaleData){var e=this.getLocale();var t=new D(e);this._oLocaleData=a.getInstance(t)}return this._oLocaleData};_.prototype.setPickerPopup=function(e){var t=this.getAggregation("header"),a,i,s;this.setProperty("pickerPopup",e,true);if(a){a.destroy()}if(e){t.setVisibleButton0(false);t.setVisibleButton1(true);t.setVisibleButton2(false);t.detachEvent("pressButton1",Y,this);t.attachEvent("pressButton1",Y,this);if(this.getAggregation("datesRow")){this.getAggregation("datesRow").destroy()}if(this.getAggregation("monthPicker")){this.getAggregation("monthPicker").destroy()}if(this.getAggregation("yearPicker")){this.getAggregation("yearPicker").destroy()}}else{t.setVisibleButton0(true);t.setVisibleButton1(true);t.setVisibleButton2(true);t.detachEvent("pressButton0",N,this);t.attachEvent("pressButton0",N,this);t.detachEvent("pressButton1",Y,this);t.attachEvent("pressButton1",Y,this);t.detachEvent("pressButton2",L,this);t.attachEvent("pressButton2",L,this);if(!this.getAggregation("datesRow")){this.setAggregation("datesRow",this._createDatesRow())}if(!this.getAggregation("yearPicker")){this.setAggregation("yearPicker",this._createYearPicker())}if(!this.getAggregation("monthPicker")){this.setAggregation("monthPicker",this._createMonthPicker())}i=this.getAggregation("monthPicker");s=this.getAggregation("yearPicker");i.setColumns(0);i.setMonths(6);s.setColumns(0);s.setYears(6)}return this};_.prototype.setMinDate=function(t){var a,s,o,r;if(e.sap.equal(t,this.getMinDate())){return this}if(!t){i._updateUTCDate(this._oMinDate.getJSDate(),1,0,1,0,0,0,0)}else{i._checkJSDateObject(t);this._oMinDate=i._createUniversalUTCDate(t,undefined,true);a=this.getAggregation("timesRow");this._oMinDate=a._getIntervalStart(this._oMinDate);s=this._oMinDate.getUTCFullYear();i._checkYearInValidRange(s);if(this._oMaxDate.getTime()<this._oMinDate.getTime()){e.sap.log.warning("minDate > maxDate -> maxDate set to end of the month",this);this._oMaxDate=i._createUniversalUTCDate(t,undefined,true);i._updateUTCDate(this._oMaxDate,null,this._oMaxDate.getUTCMonth()+1,0,23,59,59,0);this.setProperty("maxDate",i._createLocalDate(this._oMaxDate,true),true)}if(this._oFocusedDate){if(this._oFocusedDate.getTime()<this._oMinDate.getTime()){e.sap.log.warning("focused date < minDate -> minDate focused",this);this.focusDate(t)}}if(this._oUTCStartDate&&this._oUTCStartDate.getTime()<this._oMinDate.getTime()){e.sap.log.warning("start date < minDate -> minDate set as start date",this);v.call(this,new h(this._oMinDate.getTime()),true,true)}}this.setProperty("minDate",t,false);if(this.getPickerPopup()){r=this._getCalendarPicker();r.setMinDate(t)}else{o=this.getAggregation("yearPicker");o._oMinDate.setYear(this._oMinDate.getUTCFullYear())}return this};_.prototype.setMaxDate=function(t){var a,s,o,r,n,g;if(e.sap.equal(t,this.getMaxDate())){return this}if(!t){i._updateUTCDate(this._oMaxDate.getJSDate(),9999,11,31,23,59,59,0)}else{i._checkJSDateObject(t);this._oMaxDate=i._createUniversalUTCDate(t,undefined,true);a=this.getAggregation("timesRow");this._oMaxDate=a._getIntervalStart(this._oMaxDate);this._oMaxDate.setUTCMinutes(this._oMaxDate.getUTCMinutes()+this.getIntervalMinutes());this._oMaxDate.setUTCMilliseconds(-1);s=this._oMaxDate.getUTCFullYear();i._checkYearInValidRange(s);if(this._oMinDate.getTime()>this._oMaxDate.getTime()){e.sap.log.warning("maxDate < minDate -> minDate set to begin of the month",this);this._oMinDate=i._createUniversalUTCDate(t,undefined,true);i._updateUTCDate(this._oMinDate,null,null,1,0,0,0,0);this.setProperty("minDate",i._createLocalDate(this._oMinDate,true),true)}if(this._oFocusedDate){if(this._oFocusedDate.getTime()>this._oMaxDate.getTime()){e.sap.log.warning("focused date > maxDate -> maxDate focused",this);this.focusDate(t)}}if(this._oUTCStartDate){o=new h(this._oUTCStartDate.getTime());o.setUTCMinutes(o.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1));if(o.getTime()>this._oMaxDate.getTime()){r=new h(this._oMaxDate.getTime());r.setUTCMinutes(r.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1));if(r.getTime()>=this._oMinDate.getTime()){e.sap.log.warning("end date > maxDate -> maxDate set as end date",this);v.call(this,r,true,true)}}}}this.setProperty("maxDate",t,false);if(this.getPickerPopup()){g=this._getCalendarPicker();g.setMaxDate(t)}else{n=this.getAggregation("yearPicker");n._oMaxDate.setYear(this._oMaxDate.getUTCFullYear())}return this};_.prototype.onclick=function(e){if(e.isMarked("delayedMouseEvent")){return}if(e.target.id==this.getId()+"-cancel"){this.onsapescape(e)}};_.prototype.onmousedown=function(e){e.preventDefault();e.setMark("cancelAutoClose")};_.prototype.onsapescape=function(e){if(this.getPickerPopup()){M.call(this);this.fireCancel()}else{switch(this._iMode){case 0:this.fireCancel();break;case 1:P.call(this);break;case 2:I.call(this);break;case 3:w.call(this);break}}};_.prototype.onsaptabnext=function(t){var a=this.getAggregation("header"),i,s,o;if(e.sap.containsOrEquals(this.getDomRef("content"),t.target)){if(this.getPickerPopup()){e.sap.focus(a.getDomRef("B1"))}else{e.sap.focus(a.getDomRef("B0"))}if(!this._bPoupupMode){o=this.getAggregation("timesRow");e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){i=this.getAggregation("monthPicker");s=this.getAggregation("yearPicker");if(i.getDomRef()){e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(s.getDomRef()){e(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}t.preventDefault()}else if(t.target.id==a.getId()+"-B0"){e.sap.focus(a.getDomRef("B1"));t.preventDefault()}else if(!this.getPickerPopup()&&t.target.id==a.getId()+"-B1"){e.sap.focus(a.getDomRef("B2"));t.preventDefault()}};_.prototype.onsaptabprevious=function(t){var a=this.getAggregation("header"),i,s,o;if(e.sap.containsOrEquals(this.getDomRef("content"),t.target)){if(this._bPoupupMode){e.sap.focus(a.getDomRef("B2"));t.preventDefault()}}else if(t.target.id==a.getId()+"-B0"){o=this.getAggregation("timesRow");switch(this._iMode){case 0:o._oItemNavigation.focusItem(o._oItemNavigation.getFocusedIndex());break;case 2:if(!this.getPickerPopup()){i=this.getAggregation("monthPicker");i._oItemNavigation.focusItem(i._oItemNavigation.getFocusedIndex())}break;case 3:if(!this.getPickerPopup()){s=this.getAggregation("yearPicker");s._oItemNavigation.focusItem(s._oItemNavigation.getFocusedIndex())}break}t.preventDefault()}else if(t.target.id==a.getId()+"-B2"){e.sap.focus(a.getDomRef("B1"));t.preventDefault()}else if(t.target.id==a.getId()+"-B1"){if(!this.getPickerPopup()){e.sap.focus(a.getDomRef("B0"))}else{o=this.getAggregation("timesRow");o._oItemNavigation.focusItem(o._oItemNavigation.getFocusedIndex())}t.preventDefault()}};_.prototype.onfocusin=function(t){if(t.target.id==this.getId()+"-end"){var a=this.getAggregation("header"),i,s,o;if(this.getPickerPopup()){e.sap.focus(a.getDomRef("B1"))}else{e.sap.focus(a.getDomRef("B2"))}if(!this._bPoupupMode){i=this.getAggregation("timesRow");e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){s=this.getAggregation("monthPicker");o=this.getAggregation("yearPicker");if(s.getDomRef()){e(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(o.getDomRef()){e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}}this.$("end").attr("tabindex","-1")};_.prototype.onsapfocusleave=function(t){if(!t.relatedControlId||!e.sap.containsOrEquals(this.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){this.$("end").attr("tabindex","0");if(!this._bPoupupMode){var a,i,s;switch(this._iMode){case 0:a=this.getAggregation("timesRow");e(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0");break;case 2:if(!this.getPickerPopup()){i=this.getAggregation("monthPicker");e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break;case 3:if(!this.getPickerPopup()){s=this.getAggregation("yearPicker");e(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break}}}};_.prototype._handlePrevious=function(e){var t=this._getFocusedDate(),a,s,o,r,n,g,l,c;switch(this._iMode){case 0:a=this._getItems();s=new h(m.call(this).getTime());o=this.getIntervalMinutes();s.setUTCMinutes(s.getUTCMinutes()-a*o);t.setUTCMinutes(t.getUTCMinutes()-a*o);this._setFocusedDate(t);v.call(this,s,true);break;case 1:if(!this.getPickerPopup()){r=this.getAggregation("datesRow");n=i._createUniversalUTCDate(r.getDate());g=r.getDays();if(n.getUTCDate()<=g){n.setUTCDate(1)}else{n.setUTCDate(n.getUTCDate()-g)}q.call(this,n)}break;case 2:if(!this.getPickerPopup()){l=this.getAggregation("monthPicker");if(l.getMonths()<12){l.previousPage();x.call(this)}else{t.setUTCFullYear(t.getUTCFullYear()-1);j.call(this,t);this._setFocusedDate(t);b.call(this);Q.call(this,t.getUTCFullYear(),l);this.fireStartDateChange()}}break;case 3:if(!this.getPickerPopup()){c=this.getAggregation("yearPicker");c.previousPage();F.call(this)}break}};_.prototype._handleNext=function(e){var t=this._getFocusedDate();switch(this._iMode){case 0:var a=this._getItems();var s=new h(m.call(this).getTime());var o=this.getIntervalMinutes();s.setUTCMinutes(s.getUTCMinutes()+a*o);t.setUTCMinutes(t.getUTCMinutes()+a*o);this._setFocusedDate(t);v.call(this,s,true);break;case 1:if(!this.getPickerPopup()){var r=this.getAggregation("datesRow");var n=i._createUniversalUTCDate(r.getDate());var g=new h(n.getTime());g.setUTCDate(1);g.setUTCMonth(g.getUTCMonth()+1);g.setUTCDate(0);var l=r.getDays();if(n.getUTCDate()+l>g.getUTCDate()){n.setUTCDate(g.getUTCDate())}else{n.setUTCDate(n.getUTCDate()+l)}q.call(this,n)}break;case 2:if(!this.getPickerPopup()){var c=this.getAggregation("monthPicker");if(c.getMonths()<12){c.nextPage();x.call(this)}else{t.setUTCFullYear(t.getUTCFullYear()+1);j.call(this,t);this._setFocusedDate(t);b.call(this);Q.call(this,t.getUTCFullYear(),c);this.fireStartDateChange()}}break;case 3:if(!this.getPickerPopup()){var u=this.getAggregation("yearPicker");u.nextPage();F.call(this)}break}};_.prototype._getShowItemHeader=function(){var e=this.getItems();if(e>this._iItemsHead){return true}else{return false}};function v(e,t,a){var s=new h(this._oMaxDate.getTime());s.setUTCMinutes(s.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1));if(s.getTime()<this._oMinDate.getTime()){s=new h(this._oMinDate.getTime());s.setUTCMinutes(s.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1))}if(e.getTime()<this._oMinDate.getTime()){e=new h(this._oMinDate.getTime())}else if(e.getTime()>s.getTime()){e=s}var o=this.getAggregation("timesRow");var r=i._createLocalDate(e,true);o.setStartDate(r);this._oUTCStartDate=new h(o._getStartDate().getTime());r=i._createLocalDate(this._oUTCStartDate,true);this.setProperty("startDate",r,true);b.call(this);if(t){var n=i._createLocalDate(this._getFocusedDate(),true);if(!o.checkDateFocusable(n)){this._setFocusedDate(e);o.setDate(r)}else{o.setDate(n)}}if(!a){this.fireStartDateChange()}}function m(){if(!this._oUTCStartDate){var e=this.getAggregation("timesRow");e.setStartDate(i._createLocalDate(this._getFocusedDate(),true));this._oUTCStartDate=new h(e._getStartDate().getTime());this._setFocusedDate(this._oUTCStartDate)}return this._oUTCStartDate}function T(e){var t=this._getFocusedDate();var a=this.getAggregation("timesRow");if(!e){a.setDate(i._createLocalDate(t,true))}else{a.displayDate(i._createLocalDate(t,true))}b.call(this)}function C(){var e=this.getSelectedDates();if(e&&e[0]&&e[0].getStartDate()){this._oFocusedDate=i._createUniversalUTCDate(e[0].getStartDate(),undefined,true)}else{var t=new Date;this._oFocusedDate=i._createUniversalUTCDate(t,undefined,true)}if(this._oFocusedDate.getTime()<this._oMinDate.getTime()){this._oFocusedDate=new h(this._oMinDate.getTime())}else if(this._oFocusedDate.getTime()>this._oMaxDate.getTime()){this._oFocusedDate=new h(this._oMaxDate.getTime())}}_.prototype._showCalendarPicker=function(){var e=i._createLocalDate(this._getFocusedDate(),true);var t=this._getCalendarPicker();var a=new sap.ui.unified.DateRange({startDate:e});t.displayDate(e,false);t.removeAllSelectedDates();t.addSelectedDate(a);t.setMinDate(this.getMinDate());t.setMaxDate(this.getMaxDate());G.call(this,t);this._showOverlay()};_.prototype._showOverlay=function(){this.$("contentOver").css("display","")};_.prototype._hideOverlay=function(){this.$("contentOver").css("display","none")};function M(t){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close()}this._hideOverlay();if(!t){T.call(this);var a=this.getAggregation("timesRow");e(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function U(){if(this._iMode==3){w.call(this,true)}else if(this._iMode==2){I.call(this,true)}var t=this._getFocusedDate();var a=this._getItems();var s=this.getAggregation("datesRow");var o=s.getSelectedDates()[0];o.setStartDate(i._createLocalDate(t,true));var r=new h(t.getTime());r.setUTCDate(1);r.setUTCMonth(r.getUTCMonth()+1);r.setUTCDate(0);var n=r.getUTCDate();var g=Math.floor(a*1.5);if(g>n){g=n}s.setDays(g);if(s.getDomRef()){s.$().css("display","")}else{var l=sap.ui.getCore().createRenderManager();var c=this.$("content");l.renderControl(s);l.flush(c[0],false,true);l.destroy()}this._showOverlay();q.call(this,t);if(this._iMode==0){var u=this.getAggregation("timesRow");e(u._oItemNavigation.getItemDomRefs()[u._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}this._iMode=1}function P(t){this._iMode=0;var a=this.getAggregation("datesRow");a.$().css("display","none");this._hideOverlay();if(!t){T.call(this);var i=this.getAggregation("timesRow");e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function y(){if(this._iMode==1){P.call(this,true)}else if(this._iMode==3){w.call(this,true)}var t=this._getFocusedDate();var a=this.getAggregation("monthPicker");if(a.getDomRef()){a.$().css("display","")}else{var i=sap.ui.getCore().createRenderManager();var s=this.$("content");i.renderControl(a);i.flush(s[0],false,true);i.destroy()}this._showOverlay();a.setMonth(t.getUTCMonth());Q.call(this,t.getUTCFullYear(),a);if(this._iMode==0){var o=this.getAggregation("timesRow");e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}this._iMode=2;x.call(this)}function I(t){this._iMode=0;var a=this.getAggregation("monthPicker");a.$().css("display","none");this._hideOverlay();if(!t){T.call(this);var i=this.getAggregation("timesRow");e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function k(){if(this._iMode==1){P.call(this,true)}else if(this._iMode==2){I.call(this,true)}var t=this._getFocusedDate();var a=this.getAggregation("yearPicker");if(a.getDomRef()){a.$().css("display","")}else{var i=sap.ui.getCore().createRenderManager();var s=this.$("content");i.renderControl(a);i.flush(s[0],false,true);i.destroy()}this._showOverlay();a.setDate(t.getJSDate());if(this._iMode==0){var o=this.getAggregation("timesRow");e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}F.call(this);this._iMode=3}function w(t){this._iMode=0;var a=this.getAggregation("yearPicker");a.$().css("display","none");this._hideOverlay();if(!t){T.call(this);var i=this.getAggregation("timesRow");e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function b(){R.call(this);x.call(this,true)}function x(e){var t=new h(m.call(this).getTime());var a=this._getItems();var i=t.getJSDate().getUTCFullYear();var s=this._oMaxDate.getJSDate().getUTCFullYear();var o=this._oMinDate.getJSDate().getUTCFullYear();var r=t.getJSDate().getUTCMonth();var n=this._oMaxDate.getJSDate().getUTCMonth();var g=this._oMinDate.getJSDate().getUTCMonth();var l=t.getJSDate().getUTCDate();var c=this._oMaxDate.getJSDate().getUTCDate();var u=this._oMinDate.getJSDate().getUTCDate();var D=t.getJSDate().getUTCHours();var d=this._oMaxDate.getJSDate().getUTCHours();var f=this._oMinDate.getJSDate().getUTCHours();var p=t.getJSDate().getUTCMinutes();var _=this._oMaxDate.getJSDate().getUTCMinutes();var v=this._oMinDate.getJSDate().getUTCMinutes();var T=this.getAggregation("header");if(this._iMode==2&&!e){var C=this.getAggregation("monthPicker");var M=C.getMonths();var U=C.getStartMonth();var P=U+M-1;if(U==0||i==o&&U<=g){T.setEnabledPrevious(false)}else{T.setEnabledPrevious(true)}if(P>10||i==s&&P>=n){T.setEnabledNext(false)}else{T.setEnabledNext(true)}return}if(i<o||i==o&&(!e||(r<g||r==g&&(l<u||l==u&&(D<f||D==f&&p<=v))))||(this._iMode==1||this._iMode==2)&&this.getPickerPopup()){T.setEnabledPrevious(false)}else{T.setEnabledPrevious(true)}t.setUTCMinutes(t.getUTCMinutes()+a*this.getIntervalMinutes()-1);i=t.getJSDate().getUTCFullYear();r=t.getJSDate().getUTCMonth();l=t.getJSDate().getUTCDate();D=t.getJSDate().getUTCHours();p=t.getJSDate().getUTCMinutes();if(i>s||i==s&&(!e||(r>n||r==n&&(l>c||l==c&&(D>d||D==d&&p>=_))))||(this._iMode==1||this._iMode==2)&&this.getPickerPopup()){T.setEnabledNext(false)}else{T.setEnabledNext(true)}}function F(){var e=this.getAggregation("yearPicker");var t=e.getYears();var a=i._createUniversalUTCDate(e.getFirstRenderedDate());a.setUTCFullYear(a.getUTCFullYear()+Math.floor(t/2));var s=this.getAggregation("header");var o=new h(this._oMaxDate);o.setUTCFullYear(o.getUTCFullYear()-Math.ceil(t/2));o.setUTCMonth(11,31);var r=new h(this._oMinDate);r.setUTCFullYear(r.getUTCFullYear()+Math.floor(t/2)+1);r.setUTCMonth(0,1);if(a.getTime()>o.getTime()){s.setEnabledNext(false)}else{s.setEnabledNext(true)}if(a.getTime()<r.getTime()){s.setEnabledPrevious(false)}else{s.setEnabledPrevious(true)}}function R(){var e=this.getAggregation("header");var t;var a=m.call(this);var s;var o=this._getLocaleData();var r=[];var n=[];var g;var h=false;var l;var u=p.Gregorian;var D=false;if(o.oLocale.sLanguage.toLowerCase()==="ja"||o.oLocale.sLanguage.toLowerCase()==="zh"){l=c.getDateInstance({format:"d"}).format(a,true)}else{l=a.getUTCDate().toString()}if(this._bLongMonth||!this._bNamesLengthChecked){r=o.getMonthsStandAlone("wide")}else{h=true;r=o.getMonthsStandAlone("abbreviated");n=o.getMonthsStandAlone("wide")}var d=a.getUTCMonth();t=r[d];if(h){g=n[r[d]]}if(!this.getPickerPopup()){e.setTextButton0(l);e.setTextButton1(t);e.setTextButton2(this._oYearFormat.format(a,true))}else{s=c.getInstance({style:"long",strictParsing:true,relative:D,calendarType:u},o.oLocale);g=l=s.format(i._createLocalDate(a,true));e.setTextButton1(l)}if(h){e.setAriaLabelButton1(g)}}function A(e,t){var a;var i=false;if(e.getTime()<this._oMinDate.getTime()){a=this._oMinDate;i=true}else if(e.getTime()>this._oMaxDate.getTime()){a=this._oMaxDate;i=true}else{a=e}this._setFocusedDate(a);if(i||t){j.call(this,a);T.call(this,false);this.fireStartDateChange()}}function S(e,t){if(e&&(!this._oFocusedDate||this._oFocusedDate.getTime()!=e.getTime())){i._checkJSDateObject(e);e=i._createUniversalUTCDate(e,undefined,true);var a=e.getUTCFullYear();i._checkYearInValidRange(a);if(e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime()){throw new Error("Date must not be in valid range (minDate and maxDate); "+this)}this._setFocusedDate(e);if(this.getDomRef()&&this._iMode==0){T.call(this,t)}}}function N(e){if(this._iMode!=1){U.call(this)}else{P.call(this)}}function Y(e){if(this.getPickerPopup()){this._showCalendarPicker()}else{if(this._iMode!=2){y.call(this)}else{I.call(this)}}}function L(e){if(this._iMode!=3){k.call(this)}else{w.call(this)}}function E(e){this.fireSelect()}function B(e){var t=i._createUniversalUTCDate(e.getParameter("date"),undefined,true);var a=e.getParameter("notVisible");A.call(this,t,a)}function J(e){var t=e.getSource(),a=t.getSelectedDates()[0].getStartDate();var s=new h(this._getFocusedDate().getTime());var o=i._createUniversalUTCDate(a);s.setUTCDate(o.getUTCDate());s.setUTCMonth(o.getUTCMonth());s.setUTCFullYear(o.getUTCFullYear());A.call(this,s,true);M.call(this)}function O(e){var t=new h(this._getFocusedDate().getTime());var a=e.oSource;var s=a.getSelectedDates()[0];var o=i._createUniversalUTCDate(s.getStartDate());if(!this.getPickerPopup()||o.getUTCMonth()==t.getUTCMonth()){t.setUTCDate(o.getUTCDate());t.setUTCMonth(o.getUTCMonth());t.setUTCFullYear(o.getUTCFullYear());A.call(this,t,true);P.call(this)}}function V(e){var t=new h(this._getFocusedDate().getTime());var a=i._createUniversalUTCDate(e.getParameter("date"),undefined,true);var s=e.getParameter("otherMonth");if(s&&a.getUTCMonth()==t.getUTCMonth()&&a.getUTCFullYear()==t.getUTCFullYear()){q.call(this,a)}}function H(e){var t=new h(this._getFocusedDate().getTime());var a=this.getAggregation("monthPicker");var i=a.getMonth();t.setUTCMonth(i);if(i!=t.getUTCMonth()){t.setUTCDate(0)}A.call(this,t,true);I.call(this)}function $(e){var t=new h(this._getFocusedDate().getTime());var a=this.getAggregation("yearPicker");var s=i._createUniversalUTCDate(a.getDate());var o=t.getUTCMonth();s.setUTCMonth(t.getUTCMonth(),t.getUTCDate());s.setUTCHours(t.getUTCHours());s.setUTCMinutes(t.getUTCMinutes());t=s;if(o!=t.getUTCMonth()){t.setUTCDate(0)}A.call(this,t,true);w.call(this)}function z(){this._sInvalidateContent=undefined;var e=this.getAggregation("timesRow");e._bDateRangeChanged=true;e._bInvalidateSync=true;e.invalidate();e._bInvalidateSync=undefined;this._bDateRangeChanged=undefined}function j(e){var t=this.getAggregation("timesRow");var a=m.call(this);var i=t._oItemNavigation.getFocusedIndex();a=new h(e.getTime());a.setUTCMinutes(a.getUTCMinutes()-i*this.getIntervalMinutes());v.call(this,a,false,true)}function q(e){var t=this.getAggregation("datesRow");var a=this.getAggregation("header");if(!this.getPickerPopup()){var s=new h(e.getTime());s.setUTCDate(1);s.setUTCMonth(s.getUTCMonth()+1);s.setUTCDate(0);var o=t.getDays();var r=new h(e.getTime());r.setUTCDate(1+(Math.ceil(e.getUTCDate()/o)-1)*o);if(s.getUTCDate()-r.getUTCDate()<o){r.setUTCDate(s.getUTCDate()-o+1)}t.setStartDate(i._createLocalDate(r,true));var n=r.getJSDate().getUTCFullYear();var g=this._oMaxDate.getJSDate().getUTCFullYear();var l=this._oMinDate.getJSDate().getUTCFullYear();var c=r.getJSDate().getUTCMonth();var u=this._oMaxDate.getJSDate().getUTCMonth();var D=this._oMinDate.getJSDate().getUTCMonth();var d=r.getJSDate().getUTCDate();var f=this._oMaxDate.getJSDate().getUTCDate();var p=this._oMinDate.getJSDate().getUTCDate();if(d<=1||n==l&&c==D&&d<=p){a.setEnabledPrevious(false)}else{a.setEnabledPrevious(true)}if(d+o>=s.getUTCDate()||n==g&&c==u&&d>=f){a.setEnabledNext(false)}else{a.setEnabledNext(true)}}else{a.setEnabledPrevious(false);a.setEnabledNext(false)}t.setDate(i._createLocalDate(e,true))}function G(t){if(!this._oPopup){e.sap.require("sap.ui.core.Popup");this._oPopup=new sap.ui.core.Popup;this._oPopup.setAutoClose(true);this._oPopup.setAutoCloseAreas([this.getDomRef()]);this._oPopup.setDurations(0,0);this._oPopup._oCalendar=this;this._oPopup.attachClosed(K,this);this._oPopup.onsapescape=function(e){this._oCalendar.onsapescape(e)}}this._oPopup.setContent(t);var a=this.getAggregation("header");var i=sap.ui.core.Popup.Dock;this._oPopup.open(0,i.CenterTop,i.CenterTop,a,null,"flipfit",true)}function K(e){M.call(this)}function Q(e,t){var a=0;var i=11;if(e==this._oMinDate.getUTCFullYear()){a=this._oMinDate.getUTCMonth()}if(e==this._oMaxDate.getUTCFullYear()){i=this._oMaxDate.getUTCMonth()}t.setMinMax(a,i)}function W(e){x.call(this)}function X(e){F.call(this)}return _});