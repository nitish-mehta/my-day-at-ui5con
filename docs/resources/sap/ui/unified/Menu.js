/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Element","sap/ui/core/Control","sap/ui/Device","sap/ui/core/Popup","./MenuItemBase","./library","sap/ui/core/library","sap/ui/unified/MenuRenderer","jquery.sap.script","jquery.sap.keycodes","jquery.sap.events"],function(e,t,i,o,n,s,r,a,p){"use strict";var u=n.Dock;var h=a.OpenState;var l=i.extend("sap.ui.unified.Menu",{metadata:{interfaces:["sap.ui.core.IContextMenu"],library:"sap.ui.unified",properties:{enabled:{type:"boolean",group:"Behavior",defaultValue:true},ariaDescription:{type:"string",group:"Accessibility",defaultValue:null},maxVisibleItems:{type:"int",group:"Behavior",defaultValue:0},pageSize:{type:"int",group:"Behavior",defaultValue:5}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.unified.MenuItemBase",multiple:true,singularName:"item"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{itemSelect:{parameters:{item:{type:"sap.ui.unified.MenuItemBase"}}}}}});(function(r){l.prototype.bCozySupported=true;l._DELAY_SUBMENU_TIMER=300;l._DELAY_SUBMENU_TIMER_EXT=400;l.prototype.init=function(){var t=this;this.bOpen=false;this.oOpenedSubMenu=null;this.oHoveredItem=null;this.oPopup=null;this._bOpenedAsContextMenu=false;this.fAnyEventHandlerProxy=e.proxy(function(e){var t=this.getRootMenu();if(t!=this||!this.bOpen||!this.getDomRef()||e.type!="mousedown"&&e.type!="touchstart"){return}t.handleOuterEvent(this.getId(),e)},this);this.fOrientationChangeHandler=function(){t.close()};this.bUseTopStyle=false};l.prototype.exit=function(){if(this.oPopup){this.oPopup.detachClosed(this._menuClosed,this);this.oPopup.destroy();delete this.oPopup}e.sap.unbindAnyEvent(this.fAnyEventHandlerProxy);if(this._bOrientationChangeBound){e(r).unbind("orientationchange",this.fOrientationChangeHandler);this._bOrientationChangeBound=false}this._resetDelayedRerenderItems();this._detachResizeHandler()};l.prototype.invalidate=function(e){if(e instanceof s&&this.getDomRef()){this._delayedRerenderItems()}else{i.prototype.invalidate.apply(this,arguments)}};l.prototype.onBeforeRendering=function(){this._resetDelayedRerenderItems()};l.prototype.onAfterRendering=function(){if(this.$().parent().attr("id")!="sap-ui-static"){e.sap.log.error("sap.ui.unified.Menu: The Menu is popup based and must not be rendered directly as content of the page.");this.close();this.$().remove()}var t=this.getItems();for(var i=0;i<t.length;i++){if(t[i].onAfterRendering&&t[i].getDomRef()){t[i].onAfterRendering()}}if(this.oHoveredItem){this.oHoveredItem.hover(true,this)}d(this)};l.prototype.onThemeChanged=function(){if(this.getDomRef()&&this.getPopup().getOpenState()===h.OPEN){d(this);this.getPopup()._applyPosition(this.getPopup()._oLastPosition)}};l.prototype.setPageSize=function(e){return this.setProperty("pageSize",e,true)};l.prototype.addItem=function(e){this.addAggregation("items",e,!!this.getDomRef());this._delayedRerenderItems();return this};l.prototype.insertItem=function(e,t){this.insertAggregation("items",e,t,!!this.getDomRef());this._delayedRerenderItems();return this};l.prototype.removeItem=function(e){this.removeAggregation("items",e,!!this.getDomRef());this._delayedRerenderItems();return this};l.prototype.removeAllItems=function(){var e=this.removeAllAggregation("items",!!this.getDomRef());this._delayedRerenderItems();return e};l.prototype.destroyItems=function(){this.destroyAggregation("items",!!this.getDomRef());this._delayedRerenderItems();return this};l.prototype._delayedRerenderItems=function(){if(!this.getDomRef()){return}this._resetDelayedRerenderItems();this._discardOpenSubMenuDelayed();this._itemRerenderTimer=e.sap.delayedCall(0,this,function(){var e=this.getDomRef();if(e){var t=sap.ui.getCore().createRenderManager();p.renderItems(t,this);t.flush(e);t.destroy();this.onAfterRendering();this.getPopup()._applyPosition(this.getPopup()._oLastPosition)}})};l.prototype._resetDelayedRerenderItems=function(){if(this._itemRerenderTimer){e.sap.clearDelayedCall(this._itemRerenderTimer);delete this._itemRerenderTimer}};l.prototype._detachResizeHandler=function(){if(this._hasResizeListener){o.resize.detachHandler(this._handleResizeChange,this);this._hasResizeListener=false}};l.prototype.open=function(t,i,n,s,a,p,u){if(this.bOpen){return}f(this,true);this.oOpenerRef=i;this.bIgnoreOpenerDOMRef=false;this.getPopup().open(0,n,s,a,p||"0 0",u||"_sapUiCommonsMenuFlip _sapUiCommonsMenuFlip",true);this.bOpen=true;o.resize.attachHandler(this._handleResizeChange,this);this._hasResizeListener=true;var h=this.getDomRef();e(h).attr("tabIndex",0).focus();if(t){this.setHoveredItem(this.getNextSelectableItem(-1))}e.sap.bindAnyEvent(this.fAnyEventHandlerProxy);if(o.support.orientation&&this.getRootMenu()===this){e(r).bind("orientationchange",this.fOrientationChangeHandler);this._bOrientationChangeBound=true}};l.prototype._handleResizeChange=function(){this.getPopup()._applyPosition(this.getPopup()._oLastPosition)};l.prototype.openAsContextMenu=function(i,o){var n,s,r,a,p;o=o instanceof t?o.getDomRef():o;if(i instanceof e.Event){p=e(o).offset();n=i.pageX-p.left;s=i.pageY-p.top;this._iX=i.clientX;this._iY=i.clientY}else{n=i.offsetX||0;s=i.offsetY||0;this._iX=i.left||0;this._iY=i.top||0}r=sap.ui.getCore().getConfiguration().getRTL();a=u;if(r){n=o.clientWidth-n}this._bOpenedAsContextMenu=true;this.open(true,o,a.BeginTop,a.BeginTop,o,n+" "+s,"fit")};l.prototype._handleOpened=function(){var t,i,o,n,s,a,p,u,h,l;if(!this._bOpenedAsContextMenu){return}t=this.$();i=e(r);o=this._iX;n=this._iY;s=i.scrollLeft()+i.width();a=i.scrollTop()+i.height();p=sap.ui.getCore().getConfiguration().getRTL();u=false;h=t.width();l=t.height();if(n+l>a){n=n-l;u=true}if(p){if(s-o+h>s){o=s-(o+h);u=true}else{o=s-o;u=true}}else{if(o+h>s){o=o-h;u=true}}this._bOpenedAsContextMenu=false;u&&this.oPopup.setPosition("begin top","begin top",i,o+" "+n,"flip")};l.prototype.close=function(){if(!this.bOpen||l._dbg){return}this._discardOpenSubMenuDelayed();f(this,false);delete this._bFixed;e.sap.unbindAnyEvent(this.fAnyEventHandlerProxy);if(this._bOrientationChangeBound){e(r).unbind("orientationchange",this.fOrientationChangeHandler);this._bOrientationChangeBound=false}this.bOpen=false;this.closeSubmenu();this.setHoveredItem();e(this.getDomRef()).attr("tabIndex",-1);this.getPopup().close(0);this._detachResizeHandler();this._resetDelayedRerenderItems();this.$().remove();this.bOutput=false;if(this.isSubMenu()){this.getParent().getParent().oOpenedSubMenu=null}};l.prototype._menuClosed=function(){if(this.oOpenerRef){if(!this.bIgnoreOpenerDOMRef){try{this.oOpenerRef.focus()}catch(t){e.sap.log.warning("Menu.close cannot restore the focus on opener "+this.oOpenerRef+", "+t)}}this.oOpenerRef=undefined}};l.prototype.onclick=function(e){this.selectItem(this.getItemByDomRef(e.target),false,!!(e.metaKey||e.ctrlKey));e.preventDefault();e.stopPropagation()};l.prototype.onsapnext=function(t){if(t.keyCode!=e.sap.KeyCodes.ARROW_DOWN){if(this.oHoveredItem&&this.oHoveredItem.getSubmenu()&&this.checkEnabled(this.oHoveredItem)){this.openSubmenu(this.oHoveredItem,true)}return}var i=this.oHoveredItem?this.indexOfAggregation("items",this.oHoveredItem):-1;this.setHoveredItem(this.getNextSelectableItem(i));t.preventDefault();t.stopPropagation()};l.prototype.onsapprevious=function(t){if(t.keyCode!=e.sap.KeyCodes.ARROW_UP){if(this.isSubMenu()){this.close()}t.preventDefault();t.stopPropagation();return}var i=this.oHoveredItem?this.indexOfAggregation("items",this.oHoveredItem):-1;this.setHoveredItem(this.getPreviousSelectableItem(i));t.preventDefault();t.stopPropagation()};l.prototype.onsaphome=function(e){this.setHoveredItem(this.getNextSelectableItem(-1));e.preventDefault();e.stopPropagation()};l.prototype.onsapend=function(e){this.setHoveredItem(this.getPreviousSelectableItem(this.getItems().length));e.preventDefault();e.stopPropagation()};l.prototype.onsappagedown=function(e){if(this.getPageSize()<1){this.onsapend(e);return}var t=this.oHoveredItem?this.indexOfAggregation("items",this.oHoveredItem):-1;t+=this.getPageSize();if(t>=this.getItems().length){this.onsapend(e);return}this.setHoveredItem(this.getNextSelectableItem(t-1));e.preventDefault();e.stopPropagation()};l.prototype.onsappageup=function(e){if(this.getPageSize()<1){this.onsaphome(e);return}var t=this.oHoveredItem?this.indexOfAggregation("items",this.oHoveredItem):-1;t-=this.getPageSize();if(t<0){this.onsaphome(e);return}this.setHoveredItem(this.getPreviousSelectableItem(t+1));e.preventDefault();e.stopPropagation()};l.prototype.onsapselect=function(e){this._sapSelectOnKeyDown=true;e.preventDefault();e.stopPropagation()};l.prototype.onkeyup=function(t){if(this.oHoveredItem&&e(t.target).prop("tagName")!="INPUT"){var i=this.oHoveredItem.getDomRef();e(i).attr("tabIndex",0).focus()}if(!this._sapSelectOnKeyDown){return}else{this._sapSelectOnKeyDown=false}if(!e.sap.PseudoEvents.sapselect.fnCheck(t)){return}this.selectItem(this.oHoveredItem,true,false);t.preventDefault();t.stopPropagation()};l.prototype.onsapbackspace=function(t){if(e(t.target).prop("tagName")!="INPUT"){t.preventDefault()}};l.prototype.onsapbackspacemodifiers=l.prototype.onsapbackspace;l.prototype.onsapescape=function(e){this.close();e.preventDefault();e.stopPropagation()};l.prototype.onsaptabnext=l.prototype.onsapescape;l.prototype.onsaptabprevious=l.prototype.onsapescape;l.prototype.onmouseover=function(t){if(!o.system.desktop){return}var i=this.getItemByDomRef(t.target);if(!this.bOpen||!i||i==this.oHoveredItem){return}if(this.oOpenedSubMenu&&e.sap.containsOrEquals(this.oOpenedSubMenu.getDomRef(),t.target)){return}this.setHoveredItem(i);if(e.sap.checkMouseEnterOrLeave(t,this.getDomRef())){if(!o.browser.msie&&!o.browser.edge){this.getDomRef().focus()}}if(o.browser.msie){this.getDomRef().focus()}this._openSubMenuDelayed(i)};l.prototype._openSubMenuDelayed=function(t){if(!t){return}this._discardOpenSubMenuDelayed();this._delayedSubMenuTimer=e.sap.delayedCall(t.getSubmenu()&&this.checkEnabled(t)?l._DELAY_SUBMENU_TIMER:l._DELAY_SUBMENU_TIMER_EXT,this,function(){this.closeSubmenu();if(!t.getSubmenu()||!this.checkEnabled(t)){return}this.setHoveredItem(t);this.openSubmenu(t,false,true)})};l.prototype._discardOpenSubMenuDelayed=function(t){if(this._delayedSubMenuTimer){e.sap.clearDelayedCall(this._delayedSubMenuTimer);this._delayedSubMenuTimer=null}};l.prototype.onmouseout=function(t){if(!o.system.desktop){return}if(e.sap.checkMouseEnterOrLeave(t,this.getDomRef())){if(!this.oOpenedSubMenu||!(this.oOpenedSubMenu.getParent()===this.oHoveredItem)){this.setHoveredItem(null)}this._discardOpenSubMenuDelayed()}};l.prototype.onsapfocusleave=function(e){if(this.oOpenedSubMenu||!this.bOpen){return}this.getRootMenu().handleOuterEvent(this.getId(),e)};l.prototype.handleOuterEvent=function(t,i){var o=false,n=this.getPopup().touchEnabled;this.bIgnoreOpenerDOMRef=false;if(i.type=="mousedown"||i.type=="touchstart"){if(n&&(i.isMarked("delayedMouseEvent")||i.isMarked("cancelAutoClose"))){return}var s=this;while(s&&!o){if(e.sap.containsOrEquals(s.getDomRef(),i.target)){o=true}s=s.oOpenedSubMenu}}else if(i.type=="sapfocusleave"){if(n){return}if(i.relatedControlId){var s=this;while(s&&!o){if(s.oOpenedSubMenu&&s.oOpenedSubMenu.getId()==i.relatedControlId||e.sap.containsOrEquals(s.getDomRef(),e.sap.byId(i.relatedControlId).get(0))){o=true}s=s.oOpenedSubMenu}}if(!o){this.bIgnoreOpenerDOMRef=true}}if(!o){this.close()}};l.prototype.getItemByDomRef=function(t){var i=this.getItems(),o=i.length;for(var n=0;n<o;n++){var s=i[n],r=s.getDomRef();if(e.sap.containsOrEquals(r,t)){return s}}return null};l.prototype.selectItem=function(e,t,i){if(!e||!(e instanceof s&&this.checkEnabled(e))){return}var n=e.getSubmenu();if(!n){this.getRootMenu().close()}else{if(!o.system.desktop&&this.oOpenedSubMenu===n){this.closeSubmenu()}else{this.openSubmenu(e,t)}}e.fireSelect({item:e,ctrlKey:i});this.getRootMenu().fireItemSelect({item:e})};l.prototype.isSubMenu=function(){return this.getParent()&&this.getParent().getParent&&this.getParent().getParent()instanceof l};l.prototype.getRootMenu=function(){var e=this;while(e.isSubMenu()){e=e.getParent().getParent()}return e};l.prototype.getMenuLevel=function(){var e=1;var t=this;while(t.isSubMenu()){t=t.getParent().getParent();e++}return e};l.prototype.getPopup=function(){if(!this.oPopup){this.oPopup=new n(this,false,true,false);this.oPopup.setDurations(0,0);this.oPopup.attachClosed(this._menuClosed,this);this.oPopup.attachOpened(this._handleOpened,this)}return this.oPopup};l.prototype.setHoveredItem=function(t){if(this.oHoveredItem){this.oHoveredItem.hover(false,this)}if(!t){this.oHoveredItem=null;e(this.getDomRef()).removeAttr("aria-activedescendant");return}this.oHoveredItem=t;t.hover(true,this);this._setActiveDescendant(this.oHoveredItem);this.scrollToItem(this.oHoveredItem)};l.prototype._setActiveDescendant=function(e){if(sap.ui.getCore().getConfiguration().getAccessibility()&&e){var t=this;t.$().removeAttr("aria-activedescendant");setTimeout(function(){if(t.oHoveredItem===e){t.$().attr("aria-activedescendant",t.oHoveredItem.getId())}},10)}};l.prototype.openSubmenu=function(e,t,i){var o=e.getSubmenu();if(!o){return}if(this.oOpenedSubMenu&&this.oOpenedSubMenu!==o){this.closeSubmenu()}if(this.oOpenedSubMenu){this.oOpenedSubMenu._bFixed=i&&this.oOpenedSubMenu._bFixed||!i&&!this.oOpenedSubMenu._bFixed;this.oOpenedSubMenu._bringToFront()}else{this.oOpenedSubMenu=o;var s=n.Dock;o.open(t,this,s.BeginTop,s.EndTop,e,"0 0")}};l.prototype.closeSubmenu=function(e,t){if(this.oOpenedSubMenu){if(e&&this.oOpenedSubMenu._bFixed){return}if(t){this.oOpenedSubMenu.bIgnoreOpenerDOMRef=true}this.oOpenedSubMenu.close();this.oOpenedSubMenu=null}};l.prototype.scrollToItem=function(t){var i=this.getDomRef(),o=t?t.getDomRef():null;if(!o||!i){return}var n=i.scrollTop,s=o.offsetTop,r=e(i).height(),a=e(o).height();if(n>s){i.scrollTop=s}else if(s+a>n+r){i.scrollTop=Math.ceil(s+a-r)}};l.prototype._bringToFront=function(){e.sap.byId(this.getPopup().getId()).mousedown()};l.prototype.checkEnabled=function(e){return e&&e.getEnabled()&&this.getEnabled()};l.prototype.getNextSelectableItem=function(e){var t=null;var i=this.getItems();for(var o=e+1;o<i.length;o++){if(i[o].getVisible()&&this.checkEnabled(i[o])){t=i[o];break}}if(!t){for(var o=0;o<=e;o++){if(i[o].getVisible()&&this.checkEnabled(i[o])){t=i[o];break}}}return t};l.prototype.getPreviousSelectableItem=function(e){var t=null;var i=this.getItems();for(var o=e-1;o>=0;o--){if(i[o].getVisible()&&this.checkEnabled(i[o])){t=i[o];break}}if(!t){for(var o=i.length-1;o>=e;o--){if(i[o].getVisible()&&this.checkEnabled(i[o])){t=i[o];break}}}return t};l.prototype.setRootMenuTopStyle=function(e){this.getRootMenu().bUseTopStyle=e;l.rerenderMenu(this.getRootMenu())};l.rerenderMenu=function(e){var t=e.getItems();for(var i=0;i<t.length;i++){var o=t[i].getSubmenu();if(o){l.rerenderMenu(o)}}e.invalidate();e.rerender()};l.prototype.focus=function(){if(this.bOpen){i.prototype.focus.apply(this,arguments);this._setActiveDescendant(this.oHoveredItem)}};l.prototype.isCozy=function(){if(!this.bCozySupported){return false}if(this.hasStyleClass("sapUiSizeCozy")){return true}if(a(this.oOpenerRef)){return true}if(a(this.getParent())){return true}return false};function a(t){if(!t){return false}t=t.$?t.$():e(t);return t.closest(".sapUiSizeCompact,.sapUiSizeCondensed,.sapUiSizeCozy").hasClass("sapUiSizeCozy")}function f(e,t){var i=e.getParent();if(i&&i instanceof s){i.onSubmenuToggle(t)}}function d(e){var t=e.getMaxVisibleItems(),i=document.documentElement.clientHeight-10,o=e.$();if(t>0){var n=e.getItems();for(var s=0;s<n.length;s++){if(n[s].getDomRef()){i=Math.min(i,n[s].$().outerHeight(true)*t);break}}}if(o.outerHeight(true)>i){o.css("max-height",i+"px").toggleClass("sapUiMnuScroll",true)}else{o.css("max-height","").toggleClass("sapUiMnuScroll",false)}}
/*!
	 * The following code is taken from
	 * jQuery UI 1.10.3 - 2013-11-18
	 * jquery.ui.position.js
	 *
	 * http://jqueryui.com
	 * Copyright 2013 jQuery Foundation and other contributors; Licensed MIT
	 */function g(t){var i=e(r);t.within={element:i,isWindow:true,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.width(),height:i.height()};t.collisionPosition={marginLeft:0,marginTop:0};return t}var c={fit:{left:function(e,t){var i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,n=i.width,s=e.left-t.collisionPosition.marginLeft,r=o-s,a=s+t.collisionWidth-n-o,p;if(t.collisionWidth>n){if(r>0&&a<=0){p=e.left+r+t.collisionWidth-n-o;e.left+=r-p}else if(a>0&&r<=0){e.left=o}else{if(r>a){e.left=o+n-t.collisionWidth}else{e.left=o}}}else if(r>0){e.left+=r}else if(a>0){e.left-=a}else{e.left=Math.max(e.left-s,e.left)}},top:function(e,t){var i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,n=t.within.height,s=e.top-t.collisionPosition.marginTop,r=o-s,a=s+t.collisionHeight-n-o,p;if(t.collisionHeight>n){if(r>0&&a<=0){p=e.top+r+t.collisionHeight-n-o;e.top+=r-p}else if(a>0&&r<=0){e.top=o}else{if(r>a){e.top=o+n-t.collisionHeight}else{e.top=o}}}else if(r>0){e.top+=r}else if(a>0){e.top-=a}else{e.top=Math.max(e.top-s,e.top)}}},flip:{left:function(e,t){var i=t.within,o=i.offset.left+i.scrollLeft,n=i.width,s=i.isWindow?i.scrollLeft:i.offset.left,r=e.left-t.collisionPosition.marginLeft,a=r-s,p=r+t.collisionWidth-n-s,u=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,h=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,l=-2*t.offset[0],f,d;if(a<0){f=e.left+u+h+l+t.collisionWidth-n-o;if(f<0||f<Math.abs(a)){e.left+=u+h+l}}else if(p>0){d=e.left-t.collisionPosition.marginLeft+u+h+l-s;if(d>0||Math.abs(d)<p){e.left+=u+h+l}}},top:function(e,t){var i=t.within,o=i.offset.top+i.scrollTop,n=i.height,s=i.isWindow?i.scrollTop:i.offset.top,r=e.top-t.collisionPosition.marginTop,a=r-s,p=r+t.collisionHeight-n-s,u=t.my[1]==="top",h=u?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,l=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,f=-2*t.offset[1],d,g;if(a<0){g=e.top+h+l+f+t.collisionHeight-n-o;if(e.top+h+l+f>a&&(g<0||g<Math.abs(a))){e.top+=h+l+f}}else if(p>0){d=e.top-t.collisionPosition.marginTop+h+l+f-s;if(e.top+h+l+f>p&&(d>0||Math.abs(d)<p)){e.top+=h+l+f}}}},flipfit:{left:function(){c.flip.left.apply(this,arguments);c.fit.left.apply(this,arguments)},top:function(){c.flip.top.apply(this,arguments);c.fit.top.apply(this,arguments)}}};e.ui.position._sapUiCommonsMenuFlip={left:function(t,i){if(e.ui.position.flipfit){e.ui.position.flipfit.left.apply(this,arguments);return}i=g(i);c.flipfit.left.apply(this,arguments)},top:function(t,i){if(e.ui.position.flipfit){e.ui.position.flipfit.top.apply(this,arguments);return}i=g(i);c.flipfit.top.apply(this,arguments)}}})(window);return l});