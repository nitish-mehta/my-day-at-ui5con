/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","./library","sap/ui/Device","./CalendarLegendRenderer"],function(e,t,n,r,i){"use strict";var a=n.CalendarDayType;var d=n.StandardCalendarLegendItem;var s=t.extend("sap.ui.unified.CalendarLegend",{metadata:{library:"sap.ui.unified",properties:{standardItems:{type:"string[]",group:"Misc",defaultValue:["Today","Selected","WorkingDay","NonWorkingDay"]},columnWidth:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"120px"}},aggregations:{items:{type:"sap.ui.unified.CalendarLegendItem",multiple:true,singularName:"item"},_standardItems:{type:"sap.ui.unified.CalendarLegendItem",multiple:true,visibility:"hidden"}},designtime:"sap/ui/unified/designtime/CalendarLegend.designtime"},constructor:function(e,n){t.prototype.constructor.apply(this,arguments);if(typeof e!=="string"){n=e}if(!n||n&&!n.standardItems){this._addStandardItems(this.getStandardItems())}}});s.prototype.onAfterRendering=function(){if(r.browser.msie){if(r.browser.version<10){e(".sapUiUnifiedLegendItem").css("width",this.getColumnWidth()+4+"px").css("display","inline-block")}}};s.prototype.setStandardItems=function(e){var t;if(e&&e.length===1&&e[0]===""){e=[]}if(e&&e.length){e=this.validateProperty("standardItems",e);for(t=0;t<e.length;t++){if(!d[e[t]]){throw new Error("Invalid value '"+e[t]+"'. Property standardItems must contain values from sap.ui.unified.StandardCalendarLegendItem.")}}}this.setProperty("standardItems",e);this._addStandardItems(this.getStandardItems(),true);return this};s.prototype._addStandardItems=function(e,t){var n,r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified"),i=this.getId();if(t){this.destroyAggregation("_standardItems")}for(n=0;n<e.length;n++){var a=new sap.ui.unified.CalendarLegendItem(i+"-"+e[n],{text:r.getText(s._Standard_Items_TextKeys[e[n]])});this.addAggregation("_standardItems",a)}};s._Standard_Items_TextKeys={Today:"LEGEND_TODAY",Selected:"LEGEND_SELECTED",WorkingDay:"LEGEND_NORMAL_DAY",NonWorkingDay:"LEGEND_NON_WORKING_DAY"};s.prototype._getItemType=function(t,n){var r=t.getType(),i,d;if(r&&r!==a.None){return r}d=this._getUnusedItemTypes(n);i=n.filter(function(e){return!e.getType()||e.getType()===a.None}).indexOf(t);if(i<0){e.sap.log.error("Legend item is not in the legend",this);return r}if(d[i]){r=d[i]}else{r="Type"+(Object.keys(a).length+i-d.length-1)}return r};s.prototype._getItemByType=function(e){var t,n=this.getItems(),r;for(r=0;r<n.length;r++){if(this._getItemType(n[r],n)===e){t=n[r];break}}return t};s.prototype._getUnusedItemTypes=function(t){var n=e.extend({},a),r,i;delete n[a.None];delete n[a.NonWorking];for(i=0;i<t.length;i++){r=t[i].getType();if(n[r]){delete n[r]}}return Object.keys(n)};return s});