/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/core/delegate/ItemNavigation","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/library","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/ui/core/Locale","./MonthRenderer","jquery.sap.keycodes"],function(e,t,a,i,s,r,o,n,l,h,d,g){"use strict";var p=h.CalendarType;var f=n.CalendarDayType;var u=t.extend("sap.ui.unified.calendar.Month",{metadata:{library:"sap.ui.unified",properties:{date:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},showHeader:{type:"boolean",group:"Appearance",defaultValue:false},firstDayOfWeek:{type:"int",group:"Appearance",defaultValue:-1},nonWorkingDays:{type:"int[]",group:"Appearance",defaultValue:null},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},disabledDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"disabledDate"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},focus:{parameters:{date:{type:"object"},otherMonth:{type:"boolean"},restoreOldDate:{type:"boolean"}}}}}});u.prototype.init=function(){var t=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",t);this.setProperty("secondaryCalendarType",t);this._oFormatYyyymmdd=l.getInstance({pattern:"yyyyMMdd",calendarType:p.Gregorian});this._oFormatLong=l.getInstance({style:"long",calendarType:t});this._mouseMoveProxy=e.proxy(this._handleMouseMove,this);this._iColumns=7;this._aVisibleDays=[]};u.prototype.exit=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation}if(this._sInvalidateMonth){e.sap.clearDelayedCall(this._sInvalidateMonth)}this._aVisibleDays=null};u.prototype.onAfterRendering=function(){c.call(this);I.call(this)};u.prototype.onmouseover=function(t){var a=e(t.target),i,s,r;if(!this.getIntervalSelection()){return}i=this.getSelectedDates()[0];if(!i||!i.getStartDate()||i.getEndDate()){return}if(!a.hasClass("sapUiCalItemText")&&!a.hasClass("sapUiCalItem")){return}if(a.hasClass("sapUiCalItemText")){a=a.parent()}s=parseInt(this._oFormatYyyymmdd.format(i.getStartDate()),10);r=a.data("sapDay");if(s>r){s=s+r;r=s-r;s=s-r}if(this.hasListeners("datehovered")){this.fireEvent("datehovered",{date1:s,date2:r})}else{this._markDatesBetweenStartAndHoveredDate(s,r)}};u.prototype._markDatesBetweenStartAndHoveredDate=function(t,a){var i,s,r,o;i=this.$().find(".sapUiCalItem");for(o=0;o<i.length;o++){s=e(i[o]);r=s.data("sapDay");if(r>t&&r<a){s.addClass("sapUiCalItemSelBetween")}else{s.removeClass("sapUiCalItemSelBetween")}}};u.prototype.onsapfocusleave=function(t){if(!t.relatedControlId||!e.sap.containsOrEquals(this.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){if(this._bMouseMove){this._unbindMousemove(true);var a=this._selectDay(this._getDate());if(!a&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate)}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;S.call(this)}if(this._bMousedownChange){this._bMousedownChange=false;S.call(this)}}};u.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("selectedDates");return e};u.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("selectedDates");return e};u.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("specialDates");return e};u.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("specialDates");return e};u.prototype.removeAllDisabledDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("disabledDates");return e};u.prototype.destroyDisabledDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("disabledDates");return e};u.prototype.setDate=function(e){var t=o.fromLocalJSDate(e,this.getPrimaryCalendarType());v.call(this,t,false);return this};u.prototype._setDate=function(e){var t=e.toLocalJSDate();this.setProperty("date",t,true);this._oDate=e};u.prototype._getDate=function(){if(!this._oDate){this._oDate=o.fromLocalJSDate(new Date,this.getPrimaryCalendarType())}return this._oDate};u.prototype.displayDate=function(e){var t=o.fromLocalJSDate(e,this.getPrimaryCalendarType());v.call(this,t,true);return this};u.prototype.setPrimaryCalendarType=function(e){this.setProperty("primaryCalendarType",e);this._oFormatLong=l.getInstance({style:"long",calendarType:e});if(this._oDate){this._oDate=new o(this._oDate,e)}return this};u.prototype.setSecondaryCalendarType=function(e){this._bSecondaryCalendarTypeSet=true;this.setProperty("secondaryCalendarType",e);this.invalidate();this._oFormatSecondaryLong=l.getInstance({style:"long",calendarType:e});return this};u.prototype._getSecondaryCalendarType=function(){var e;if(this._bSecondaryCalendarTypeSet){e=this.getSecondaryCalendarType();var t=this.getPrimaryCalendarType();if(e==t){e=undefined}}return e};u.prototype._getLocale=function(){var e=this.getParent();if(e&&e.getLocale){return e.getLocale()}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};u.prototype._getLocaleData=function(){var e=this.getParent();if(e&&e._getLocaleData){return e._getLocaleData()}else if(!this._oLocaleData){var t=this._getLocale();var a=new d(t);this._oLocaleData=i.getInstance(a)}return this._oLocaleData};u.prototype._getFormatLong=function(){var e=this._getLocale();if(this._oFormatLong.oLocale.toString()!=e){var t=new d(e);this._oFormatLong=l.getInstance({style:"long",calendarType:this.getPrimaryCalendarType()},t);if(this._oFormatSecondaryLong){this._oFormatSecondaryLong=l.getInstance({style:"long",calendarType:this._getSecondaryCalendarType()},t)}}return this._oFormatLong};u.prototype.getIntervalSelection=function(){var e=this.getParent();if(e&&e.getIntervalSelection){return e.getIntervalSelection()}else{return this.getProperty("intervalSelection")}};u.prototype.getSingleSelection=function(){var e=this.getParent();if(e&&e.getSingleSelection){return e.getSingleSelection()}else{return this.getProperty("singleSelection")}};u.prototype.getSelectedDates=function(){var e=this.getParent();if(e&&e.getSelectedDates){return e.getSelectedDates()}else{return this.getAggregation("selectedDates",[])}};u.prototype.getSpecialDates=function(){var e=this.getParent();if(e&&e.getSpecialDates){return e.getSpecialDates()}else{return this.getAggregation("specialDates",[])}};u.prototype.getDisabledDates=function(){var e=this.getParent();if(e&&e.getDisabledDates){return e.getDisabledDates()}else{return this.getAggregation("disabledDates",[])}};u.prototype._getShowHeader=function(){var e=this.getParent();if(e&&e._getShowMonthHeader){return e._getShowMonthHeader()}else{return this.getProperty("showHeader")}};u.prototype.getAriaLabelledBy=function(){var e=this.getParent();if(e&&e.getAriaLabelledBy){return e.getAriaLabelledBy()}else{return this.getAssociation("ariaLabelledBy",[])}};u.prototype.getLegend=function(){var e=this.getParent();if(e&&e.getLegend){return e.getLegend()}else{return this.getAssociation("legend",[])}};u.prototype._getFirstDayOfWeek=function(){var e=this.getParent();var t=0;if(e&&e.getFirstDayOfWeek){t=e.getFirstDayOfWeek()}else{t=this.getProperty("firstDayOfWeek")}if(t<0||t>6){var a=this._getLocaleData();t=a.getFirstDayOfWeek()}return t};u.prototype._getNonWorkingDays=function(){var t=this.getParent();var a;if(t&&t.getNonWorkingDays){a=t.getNonWorkingDays()}else{a=this.getProperty("nonWorkingDays")}if(a&&!e.isArray(a)){a=[]}return a};u.prototype._checkDateSelected=function(e){r._checkCalendarDate(e);var t=0;var a=this.getSelectedDates();var i=e.toUTCJSDate().getTime();var s=this.getPrimaryCalendarType();for(var n=0;n<a.length;n++){var l=a[n];var h=l.getStartDate();var d=0;if(h){h=o.fromLocalJSDate(h,s);d=h.toUTCJSDate().getTime()}var g=l.getEndDate();var p=0;if(g){g=o.fromLocalJSDate(g,s);p=g.toUTCJSDate().getTime()}if(i==d&&!g){t=1;break}else if(i==d&&g){t=2;if(g&&i==p){t=5}break}else if(g&&i==p){t=3;break}else if(g&&i>d&&i<p){t=4;break}if(this.getSingleSelection()){break}}return t};u.prototype._getDateTypes=function(e){r._checkCalendarDate(e);var t,a,i,s=[];var n=this.getSpecialDates();var l=e.toUTCJSDate().getTime();var h=this.getPrimaryCalendarType();for(var d=0;d<n.length;d++){var g=n[d];var p=g.getStartDate();var u=r.MAX_MILLISECONDS;if(p){p=o.fromLocalJSDate(p,h);u=p.toUTCJSDate().getTime()}var c=g.getEndDate();var y=-r.MAX_MILLISECONDS;if(c){c=o.fromLocalJSDate(c,h);y=c.toUTCJSDate().getTime()}i=g.getType()===f.NonWorking;if(l==u&&!c||l>=u&&l<=y){if(!i&&!t){t={type:g.getType(),tooltip:g.getTooltip_AsString()};s.push(t)}else if(i&&!a){a={type:g.getType(),tooltip:g.getTooltip_AsString()};s.push(a)}if(t&&a){break}}}return s};u.prototype._checkDateEnabled=function(e){r._checkCalendarDate(e);var t=true;var a=this.getDisabledDates();var i=e.toUTCJSDate().getTime();var s=this.getPrimaryCalendarType();var n=this.getParent();if(n&&n._oMinDate&&n._oMaxDate){if(i<n._oMinDate.valueOf()||i>n._oMaxDate.valueOf()){return false}}for(var l=0;l<a.length;l++){var h=a[l];var d=h.getStartDate();var g=0;if(d){d=o.fromLocalJSDate(d,s);g=d.toUTCJSDate().getTime()}var p=h.getEndDate();var f=0;if(p){p=o.fromLocalJSDate(p,s);f=p.toUTCJSDate().getTime()}if(p){if(i>g&&i<f){t=false;break}}else if(i==g){t=false;break}}return t};u.prototype.setWidth=function(e){this.setProperty("width",e,true);if(this.getDomRef()){e=this.getWidth();this.$().css("width",e)}return this};u.prototype._handleMouseMove=function(t){if(!this.$().is(":visible")){this._unbindMousemove(true)}var a=e(t.target);if(a.hasClass("sapUiCalItemText")){a=a.parent()}if(this._sLastTargetId&&this._sLastTargetId==a.attr("id")){return}this._sLastTargetId=a.attr("id");if(a.hasClass("sapUiCalItem")){var i=this._getDate();if(!e.sap.containsOrEquals(this.getDomRef(),t.target)){var s=this.getSelectedDates();if(s.length>0&&this.getSingleSelection()){var r=s[0].getStartDate();if(r){r=o.fromLocalJSDate(r,this.getPrimaryCalendarType())}var n=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(a.attr("data-sap-day")));if(n.isSameOrAfter(r)){_.call(this,r,n)}else{_.call(this,n,r)}}}else{var l=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(a.attr("data-sap-day")),this.getPrimaryCalendarType());if(!l.isSame(i)){if(a.hasClass("sapUiCalItemOtherMonth")){this.fireFocus({date:l.toLocalJSDate(),otherMonth:true})}else{this._setDate(l);var h=this._selectDay(l,true);if(h){this._oMoveSelectedDate=new o(l,this.getPrimaryCalendarType())}this._bMoveChange=true}}}}};u.prototype.onmousedown=function(e){this._oMousedownPosition={clientX:e.clientX,clientY:e.clientY}};u.prototype.onmouseup=function(t){if(this._bMouseMove){this._unbindMousemove(true);var i=this._getDate();var s=this._oItemNavigation.getItemDomRefs();for(var r=0;r<s.length;r++){var n=e(s[r]);if(!n.hasClass("sapUiCalItemOtherMonth")){if(n.attr("data-sap-day")==this._oFormatYyyymmdd.format(i.toUTCJSDate(),true)){n.focus();break}}}if(this._bMoveChange){var l=this._selectDay(i);if(!l&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate)}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;S.call(this)}}if(this._bMousedownChange){this._bMousedownChange=false;S.call(this)}else if(a.support.touch&&this._isValueInThreshold(this._oMousedownPosition.clientX,t.clientX,10)&&this._isValueInThreshold(this._oMousedownPosition.clientY,t.clientY,10)&&(t.target.classList.contains("sapUiCalItemText")||t.target.classList.contains("sapUiCalDayName"))){var h=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(e(t.target).parent().attr("data-sap-day")),this.getPrimaryCalendarType());this._selectDay(h,false,false);S.call(this)}};u.prototype.onsapselect=function(e){var t=this._selectDay(this._getDate());if(t){S.call(this)}e.stopPropagation();e.preventDefault()};u.prototype.onsapselectmodifiers=function(e){this.onsapselect(e)};u.prototype.onsappageupmodifiers=function(e){var t=new o(this._getDate(),this.getPrimaryCalendarType());var a=t.getYear();if(e.metaKey||e.ctrlKey){t.setYear(a-10)}else{t.setYear(a-1)}this.fireFocus({date:t.toLocalJSDate(),otherMonth:true});e.preventDefault()};u.prototype.onsappagedownmodifiers=function(e){var t=new o(this._getDate(),this.getPrimaryCalendarType());var a=t.getYear();if(e.metaKey||e.ctrlKey){t.setYear(a+10)}else{t.setYear(a+1)}this.fireFocus({date:t.toLocalJSDate(),otherMonth:true});e.preventDefault()};u.prototype._updateSelection=function(){var e=this.getSelectedDates();if(e.length>0){var t=this.getPrimaryCalendarType();var a=e.map(function(e){var a=e.getStartDate();if(a){return o.fromLocalJSDate(a,t)}});var i=e[0].getEndDate();if(i){i=o.fromLocalJSDate(i,t)}_.call(this,a,i)}};u.prototype._isValueInThreshold=function(e,t,a){var i=e-a,s=e+a;return t>=i&&t<=s};u.prototype._bindMousemove=function(t){e(window.document).bind("mousemove",this._mouseMoveProxy);this._bMouseMove=true;if(t){this.fireEvent("_bindMousemove")}};u.prototype._unbindMousemove=function(t){e(window.document).unbind("mousemove",this._mouseMoveProxy);this._bMouseMove=undefined;this._sLastTargetId=undefined;if(t){this.fireEvent("_unbindMousemove")}};u.prototype.onThemeChanged=function(){if(this._bNoThemeChange){return}this._bNamesLengthChecked=undefined;this._bLongWeekDays=undefined;var t=this.$().find(".sapUiCalWH");var a=this._getLocaleData();var i=this._getFirstWeekDay();var s=a.getDaysStandAlone("abbreviated",this.getPrimaryCalendarType());for(var r=0;r<t.length;r++){var o=t[r];e(o).text(s[(r+i)%7])}I.call(this)};u.prototype._handleBorderReached=function(t){var a=t.getParameter("event");var i=0;var s=this._getDate();var r=new o(s,this.getPrimaryCalendarType());if(a.type){switch(a.type){case"sapnext":case"sapnextmodifiers":if(a.keyCode==e.sap.KeyCodes.ARROW_DOWN){r.setDate(r.getDate()+7)}else{r.setDate(r.getDate()+1)}break;case"sapprevious":case"sappreviousmodifiers":if(a.keyCode==e.sap.KeyCodes.ARROW_UP){r.setDate(r.getDate()-7)}else{r.setDate(r.getDate()-1)}break;case"sappagedown":i=r.getMonth()+1;r.setMonth(i);if(i%12!=r.getMonth()){while(i!=r.getMonth()){r.setDate(r.getDate()-1)}}break;case"sappageup":i=r.getMonth()-1;r.setMonth(i);if(i<0){i=11}if(i!=r.getMonth()){while(i!=r.getMonth()){r.setDate(r.getDate()-1)}}break;default:break}this.fireFocus({date:r.toLocalJSDate(),otherMonth:true})}};u.prototype.checkDateFocusable=function(e){r._checkJSDateObject(e);var t=this._getDate();var a=o.fromLocalJSDate(e,this.getPrimaryCalendarType());return r._isSameMonthAndYear(a,t)};u.prototype.applyFocusInfo=function(e){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex());return this};u.prototype._renderHeader=function(){if(this._getShowHeader()){var e=this._getDate();var t=this._getLocaleData();var a=t.getMonthsStandAlone("wide",this.getPrimaryCalendarType());this.$("Head").text(a[e.getMonth()])}};u.prototype._getFirstWeekDay=function(){return this._getFirstDayOfWeek()};u.prototype._isMonthNameLong=function(e){var t;var a;for(t=0;t<e.length;t++){a=e[t];if(Math.abs(a.clientWidth-a.scrollWidth)>1){return true}}return false};u.prototype._getVisibleDays=function(e,t){var a,i,s,r,n,l,h;if(!e){return this._aVisibleDays}this._aVisibleDays=[];l=this._getFirstDayOfWeek();n=new o(e,this.getPrimaryCalendarType());n.setDate(1);r=n.getDay()-l;if(r<0){r=7+r}if(r>0){n.setDate(1-r)}i=new o(n);a=(e.getMonth()+1)%12;do{h=i.getYear();s=new o(i,this.getPrimaryCalendarType());if(t&&h<1){s._bBeforeFirstYear=true;this._aVisibleDays.push(s)}else if(h>0&&h<1e4){this._aVisibleDays.push(s)}i.setDate(i.getDate()+1)}while(i.getMonth()!==a||i.getDay()!==l);return this._aVisibleDays};u.prototype._handleMousedown=function(e,t,i){var s=(a.browser.msie||a.browser.edge)&&navigator.maxTouchPoints,r=e.target.classList.contains("sapUiCalWeekNum"),n=!e.button;if(!n||a.support.touch||r&&(n||s)){return}var l=this._selectDay(t);if(l){this._bMousedownChange=true}if(this._bMouseMove){this._unbindMousemove(true);this._bMoveChange=false;this._oMoveSelectedDate=undefined}else if(l&&this.getIntervalSelection()&&this.$().is(":visible")){this._bindMousemove(true);this._oMoveSelectedDate=new o(t,this.getPrimaryCalendarType())}e.preventDefault();e.setMark("cancelAutoClose")};u.prototype._selectDay=function(t,a){if(!this._checkDateEnabled(t)){return false}var i=this.getSelectedDates();var s;var r=this._oItemNavigation.getItemDomRefs();var n;var l;var h=0;var d=this.getParent();var g=this;var p;var f=this.getPrimaryCalendarType();if(d&&d.getSelectedDates){g=d}if(this.getSingleSelection()){if(i.length>0){s=i[0];p=s.getStartDate();if(p){p=o.fromLocalJSDate(p,f)}}else{s=new sap.ui.unified.DateRange;g.addAggregation("selectedDates",s,true)}if(this.getIntervalSelection()&&(!s.getEndDate()||a)&&p){var u;if(t.isBefore(p)){u=p;p=t;if(!a){s.setProperty("startDate",p.toLocalJSDate(),true);s.setProperty("endDate",u.toLocalJSDate(),true)}}else if(t.isSameOrAfter(p)){u=t;if(!a){s.setProperty("endDate",u.toLocalJSDate(),true)}}_.call(this,p,u)}else{_.call(this,t);s.setProperty("startDate",t.toLocalJSDate(),true);s.setProperty("endDate",undefined,true)}}else{if(this.getIntervalSelection()){throw new Error("Calender don't support multiple interval selection")}else{var c=this._checkDateSelected(t);if(c>0){for(h=0;h<i.length;h++){p=i[h].getStartDate();if(p&&t.isSame(o.fromLocalJSDate(p,f))){g.removeAggregation("selectedDates",h,true);break}}}else{s=new sap.ui.unified.DateRange({startDate:t.toLocalJSDate()});g.addAggregation("selectedDates",s,true)}l=this._oFormatYyyymmdd.format(t.toUTCJSDate(),true);for(h=0;h<r.length;h++){n=e(r[h]);if(n.attr("data-sap-day")==l){if(c>0){n.removeClass("sapUiCalItemSel");n.attr("aria-selected","false")}else{n.addClass("sapUiCalItemSel");n.attr("aria-selected","true")}}}}}return true};function c(){var t=this._oFormatYyyymmdd.format(this._getDate().toUTCJSDate(),true);var a=0;var i=this.$("days").get(0);var r=this.$("days").find(".sapUiCalItem");for(var o=0;o<r.length;o++){var n=e(r[o]);if(n.attr("data-sap-day")===t){a=o;break}}if(!this._oItemNavigation){this._oItemNavigation=new s;this._oItemNavigation.attachEvent(s.Events.AfterFocus,y,this);this._oItemNavigation.attachEvent(s.Events.FocusAgain,m,this);this._oItemNavigation.attachEvent(s.Events.BorderReached,this._handleBorderReached,this);this.addDelegate(this._oItemNavigation);if(this._iColumns>1){this._oItemNavigation.setHomeEndColumnMode(true,true)}this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"],saphome:["alt"],sapend:["alt"]});this._oItemNavigation.setCycling(false);this._oItemNavigation.setColumns(this._iColumns,true)}this._oItemNavigation.setRootDomRef(i);this._oItemNavigation.setItemDomRefs(r);this._oItemNavigation.setFocusedIndex(a);this._oItemNavigation.setPageSize(r.length)}function y(t){var a=t.getParameter("index");var i=t.getParameter("event");if(!i){return}var s=this._getDate();var r=new o(s,this.getPrimaryCalendarType());var n=false;var l=true;var h=this._oItemNavigation.getItemDomRefs();var d=0;var g=e(h[a]);var p;if(g.hasClass("sapUiCalItemOtherMonth")){if(i.type=="saphomemodifiers"&&(i.metaKey||i.ctrlKey)){r.setDate(1);this._focusDate(r)}else if(i.type=="sapendmodifiers"&&(i.metaKey||i.ctrlKey)){for(d=h.length-1;d>0;d--){p=e(h[d]);if(!p.hasClass("sapUiCalItemOtherMonth")){r=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(p.attr("data-sap-day")),this.getPrimaryCalendarType());break}}this._focusDate(r)}else{n=true;r=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(g.attr("data-sap-day")),this.getPrimaryCalendarType());if(!r){r=new o(s)}this._focusDate(s);if(i.type=="mousedown"||this._sTouchstartYyyyMMdd&&i.type=="focusin"&&this._sTouchstartYyyyMMdd==g.attr("data-sap-day")){l=false;this.fireFocus({date:s.toLocalJSDate(),otherMonth:false,restoreOldDate:true})}if(i.originalEvent&&i.originalEvent.type=="touchstart"){this._sTouchstartYyyyMMdd=g.attr("data-sap-day")}else{this._sTouchstartYyyyMMdd=undefined}}}else{if(e(i.target).hasClass("sapUiCalWeekNum")){this._focusDate(r)}else{r=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(g.attr("data-sap-day")),this.getPrimaryCalendarType());this._setDate(r)}this._sTouchstartYyyyMMdd=undefined}if(i.type=="mousedown"&&this.getIntervalSelection()){this._sLastTargetId=g.attr("id")}if(l){this.fireFocus({date:r.toLocalJSDate(),otherMonth:n})}if(i.type=="mousedown"){this._handleMousedown(i,r,a)}}function m(e){var t=e.getParameter("index");var a=e.getParameter("event");if(!a){return}if(a.type=="mousedown"){var i=this._getDate();if(this.getIntervalSelection()){var s=this._oItemNavigation.getItemDomRefs();this._sLastTargetId=s[t].id}this._handleMousedown(a,i,t)}}function v(e,t){r._checkCalendarDate(e);var a=e.getYear();r._checkYearInValidRange(a);var i=true;if(!this.getDate()||!e.isSame(o.fromLocalJSDate(this.getDate(),e.getCalendarType()))){var s=new o(e);i=this.checkDateFocusable(e.toLocalJSDate());this.setProperty("date",e.toLocalJSDate(),true);this._oDate=s}if(this.getDomRef()){if(i){this._focusDate(this._oDate,true,t)}else{D.call(this,t)}}}u.prototype._focusDate=function(t,a,i){if(!a){this.setDate(t.toLocalJSDate())}var s=this._oFormatYyyymmdd.format(t.toUTCJSDate(),true);var r=this._oItemNavigation.getItemDomRefs();var o;for(var n=0;n<r.length;n++){o=e(r[n]);if(o.attr("data-sap-day")==s){if(document.activeElement!=r[n]){if(i){this._oItemNavigation.setFocusedIndex(n)}else{this._oItemNavigation.focusItem(n)}}break}}};function D(t){var a=this.getRenderer().getStartDate(this);var i=this.$("days");var s=this.$("weeks");var r;var o;var n=0;var l=0;if(this._sLastTargetId){r=this._oItemNavigation.getItemDomRefs();for(n=0;n<r.length;n++){o=e(r[n]);if(o.attr("id")==this._sLastTargetId){l=n;break}}}if(i.length>0){var h=sap.ui.getCore().createRenderManager();this.getRenderer().renderDays(h,this,a);h.flush(i[0]);if(s.length){this.getRenderer().renderWeekNumbers(h,this);h.flush(s[0])}h.destroy()}this._renderHeader();this.fireEvent("_renderMonth",{days:i.find(".sapUiCalItem").length});c.call(this);if(!t){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex())}if(this._sLastTargetId){r=this._oItemNavigation.getItemDomRefs();if(l<=r.length-1){o=e(r[l]);this._sLastTargetId=o.attr("id")}}}function _(t,a){if(!Array.isArray(t)){t=[t]}var i=this._oItemNavigation.getItemDomRefs();var s;var n=0;var l=false;var h=false;if(!a){var d=t.map(function(e){return this._oFormatYyyymmdd.format(e.toUTCJSDate(),true)},this);for(n=0;n<i.length;n++){s=e(i[n]);l=false;h=false;if(d.indexOf(s.attr("data-sap-day"))>-1){s.addClass("sapUiCalItemSel");s.attr("aria-selected","true");l=true}else if(s.hasClass("sapUiCalItemSel")){s.removeClass("sapUiCalItemSel");s.attr("aria-selected","false")}if(s.hasClass("sapUiCalItemSelStart")){s.removeClass("sapUiCalItemSelStart")}else if(s.hasClass("sapUiCalItemSelBetween")){s.removeClass("sapUiCalItemSelBetween")}else if(s.hasClass("sapUiCalItemSelEnd")){s.removeClass("sapUiCalItemSelEnd")}C.call(this,s,l,h)}}else{var g;for(n=0;n<i.length;n++){s=e(i[n]);l=false;h=false;g=o.fromLocalJSDate(this._oFormatYyyymmdd.parse(s.attr("data-sap-day")),p.Gregorian);if(g.isSame(t[0])){s.addClass("sapUiCalItemSelStart");l=true;s.addClass("sapUiCalItemSel");s.attr("aria-selected","true");if(a&&g.isSame(a)){s.addClass("sapUiCalItemSelEnd");h=true}s.removeClass("sapUiCalItemSelBetween")}else if(a&&r._isBetween(g,t[0],a)){s.addClass("sapUiCalItemSel");s.attr("aria-selected","true");s.addClass("sapUiCalItemSelBetween");s.removeClass("sapUiCalItemSelStart");s.removeClass("sapUiCalItemSelEnd")}else if(a&&g.isSame(a)){s.addClass("sapUiCalItemSelEnd");h=true;s.addClass("sapUiCalItemSel");s.attr("aria-selected","true");s.removeClass("sapUiCalItemSelStart");s.removeClass("sapUiCalItemSelBetween")}else{if(s.hasClass("sapUiCalItemSel")){s.removeClass("sapUiCalItemSel");s.attr("aria-selected","false")}if(s.hasClass("sapUiCalItemSelStart")){s.removeClass("sapUiCalItemSelStart")}else if(s.hasClass("sapUiCalItemSelBetween")){s.removeClass("sapUiCalItemSelBetween")}else if(s.hasClass("sapUiCalItemSelEnd")){s.removeClass("sapUiCalItemSelEnd")}}C.call(this,s,l,h)}}}function C(e,t,a){if(!this.getIntervalSelection()){return}var i="";var s=[];var r=this.getId();var o=false;i=e.attr("aria-describedby");if(i){s=i.split(" ")}var n=-1;var l=-1;for(var h=0;h<s.length;h++){var d=s[h];if(d==r+"-Start"){n=h}if(d==r+"-End"){l=h}}if(n>=0&&!t){s.splice(n,1);o=true;if(l>n){l--}}if(l>=0&&!a){s.splice(l,1);o=true}if(n<0&&t){s.push(r+"-Start");o=true}if(l<0&&a){s.push(r+"-End");o=true}if(o){i=s.join(" ");e.attr("aria-describedby",i)}}function S(){if(this._bMouseMove){this._unbindMousemove(true)}this.fireSelect()}function I(){if(!this._bNamesLengthChecked){var t;var a=this.$().find(".sapUiCalWH");var i=this._isMonthNameLong(a);var s=0;if(i){this._bLongWeekDays=false;var r=this._getLocaleData();var o=this._getFirstWeekDay();var n=r.getDaysStandAlone("narrow",this.getPrimaryCalendarType());for(s=0;s<a.length;s++){t=a[s];e(t).text(n[(s+o)%7])}}else{this._bLongWeekDays=true}this._bNamesLengthChecked=true}}return u});