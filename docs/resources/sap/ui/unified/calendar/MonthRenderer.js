/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/CalendarLegend","sap/ui/unified/CalendarLegendRenderer","sap/ui/core/library","sap/ui/unified/library"],function(e,a,t,i,r,d,s){"use strict";var l=s.CalendarDayType;var n=d.CalendarType;var o={};o.render=function(e,a){var t=this.getStartDate(a);var i=a.getTooltip_AsString();var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");var d=a.getId();var s={value:d+"-Descr",append:true};var l=a.getWidth();e.write("<div");e.writeControlData(a);e.addClass(this.getClass(e,a));if(a._getSecondaryCalendarType()){e.addClass("sapUiCalMonthSecType")}e.writeClasses();if(i){e.writeAttributeEscaped("title",i)}if(a._getShowHeader()){s.value=s.value+" "+d+"-Head"}if(l){e.addStyle("width",l);e.writeStyles()}e.writeAccessibilityState(a,{role:"grid",readonly:"true",multiselectable:!a.getSingleSelection()||a.getIntervalSelection(),labelledby:s});e.write(">");e.write('<span id="'+d+'-Descr" style="display: none;">'+r.getText("CALENDAR_DIALOG")+"</span>");if(a.getIntervalSelection()){e.write('<span id="'+d+'-Start" style="display: none;">'+r.getText("CALENDAR_START_DATE")+"</span>");e.write('<span id="'+d+'-End" style="display: none;">'+r.getText("CALENDAR_END_DATE")+"</span>")}this.renderMonth(e,a,t);e.write("</div>")};o.getStartDate=function(e){return e._getDate()};o.getClass=function(e,a){var t="sapUiCalMonthView",i=a.getPrimaryCalendarType(),r=a.getShowWeekNumbers();if(i==n.Islamic||!r){t=t+" sapUiCalNoWeekNum"}return t};o.renderMonth=function(e,a,t){var i=a.getId();this.renderHeader(e,a,t);e.write('<div id="'+i+'-days" class="sapUiCalItems">');this.renderDays(e,a,t);e.write("</div>")};o.renderHeader=function(e,a,t){var i=a._getLocaleData();var r=a._getFirstDayOfWeek();var d=a.getId();var s=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");this.renderHeaderLine(e,a,i,t);e.write("<div");e.writeAttribute("id",d+"-CW");e.addStyle("display","none");e.writeStyles();e.writeAccessibilityState(null,{role:"columnheader"});e.write(">");e.write(s.getText("CALENDAR_WEEK"));e.write("</div>");e.write("<div");e.writeAccessibilityState(null,{role:"row"});e.addStyle("overflow","hidden");e.writeStyles();e.write(">");this.renderDayNames(e,a,i,r,7,true,undefined);e.write("</div>")};o.renderHeaderLine=function(e,t,i,r){a._checkCalendarDate(r);if(t._getShowHeader()){var d=t.getId();var s=t.getPrimaryCalendarType();var l=i.getMonthsStandAlone("wide",s);e.write('<div id="'+d+'-Head"class="sapUiCalHeadText" >');e.write(l[r.getMonth()]);e.write("</div>")}};o.renderDayNames=function(e,a,t,i,r,d,s){var l=a._getFirstDayOfWeek();var n=a.getId();var o="";var y=a.getPrimaryCalendarType();var C=[];if(a._bLongWeekDays||!a._bNamesLengthChecked){C=t.getDaysStandAlone("abbreviated",y)}else{C=t.getDaysStandAlone("narrow",y)}var g=t.getDaysStandAlone("wide",y);for(var c=0;c<r;c++){e.write("<div");e.addClass("sapUiCalWH");if(d){o=n+"-WH"+(c+l)%7}else{o=n+"-WH"+c}e.writeAttribute("id",o);if(c==0){e.addClass("sapUiCalFirstWDay")}if(s){e.addStyle("width",s)}e.writeAccessibilityState(null,{role:"columnheader",label:g[(c+i)%7]});e.writeClasses();e.writeStyles();e.write(">");e.write(C[(c+i)%7]);e.write("</div>")}};o.renderDays=function(e,t,i){var r,d,s,l,o,y,C;a._checkCalendarDate(i);if(!i){i=t._getFocusedDate()}y=i.toUTCJSDate().getTime();if(!y&&y!==0){throw new Error("Date is invalid "+t)}l=this.getDayHelper(t,i);d=t._getVisibleDays(i,true);C=t.getShowWeekNumbers();r=t.getPrimaryCalendarType()!==n.Islamic&&C;s=d.length;for(o=0;o<s;o++){this.renderDay(e,t,d[o],l,true,r,-1)}};o.getDayHelper=function(a,r){var d,s,l=a._getLocaleData(),n={sLocale:a._getLocale(),oLocaleData:l,iMonth:r.getMonth(),iYear:r.getYear(),iFirstDayOfWeek:a._getFirstDayOfWeek(),iWeekendStart:l.getWeekendStart(),iWeekendEnd:l.getWeekendEnd(),aNonWorkingDays:a._getNonWorkingDays(),sToday:l.getRelativeDay(0),oToday:t.fromLocalJSDate(new Date,a.getPrimaryCalendarType()),sId:a.getId(),oFormatLong:a._getFormatLong(),sSecondaryCalendarType:a._getSecondaryCalendarType(),oLegend:undefined};s=a.getLegend();if(s&&typeof s==="string"){d=sap.ui.getCore().byId(s);if(d){if(!(d instanceof i)){throw new Error(d+" is not an sap.ui.unified.CalendarLegend. "+a)}n.oLegend=d}else{e.sap.log.warning("CalendarLegend "+s+" does not exist!",a)}}return n};o.renderDay=function(e,i,d,s,n,o,y,C,g){a._checkCalendarDate(d);var c=new t(d,s.sSecondaryCalendarType),p={role:"gridcell",selected:false,label:"",describedby:""},w=d._bBeforeFirstYear,f="";var u=i._oFormatYyyymmdd.format(d.toUTCJSDate(),true);var b=d.getDay();var D=i._checkDateSelected(d);var S=i._getDateTypes(d);var v=i._checkDateEnabled(d);var m=0;if(w){v=false}var h=0;if(o){h=a.calculateWeekNumber(d.toUTCJSDate(),s.iYear,s.sLocale,s.oLocaleData);p["describedby"]=s.sId+"-CW"+" "+s.sId+"-WNum-"+h}if(!g){var W="";if(y<0){W=s.sId+"-WH"+b}else{W=s.sId+"-WH"+y}p["describedby"]=p["describedby"]+" "+W}e.write("<div");e.writeAttribute("id",s.sId+"-"+u);e.addClass("sapUiCalItem");e.addClass("sapUiCalWDay"+b);if(C){e.addStyle("width",C)}if(b==s.iFirstDayOfWeek){e.addClass("sapUiCalFirstWDay")}if(n&&s.iMonth!=d.getMonth()){e.addClass("sapUiCalItemOtherMonth");p["disabled"]=true}if(d.isSame(s.oToday)){e.addClass("sapUiCalItemNow");p["label"]=s.sToday+" "}if(D>0){e.addClass("sapUiCalItemSel");p["selected"]=true}else{p["selected"]=false}if(D==2){e.addClass("sapUiCalItemSelStart");p["describedby"]=p["describedby"]+" "+s.sId+"-Start"}else if(D==3){e.addClass("sapUiCalItemSelEnd");p["describedby"]=p["describedby"]+" "+s.sId+"-End"}else if(D==4){e.addClass("sapUiCalItemSelBetween")}else if(D==5){e.addClass("sapUiCalItemSelStart");e.addClass("sapUiCalItemSelEnd");p["describedby"]=p["describedby"]+" "+s.sId+"-Start";p["describedby"]=p["describedby"]+" "+s.sId+"-End"}S.forEach(function(a){if(a.type!=l.None){if(a.type===l.NonWorking){e.addClass("sapUiCalItemWeekEnd");return}e.addClass("sapUiCalItem"+a.type);f=a.type;if(a.tooltip){e.writeAttributeEscaped("title",a.tooltip)}}});if(i.getParent()&&i.getParent().getMetadata().getName()==="sap.ui.unified.CalendarOneMonthInterval"&&d.getMonth()!==i.getStartDate().getMonth()){e.addClass("sapUiCalItemOtherMonth")}if(!v){e.addClass("sapUiCalItemDsbl");p["disabled"]=true}if(s.aNonWorkingDays){for(m=0;m<s.aNonWorkingDays.length;m++){if(b==s.aNonWorkingDays[m]){e.addClass("sapUiCalItemWeekEnd");break}}}else if(b>=s.iWeekendStart&&b<=s.iWeekendEnd||s.iWeekendEnd<s.iWeekendStart&&(b>=s.iWeekendStart||b<=s.iWeekendEnd)){e.addClass("sapUiCalItemWeekEnd")}e.writeAttribute("tabindex","-1");e.writeAttribute("data-sap-day",u);if(g){p["label"]=p["label"]+s.aWeekDaysWide[b]+" "}p["label"]=p["label"]+s.oFormatLong.format(d.toUTCJSDate(),true);if(f!==""){r.addCalendarTypeAccInfo(p,f,s.oLegend)}if(s.sSecondaryCalendarType){p["label"]=p["label"]+" "+i._oFormatSecondaryLong.format(c.toUTCJSDate(),true)}e.writeAccessibilityState(null,p);e.writeClasses();e.writeStyles();e.write(">");e.write("<span");e.addClass("sapUiCalItemText");e.writeClasses();e.write(">");if(!w){e.write(d.getDate())}e.write("</span>");if(o&&b==s.iFirstDayOfWeek){e.write("<span");e.writeAttribute("id",s.sId+"-WNum-"+h);e.addClass("sapUiCalWeekNum");e.writeClasses();e.writeAccessibilityState(null,{role:"rowheader",desribedby:s.sId+"-CW"});e.write(">");e.write(h);e.write("</span>")}if(g){e.write("<span");e.addClass("sapUiCalDayName");e.writeClasses();e.write(">");e.write(s.aWeekDays[b]);e.write("</span>")}if(s.sSecondaryCalendarType){e.write("<span");e.addClass("sapUiCalItemSecText");e.writeClasses();e.write(">");e.write(c.getDate());e.write("</span>")}e.write("</div>")};return o},true);