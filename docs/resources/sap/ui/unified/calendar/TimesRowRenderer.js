/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/unified/calendar/CalendarUtils","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarLegendRenderer","sap/ui/unified/library"],function(e,t,a,i,r){"use strict";var s=r.CalendarDayType;var d={};d.render=function(e,t){var a=t._getStartDate();var i=t.getTooltip_AsString();var r=t.getId();var s={value:r+"-Descr",append:true};e.write("<div");e.writeControlData(t);e.addClass("sapUiCalTimesRow");e.addClass("sapUiCalRow");e.writeClasses();if(i){e.writeAttributeEscaped("title",i)}if(t._getShowHeader()){s.value=s.value+" "+r+"-Head"}e.writeAccessibilityState(t,{role:"grid",readonly:"true",multiselectable:!t.getSingleSelection()||t.getIntervalSelection(),labelledby:s});e.write(">");e.write('<span id="'+r+'-Descr" style="display: none;">'+t._rb.getText("CALENDAR_DIALOG")+"</span>");if(t.getIntervalSelection()){e.write('<span id="'+r+'-Start" style="display: none;">'+t._rb.getText("CALENDAR_START_TIME")+"</span>");e.write('<span id="'+r+'-End" style="display: none;">'+t._rb.getText("CALENDAR_END_TIME")+"</span>")}this.renderRow(e,t,a);e.write("</div>")};d.renderRow=function(e,t,a){var i=t.getId();this.renderHeader(e,t,a);e.write('<div id="'+i+'-times" class="sapUiCalItems">');this.renderTimes(e,t,a);e.write("</div>")};d.renderHeader=function(e,t,a){if(t._getShowHeader()){var i=t._getLocaleData();var r=t.getId();e.write('<div id="'+r+'-Head">');this.renderHeaderLine(e,t,i,a);e.write("</div>")}};d.renderHeaderLine=function(e,t,a,i){var r=t._getFormatDate();var s=t.getId();var d=t.getItems();var l=t._getIntervalStart(i);var n=t.getIntervalMinutes();var o="";var m=0;var g=[];var u=0;for(u=0;u<d;u++){m=r.format(l,true);if(g.length>0&&g[g.length-1].sDay==m){g[g.length-1].iItems++}else{g.push({sDay:m,iItems:1})}l.setUTCMinutes(l.getUTCMinutes()+n)}for(u=0;u<g.length;u++){var p=g[u];o=100/d*p.iItems+"%";e.write('<div id="'+s+"-Head"+u+'"class="sapUiCalHeadText" style="width:'+o+'">');e.write(p.sDay);e.write("</div>")}};d.renderTimes=function(e,t,a){var i=this.getHelper(t,a);var r=t.getItems();var s=100/r+"%";var d=t._getIntervalStart(a);var l="";var n="";for(var o=0;o<r;o++){if(i.oFormatTimeAmPm){n=i.oFormatTimeAmPm.format(d,true);if(l==n){n=""}else{l=n}}this.renderTime(e,t,d,i,s,n);d.setUTCMinutes(d.getUTCMinutes()+i.iMinutes)}};d.getHelper=function(a,i){var r={};r.sLocale=a._getLocale();r.oLocaleData=a._getLocaleData();r.oNow=t._createUniversalUTCDate(new Date,undefined,true);r.sCurrentTime=a._rb.getText("CALENDAR_CURRENT_TIME");r.sId=a.getId();r.oFormatLong=a._getFormatLong();r.oFormatTime=a._getFormatTime();r.oFormatTimeAmPm=a._oFormatTimeAmPm;r.iMinutes=a.getIntervalMinutes();var s=a.getLegend();if(s){var d=sap.ui.getCore().byId(s);if(d){if(!(d instanceof sap.ui.unified.CalendarLegend)){throw new Error(d+" is not an sap.ui.unified.CalendarLegend. "+a)}r.oLegend=d}else{e.sap.log.warning("CalendarLegend "+s+" does not exist!",a)}}return r};d.renderTime=function(e,t,r,d,l,n){var o={role:"gridcell",selected:false,label:"",describedby:""};var m=t._oFormatYyyyMMddHHmm.format(r.getJSDate(),true);var g=t._checkDateSelected(r);var u=t._getDateType(r);var p=t._checkTimeEnabled(r);e.write("<div");e.writeAttribute("id",d.sId+"-"+m);e.addClass("sapUiCalItem");if(l){e.addStyle("width",l)}var C=new a(r.getTime());C.setUTCMinutes(C.getUTCMinutes()+d.iMinutes);if(r.getTime()<=d.oNow.getTime()&&C.getTime()>d.oNow.getTime()){e.addClass("sapUiCalItemNow");o["label"]=d.sCurrentTime+" "}if(g>0){e.addClass("sapUiCalItemSel");o["selected"]=true}if(g==2){e.addClass("sapUiCalItemSelStart");o["describedby"]=o["describedby"]+" "+d.sId+"-Start"}else if(g==3){e.addClass("sapUiCalItemSelEnd");o["describedby"]=o["describedby"]+" "+d.sId+"-End"}else if(g==4){e.addClass("sapUiCalItemSelBetween")}else if(g==5){e.addClass("sapUiCalItemSelStart");e.addClass("sapUiCalItemSelEnd");o["describedby"]=o["describedby"]+" "+d.sId+"-Start";o["describedby"]=o["describedby"]+" "+d.sId+"-End"}if(u&&u.type!=s.None){e.addClass("sapUiCalItem"+u.type);if(u.tooltip){e.writeAttributeEscaped("title",u.tooltip)}}if(!p){e.addClass("sapUiCalItemDsbl");o["disabled"]=true}e.writeAttribute("tabindex","-1");e.writeAttribute("data-sap-time",m);o["label"]=o["label"]+d.oFormatLong.format(r,true);if(u&&u.type!=s.None){i.addCalendarTypeAccInfo(o,u.type,d.oLegend)}e.writeAccessibilityState(null,o);e.writeClasses();e.writeStyles();e.write(">");e.write("<span");e.addClass("sapUiCalItemText");e.writeClasses();e.write(">");e.write(d.oFormatTime.format(r,true));if(n){e.write("<span");e.addClass("sapUiCalItemTextAmPm");e.writeClasses();e.write(">");e.write(n);e.write("</span>")}e.write("</span>");e.write("</div>")};return d},true);