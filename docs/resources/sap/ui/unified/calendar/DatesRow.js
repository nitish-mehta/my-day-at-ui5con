/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/calendar/Month","sap/ui/unified/library","./DatesRowRenderer"],function(e,t,a,r,i,s){"use strict";var n=r.extend("sap.ui.unified.calendar.DatesRow",{metadata:{library:"sap.ui.unified",properties:{startDate:{type:"object",group:"Data"},days:{type:"int",group:"Appearance",defaultValue:7},showDayNamesLine:{type:"boolean",group:"Appearance",defaultValue:true}}}});n.prototype.init=function(){r.prototype.init.apply(this,arguments);this._iColumns=1;this._aWeekNumbers=[]};n.prototype.setStartDate=function(e){t._checkJSDateObject(e);var r=e.getFullYear();t._checkYearInValidRange(r);this.setProperty("startDate",e,true);this._oStartDate=a.fromLocalJSDate(e,this.getPrimaryCalendarType());if(this.getDomRef()){var i=this._getDate().toLocalJSDate();this._bNoRangeCheck=true;this.displayDate(e);this._bNoRangeCheck=false;if(i&&this.checkDateFocusable(i)){this.displayDate(i)}}return this};n.prototype._getStartDate=function(){if(!this._oStartDate){this._oStartDate=a.fromLocalJSDate(new Date,this.getPrimaryCalendarType())}return this._oStartDate};n.prototype.setDate=function(e){if(!this._bNoRangeCheck&&!this.checkDateFocusable(e)){throw new Error("Date must be in visible date range; "+this)}r.prototype.setDate.apply(this,arguments);return this};n.prototype.displayDate=function(e){if(!this._bNoRangeCheck&&!this.checkDateFocusable(e)){throw new Error("Date must be in visible date range; "+this)}r.prototype.displayDate.apply(this,arguments);return this};n.prototype.setPrimaryCalendarType=function(e){r.prototype.setPrimaryCalendarType.apply(this,arguments);if(this._oStartDate){this._oStartDate=new a(this._oStartDate,e)}return this};n.prototype.setFirstDayOfWeek=function(e){if(e==-1){return this.setProperty("firstDayOfWeek",e,false)}else{throw new Error("Property firstDayOfWeek not supported "+this)}};n.prototype._handleBorderReached=function(e){var t=e.getParameter("event");var r=this.getDays();var i=this._getDate();var s=new a(i,this.getPrimaryCalendarType());if(t.type){switch(t.type){case"sapnext":case"sapnextmodifiers":s.setDate(s.getDate()+1);break;case"sapprevious":case"sappreviousmodifiers":s.setDate(s.getDate()-1);break;case"sappagedown":s.setDate(s.getDate()+r);break;case"sappageup":s.setDate(s.getDate()-r);break;default:break}this.fireFocus({date:s.toLocalJSDate(),otherMonth:true,_outsideBorder:true})}};n.prototype.checkDateFocusable=function(e){t._checkJSDateObject(e);if(this._bNoRangeCheck){return false}var r=this._getStartDate();var i=new a(r,this.getPrimaryCalendarType());i.setDate(i.getDate()+this.getDays());var s=a.fromLocalJSDate(e,this.getPrimaryCalendarType());return s.isSameOrAfter(r)&&s.isBefore(i)};n.prototype._renderHeader=function(){var t=this._getStartDate();var a=t.getDay();var r=this._getLocaleData();var i=this.$("Names").children();var s=[];if(this._bLongWeekDays||!this._bNamesLengthChecked){s=r.getDaysStandAlone("abbreviated")}else{s=r.getDaysStandAlone("narrow")}var n=r.getDaysStandAlone("wide");var o=0;for(o=0;o<i.length;o++){var h=e(i[o]);h.text(s[(o+a)%7]);h.attr("aria-label",n[(o+a)%7])}if(this._getShowHeader()){var p=this.$("Head");if(p.length>0){var u=sap.ui.getCore().createRenderManager();this.getRenderer().renderHeaderLine(u,this,r,t);u.flush(p[0]);u.destroy()}}};n.prototype._getFirstWeekDay=function(){return this._getStartDate().getDay()};n.prototype.getWeekNumbers=function(){var e=this.getDays(),r=this._getLocale(),i=this._getLocaleData(),s=this.getPrimaryCalendarType(),n=this._getStartDate(),o=new a(n,s),h=new a(n,s).setDate(o.getDate()+e),p=[];while(o.isBefore(h)){p.push(new a(o,s));o.setDate(o.getDate()+1)}this._aWeekNumbers=p.reduce(function(e,a){var s=t.calculateWeekNumber(a.toUTCJSDate(),a.getYear(),r,i);if(!e.length||e[e.length-1].number!==s){e.push({len:0,number:s})}e[e.length-1].len++;return e},[]);return this._aWeekNumbers};n.prototype._getCachedWeekNumbers=function(){return this._aWeekNumbers};return n});