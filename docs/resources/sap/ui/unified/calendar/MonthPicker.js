/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/core/delegate/ItemNavigation","sap/ui/unified/library","sap/ui/core/Locale","./MonthPickerRenderer"],function(t,e,a,i,s,o,n,r){"use strict";var h=e.extend("sap.ui.unified.calendar.MonthPicker",{metadata:{library:"sap.ui.unified",properties:{month:{type:"int",group:"Data",defaultValue:0},months:{type:"int",group:"Appearance",defaultValue:12},columns:{type:"int",group:"Appearance",defaultValue:3},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"}},events:{select:{},pageChange:{}}}});h.prototype.init=function(){var t=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",t);this._iMinMonth=0;this._iMaxMonth=11};h.prototype.onAfterRendering=function(){l.call(this);p.call(this)};h.prototype.setMonth=function(t){this.setProperty("month",t,true);t=this.getProperty("month");if(t<0||t>11){throw new Error("Property month must be between 0 and 11; "+this)}if(this.getDomRef()){if(this.getMonths()<12){var e=this.getStartMonth();if(t>=e&&t<=e+this.getMonths()-1){f.call(this,t,true);this._oItemNavigation.focusItem(t-e)}else{d.call(this,t)}}else{f.call(this,t,true);this._oItemNavigation.focusItem(t)}}return this};h.prototype._getLocale=function(){var t=this.getParent();if(t&&t._getLocale){return t._getLocale()}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};h.prototype._getLocaleData=function(){var t=this.getParent();if(t&&t._getLocaleData){return t._getLocaleData()}else if(!this._oLocaleData){var e=this._getLocale();var a=new n(e);this._oLocaleData=i.getInstance(a)}return this._oLocaleData};h.prototype.onsapspace=function(t){t.preventDefault()};h.prototype.onsapselect=function(t){var e=this._oItemNavigation.getFocusedIndex();var a=e+this.getStartMonth();if(a>=this._iMinMonth&&a<=this._iMaxMonth){f.call(this,a);this.fireSelect()}};h.prototype.onmousedown=function(t){this._oMousedownPosition={clientX:t.clientX,clientY:t.clientY}};h.prototype.onmouseup=function(t){if(this._bMousedownChange){this._bMousedownChange=false;this.fireSelect()}else if(a.support.touch&&this._isValueInThreshold(this._oMousedownPosition.clientX,t.clientX,10)&&this._isValueInThreshold(this._oMousedownPosition.clientY,t.clientY,10)){var e=this._oItemNavigation.getFocusedIndex();var i=e+this.getStartMonth();f.call(this,i);this.fireSelect()}};h.prototype.onThemeChanged=function(){if(this._bNoThemeChange){return}if(!this.getDomRef()){return}this._bNamesLengthChecked=undefined;var e=this._oItemNavigation.getItemDomRefs();this._bLongMonth=false;var a=this._getLocaleData();var i=a.getMonthsStandAlone("wide",this.getPrimaryCalendarType());for(var s=0;s<e.length;s++){var o=t(e[s]);o.text(i[s])}p.call(this)};h.prototype.nextPage=function(){var t=this.getStartMonth();var e=this._oItemNavigation.getFocusedIndex();var a=e+t;var i=this.getMonths();a=a+i;if(a>11){a=11}d.call(this,a);return this};h.prototype.previousPage=function(){var t=this.getStartMonth();var e=this._oItemNavigation.getFocusedIndex();var a=e+t;var i=this.getMonths();a=a-i;if(a<0){a=0}d.call(this,a);return this};h.prototype.setMinMax=function(e,a){if(e==this._iMinMonth&&a==this._iMaxMonth){return this}e=parseInt(e,10);if(isNaN(e)||e<0||e>11){e=0}a=parseInt(a,10);if(isNaN(a)||a<0||a>11){a=11}if(e<=a){this._iMinMonth=e;this._iMaxMonth=a}else{this._iMaxMonth=e;this._iMinMonth=a}if(this.getDomRef()){var i=this._oItemNavigation.getItemDomRefs();var s=this.getId().length+2;for(var o=0;o<i.length;o++){var n=t(i[o]);var r=parseInt(n.attr("id").slice(s),10);if(r<this._iMinMonth||r>this._iMaxMonth){n.addClass("sapUiCalItemDsbl");n.attr("aria-disabled",true)}else{n.removeClass("sapUiCalItemDsbl");n.removeAttr("aria-disabled")}}}return this};h.prototype.getStartMonth=function(){if(this.getMonths()<12){var t=this._oItemNavigation.getItemDomRefs()[0];return parseInt(t.id.slice(this.getId().length+2),10)}else{return 0}};h.prototype._isValueInThreshold=function(t,e,a){var i=t-a,s=t+a;return e>=i&&e<=s};function l(){var t=this.getDomRef();var e=this.$().find(".sapUiCalItem");var a=this.getColumns();var i=this.getMonths();var o=true;if(i<12){o=false}if(!this._oItemNavigation){this._oItemNavigation=new s;this._oItemNavigation.attachEvent(s.Events.AfterFocus,g,this);this._oItemNavigation.attachEvent(s.Events.FocusAgain,u,this);this._oItemNavigation.attachEvent(s.Events.BorderReached,v,this);this.addDelegate(this._oItemNavigation);this._oItemNavigation.setHomeEndColumnMode(true,true);this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"],saphome:["alt"],sapend:["alt"]})}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(e);this._oItemNavigation.setCycling(o);this._oItemNavigation.setColumns(a,!o);var n=this.getMonth()-this.getStartMonth();this._oItemNavigation.setFocusedIndex(n);this._oItemNavigation.setPageSize(e.length)}function g(t){var e=t.getParameter("index");var a=t.getParameter("event");if(!a){return}if(a.type=="mousedown"){c.call(this,a,e)}}function u(t){var e=t.getParameter("index");var a=t.getParameter("event");if(!a){return}if(a.type=="mousedown"){c.call(this,a,e)}}function c(t,e){if(t.button||a.support.touch){return}var i=e+this.getStartMonth();if(i>=this._iMinMonth&&i<=this._iMaxMonth){f.call(this,i);this._bMousedownChange=true}t.preventDefault();t.setMark("cancelAutoClose")}function v(t){var e=t.getParameter("event");if(e.type){var a=this.getStartMonth();var i=this._oItemNavigation.getFocusedIndex();var s=i+a;var o=this.getMonths();switch(e.type){case"sapnext":case"sapnextmodifiers":if(s<11){s++;d.call(this,s,true)}break;case"sapprevious":case"sappreviousmodifiers":if(s>0){s--;d.call(this,s,true)}break;case"sappagedown":if(s<12-o){s=s+o;d.call(this,s,true)}break;case"sappageup":if(s>o){s=s-o;d.call(this,s,true)}break;default:break}}}function f(e,a){var i=this._oItemNavigation.getItemDomRefs();var s;var o=this.getId()+"-m"+e;for(var n=0;n<i.length;n++){s=t(i[n]);if(s.attr("id")==o){s.addClass("sapUiCalItemSel");s.attr("aria-selected","true")}else{s.removeClass("sapUiCalItemSel");s.attr("aria-selected","false")}}if(!a){this.setProperty("month",e,true)}}function p(){if(!this._bNamesLengthChecked){var e=0;var a=this._oItemNavigation.getItemDomRefs();var i=false;var s=this.getMonths();var o=Math.ceil(12/s);var n=s-1;for(var r=0;r<o;r++){if(s<12){d.call(this,n);n=n+s;if(n>11){n=11}}for(e=0;e<a.length;e++){var h=a[e];if(Math.abs(h.clientWidth-h.scrollWidth)>1){i=true;break}}if(i){break}}if(s<12){n=this.getMonth();d.call(this,n)}if(i){this._bLongMonth=false;var l=this._getLocaleData();var g=this.getPrimaryCalendarType();var u=l.getMonthsStandAlone("abbreviated",g);var c=l.getMonthsStandAlone("wide",g);for(e=0;e<a.length;e++){var v=t(a[e]);v.text(u[e]);v.attr("aria-label",c[e])}}else{this._bLongMonth=true}this._bNamesLengthChecked=true}}function d(e,a){var i=this._oItemNavigation.getItemDomRefs();if(i.legth>11){return}var s=i.length;var o=Math.floor(e/s)*s;if(o+s>12){o=12-s}var n=this._getLocaleData();var r=[];var h=[];var l=this.getPrimaryCalendarType();if(this._bLongMonth||!this._bNamesLengthChecked){r=n.getMonthsStandAlone("wide",l)}else{r=n.getMonthsStandAlone("abbreviated",l);h=n.getMonthsStandAlone("wide",l)}var g=this.getMonth();for(var u=0;u<i.length;u++){var c=u+o;var v=t(i[u]);v.text(r[u+o]);v.attr("id",this.getId()+"-m"+(u+o));if(!this._bLongMonth){v.attr("aria-label",h[u+o])}if(c==g){v.addClass("sapUiCalItemSel");v.attr("aria-selected","true")}else{v.removeClass("sapUiCalItemSel");v.attr("aria-selected","false")}if(c<this._iMinMonth||c>this._iMaxMonth){v.addClass("sapUiCalItemDsbl");v.attr("aria-disabled",true)}else{v.removeClass("sapUiCalItemDsbl");v.removeAttr("aria-disabled")}}this._oItemNavigation.focusItem(e-o);if(a){this.firePageChange()}}return h});