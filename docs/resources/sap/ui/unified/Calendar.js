/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/DateRange","./calendar/Header","./calendar/Month","./calendar/MonthPicker","./calendar/YearPicker","./calendar/CalendarDate","./library","sap/ui/Device","sap/ui/core/format/DateFormat","sap/ui/core/ResizeHandler","sap/ui/core/Locale","./CalendarRenderer"],function(e,t,a,i,s,o,r,n,h,g,l,d,u,c,p,f){"use strict";var _=t.extend("sap.ui.unified.Calendar",{metadata:{library:"sap.ui.unified",designtime:"sap/ui/unified/designtime/Calendar.designtime",properties:{intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},months:{type:"int",group:"Appearance",defaultValue:1},firstDayOfWeek:{type:"int",group:"Appearance",defaultValue:-1},nonWorkingDays:{type:"int[]",group:"Appearance",defaultValue:null},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance",defaultValue:null},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},disabledDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"disabledDate"},header:{type:"sap.ui.unified.calendar.Header",multiple:false,visibility:"hidden"},secondMonthHeader:{type:"sap.ui.unified.calendar.Header",multiple:false,visibility:"hidden"},month:{type:"sap.ui.unified.calendar.Month",multiple:true,visibility:"hidden"},monthPicker:{type:"sap.ui.unified.calendar.MonthPicker",multiple:false,visibility:"hidden"},yearPicker:{type:"sap.ui.unified.calendar.YearPicker",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},cancel:{},startDateChange:{},weekNumberSelect:{allowPreventDefault:true,parameters:{weekNumber:{type:"int"},weekDays:{type:"sap.ui.unified.DateRange"}}}}}});_.prototype.init=function(){this._iBreakPointTablet=d.media._predefinedRangeSets[d.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=d.media._predefinedRangeSets[d.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=d.media._predefinedRangeSets[d.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];var t=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",t);this.setProperty("secondaryCalendarType",t);this._iMode=0;this._iColumns=1;this._oYearFormat=u.getDateInstance({format:"y",calendarType:t});this.data("sap-ui-fastnavgroup","true",true);this._oMinDate=i._minDate(this.getPrimaryCalendarType());this._oMaxDate=i._maxDate(this.getPrimaryCalendarType());this._initializeHeader();this._initializeSecondMonthHeader();var a=this._createMonth(this.getId()+"--Month0");a.attachEvent("focus",this._handleFocus,this);a.attachEvent("select",P,this);a.attachEvent("_renderMonth",M,this);a.attachEvent("_bindMousemove",C,this);a.attachEvent("_unbindMousemove",S,this);a._bNoThemeChange=true;this.addAggregation("month",a);this._initilizeMonthPicker();this._initilizeYearPicker();this._resizeProxy=e.proxy(b,this);this._oSelectedMonth};_.prototype.exit=function(){if(this._sInvalidateMonth){e.sap.clearDelayedCall(this._sInvalidateMonth)}if(this._sResizeListener){c.deregister(this._sResizeListener);this._sResizeListener=undefined}this._oSelectedMonth=null};_.prototype._initializeHeader=function(){var e=new o(this.getId()+"--Head");e.attachEvent("pressPrevious",this._handlePrevious,this);e.attachEvent("pressNext",this._handleNext,this);e.attachEvent("pressButton1",this._handleButton1,this);e.attachEvent("pressButton2",this._handleButton2,this);e.attachEvent("pressButton3",this._handleButton1,this);e.attachEvent("pressButton4",this._handleButton2,this);this.setAggregation("header",e)};_.prototype._initializeSecondMonthHeader=function(){var e=new o(this.getId()+"--SecondMonthHead");e.addStyleClass("sapUiCalHeadSecondMonth");e.attachEvent("pressPrevious",this._handlePrevious,this);e.attachEvent("pressNext",this._handleNext,this);e.attachEvent("pressButton1",this._handleButton1,this);e.attachEvent("pressButton2",this._handleButton2,this);this.setAggregation("secondMonthHeader",e)};_.prototype._initilizeMonthPicker=function(){var e=new n(this.getId()+"--MP");e.attachEvent("select",this._selectMonth,this);e._bNoThemeChange=true;this.setAggregation("monthPicker",e)};_.prototype._initilizeYearPicker=function(){var e=new h(this.getId()+"--YP");e.attachEvent("select",this._selectYear,this);this.setAggregation("yearPicker",e)};_.prototype._createMonth=function(e){var t=new r(e,{width:"100%"});t.attachEvent("datehovered",this._handleDateHovered,this);return t};_.prototype._handleDateHovered=function(e){var t=this.getAggregation("month"),a=e.getParameter("date1"),i=e.getParameter("date2"),s;for(s=0;s<t.length;s++){t[s]._markDatesBetweenStartAndHoveredDate(a,i)}};_.prototype.onBeforeRendering=function(){var e=this.getAggregation("month");var t;var a=e[0].getDate();var i=this._getFocusedDate();if(e.length>1&&a){t=g.fromLocalJSDate(a,this.getPrimaryCalendarType())}else if(e.length>1){t=T.call(this,this._getFocusedDate())}else{t=i}for(var s=0;s<e.length;s++){a=new g(t);if(s>0){a.setDate(1);a.setMonth(a.getMonth()+s)}var o=a;if(i.getYear()===a.getYear()&&i.getMonth()===a.getMonth()){o=i}e[s].displayDate(o.toLocalJSDate());e[s].setShowWeekNumbers(this.getShowWeekNumbers())}this._updateHeader(t);this._iSize=0};_.prototype.onAfterRendering=function(e){if(!this._getSucessorsPickerPopup()){D.call(this)}if(y.call(this)>1||this._bInitMonth){e.size={width:this.getDomRef().offsetWidth};b.call(this,e,true);if(!this._sResizeListener){this._sResizeListener=c.register(this,this._resizeProxy)}this._bInitMonth=undefined}};_.prototype.invalidate=function(a){if(!this._bDateRangeChanged&&(!a||!(a instanceof s))){t.prototype.invalidate.apply(this,arguments)}else if(this.getDomRef()&&this._iMode==0&&!this._sInvalidateMonth){this._sInvalidateMonth=e.sap.delayedCall(0,this,this._invalidateMonth,[a])}};_.prototype.removeSelectedDate=function(e){this._bDateRangeChanged=true;return this.removeAggregation("selectedDates",e)};_.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("selectedDates");return e};_.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("selectedDates");return e};_.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("specialDates");return e};_.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("specialDates");return e};_.prototype.getSpecialDates=function(){var e=this.getParent();if(e&&e.getSpecialDates){return e.getSpecialDates()}else{return this.getAggregation("specialDates",[])}};_.prototype.removeAllDisabledDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("disabledDates");return e};_.prototype.destroyDisabledDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("disabledDates");return e};_.prototype.setLocale=function(e){if(this._sLocale!=e){this._sLocale=e;this._oLocaleData=undefined;this.invalidate()}return this};_.prototype.getLocale=function(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};_.prototype._getFocusedDate=function(){if(!this._oFocusedDate){m.call(this)}return this._oFocusedDate};_.prototype._setFocusedDate=function(e){i._checkCalendarDate(e);this._oFocusedDate=new g(e,this.getPrimaryCalendarType())};_.prototype.focusDate=function(e){v.call(this,e,false);return this};_.prototype.displayDate=function(e){v.call(this,e,true);return this};_.prototype.getStartDate=function(){var e;if(this.getDomRef()){var t=this.getAggregation("month");e=g.fromLocalJSDate(t[0].getDate(),this.getPrimaryCalendarType())}else{e=new g(this._getFocusedDate())}e.setDate(1);return e.toLocalJSDate()};_.prototype.setPopupMode=function(e){this._bPoupupMode=e;return this};_.prototype.setMonths=function(e){this._bDateRangeChanged=undefined;this.setProperty("months",e,false);e=y.call(this);var t=this.getAggregation("month");var a=0;var i;if(t.length<e){for(a=t.length;a<e;a++){i=this._createMonth(this.getId()+"--Month"+a);i.attachEvent("focus",this._handleFocus,this);i.attachEvent("select",P,this);i.attachEvent("_renderMonth",M,this);i.attachEvent("_bindMousemove",C,this);i.attachEvent("_unbindMousemove",S,this);i._bNoThemeChange=true;this.addAggregation("month",i)}}else if(t.length>e){for(a=t.length;a>e;a--){i=this.removeAggregation("month",a-1);i.destroy()}if(e==1){this._bInitMonth=true}}if(e>1&&t[0].getDate()){t[0].setProperty("date",null,true)}return this};_.prototype.setPrimaryCalendarType=function(e){var t=this.getAggregation("month");var a=false;if(t.length>1){a=true}this.setProperty("primaryCalendarType",e,!a);this._oYearFormat=u.getDateInstance({format:"y",calendarType:e});if(this._oFocusedDate){this._oFocusedDate=new g(this._oFocusedDate,e)}this._oMinDate=new g(this._oMinDate,e);this._oMaxDate=new g(this._oMaxDate,e);for(var i=0;i<t.length;i++){var s=t[i];s.setPrimaryCalendarType(e)}if(!this._getSucessorsPickerPopup()){var o=this.getAggregation("monthPicker");o.setPrimaryCalendarType(e);var r=this.getAggregation("yearPicker");r.setPrimaryCalendarType(e)}if(this.getDomRef()){this._updateHeader(this._oFocusedDate);if(!this._getSucessorsPickerPopup()){if(this.iMode!=1&&o.getDomRef()){o.$().remove()}if(this.iMode!=2&&r.getDomRef()){r.$().remove()}}}return this};_.prototype.setSecondaryCalendarType=function(e){this._bSecondaryCalendarTypeSet=true;this.setProperty("secondaryCalendarType",e,true);this._oYearFormatSecondary=u.getDateInstance({format:"y",calendarType:e});var t=this.getAggregation("month");for(var a=0;a<t.length;a++){var i=t[a];i.setSecondaryCalendarType(e)}if(this.getDomRef()){this._updateHeader(this._getFocusedDate());this.$().toggleClass("sapUiCalSecType",!!this._getSecondaryCalendarType())}return this};_.prototype._getSecondaryCalendarType=function(){var e;if(this._bSecondaryCalendarTypeSet){e=this.getSecondaryCalendarType();var t=this.getPrimaryCalendarType();if(e==t){e=undefined}}return e};_.prototype.setMinDate=function(t){if(e.sap.equal(t,this.getMinDate())){return this}if(!t){this._oMinDate=i._minDate(this.getPrimaryCalendarType())}else{i._checkJSDateObject(t);this._oMinDate=g.fromLocalJSDate(t,this.getPrimaryCalendarType());var a=this._oMinDate.getYear();i._checkYearInValidRange(a);if(this._oMaxDate.isBefore(this._oMinDate)){e.sap.log.warning("minDate > maxDate -> maxDate set to end of the month",this);this._oMaxDate=g.fromLocalJSDate(t,this.getPrimaryCalendarType());this._oMaxDate.setDate(i._daysInMonth(this._oMaxDate));this.setProperty("maxDate",this._oMaxDate.toLocalJSDate(),true)}this._setMinMaxDateExtend(g.fromLocalJSDate(t,this.getPrimaryCalendarType()))}this.setProperty("minDate",t,false);if(!this._getSucessorsPickerPopup()){var s=this.getAggregation("yearPicker");s._oMinDate.setYear(this._oMinDate.getYear())}return this};_.prototype.setMaxDate=function(t){if(e.sap.equal(t,this.getMaxDate())){return this}if(!t){this._oMaxDate=i._maxDate(this.getPrimaryCalendarType())}else{i._checkJSDateObject(t);this._oMaxDate=g.fromLocalJSDate(t,this.getPrimaryCalendarType());var a=this._oMaxDate.getYear();i._checkYearInValidRange(a);if(this._oMinDate.isAfter(this._oMaxDate)){e.sap.log.warning("maxDate < minDate -> minDate set to begin of the month",this);this._oMinDate=g.fromLocalJSDate(t,this.getPrimaryCalendarType());this._oMinDate.setDate(1);this.setProperty("minDate",this._oMinDate.toLocalJSDate(),true)}this._setMinMaxDateExtend(g.fromLocalJSDate(t,this.getPrimaryCalendarType()))}this.setProperty("maxDate",t,false);if(!this._getSucessorsPickerPopup()){var s=this.getAggregation("yearPicker");s._oMaxDate.setYear(this._oMaxDate.getYear())}return this};_.prototype._setMinMaxDateExtend=function(t){if(this._oFocusedDate){if(i._isOutside(this._oFocusedDate,this._oMinDate,this._oMaxDate)){e.sap.log.warning("focused date is not between [minDate - maxDate] -> refocus to the new max/min date: "+t.toString(),this);this.focusDate(t.toLocalJSDate())}}};_.prototype._getLocaleData=function(){if(!this._oLocaleData){var e=this.getLocale();var t=new p(e);this._oLocaleData=a.getInstance(t)}return this._oLocaleData};_.prototype._getShowMonthHeader=function(){var e=y.call(this);if(e>2){return true}else{return false}};_.prototype.setWidth=function(e){this.setProperty("width",e,true);if(this.getDomRef()){e=this.getWidth();this.$().css("width",e);if(e){this.$().addClass("sapUiCalWidth")}else{this.$().removeClass("sapUiCalWidth")}}return this};_.prototype.onclick=function(e){var t=e.target,a=t.classList.contains("sapUiCalWeekNum");if(this.getIntervalSelection()&&this.getPrimaryCalendarType()===sap.ui.core.CalendarType.Gregorian&&a){this._handleWeekSelection(t)}if(e.isMarked("delayedMouseEvent")){return}if(t.id==this.getId()+"-cancel"){this.onsapescape(e)}};_.prototype.onmousedown=function(e){e.preventDefault();e.setMark("cancelAutoClose")};_.prototype.onsapescape=function(e){if(this._iMode==0){this.fireCancel()}this._closedPickers()};_.prototype.onsapshow=function(e){if(this._bPoupupMode){this._closedPickers();this.fireCancel();e.preventDefault()}};_.prototype.onsaphide=_.prototype.onsapshow;_.prototype.onsaptabnext=function(t){var a=this.getAggregation("header");if(e.sap.containsOrEquals(this.getDomRef("content"),t.target)){if(this._shouldFocusB2OnTabNext(t)){e.sap.focus(a.getDomRef("B2"))}else{e.sap.focus(a.getDomRef("B1"))}if(!this._bPoupupMode){var i=this.getAggregation("month");for(var s=0;s<i.length;s++){var o=i[s];e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(!this._getSucessorsPickerPopup()){var r=this.getAggregation("monthPicker");var n=this.getAggregation("yearPicker");if(r.getDomRef()){e(r._oItemNavigation.getItemDomRefs()[r._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(n.getDomRef()){e(n._oItemNavigation.getItemDomRefs()[n._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}t.preventDefault()}else if(this._shouldFocusB2OnTabNext(t)){e.sap.focus(a.getDomRef("B2"));t.preventDefault()}};_.prototype._shouldFocusB2OnTabNext=function(e){var t=this.getAggregation("header");return e.target.id==t.getId()+"-B1"};_.prototype._shouldFocusB2OnTabPrevious=function(e){return this._bPoupupMode};_.prototype.onsaptabprevious=function(t){var a=this.getAggregation("header");if(e.sap.containsOrEquals(this.getDomRef("content"),t.target)){if(this._shouldFocusB2OnTabPrevious()){e.sap.focus(a.getDomRef("B2"));t.preventDefault()}}else if(t.target.id==a.getId()+"-B1"){var i=this.getAggregation("month");var s;switch(this._iMode){case 0:s=this._getFocusedDate();for(var o=0;o<i.length;o++){var r=i[o];var n=g.fromLocalJSDate(r.getDate(),this.getPrimaryCalendarType());if(s.isSame(n)){r._oItemNavigation.focusItem(r._oItemNavigation.getFocusedIndex())}else{e(r._oItemNavigation.getItemDomRefs()[r._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}break;case 1:if(!this._getSucessorsPickerPopup()){var h=this.getAggregation("monthPicker");h._oItemNavigation.focusItem(h._oItemNavigation.getFocusedIndex())}break;case 2:if(!this._getSucessorsPickerPopup()){var l=this.getAggregation("yearPicker");l._oItemNavigation.focusItem(l._oItemNavigation.getFocusedIndex())}break}t.preventDefault()}else if(t.target.id==a.getId()+"-B2"){e.sap.focus(a.getDomRef("B1"));t.preventDefault()}};_.prototype.onfocusin=function(t){if(t.target.id==this.getId()+"-end"){var a=this.getAggregation("month");this._focusOnShiftTab();if(!this._bPoupupMode){for(var i=0;i<a.length;i++){var s=a[i];e(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(!this._getSucessorsPickerPopup()){var o=this.getAggregation("monthPicker");var r=this.getAggregation("yearPicker");if(o.getDomRef()){e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(r.getDomRef()){e(r._oItemNavigation.getItemDomRefs()[r._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}}this.$("end").attr("tabindex","-1")};_.prototype._focusOnShiftTab=function(){var t=this.getAggregation("header");e.sap.focus(t.getDomRef("B2"))};_.prototype.onsapfocusleave=function(t){var a,i,s,o;if(!t.relatedControlId||!e.sap.containsOrEquals(this.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){this.$("end").attr("tabindex","0");if(!this._bPoupupMode){a=this.getAggregation("month");switch(this._iMode){case 0:for(var r=0;r<a.length;r++){i=a[r];e(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break;case 1:if(!this._getSucessorsPickerPopup()){s=this.getAggregation("monthPicker");e(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break;case 2:if(!this._getSucessorsPickerPopup()){o=this.getAggregation("yearPicker");e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break}}}};_.prototype.getFocusDomRef=function(){var e=this._oSelectedMonth?this._oSelectedMonth:this.getAggregation("month")[0];return e._oItemNavigation.getItemDomRefs()[e._oItemNavigation.getFocusedIndex()]};_.prototype.onThemeChanged=function(){var e;if(!this.getDomRef()){return}this._bNamesLengthChecked=undefined;if(!this._getSucessorsPickerPopup()){e=this.getAggregation("monthPicker");this._showMonthPicker(true);e._bNoThemeChange=false;e.onThemeChanged(arguments);e._bNoThemeChange=true;this._bLongMonth=e._bLongMonth;this._hideMonthPicker(true)}var t=this.getAggregation("month");for(var a=0;a<t.length;a++){var i=t[a];i._bNoThemeChange=false;i.onThemeChanged(arguments);i._bNoThemeChange=true}var s;if(t.length>1){s=g.fromLocalJSDate(t[0].getDate(),this.getPrimaryCalendarType())}else{s=this._getFocusedDate()}this._setHeaderText(s);this._updateHeadersButtons();this._setPrimaryHeaderMonthButtonText();this._toggleTwoMonthsInTwoColumnsCSS();if(!this._getSucessorsPickerPopup()){D.call(this)}};_.prototype._updateHeader=function(e){this._setHeaderText(e);this._togglePrevNext(e,true)};_.prototype._togglePrevNext=function(e,t){var a=this._oMaxDate.getYear();var s=this._oMinDate.getYear();var o=this._oMaxDate.getMonth();var r=this._oMinDate.getMonth();var n=this.getAggregation("header");var h=y.call(this);var l=new g(e,this.getPrimaryCalendarType());if(this._iMode==0&&h>1){l=T.call(this,e);l.setMonth(l.getMonth()+h-1);l.setDate(i._daysInMonth(l))}else{l.setDate(i._daysInMonth(l))}var d=l.getYear();var u=l.getMonth();if(d>a||d==a&&(!t||u>=o)||this._iMode==1&&this._getSucessorsPickerPopup()){n.setEnabledNext(false)}else{n.setEnabledNext(true)}if(this._iMode==0&&h>1){l.setMonth(l.getMonth()-h+1);l.setDate(1)}else{l.setDate(1)}d=l.getYear();u=l.getMonth();if(d<s||d==s&&(!t||u<=r)||this._iMode==1&&this._getSucessorsPickerPopup()){n.setEnabledPrevious(false)}else{n.setEnabledPrevious(true)}};_.prototype._togglePrevNexYearPicker=function(){var e=this.getAggregation("yearPicker");var t=e.getYears();var a=g.fromLocalJSDate(e.getFirstRenderedDate());a.setYear(a.getYear()+Math.floor(t/2));var i=this.getAggregation("header");var s=new g(this._oMaxDate,this.getPrimaryCalendarType());s.setYear(s.getYear()-Math.ceil(t/2));s.setMonth(11);s.setDate(31);var o=new g(this._oMinDate,this.getPrimaryCalendarType());o.setYear(o.getYear()+Math.floor(t/2)+1);o.setMonth(0);o.setDate(1);i.setEnabledNext(a.isSameOrBefore(s));i.setEnabledPrevious(a.isSameOrAfter(o))};_.prototype._handlePrevious=function(e){var t=this._getFocusedDate();var a=this.getAggregation("yearPicker");var i=y.call(this);var s;var o;var r=false;switch(this._iMode){case 0:if(i>1){s=g.fromLocalJSDate(this.getAggregation("month")[0].getDate(),this.getPrimaryCalendarType());s.setDate(1);this._setFocusedDate(s);t=this._getFocusedDate()}else{t.setDate(1)}t.setDate(t.getDate()-1);this._renderMonth(r,true);break;case 1:t.setYear(t.getYear()-1);this._updateHeadersYearPrimaryText(this._oYearFormat.format(t.toUTCJSDate(),true));var n=this._getSecondaryCalendarType();if(n){o=new g(t,n);o.setMonth(0);o.setDate(1);this._updateHeadersYearAdditionalText(this._oYearFormatSecondary.format(o.toUTCJSDate(),true))}else{this._updateHeadersYearAdditionalText()}this._togglePrevNext(t);this._setDisabledMonths(t.getYear());break;case 2:a.previousPage();this._togglePrevNexYearPicker();break}};_.prototype._handleNext=function(e){var t=this._getFocusedDate();var a=this.getAggregation("yearPicker");var i=y.call(this);var s;var o;switch(this._iMode){case 0:if(i>1){s=g.fromLocalJSDate(this.getAggregation("month")[0].getDate(),this.getPrimaryCalendarType());this._setFocusedDate(s);t=this._getFocusedDate()}t.setDate(1);t.setMonth(t.getMonth()+i);this._renderMonth();break;case 1:t.setYear(t.getYear()+1);this._updateHeadersYearPrimaryText(this._oYearFormat.format(t.toUTCJSDate(),true));var r=this._getSecondaryCalendarType();if(r){o=new g(t,r);o.setMonth(0);o.setDate(1);this._updateHeadersYearAdditionalText(this._oYearFormatSecondary.format(o.toUTCJSDate(),true))}else{this._updateHeadersYearAdditionalText()}this._togglePrevNext(t);this._setDisabledMonths(t.getYear());break;case 2:a.nextPage();this._togglePrevNexYearPicker();break}};_.prototype._getDisplayedMonths=function(e){var t=[];var a=e.getMonth();var i=y.call(this);if(i>1){for(var s=0;s<i;s++){t.push((a+s)%12)}}else{t.push(a)}return t};_.prototype._getDisplayedSecondaryMonths=function(e,t){var a=this.getAggregation("month");var s=g.fromLocalJSDate(a[0].getDate(),e);s.setDate(1);s=new g(s,t);var o=s.getMonth();var r=g.fromLocalJSDate(a[a.length-1].getDate(),e);r.setDate(i._daysInMonth(r));r=new g(r,t);var n=r.getMonth();return{start:o,end:n}};_.prototype._closedPickers=function(){switch(this._iMode){case 0:break;case 1:this._hideMonthPicker();break;case 2:this._hideYearPicker();break}};_.prototype._setDisabledMonths=function(e,t){var a=0;var i=11;if(e==this._oMinDate.getYear()){a=this._oMinDate.getMonth()}if(e==this._oMaxDate.getYear()){i=this._oMaxDate.getMonth()}if(!t){t=this.getAggregation("monthPicker")}t.setMinMax(a,i)};_.prototype._handleFocus=function(t){var a=g.fromLocalJSDate(t.getParameter("date"),this.getPrimaryCalendarType());var i=t.getParameter("otherMonth");var s=t.getParameter("restoreOldDate");if(s){if(!e.sap.equal(this._getFocusedDate(),a)){this._renderMonth(false,false,true)}}else{this._focusDate(a,i)}};_.prototype._getVisibleDays=function(){var e=this.getAggregation("month")[0];return e._getVisibleDays(e._getDate(),false)};_.prototype._renderMonth=function(e,t,a){var s=this._getFocusedDate();var o=this.getAggregation("month");var r=false;var n;var h;var l;var d=0;for(d=0;d<o.length;d++){n=o[d];if(n.checkDateFocusable(s.toLocalJSDate())){r=true}if(r||o.length==1){if(!e){n.setDate(s.toLocalJSDate())}else{n.displayDate(s.toLocalJSDate())}break}}if(!r){l=new g(s,this.getPrimaryCalendarType());if(o.length>1){l=T.call(this,l);for(d=0;d<o.length;d++){n=o[d];h=new g(l,this.getPrimaryCalendarType());h.setMonth(l.getMonth()+d);if(!e&&i._isSameMonthAndYear(h,s)){n.setDate(s.toLocalJSDate())}else{n.displayDate(h.toLocalJSDate())}}}this._updateHeader(l);this._updateHeadersButtons();this._setPrimaryHeaderMonthButtonText();this._toggleTwoMonthsInTwoColumnsCSS();if(!a){this.fireStartDateChange()}}};function m(){var e=this.getSelectedDates();var t=this.getPrimaryCalendarType();if(e&&e[0]&&e[0].getStartDate()){this._oFocusedDate=g.fromLocalJSDate(e[0].getStartDate(),t)}else{this._oFocusedDate=g.fromLocalJSDate(new Date,t)}if(this._oFocusedDate.isBefore(this._oMinDate)){this._oFocusedDate=new g(this._oMinDate,t)}else if(this._oFocusedDate.isAfter(this._oMaxDate)){this._oFocusedDate=new g(this._oMaxDate,t)}}_.prototype._showMonthPicker=function(t){if(this._iMode==2){this._hideYearPicker(true)}var a=this._getFocusedDate();var i=this.getAggregation("monthPicker");if(i.getDomRef()){i.$().css("display","")}else{var s=sap.ui.getCore().createRenderManager();var o=this.$("content");s.renderControl(i);s.flush(o[0],false,true);s.destroy()}this._showOverlay();if(!t){i.setMonth(a.getMonth());this._setDisabledMonths(a.getYear(),i);if(this._iMode==0){var r=this.getAggregation("month");for(var n=0;n<r.length;n++){var h=r[n];e(h._oItemNavigation.getItemDomRefs()[h._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}this._iMode=1;this._togglePrevNext(a,false)};_.prototype._hideMonthPicker=function(t){this._iMode=0;var a=this.getAggregation("monthPicker");a.$().css("display","none");this._hideOverlay();if(!t){this._renderMonth();if(y.call(this)>1){var i=this.getAggregation("month");for(var s=0;s<i.length;s++){var o=i[s];e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}}this._togglePrevNext(this._getFocusedDate(),true)};_.prototype._showYearPicker=function(){if(this._iMode==1){this._hideMonthPicker(true)}var t=this._getFocusedDate();var a=this.getAggregation("yearPicker");if(a.getDomRef()){a.$().css("display","")}else{var i=sap.ui.getCore().createRenderManager();var s=this.$("content");i.renderControl(a);i.flush(s[0],false,true);i.destroy()}this._showOverlay();a.setDate(t.toLocalJSDate());var o;if(y.call(this)==1){o=this.getAggregation("month")[0];var r=o.$("days").find(".sapUiCalItem");if(r.length==28){a.$().addClass("sapUiCalYearNoTop")}else{a.$().removeClass("sapUiCalYearNoTop")}}if(this._iMode==0){var n=this.getAggregation("month");for(var h=0;h<n.length;h++){o=n[h];e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}this._togglePrevNexYearPicker();this._iMode=2};_.prototype._hideYearPicker=function(t){this._iMode=0;var a=this.getAggregation("yearPicker");a.$().css("display","none");this._hideOverlay();if(!t){this._renderMonth();if(y.call(this)>1){var i=this.getAggregation("month");for(var s=0;s<i.length;s++){var o=i[s];e(o._oItemNavigation.getItemDomRefs()[o._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}}this._togglePrevNext(this._getFocusedDate(),true)};function D(){if(!this._bNamesLengthChecked){this._showMonthPicker(true);this._hideMonthPicker(true);var e=this.getAggregation("monthPicker");this._bLongMonth=e._bLongMonth;this._bNamesLengthChecked=true;if(!this._bLongMonth){var t=this.getAggregation("month");var a;if(t.length>1){a=g.fromLocalJSDate(t[0].getDate(),this.getPrimaryCalendarType())}else{a=this._getFocusedDate()}this._setHeaderText(a);this._updateHeadersButtons();this._setPrimaryHeaderMonthButtonText();this._toggleTwoMonthsInTwoColumnsCSS()}}else if(y.call(this)>1){this._focusDate(this._getFocusedDate(),true,true)}}_.prototype._focusDate=function(e,t,a){var i;var s=false;var o=false;if(e.isBefore(this._oMinDate)){i=this._oMinDate;s=true}else if(e.isAfter(this._oMaxDate)){i=this._oMaxDate;s=true}else{i=e}if(this._focusDateExtend){o=this._focusDateExtend(e,t,a)}var r=i.isBefore(this._getFocusedDate());this._setFocusedDate(i);if(s||t){this._renderMonth(false,r,a)}if(o){this.fireStartDateChange()}};_.prototype._invalidateMonth=function(e){this._sInvalidateMonth=undefined;var t=this.getAggregation("month");if(t){for(var a=0;a<t.length;a++){var i=t[a];i._bDateRangeChanged=true;i._bInvalidateSync=true;i._bNoFocus=true;i.invalidate(e);i._bInvalidateSync=undefined}}this._bDateRangeChanged=undefined};_.prototype._setHeaderText=function(e){var t=this.getAggregation("header");var a=this.getAggregation("secondMonthHeader");var i=this._getLocaleData();var s=[];var o=[];var r=[];var n;var h=false;var l;var d;var u;var c;var p;var f=this.getPrimaryCalendarType();var _=this._getSecondaryCalendarType();if(this._bLongMonth||!this._bNamesLengthChecked){s=i.getMonthsStandAlone("wide",f)}else{h=true;s=i.getMonthsStandAlone("abbreviated",f);o=i.getMonthsStandAlone("wide",f)}if(_){r=i.getMonthsStandAlone("abbreviated",_);var m=this._getDisplayedSecondaryMonths(f,_);if(m.start==m.end){u=r[m.start]}else{p=i.getIntervalPattern();u=p.replace(/\{0\}/,r[m.start]).replace(/\{1\}/,r[m.end])}}t.setAdditionalTextButton1(u);t._setAdditionalTextButton3(u);a.setAdditionalTextButton1(u);var D=this._getDisplayedMonths(e);this._sFirstMonthName=l=s[D[0]];d=s[D[D.length-1]];if(D.length>1&&!this._bShowOneMonth){if(!p){p=i.getIntervalPattern()}u=p.replace(/\{0\}/,l).replace(/\{1\}/,d);n=o.length?p.replace(/\{0\}/,o[D[0]]).replace(/\{1\}/,o[D[D.length-1]]):u}else{u=l;n=o[D[0]]||u}t.setTextButton1(u);t.setAriaLabelButton1(n);t._setTextButton3(d);t._setAriaLabelButton3(d);a.setTextButton1(d);a.setAriaLabelButton1(d);var v=new g(e,f);v.setDate(1);c=this._oYearFormat.format(v.toUTCJSDate(),true);this._updateHeadersYearPrimaryText(c);if(_){v=new g(v,_);this._updateHeadersYearAdditionalText(this._oYearFormatSecondary.format(v.toUTCJSDate(),true))}else{this._updateHeadersYearAdditionalText()}return{sMonth:u,sYear:c,sAriaLabel:n,bShort:h}};function v(e,t){if(!e){return}var a=g.fromLocalJSDate(e,this.getPrimaryCalendarType());var s=a.getYear();i._checkYearInValidRange(s);if(i._isOutside(a,this._oMinDate,this._oMaxDate)){throw new Error("Date must not be in valid range (minDate and maxDate); "+this)}this._setFocusedDate(a);if(this.getDomRef()&&this._iMode==0){this._renderMonth(t,false,true)}}function y(){if(d.system.phone){return 1}else{return this.getMonths()}}_.prototype._handleButton1=function(e){if(this._iMode!=1){this._showMonthPicker()}else{this._hideMonthPicker()}};_.prototype._handleButton2=function(e){if(this._iMode!=2){this._showYearPicker()}else{this._hideYearPicker()}};function M(e){this.fireEvent("_renderMonth",{days:e.getParameter("days")})}function P(e){if(y.call(this)>1){var t=this.getAggregation("month");for(var a=0;a<t.length;a++){var i=t[a];if(i.getId()!=e.oSource.getId()){i._updateSelection()}}}this._oSelectedMonth=e.oSource;this.fireSelect()}function C(e){if(y.call(this)>1){var t=this.getAggregation("month");for(var a=0;a<t.length;a++){var i=t[a];if(i.getId()!=e.oSource.getId()){i._bindMousemove()}}}}function S(e){if(y.call(this)>1){var t=this.getAggregation("month");for(var a=0;a<t.length;a++){var i=t[a];if(i.getId()!=e.oSource.getId()){i._unbindMousemove()}}}}_.prototype._selectMonth=function(){var e=new g(this._getFocusedDate(),this.getPrimaryCalendarType()),t=this.getAggregation("monthPicker"),a=t.getMonth();e.setMonth(a);if(a!=e.getMonth()){e.setDate(0)}this._focusDate(e,true);this._hideMonthPicker()};_.prototype._getSucessorsPickerPopup=function(){return this.getPickerPopup&&this.getPickerPopup()};_.prototype._selectYear=function(){var e=new g(this._getFocusedDate(),this.getPrimaryCalendarType());var t=this.getAggregation("yearPicker");var a=g.fromLocalJSDate(t.getDate(),this.getPrimaryCalendarType());a.setMonth(e.getMonth());a.setDate(e.getDate());e=a;this._focusDate(e,true);this._hideYearPicker()};_.prototype._showOverlay=function(){this.$("contentOver").css("display","")};_.prototype._hideOverlay=function(){this.$("contentOver").css("display","none")};_.prototype._setColumns=function(e){this._iColumns=e;return this};_.prototype._getColumns=function(){return this._iColumns};_.prototype._updateHeadersButtons=function(){var e=this.getAggregation("header"),t=this.getAggregation("secondMonthHeader");if(this._isTwoMonthsInOneColumn()){t.setVisible(true);e._setVisibleButton3(false);e._setVisibleButton4(false)}else if(this._isTwoMonthsInTwoColumns()){t.setVisible(false);e._setVisibleButton3(true);e._setVisibleButton4(true)}else{t.setVisible(false);e._setVisibleButton3(false);e._setVisibleButton4(false)}};_.prototype._setPrimaryHeaderMonthButtonText=function(){var e=this.getAggregation("header");if(this._isTwoMonthsInOneColumn()||this._isTwoMonthsInTwoColumns()){e.setTextButton1(this._sFirstMonthName)}};_.prototype._toggleTwoMonthsInTwoColumnsCSS=function(){if(this._isTwoMonthsInTwoColumns()){this.addStyleClass("sapUiCalTwoMonthsTwoColumns")}else{this.removeStyleClass("sapUiCalTwoMonthsTwoColumns")}};_.prototype._isTwoMonthsInOneColumn=function(){var e=y.call(this);return this._getColumns()===1&&e===2};_.prototype._isTwoMonthsInTwoColumns=function(){var e=y.call(this);return this._getColumns()===2&&e===2};_.prototype._updateHeadersYearPrimaryText=function(e){var t=this.getAggregation("header"),a=this.getAggregation("secondMonthHeader");t.setTextButton2(e);t.setAriaLabelButton2(e);t._setTextButton4(e);t._setAriaLabelButton4(e);a.setTextButton2(e);a.setAriaLabelButton2(e)};_.prototype._updateHeadersYearAdditionalText=function(e){var t=this.getAggregation("header"),a=this.getAggregation("secondMonthHeader");t.setAdditionalTextButton2(e);t._setAdditionalTextButton4(e);a.setAdditionalTextButton2(e)};_.prototype._handleWeekSelection=function(t){var a=parseInt(t.innerText,10),i=e(t.parentElement).attr("data-sap-day"),o=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyyMMdd"}),r=o.parse(i),n=new Date(r.getFullYear(),r.getMonth(),r.getDate()+6),h=new s({startDate:r,endDate:n}),g=this.getSelectedDates();if(g.length&&g[0].getStartDate().getTime()===h.getStartDate().getTime()&&g[0].getEndDate()&&g[0].getEndDate().getTime()===h.getEndDate().getTime()){h=null}if(this.fireWeekNumberSelect({weekNumber:a,weekDays:h})){this.removeAllSelectedDates();this.addSelectedDate(h);this.focusDate(r)}};function b(e){var t=e.size.width;if(t<=0){return}var a=this._iSize;if(t<this._iBreakPointTablet){this._iSize=0}else if(t<this._iBreakPointDesktop){this._iSize=1}else if(t<this._iBreakPointLargeDesktop){this._iSize=2}else{this._iSize=3}var i=y.call(this);if(a!=this._iSize||this._bInitMonth){switch(this._iSize){case 1:this._setColumns(2);break;case 2:this._setColumns(3);break;case 3:this._setColumns(4);break;default:this._setColumns(1);break}if(i<this._getColumns()){this._setColumns(i)}if(this._getColumns()>2&&i>this._getColumns()){var s=this._getColumns();var o=0;var r=this._getColumns();while(s>=2){var n=i%s;if(n==0){r=s;break}else{var h=n/s;if(h>o){o=h;r=s}}s--}this._setColumns(r)}var g;var l=this.getAggregation("month");if(this._getColumns()>1){g=100/this._getColumns()+"%";this.$("content").removeClass("sapUiCalContentSingle")}else{g="100%";this.$("content").addClass("sapUiCalContentSingle")}for(var d=0;d<l.length;d++){var u=l[d];u.setWidth(g)}}this._updateHeadersButtons();this._setPrimaryHeaderMonthButtonText();this._toggleTwoMonthsInTwoColumnsCSS()}function T(e){var t=new g(e,this.getPrimaryCalendarType());t.setDate(1);var a=y.call(this);if(a<=12){var i=e.getMonth();i=i-i%a;if(12%a>0&&i+a>11){i=12-a}t.setMonth(i)}return t}return _});