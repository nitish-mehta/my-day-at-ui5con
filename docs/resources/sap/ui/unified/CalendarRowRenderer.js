/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarAppointment","sap/ui/unified/CalendarLegendRenderer","sap/ui/Device","sap/ui/unified/library","sap/ui/core/InvisibleText"],function(e,t,a,r,i,s,n){"use strict";var d=s.CalendarDayType;var l=s.CalendarIntervalType;var p=s.CalendarAppointmentVisualization;var o={};o.render=function(e,t){var a=t.getTooltip_AsString();var r=t.getAppointmentsVisualization();var s=this.getLegendItems(t);e.write("<div");e.writeControlData(t);e.addClass("sapUiCalendarRow");if(!i.system.phone&&t.getAppointmentsReducedHeight()){e.addClass("sapUiCalendarRowAppsRedHeight")}if(r!=p.Standard){e.addClass("sapUiCalendarRowVis"+r)}if(a){e.writeAttributeEscaped("title",a)}var n=t.getWidth();if(n){e.addStyle("width",n)}var d=t.getHeight();if(d){e.addStyle("height",d)}e.writeAccessibilityState(t);e.writeClasses();e.writeStyles();e.write(">");this.renderAppointmentsRow(e,t,s);e.write("</div>")};o.renderAppointmentsRow=function(e,t,a){var r=t.getId();e.write('<div id="'+r+'-Apps" class="sapUiCalendarRowApps">');this.renderBeforeAppointments(e,t);this.renderAppointments(e,t,a);this.renderAfterAppointments(e,t);e.write("</div>")};o.renderBeforeAppointments=function(e,t){};o.renderAfterAppointments=function(e,t){};o.renderResizeHandle=function(e,t,a){};o.renderAppointments=function(e,a,r){var i=a._getVisibleAppointments();var s=a._getVisibleIntervalHeaders();var n=a._getStartDate();var d=[];var p=0;var o=0;var w=[];var v=0;var g=0;var C=a.getIntervals();var f=a.getIntervalType();var u=100/C;var A=0;var c=new t(n);var T=false;var I=false;switch(f){case l.Hour:d=a.getNonWorkingHours()||[];p=n.getUTCHours();o=24;break;case l.Day:case l.Week:case l.OneMonth:d=a._getNonWorkingDays();p=n.getUTCDay();o=7;w=a.getNonWorkingHours()||[];v=n.getUTCHours();g=24;break;case l.Month:w=a._getNonWorkingDays();v=n.getUTCDay();g=7;break;default:break}if(a._isOneMonthIntervalOnSmallSizes()){this.renderSingleDayInterval(e,a,i,r,s,d,p,o,w,v,g,true,true)}else{for(A=0;A<C;A++){if(I){T=true}else{T=false}I=false;switch(f){case l.Hour:c.setUTCHours(c.getUTCHours()+1);if(c.getUTCHours()==0){I=true}break;case l.Day:case l.Week:case l.OneMonth:c.setUTCDate(c.getUTCDate()+1);if(c.getUTCDate()==1){I=true}break;case l.Month:c.setUTCMonth(c.getUTCMonth()+1);if(c.getUTCMonth()==0){I=true}break;default:break}this.renderInterval(e,a,A,u,s,d,p,o,w,v,g,T,I)}this.renderIntervalHeaders(e,a,u,s,C);e.write('<div id="'+a.getId()+'-Now" class="sapUiCalendarRowNow"></div>');for(A=0;A<i.length;A++){var h=i[A];this.renderAppointment(e,a,h,r)}e.write('<div id="'+a.getId()+'-DummyApp" class="sapUiCalendarApp sapUiCalendarAppTitleOnly sapUiCalendarAppDummy"></div>')}};o.writeCustomAttributes=function(e,t){};o.renderInterval=function(e,a,r,i,s,n,d,p,o,w,v,g,C){var f=a.getId()+"-AppsInt"+r;var u;var A=a.getShowIntervalHeaders()&&(a.getShowEmptyIntervalHeaders()||s.length>0);var c=a.getStartDate().getMonth();var T=new Date(a.getStartDate().getFullYear(),c+1,0).getDate();e.write('<div id="'+f+'"');e.addClass("sapUiCalendarRowAppsInt");e.addStyle("width",i+"%");if(r>=T&&a.getIntervalType()===l.OneMonth){e.addClass("sapUiCalItemOtherMonth")}for(u=0;u<n.length;u++){if((r+d)%p==n[u]){e.addClass("sapUiCalendarRowAppsNoWork");break}}if(!A){e.addClass("sapUiCalendarRowAppsIntNoHead")}if(g){e.addClass("sapUiCalendarRowAppsIntFirst")}if(C){e.addClass("sapUiCalendarRowAppsIntLast")}e.writeClasses();e.writeStyles();this.writeCustomAttributes(e,a);e.write(">");if(A){e.write("<div");e.addClass("sapUiCalendarRowAppsIntHead");e.writeClasses();e.write(">");e.write("</div>")}if(a.getShowSubIntervals()){var I=a.getIntervalType();var h=0;switch(I){case l.Hour:h=4;break;case l.Day:case l.Week:case l.OneMonth:h=24;break;case l.Month:var b=a._getStartDate();var y=new t(b);y.setUTCMonth(y.getUTCMonth()+r+1,0);h=y.getUTCDate();y.setUTCDate(1);d=y.getUTCDay();break;default:break}var U=100/h;for(u=0;u<h;u++){e.write("<div");e.addClass("sapUiCalendarRowAppsSubInt");e.addStyle("width",U+"%");for(var S=0;S<o.length;S++){if((u+w)%v==o[S]){e.addClass("sapUiCalendarRowAppsNoWork");break}}e.writeStyles();e.writeClasses();e.write(">");e.write("</div>")}}e.write("</div>")};o.renderIntervalHeaders=function(e,t,a,r,i){var s=t.getShowIntervalHeaders()&&(t.getShowEmptyIntervalHeaders()||r.length>0);if(s){for(var n=0;n<r.length;n++){var d=r[n],l,p;if(t._bRTL){p=a*d.interval;l=a*(i-d.last-1)}else{l=a*d.interval;p=a*(i-d.last-1)}this.renderIntervalHeader(e,d,t._bRTL,l,p)}}};o.renderIntervalHeader=function(e,t,a,r,i){var s=t.appointment.getId();e.write("<div");e.addClass("sapUiCalendarRowAppsIntHead");if(r!==undefined){e.addStyle("left",r+"%")}if(i!==undefined){e.addStyle("right",i+"%")}e.writeElementData(t.appointment);e.addClass("sapUiCalendarRowAppsIntHeadFirst");if(t.appointment.getSelected()){e.addClass("sapUiCalendarRowAppsIntHeadSel")}if(t.appointment.getTentative()){e.addClass("sapUiCalendarRowAppsIntHeadTent")}var n=t.appointment.getTooltip_AsString();if(n){e.writeAttributeEscaped("title",n)}var l=t.appointment.getType();var p=t.appointment.getColor();if(!p&&l&&l!=d.None){e.addClass("sapUiCalendarRowAppsIntHead"+l)}if(p){if(a){e.addStyle("border-right-color",p)}else{e.addStyle("border-left-color",p)}}e.writeStyles();e.writeClasses();e.write(">");e.write("<div");e.addClass("sapUiCalendarIntervalHeaderCont");e.writeClasses();if(p){e.addStyle("background-color",t.appointment._getCSSColorForBackground(p));e.writeStyles()}e.write(">");var o=t.appointment.getIcon();if(o){var w=["sapUiCalendarRowAppsIntHeadIcon"];var v={};v["id"]=s+"-Icon";v["title"]=null;e.writeIcon(o,w,v)}var g=t.appointment.getTitle();if(g){e.write("<span");e.writeAttribute("id",s+"-Title");e.addClass("sapUiCalendarRowAppsIntHeadTitle");e.writeClasses();e.write(">");e.writeEscaped(g,true);e.write("</span>")}var C=t.appointment.getText();if(C){e.write("<span");e.writeAttribute("id",s+"-Text");e.addClass("sapUiCalendarRowAppsIntHeadText");e.writeClasses();e.write(">");e.writeEscaped(C,true);e.write("</span>")}e.write("</div>");e.write("</div>")};o.renderAppointment=function(e,t,a,r,i){var s=a.appointment;var l=s.getTooltip_AsString();var o=s.getType();var w=s.getColor();var v=s.getTitle();var g=s.getText();var C=s.getIcon();var f=s.getId();var u={labelledby:{value:n.getStaticId("sap.ui.unified","APPOINTMENT")+" "+f+"-Descr",append:true}};var A=t.getAriaLabelledBy();if(A.length>0){u["labelledby"].value=u["labelledby"].value+" "+A.join(" ")}if(v){u["labelledby"].value=u["labelledby"].value+" "+f+"-Title"}if(g){u["labelledby"].value=u["labelledby"].value+" "+f+"-Text"}e.write("<div");e.writeElementData(s);e.addClass("sapUiCalendarApp");if(s.getSelected()){e.addClass("sapUiCalendarAppSel");u["labelledby"].value=u["labelledby"].value+" "+n.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED")}if(s.getTentative()){e.addClass("sapUiCalendarAppTent");u["labelledby"].value=u["labelledby"].value+" "+n.getStaticId("sap.ui.unified","APPOINTMENT_TENTATIVE")}if(!g){e.addClass("sapUiCalendarAppTitleOnly")}if(C){e.addClass("sapUiCalendarAppWithIcon")}if(!i){if(t._bRTL){e.addStyle("right",a.begin+"%");e.addStyle("left",a.end+"%")}else{e.addStyle("left",a.begin+"%");e.addStyle("right",a.end+"%")}}e.writeAttribute("data-sap-level",a.level);if(t._sFocusedAppointmentId==f){e.writeAttribute("tabindex","0")}else{e.writeAttribute("tabindex","-1")}if(l){e.writeAttributeEscaped("title",l)}if(!w&&o&&o!=d.None){e.addClass("sapUiCalendarApp"+o)}if(w){if(t._bRTL){e.addStyle("border-right-color",w)}else{e.addStyle("border-left-color",w)}}e.writeAccessibilityState(s,u);e.writeClasses();e.writeStyles();e.write(">");e.write("<div");e.addClass("sapUiCalendarAppCont");if(w&&t.getAppointmentsVisualization()===p.Filled){e.addStyle("background-color",s._getCSSColorForBackground(w));e.writeStyles()}e.writeClasses();e.write(">");if(C){var c=["sapUiCalendarAppIcon"];var T={};T["id"]=f+"-Icon";T["title"]=null;e.writeIcon(C,c,T)}if(v){e.write("<span");e.writeAttribute("id",f+"-Title");e.addClass("sapUiCalendarAppTitle");e.writeClasses();e.write(">");e.writeEscaped(v,true);e.write("</span>")}if(g){e.write("<span");e.writeAttribute("id",f+"-Text");e.addClass("sapUiCalendarAppText");e.writeClasses();e.write(">");e.writeEscaped(g,true);e.write("</span>")}var I=t._oRb.getText("CALENDAR_START_TIME")+": "+t._oFormatAria.format(s.getStartDate());I=I+"; "+t._oRb.getText("CALENDAR_END_TIME")+": "+t._oFormatAria.format(s.getEndDate());if(l){I=I+"; "+l}if(o&&o!=d.None){I=I+"; "+this.getAriaTextForType(o,r)}e.write('<span id="'+f+'-Descr" class="sapUiInvisibleText">'+I+"</span>");e.write("</div>");this.renderResizeHandle(e,t,s);e.write("</div>")};o.renderSingleDayInterval=function(e,r,i,s,n,d,p,o,w,v,g,C,f){var u=1,A=100,c=r.getId()+"-AppsInt"+u,T,I=r.getShowIntervalHeaders()&&(r.getShowEmptyIntervalHeaders()||n.length>0),h=r.getStartDate(),b=h.getMonth(),y=new Date(h.getFullYear(),b+1,0).getDate(),U,S=i.concat(r.getIntervalHeaders().filter(function(e){var t=e.getStartDate().getTime(),a=e.getStartDate().getTime(),r=h.getTime(),i=r+1e3*60*60*24;return t>=r&&t<i||a>=r&&a<i}).map(function(e){return{appointment:e,isHeader:true}})).sort(a._getComparer(h)),m;e.write('<div id="'+c+'"');e.addClass("sapUiCalendarRowAppsInt");e.addClass("sapUiCalendarMonthRowAppsS");e.addStyle("width",A+"%");if(u>=y&&r.getIntervalType()===l.OneMonth){e.addClass("sapUiCalItemOtherMonth")}for(T=0;T<d.length;T++){if((u+p)%o==d[T]){e.addClass("sapUiCalendarRowAppsNoWork");break}}if(!I){e.addClass("sapUiCalendarRowAppsIntNoHead")}if(C){e.addClass("sapUiCalendarRowAppsIntFirst")}if(f){e.addClass("sapUiCalendarRowAppsIntLast")}e.writeClasses();e.writeStyles();e.write(">");if(I){e.write("<div");e.addClass("sapUiCalendarRowAppsIntHead");e.writeClasses();e.write(">");e.write("</div>")}for(T=0;T<S.length;T++){m=S[T];e.write('<div class="sapUiCalendarAppContainer">');e.write('<div class="sapUiCalendarAppContainerLeft">');e.write("<div>"+m.appointment._getDateRangeIntersectionText(h)+"</div>");e.write("</div>");e.write('<div class="sapUiCalendarAppContainerRight">');if(m.isHeader){this.renderIntervalHeader(e,m)}else{this.renderAppointment(e,r,m,s,true)}e.write("</div>");e.write("</div>")}if(i.length===0){e.write('<div class="sapUiCalendarNoApps">');U=sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PLANNINGCALENDAR_ROW_NO_APPOINTMENTS");e.write(U);e.write("</div>")}e.write('<div id="'+r.getId()+'-Now" class="sapUiCalendarRowNow"></div>');e.write('<div id="'+r.getId()+'-DummyApp" class="sapUiCalendarApp sapUiCalendarAppTitleOnly sapUiCalendarAppDummy" style=\'margin:0; height:0px;\'></div>');if(r.getShowSubIntervals()){var R=r.getIntervalType();var D=0;switch(R){case l.Hour:D=4;break;case l.Day:case l.Week:case l.OneMonth:D=24;break;case l.Month:var H=new t(h);H.setUTCMonth(H.getUTCMonth()+u+1,0);D=H.getUTCDate();H.setUTCDate(1);p=H.getUTCDay();break;default:break}var k=100/D;for(T=0;T<D;T++){e.write("<div");e.addClass("sapUiCalendarRowAppsSubInt");e.addStyle("width",k+"%");for(var N=0;N<w.length;N++){if((T+v)%g==w[N]){e.addClass("sapUiCalendarRowAppsNoWork");break}}e.writeStyles();e.writeClasses();e.write(">");e.write("</div>")}}e.write("</div>")};o.getLegendItems=function(t){var a=[],r,i=t.getLegend();if(i){r=sap.ui.getCore().byId(i);if(r){a=r.getItems()}else{e.sap.log.error("CalendarLegend with id '"+i+"' does not exist!",t)}}return a};o.getAriaTextForType=function(e,t){var a,i,s,n;if(t&&t.length){for(var n=0;n<t.length;n++){s=t[n];if(s.getType()===e){a=s.getText();break}}}if(!a){i=r.getTypeAriaText(e);if(i){a=i.getText()}}return a};return o},true);