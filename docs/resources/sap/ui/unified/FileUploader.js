/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","./library","sap/ui/core/LabelEnablement","sap/ui/core/library","sap/ui/Device","./FileUploaderRenderer","jquery.sap.keycodes"],function(e,t,i,s,r,o,a){"use strict";var l=r.ValueState;var n=t.extend("sap.ui.unified.FileUploader",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.unified.IProcessableBlobs"],library:"sap.ui.unified",designtime:"sap/ui/unified/designtime/FileUploader.designtime",properties:{value:{type:"string",group:"Data",defaultValue:""},enabled:{type:"boolean",group:"Behavior",defaultValue:true},uploadUrl:{type:"sap.ui.core.URI",group:"Data",defaultValue:""},name:{type:"string",group:"Data",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:""},uploadOnChange:{type:"boolean",group:"Behavior",defaultValue:false},additionalData:{type:"string",group:"Data",defaultValue:null},sameFilenameAllowed:{type:"boolean",group:"Behavior",defaultValue:false},buttonText:{type:"string",group:"Misc",defaultValue:null},fileType:{type:"string[]",group:"Data",defaultValue:null},multiple:{type:"boolean",group:"Behavior",defaultValue:false},maximumFileSize:{type:"float",group:"Data",defaultValue:null},mimeType:{type:"string[]",group:"Data",defaultValue:null},sendXHR:{type:"boolean",group:"Behavior",defaultValue:false},placeholder:{type:"string",group:"Appearance",defaultValue:null},style:{type:"string",group:"Appearance",defaultValue:null},buttonOnly:{type:"boolean",group:"Appearance",defaultValue:false},useMultipart:{type:"boolean",group:"Behavior",defaultValue:true},maximumFilenameLength:{type:"int",group:"Data",defaultValue:null},valueState:{type:"sap.ui.core.ValueState",group:"Data",defaultValue:l.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:""},iconHovered:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:""},iconSelected:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:""},iconFirst:{type:"boolean",group:"Appearance",defaultValue:true},iconOnly:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{parameters:{type:"sap.ui.unified.FileUploaderParameter",multiple:true,singularName:"parameter"},headerParameters:{type:"sap.ui.unified.FileUploaderParameter",multiple:true,singularName:"headerParameter"},xhrSettings:{type:"sap.ui.unified.FileUploaderXHRSettings",multiple:false}},events:{change:{parameters:{newValue:{type:"string"},files:{type:"object[]"}}},uploadComplete:{parameters:{fileName:{type:"string"},response:{type:"string"},readyStateXHR:{type:"string"},status:{type:"string"},responseRaw:{type:"string"},headers:{type:"object"},requestHeaders:{type:"object[]"}}},typeMissmatch:{parameters:{fileName:{type:"string"},fileType:{type:"string"},mimeType:{type:"string"}}},fileSizeExceed:{parameters:{fileName:{type:"string"},fileSize:{type:"string"}}},fileAllowed:{},uploadProgress:{parameters:{lengthComputable:{type:"boolean"},loaded:{type:"float"},total:{type:"float"},fileName:{type:"string"},requestHeaders:{type:"object[]"}}},uploadAborted:{parameters:{fileName:{type:"string"},requestHeaders:{type:"object[]"}}},filenameLengthExceed:{parameters:{fileName:{type:"string"}}},uploadStart:{parameters:{fileName:{type:"string"},requestHeaders:{type:"object[]"}}}}}});n.prototype.init=function(){this.oFilePath=i.FileUploaderHelper.createTextField(this.getId()+"-fu_input");this.oBrowse=i.FileUploaderHelper.createButton();this.oFilePath.setParent(this);this.oBrowse.setParent(this);this.oFileUpload=null;this.bMobileLib=this.oBrowse.getMetadata().getName()=="sap.m.Button";if(!this.getIconOnly()){this.oBrowse.setText(this.getBrowseText())}else{this.oBrowse.setTooltip(this.getBrowseText())}if(sap.ui.getCore().getConfiguration().getAccessibility()){if(!n.prototype._sAccText){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");n.prototype._sAccText=e.getText("FILEUPLOAD_ACC")}if(this.oBrowse.addAriaDescribedBy){this.oBrowse.addAriaDescribedBy(this.getId()+"-AccDescr")}}};n.prototype.setButtonText=function(e){this.setProperty("buttonText",e,false);if(!this.getIconOnly()){this.oBrowse.setText(e||this.getBrowseText())}else{this.oBrowse.setTooltip(e||this.getBrowseText())}return this};n.prototype.setIcon=function(e){this.oBrowse.setIcon(e);this.setProperty("icon",e,false);return this};n.prototype.setIconHovered=function(e){this.setProperty("iconHovered",e,false);if(this.oBrowse.setIconHovered){this.oBrowse.setIconHovered(e)}return this};n.prototype.setIconSelected=function(e){this.setProperty("iconSelected",e,false);if(this.oBrowse.setIconSelected){this.oBrowse.setIconSelected(e)}else{this.oBrowse.setActiveIcon(e)}return this};n.prototype.setIconFirst=function(e){this.oBrowse.setIconFirst(e);this.setProperty("iconFirst",e,false);return this};n.prototype.setIconOnly=function(e){this.setProperty("iconOnly",e,false);if(e){this.oBrowse.setText("");this.oBrowse.setTooltip(this.getButtonText()||this.getBrowseText())}else{this.oBrowse.setText(this.getButtonText()||this.getBrowseText());this.oBrowse.setTooltip("")}return this};n.prototype.getIdForLabel=function(){return this.oBrowse.getId()};n.prototype.setFileType=function(e){var t=this._convertTypesToArray(e);this.setProperty("fileType",t,false);return this};n.prototype.setMimeType=function(e){var t=this._convertTypesToArray(e);this.setProperty("mimeType",t,false);return this};n.prototype.setTooltip=function(e){var t,i;this._refreshTooltipBaseDelegate(e);this.setAggregation("tooltip",e,true);if(this.oFileUpload){if(typeof e==="string"){t=this.getTooltip_AsString();i=this.$().find(".sapUiFupInputMask")[0];if(t){this.oFileUpload.setAttribute("title",t);i&&i.setAttribute("title",t)}else{this.oFileUpload.removeAttribute("title");i&&i.removeAttribute("title")}}}return this};n.prototype.setXhrSettings=function(e){this.setAggregation("xhrSettings",e,true);return this};n.prototype._convertTypesToArray=function(e){if(typeof e==="string"){if(e===""){return[]}else{return e.split(",").map(function(e){return e.trim()})}}return e};n.prototype.exit=function(){this.oFilePath.destroy();this.oBrowse.destroy();if(this.oIFrameRef){e(this.oIFrameRef).unbind();sap.ui.getCore().getStaticAreaRef().removeChild(this.oIFrameRef);this.oIFrameRef=null}};n.prototype.onBeforeRendering=function(){var t=sap.ui.getCore().getStaticAreaRef();e(this.oFileUpload).appendTo(t);e(this.oFileUpload).unbind()};n.prototype.onAfterRendering=function(){this.prepareFileUploadAndIFrame();this._cacheDOMEls();this._addLabelFeaturesToBrowse();e(this.oFileUpload).change(e.proxy(this.handlechange,this));if(!this.bMobileLib){this.oFilePath.$().attr("tabindex","-1")}else{this.oFilePath.$().find("input").attr("tabindex","-1")}if(!!o.browser.internet_explorer&&o.browser.version==9){this.oBrowse.$().attr("tabindex","-1")}if(s.isRequired(this)){this.oBrowse.$().attr("aria-required","true")}e.sap.delayedCall(0,this,this._recalculateWidth);this.oFilePath.$().find("input").removeAttr("role").attr("aria-live","polite");if(this.getValueState()==l.Error){this.oBrowse.$().attr("aria-invalid","true")}};n.prototype._cacheDOMEls=function(){this.FUEl=this.getDomRef("fu");this.FUDataEl=this.getDomRef("fu_data")};n.prototype.onfocusin=function(e){if(!this.oFilePath.shouldValueStateMessageBeOpened||this.oFilePath.shouldValueStateMessageBeOpened()){this.openValueStateMessage()}};n.prototype.onsapfocusleave=function(t){if(!t.relatedControlId||!e.sap.containsOrEquals(this.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){this.closeValueStateMessage()}};n.prototype._recalculateWidth=function(){if(this.getWidth()){if(this.getButtonOnly()&&this.oBrowse.getDomRef()){this.oBrowse.getDomRef().style.width=this.getWidth()}this._resizeDomElements()}};n.prototype.getFocusDomRef=function(){return this.$("fu").get(0)};n.prototype._resizeDomElements=function(){var t=this.getId();this._oBrowseDomRef=this.oBrowse.getDomRef();var i=e(this._oBrowseDomRef);var s=i.parent().outerWidth(true);this._oFilePathDomRef=this.oFilePath.getDomRef();var r=this._oFilePathDomRef;var a=this.getWidth();if(a.substr(-1)=="%"&&r){while(r.id!=t){r.style.width="100%";r=r.parentNode}r.style.width=a}else{if(r){r.style.width=a;var l=e(this._oFilePathDomRef);var n=l.outerWidth()-s;if(n<0){this.oFilePath.getDomRef().style.width="0px";if(!o.browser.internet_explorer){this.oFileUpload.style.width=i.outerWidth(true)}}else{this.oFilePath.getDomRef().style.width=n+"px"}}}};n.prototype.onresize=function(){this._recalculateWidth()};n.prototype.onThemeChanged=function(){this._recalculateWidth()};n.prototype.setEnabled=function(t){var i=e(this.oFileUpload);this.setProperty("enabled",t,true);this.oFilePath.setEnabled(t);this.oBrowse.setEnabled(t);t?i.removeAttr("disabled"):i.attr("disabled","disabled");this.$().toggleClass("sapUiFupDisabled",!t);return this};n.prototype.setValueState=function(t){this.setProperty("valueState",t,true);if(this.oFilePath.setValueState){this.oFilePath.setValueState(t)}else{e.sap.log.warning("Setting the valueState property with the combination of libraries used is not supported.",this)}if(this.oBrowse.getDomRef()){if(t==l.Error){this.oBrowse.$().attr("aria-invalid","true")}else{this.oBrowse.$().removeAttr("aria-invalid")}}if(e.sap.containsOrEquals(this.getDomRef(),document.activeElement)){switch(t){case l.Error:case l.Warning:case l.Success:this.openValueStateMessage();break;default:this.closeValueStateMessage()}}return this};n.prototype.setValueStateText=function(t){if(this.oFilePath.setValueStateText){this.oFilePath.setValueStateText(t)}else{e.sap.log.warning("Setting the valueStateText property with the combination of libraries used is not supported.",this)}return this.setProperty("valueStateText",t,true)};n.prototype.setUploadUrl=function(e,t){this.setProperty("uploadUrl",e,true);var i=this.$("fu_form");i.attr("action",this.getUploadUrl());return this};n.prototype.setPlaceholder=function(e){this.setProperty("placeholder",e,true);this.oFilePath.setPlaceholder(e);return this};n.prototype.setStyle=function(e){this.setProperty("style",e,true);if(e){if(e=="Transparent"){if(this.oBrowse.setLite){this.oBrowse.setLite(true)}else{this.oBrowse.setType("Transparent")}}else{if(this.oBrowse.setType){this.oBrowse.setType(e)}else{if(e=="Emphasized"){e="Emph"}this.oBrowse.setStyle(e)}}}return this};n.prototype.setValue=function(t,i,s){var r=this.getValue();var o;if(r!=t||this.getSameFilenameAllowed()){var a=this.getUploadOnChange()&&t;this.setProperty("value",t,a);if(this.oFilePath){this.oFilePath.setValue(t);if(this.oBrowse.getDomRef()&&!s&&e.sap.containsOrEquals(this.getDomRef(),document.activeElement)){this.oBrowse.focus()}}var l=this.getDomRef("fu_form"),n=this.getDomRef("fu_input-inner");if(this.oFileUpload&&l&&!t){l.reset();this.getDomRef("fu_input").value="";if(n){n.value=""}e(this.FUDataEl).val(this.getAdditionalData())}if(i){if(window.File){o=this.FUEl.files}if(!this.getSameFilenameAllowed()||t){this.fireChange({id:this.getId(),newValue:t,files:o})}}if(a){this.upload()}}return this};n.prototype.clear=function(){var e=this.getDomRef("fu_form");if(e){e.reset()}return this.setValue("",false,true)};n.prototype.onmousedown=function(e){if(!this.bMobileLib){this.oBrowse.onmousedown(e)}};n.prototype.onmouseup=function(e){if(!this.bMobileLib){this.oBrowse.onmouseup(e)}};n.prototype.onmouseover=function(t){if(!this.bMobileLib){e(this.oBrowse.getDomRef()).addClass("sapUiBtnStdHover");this.oBrowse.onmouseover(t)}};n.prototype.onmouseout=function(t){if(!this.bMobileLib){e(this.oBrowse.getDomRef()).removeClass("sapUiBtnStdHover");this.oBrowse.onmouseout(t)}};n.prototype.setAdditionalData=function(e){this.setProperty("additionalData",e,true);var t=this.FUDataEl;if(t){e=this.getAdditionalData()||"";t.value=e}return this};n.prototype.sendFiles=function(e,t){var i=this;var s=true;for(var r=0;r<e.length;r++){if(!e[r].bPosted){s=false;break}}if(s){if(this.getSameFilenameAllowed()&&this.getUploadOnChange()){i.setValue("",true)}return}var a=e[t];var l=a.file.name?a.file.name:"MultipartFile";if((o.browser.edge||o.browser.internet_explorer)&&a.file.type&&a.xhr.readyState==1){var n=a.file.type;a.xhr.setRequestHeader("Content-Type",n);a.requestHeaders.push({name:"Content-Type",value:n})}var p=a.requestHeaders;var h=function(e){var t={lengthComputable:!!e.lengthComputable,loaded:e.loaded,total:e.total};i.fireUploadProgress({lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total,fileName:l,requestHeaders:p})};a.xhr.upload.addEventListener("progress",h);a.xhr.onreadystatechange=function(){var e;var t;var s={};var r;var o;var n;var h;h=a.xhr.readyState;var u=a.xhr.status;if(a.xhr.readyState==4){if(a.xhr.responseXML){e=a.xhr.responseXML.documentElement.textContent}t=a.xhr.response;r=a.xhr.getAllResponseHeaders();if(r){o=r.split("\r\n");for(var f=0;f<o.length;f++){if(o[f]){n=o[f].indexOf(": ");s[o[f].substring(0,n)]=o[f].substring(n+2)}}}i.fireUploadComplete({fileName:l,headers:s,response:e,responseRaw:t,readyStateXHR:h,status:u,requestHeaders:p})}i._bUploading=false};if(a.xhr.readyState===0||a.bPosted){t++;i.sendFiles(e,t)}else{a.xhr.send(a.file);a.bPosted=true;t++;i.sendFiles(e,t)}};n.prototype.upload=function(t){if(!this.getEnabled()){return}var i=this.getDomRef("fu_form");try{this._bUploading=true;if(this.getSendXHR()&&window.File){var s=this.FUEl.files;if(t){this._sendProcessedFilesWithXHR(s)}else{this._sendFilesWithXHR(s)}}else if(i){i.submit();this._resetValueAfterUploadStart()}}catch(t){e.sap.log.error("File upload failed:\n"+t.message)}};n.prototype.abort=function(t,i){if(!this.getUseMultipart()){var s=this._aXhr.length-1;for(var r=s;r>-1;r--){if(t&&i){for(var o=0;o<this._aXhr[r].requestHeaders.length;o++){var a=this._aXhr[r].requestHeaders[o].name;var l=this._aXhr[r].requestHeaders[o].value;if(a==t&&l==i){this._aXhr[r].xhr.abort();this.fireUploadAborted({fileName:this._aXhr[r].fileName,requestHeaders:this._aXhr[r].requestHeaders});this._aXhr.splice(r,1);e.sap.log.info("File upload aborted.");break}}}else{this._aXhr[r].xhr.abort();this.fireUploadAborted({fileName:this._aXhr[r].fileName,requestHeaders:this._aXhr[r].requestHeaders});this._aXhr.splice(r,1);e.sap.log.info("File upload aborted.")}}}else if(this._uploadXHR&&this._uploadXHR.abort){this._uploadXHR.abort();this.fireUploadAborted({fileName:null,requestHeaders:null});e.sap.log.info("File upload aborted.")}};n.prototype.onkeypress=function(e){this.onkeydown(e)};n.prototype.onclick=function(t){if(this.getSameFilenameAllowed()&&this.getEnabled()){this.setValue("",true)}if(this.oBrowse.getDomRef()&&e.sap.containsOrEquals(this.getDomRef(),document.activeElement)){this.oBrowse.focus()}};n.prototype.onkeydown=function(t){if(!this.getEnabled()){return}if(this.getSameFilenameAllowed()&&this.getUploadOnChange()){this.setValue("",true)}var i=t.keyCode,s=e.sap.KeyCodes;if(i==s.DELETE||i==s.BACKSPACE){if(this.oFileUpload){this.setValue("",true)}}else if(i==s.SPACE||i==s.ENTER){if(!(!!o.browser.internet_explorer&&o.browser.version<=9)&&this.oFileUpload){this.oFileUpload.click();t.preventDefault();t.stopPropagation()}}else if(i!=s.TAB&&i!=s.SHIFT&&i!=s.F6&&i!=s.PAGE_UP&&i!=s.PAGE_DOWN&&i!=s.END&&i!=s.ESCAPE&&i!=s.HOME&&i!=s.ARROW_LEFT&&i!=s.ARROW_UP&&i!=s.ARROW_RIGHT&&i!=s.ARROW_DOWN){t.preventDefault();t.stopPropagation()}};n.prototype._isFilenameTooLong=function(t){var i=this.getMaximumFilenameLength();if(i!==0&&t.length>i){e.sap.log.info("The filename of "+t+" ("+t.length+" characters)  is longer than the maximum of "+i+" characters.");return true}return false};n.prototype.handlechange=function(t){if(this.oFileUpload&&this.getEnabled()){var i=this.getFileType();var s="";var r,a,l,n;var p=this.getDomRef("fu_form");if(window.File){var h=t.target.files;if(this._areFilesAllowed(h)){this.fireFileAllowed();s=this._generateInputValue(h)}else{p.reset();this.setValue("",true,true);return}}else if(i&&i.length>0){r=true;a=this.oFileUpload.value||"";l=a.lastIndexOf(".");n=a.substring(l+1);for(var u=0;u<i.length;u++){if(n==i[u]){r=false}}if(r){e.sap.log.info("File: "+a+" is of type "+n+". Allowed types are: "+i+".");this.fireTypeMissmatch({fileName:a,fileType:n});p.reset();this.setValue("",true,true);return}if(this._isFilenameTooLong(a)){this.fireFilenameLengthExceed({fileName:a});p.reset();this.setValue("",true,true);return}if(a){this.fireFileAllowed()}}var f=this.oFileUpload.value||"";var d=f.lastIndexOf("\\");if(d>=0){f=f.substring(d+1)}if(this.getMultiple()){if(!(o.browser.internet_explorer&&o.browser.version<=9)){f=s}}if(f||o.browser.chrome){this.setValue(f,true)}}};n.prototype._sendFilesWithXHR=function(e){var t,i,s,r,o=this.getXhrSettings();if(e.length>0){if(this.getUseMultipart()){t=1}else{t=e.length}this._aXhr=this._aXhr||[];for(var a=0;a<t;a++){this._uploadXHR=new window.XMLHttpRequest;r={xhr:this._uploadXHR,requestHeaders:[]};this._aXhr.push(r);r.xhr.open("POST",this.getUploadUrl(),true);if(o){r.xhr.withCredentials=o.getWithCredentials()}if(this.getHeaderParameters()){var l=this.getHeaderParameters();for(var n=0;n<l.length;n++){i=l[n].getName();s=l[n].getValue();r.requestHeaders.push({name:i,value:s})}}var p=e[a].name;var h=r.requestHeaders;r.fileName=p;r.file=e[a];this.fireUploadStart({fileName:p,requestHeaders:h});for(var u=0;u<h.length;u++){if(r.xhr.readyState===0){break}i=h[u].name;s=h[u].value;r.xhr.setRequestHeader(i,s)}}if(this.getUseMultipart()){var f=new window.FormData;var d=this.FUEl.name;for(var g=0;g<e.length;g++){this._appendFileToFormData(f,d,e[g])}f.append("_charset_","UTF-8");var c=this.FUDataEl.name;if(this.getAdditionalData()){var m=this.getAdditionalData();f.append(c,m)}else{f.append(c,"")}if(this.getParameters()){var y=this.getParameters();for(var F=0;F<y.length;F++){var v=y[F].getName();s=y[F].getValue();f.append(v,s)}}r.file=f;this.sendFiles(this._aXhr,0)}else{this.sendFiles(this._aXhr,0)}this._bUploading=false;this._resetValueAfterUploadStart()}return this};n.prototype._appendFileToFormData=function(e,t,i){if(i instanceof window.Blob&&i.name){e.append(t,i,i.name)}else{e.append(t,i)}};n.prototype._sendProcessedFilesWithXHR=function(t){this.getProcessedBlobsFromArray(t).then(function(e){this._sendFilesWithXHR(e)}.bind(this)).catch(function(t){e.sap.log.error("File upload failed: "+t&&t.message?t.message:"no details available")});return this};n.prototype._areFilesAllowed=function(t){var i,s,r,o,a,l=this.getMaximumFileSize(),n=this.getMimeType(),p=this.getFileType();for(var h=0;h<t.length;h++){i=t[h].name;a=t[h].type;if(!a){a="unknown"}var u=t[h].size/1024/1024;if(l&&u>l){e.sap.log.info("File: "+i+" is of size "+u+" MB which exceeds the file size limit of "+l+" MB.");this.fireFileSizeExceed({fileName:i,fileSize:u});return false}if(this._isFilenameTooLong(i)){this.fireFilenameLengthExceed({fileName:i});return false}if(n&&n.length>0){var f=true;for(var d=0;d<n.length;d++){if(a==n[d]||n[d]=="*/*"||a.match(n[d])){f=false}}if(f){e.sap.log.info("File: "+i+" is of type "+a+". Allowed types are: "+n+".");this.fireTypeMissmatch({fileName:i,mimeType:a});return false}}if(p&&p.length>0){s=true;r=i.lastIndexOf(".");o=i.substring(r+1);for(var g=0;g<p.length;g++){if(o.toLowerCase()==p[g].toLowerCase()){s=false}}if(s){e.sap.log.info("File: "+i+" is of type "+o+". Allowed types are: "+p+".");this.fireTypeMissmatch({fileName:i,fileType:o});return false}}}return true};n.prototype._sendFilesFromDragAndDrop=function(e){if(this._areFilesAllowed(e)){this._sendFilesWithXHR(e)}return this};n.prototype._generateInputValue=function(e){var t="";for(var i=0;i<e.length;i++){t=t+'"'+e[i].name+'" '}return t};n.prototype.getBrowseText=function(){if(!n.prototype._sBrowseText){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");n.prototype._sBrowseText=e.getText("FILEUPLOAD_BROWSE")}return n.prototype._sBrowseText?n.prototype._sBrowseText:"Browse..."};n.prototype.getShortenValue=function(){return this.getValue()};n.prototype.prepareFileUploadAndIFrame=function(){if(!this.oFileUpload){var t=[];t.push("<input ");t.push('type="file" ');t.push('aria-hidden="true" ');if(this.getName()){if(this.getMultiple()){if(!(o.browser.internet_explorer&&o.browser.version<=9)){t.push('name="'+this.getName()+'[]" ')}}else{t.push('name="'+this.getName()+'" ')}}else{if(this.getMultiple()){if(!(o.browser.internet_explorer&&o.browser.version<=9)){t.push('name="'+this.getId()+'[]" ')}}else{t.push('name="'+this.getId()+'" ')}}t.push('id="'+this.getId()+'-fu" ');if(!(!!o.browser.internet_explorer&&o.browser.version==9)){t.push('tabindex="-1" ')}t.push('size="1" ');if(this.getTooltip_AsString()){t.push('title="'+e.sap.encodeHTML(this.getTooltip_AsString())+'" ')}else if(this.getValue()!==""){t.push('title="'+e.sap.encodeHTML(this.getValue())+'" ')}if(!this.getEnabled()){t.push('disabled="disabled" ')}if(this.getMultiple()){if(!(o.browser.internet_explorer&&o.browser.version<=9)){t.push("multiple ")}}if(this.getMimeType()&&window.File){var i=this.getMimeType();var s=i.join(",");t.push('accept="'+s+'" ')}t.push(">");this.oFileUpload=e(t.join("")).prependTo(this.$().find(".sapUiFupInputMask")).get(0)}else{e(this.oFileUpload).prependTo(this.$().find(".sapUiFupInputMask"))}if(!this.oIFrameRef){var r=document.createElement("iframe");r.style.display="none";r.id=this.sId+"-frame";sap.ui.getCore().getStaticAreaRef().appendChild(r);r.contentWindow.name=this.sId+"-frame";var a=this;this._bUploading=false;e(r).load(function(t){if(a._bUploading){e.sap.log.info("File uploaded to "+a.getUploadUrl());var i;try{i=a.oIFrameRef.contentWindow.document.body.innerHTML}catch(e){}a.fireUploadComplete({response:i});a._bUploading=false}});this.oIFrameRef=r}};n.prototype.openValueStateMessage=function(){if(this.oFilePath.openValueStateMessage){this.oFilePath.openValueStateMessage();this.oBrowse.$().addAriaDescribedBy(this.oFilePath.getId()+"-message")}};n.prototype.closeValueStateMessage=function(){if(this.oFilePath.closeValueStateMessage){this.oFilePath.closeValueStateMessage();this.oBrowse.$().removeAriaDescribedBy(this.oFilePath.getId()+"-message")}};n.prototype._resetValueAfterUploadStart=function(){e.sap.log.info("File uploading to "+this.getUploadUrl());if(this.getSameFilenameAllowed()&&this.getUploadOnChange()&&this.getUseMultipart()){this.setValue("",true)}};n.prototype._addLabelFeaturesToBrowse=function(){var e;if(this.oBrowse&&this.oBrowse.$().length){e=this.oBrowse.$();e.attr("type', 'button");e.click(function(e){e.preventDefault();this.FUEl.click()}.bind(this))}};n.prototype.getProcessedBlobsFromArray=function(e){return new Promise(function(t){t(e)})};return n});