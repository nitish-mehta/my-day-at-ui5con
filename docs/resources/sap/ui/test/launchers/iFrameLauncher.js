/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/thirdparty/URI","sap/ui/Device","sap/ui/test/_LogCollector"],function(t,e,n,r){"use strict";var i=null,a=null,o=null,s=null,u=null,c=false,l=false,h=null,f=null,p;function d(){i=a[0].contentWindow;g();y()}function g(){var t=i.onerror;i.onerror=function(e,n,r,i,a){var o=false;if(t){o=t.apply(this,arguments)}setTimeout(function(){var t=i?"\ncolumn: "+i:"";var o=a&&"\niFrame error: "+(a.stack?a.message+"\n"+a.stack:a)||"";throw new Error("Error in launched application iFrame: "+e+"\nurl: "+n+"\nline: "+r+t+o)},0);return o}}function y(){if(l){return true}if(i&&i.sap&&i.sap.ui&&i.sap.ui.getCore){if(!c){i.sap.ui.getCore().attachInit(m)}c=true}return l}function w(t){i.sap.ui.require(["sap/ui/thirdparty/sinon"],function(e){if(!e){setTimeout(function(){w(t)},50)}else{t()}})}function m(){H();if(n.browser.firefox){w(L)}else{L()}}function v(){u.sap.log.addLogListener(r.getInstance()._oListener);l=true}function H(){u=i.jQuery;F("sap.ui.test");F("sap.ui.qunit");F("sap.ui.thirdparty")}function b(e,n,r){var a=new r,o=new n(a),s=e.setHash,u=e.getHash,c,l=false,h=i.history.go;e.replaceHash=function(t){l=true;var e=this.getHash();c=t;a.fireEvent("hashReplaced",{sHash:t});this.changed.dispatch(t,e)};e.setHash=function(t){l=true;var e=u.call(this);c=t;a.fireEvent("hashSet",{sHash:t});s.apply(this,arguments);if(e===this.getHash()){this.changed.dispatch(e,o.aHistory[o.iHistoryPosition])}};e.getHash=function(){if(c===undefined){return u.apply(this,arguments)}return c};e.changed.add(function(t){if(!l){a.fireEvent("hashSet",{sHash:t});c=t}l=false});a.init();function f(){l=true;var t=o.aHistory[o.iHistoryPosition],n=o.getPreviousHash();c=n;e.changed.dispatch(n,t)}function p(){l=true;var n=o.aHistory[o.iHistoryPosition+1],r=o.aHistory[o.iHistoryPosition];if(n===undefined){t.sap.log.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return}c=n;e.changed.dispatch(n,r)}i.history.back=f;i.history.forward=p;i.history.go=function(e){if(e===-1){f();return}else if(e===1){p();return}t.sap.log.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return h.apply(i.history,arguments)}}function L(){i.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_OpaLogger","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(t,e,n,r,i,a,u){n.setLevel(p);o=new t;h=e;s=r;b(i,a,u);f=u;v()})}function F(n){var r=t.sap.getModulePath(n);var i=new e(r).absoluteTo(document.baseURI).search("").toString();u.sap.registerModulePath(n,i)}function I(){if(!i){throw new Error("sap.ui.test.launchers.iFrameLauncher: Teardown was called before launch. No iFrame was loaded.")}i.onerror=t.noop;for(var e=0;e<a.length;e++){a[0].src="about:blank";a[0].contentWindow.document.write("");a[0].contentWindow.close()}if(typeof CollectGarbage=="function"){CollectGarbage()}a.remove();u=null;o=null;s=null;i=null;l=false;c=false;h=null;f=null}return{launch:function(e){if(i){throw new Error("sap.ui.test.launchers.iFrameLauncher: Launch was called twice without teardown. Only one iFrame may be loaded at a time.")}a=t("#"+e.frameId);if(!a.length){if(!e.source){t.sap.log.error("No source was given to launch the IFrame",this)}a=t('<IFrame id="'+e.frameId+'" class="opaFrame" src="'+e.source+'"></IFrame>');t("body").append(a)}if(a[0].contentDocument&&a[0].contentDocument.readyState==="complete"){d()}else{a.on("load",d)}p=e.opaLogLevel;return y()},hasLaunched:function(){y();return l},teardown:function(){I()},getHashChanger:function(){if(!f){return null}return f.getInstance()},getPlugin:function(){return o},getJQuery:function(){return u},getUtils:function(){return s},getWindow:function(){return i},_getAutoWaiter:function(){return h}}},true);