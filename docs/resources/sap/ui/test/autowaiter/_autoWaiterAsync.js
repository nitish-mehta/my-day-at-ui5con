/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/autowaiter/_autoWaiterLogCollector"],function(e,t,i,n,o){"use strict";var a=t.getLogger("sap.ui.test.autowaiter._autoWaiterAsync");var r=new i({errorPrefix:"sap.ui.test.autowaiter._autoWaiterAsync#extendConfig"});var s;var u;var l={interval:400,timeout:15e3};function g(t){f(t);e.extend(l,t);n.extendConfig(l)}function c(e){if(s){r({error:"waitAsync is already running and cannot be called again at this moment"});return}var t=Date.now();s=true;a.debug("Start polling to check for pending asynchronous work");o.start();i();function i(){var e=Date.now()-t;if(e<=l.timeout){setTimeout(function(){if(n.hasToWait()){u=o.getAndClearLog();i()}else{r({log:"Polling finished successfully. There is no more pending asynchronous work for the moment"});s=false}},l.interval)}else{r({error:"Polling stopped because the timeout of "+l.timeout+" milliseconds has been reached but there is still pending asynchronous work.\n"+"This is the last log of pending work:\n"+u});s=false}}function r(t){if(e){e(t.error)}a.debug(t.error||t.log);o.stop()}}function f(e){r.validate({inputToValidate:e,validationInfo:{interval:"numeric",timeout:"numeric"}});if(e.timeout<=0||e.interval<=0){throw new Error("Invalid polling config: Timeout and interval should be greater than 0")}}return{extendConfig:g,waitAsync:c}},true);