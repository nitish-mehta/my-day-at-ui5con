/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_utils"],function(e,r,t,a){"use strict";var i=r.getLogger("sap.ui.test.autowaiter._promiseWaiter");var n=r.getLogger("sap.ui.test.autowaiter._promiseWaiter#hasPending");var o=new t({errorPrefix:"sap.ui.test.autowaiter._promiseCounter#extendConfig"});var s=1e3;var u={maxDelay:s};var c=[];function g(e){var r=Promise[e];Promise[e]=function(){var t=false;var n={func:e,args:a.argumentsToString(arguments),stack:a.resolveStackTrace()};var o=l(n);var s=setTimeout(function(){t=true;c.splice(c.indexOf(n),1);i.trace("Long-running promise is ignored:"+o)},u.maxDelay);var g=function(){if(t){return}c.splice(c.indexOf(n),1);i.trace("Promise complete:"+o);clearTimeout(s)};var p=r.apply(this,arguments);c.push(n);i.trace("New pending promise:"+o);p.then(g,g);return p}}g("resolve");g("all");g("race");g("reject");function l(e){return"\nPromise: Function: "+e.func+" Args: "+e.args+" Stack: "+e.stack}function p(){var e="There are "+c.length+" pending promises\n";c.forEach(function(r){e+=l(r)});n.debug(e)}return{hasPending:function(){var e=c.length>0;if(e){p()}return e},extendConfig:function(r){var t=r&&r.timeoutWaiter&&r.timeoutWaiter.maxDelay;r={maxDelay:t||s};o.validate({inputToValidate:r,validationInfo:{maxDelay:"numeric"}});e.extend(u,r)}}},true);