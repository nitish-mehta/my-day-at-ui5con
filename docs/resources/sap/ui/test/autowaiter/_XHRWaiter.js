/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/sinon","sap/ui/test/_OpaLogger","sap/ui/test/autowaiter/_utils"],function(t,e,r){"use strict";var a=e.getLogger("sap.ui.test.autowaiter._XHRWaiter");var n=e.getLogger("sap.ui.test.autowaiter._XHRWaiter#hasPending");var u=[];var i=t.useFakeXMLHttpRequest;t.useFakeXMLHttpRequest=function(){var t=i.apply(this,arguments);s();return t};function s(){var t=XMLHttpRequest.restore;if(t){XMLHttpRequest.restore=function(){var e=t.apply(this,arguments);u=l();return e}}}s();var o=t.FakeXMLHttpRequest.prototype.send;t.FakeXMLHttpRequest.prototype.send=function(){h.call(this,true);return o.apply(this,arguments)};var p=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){h.call(this);return p.apply(this,arguments)};function h(t){var e=t?"FakeXHR":"XHR";var n={url:this.url,method:this.method,fake:t,trace:r.resolveStackTrace()};var i=f(n);u.push(n);a.trace("New pending "+e+":"+i);this.addEventListener("readystatechange",function(){if(this.readyState===4){u.splice(u.indexOf(n),1);a.trace(e+" finished:"+i)}})}var c=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,e){this.method=t;this.url=e;return c.apply(this,arguments)};function f(t){var e=t.fake?"\nFakeXHR: ":"\nXHR: ";e+="URL: '"+t.url+"' Method: '"+t.method+"'\nStack: "+t.trace;return e}function d(){var t=l(true).length;var e="There are "+(u.length-t)+" open XHRs and "+t+" open FakeXHRs.";u.forEach(function(t){e+=f(t)});n.debug(e)}function l(t){return u.filter(function(e){return t?e.fake:!e.fake})}return{hasPending:function(){var t=u.length>0;if(t){d()}return t}}},true);