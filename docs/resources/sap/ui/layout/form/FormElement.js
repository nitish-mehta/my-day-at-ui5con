/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Element","sap/ui/base/ManagedObjectObserver","sap/ui/layout/library"],function(e,i,t,s){"use strict";var a=i.extend("sap.ui.layout.form.FormElement",{metadata:{library:"sap.ui.layout",properties:{visible:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"fields",aggregations:{label:{type:"sap.ui.core.Label",altTypes:["string"],multiple:false},_label:{type:"sap.ui.core.Label",multiple:false,visibility:"hidden"},fields:{type:"sap.ui.core.Control",multiple:true,singularName:"field"}},designtime:"sap/ui/layout/designtime/form/FormElement.designtime"}});a.prototype.init=function(){this._oFieldDelegate={oElement:this,onAfterRendering:f};this._oObserver=new t(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["fields"]})};a.prototype.exit=function(){if(this._oLabel){delete this._oLabel}this._oFieldDelegate=undefined;this._oObserver.disconnect();this._oObserver=undefined};a.prototype.setLabel=function(e){if(!this._oLabel){var i=this.getLabel();if(i){if(i.setAlternativeLabelFor){i.setAlternativeLabelFor(null)}if(i.isRequired){i.isRequired=i._sapuiIsRequired;i._sapuiIsRequired=undefined;i.disableRequiredChangeCheck(false)}if(i.isDisplayOnly){i.isDisplayOnly=i._sapuiIsDisplayOnly;i._sapuiIsDisplayOnly=undefined}if(i.isWrapping){i.isWrapping=i._sapuiIsWrapping;i._sapuiIsWrapping=undefined}}}this.setAggregation("label",e);var t=e;if(typeof t==="string"){if(!this._oLabel){this._oLabel=s.form.FormHelper.createLabel(t);this.setAggregation("_label",this._oLabel,true);this._oLabel.disableRequiredChangeCheck(true);if(this._oLabel.isRequired){this._oLabel.isRequired=o}if(this._oLabel.isDisplayOnly){this._oLabel.isDisplayOnly=u}if(this._oLabel.setWrapping){this._oLabel.setWrapping(true)}}else{this._oLabel.setText(t)}}else{if(this._oLabel){this._oLabel.destroy();delete this._oLabel}if(t&&t.isRequired){t._sapuiIsRequired=t.isRequired;t.isRequired=o;t.disableRequiredChangeCheck(true)}if(t&&t.isDisplayOnly){t._sapuiIsDisplayOnly=t.isDisplayOnly;t.isDisplayOnly=u}if(t&&t.isWrapping){t._sapuiIsWrapping=t.isWrapping;t.isWrapping=h}}p.call(this);return this};a.prototype.destroyLabel=function(){this.destroyAggregation("label");if(this._oLabel){this._oLabel.destroy();delete this._oLabel}return this};a.prototype.getLabelControl=function(){if(this._oLabel){return this._oLabel}else{return this.getLabel()}};a.prototype.updateFields=function(){var e=this.getFields();var i;var t=0;for(t=0;t<e.length;t++){i=e[t];d.call(this,i)}this.updateAggregation("fields");e=this.getFields();for(t=0;t<e.length;t++){i=e[t];g.call(this,i)}p.call(this);return this};a.prototype.enhanceAccessibilityState=function(i,t){var s=this.getLabelControl();if(s&&s!=i){var a=t["labelledby"];if(!a){a=s.getId()}else{var r=a.split(" ");if(e.inArray(s.getId(),r)<0){r.splice(0,0,s.getId());a=r.join(" ")}}t["labelledby"]=a}return t};a.prototype.onLayoutDataChange=function(e){var i=this.getParent();if(i&&i.onLayoutDataChange){i.onLayoutDataChange(e)}};a.prototype.getRenderedDomRef=function(){var e=this;var i=this.getParent();if(i&&i.getElementRenderedDomRef){return i.getElementRenderedDomRef(e)}else{return null}};a.prototype.invalidateLabel=function(){var e=this.getLabelControl();if(e){e.invalidate()}};a.prototype.isVisible=function(){return this.getVisible()};a.prototype._observeChanges=function(e){if(e.object==this){if(e.name=="fields"){r.call(this,e)}}else{n.call(this,e)}};function r(e){if(e.child){l.call(this,e.child,e.mutation)}else if(e.children){for(var i=0;i<e.chlidren.length;i++){l.call(this,e.children[i],e.mutation)}}p.call(this)}function l(i,t){if(t=="insert"){if(!i.isA("sap.ui.core.IFormContent")){e.sap.log.warning(i+" is not valid Form content",this)}g.call(this,i)}else{d.call(this,i)}}function n(e){if(e.name=="required"){this.invalidateLabel()}}function o(){if(this.getRequired&&this.getRequired()){return true}var e=this.getParent();var i=e.getFields();for(var t=0;t<i.length;t++){var s=i[t];if(s.getRequired&&s.getRequired()===true&&(!s.getEditable||s.getEditable())){return true}}return false}function u(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly()}var e=this.getParent();var i=e.getParent();if(i){var t=i.getParent();if(t){return!t.getEditable()}}}return false}function h(){if(this.getWrapping&&!this.isPropertyInitial("wrapping")){return this.getWrapping()}return true}function p(){var e=this.getFields();var i=e.length>0?e[0]:null;var t=this._oLabel;if(t){t.setLabelFor(i)}else{t=this.getLabel();if(t instanceof sap.ui.core.Control){t.setAlternativeLabelFor(i)}}}function g(e){e.addDelegate(this._oFieldDelegate);if(!this._bNoObserverChange&&e.getMetadata().getProperty("required")){this._oObserver.observe(e,{properties:["required"]})}}function d(e){e.removeDelegate(this._oFieldDelegate);if(!this._bNoObserverChange){this._oObserver.unobserve(e)}}function f(e){var i=this.oElement.getParent();if(i&&i.contentOnAfterRendering){i.contentOnAfterRendering(this.oElement,e.srcControl)}}return a});