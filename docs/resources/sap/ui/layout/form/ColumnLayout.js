/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/layout/library","./FormLayout","sap/ui/Device","sap/ui/core/ResizeHandler","./ColumnLayoutRenderer"],function(e,t,a,i,s,l){"use strict";var r=a.extend("sap.ui.layout.form.ColumnLayout",{metadata:{library:"sap.ui.layout",properties:{columnsXL:{type:"sap.ui.layout.form.ColumnsXL",group:"Appearance",defaultValue:2},columnsL:{type:"sap.ui.layout.form.ColumnsL",group:"Appearance",defaultValue:2},columnsM:{type:"sap.ui.layout.form.ColumnsM",group:"Appearance",defaultValue:1},labelCellsLarge:{type:"sap.ui.layout.form.ColumnCells",group:"Appearance",defaultValue:4},emptyCellsLarge:{type:"sap.ui.layout.form.EmptyCells",group:"Appearance",defaultValue:0}}}});r.prototype.init=function(){this._iBreakPointTablet=i.media._predefinedRangeSets[i.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=i.media._predefinedRangeSets[i.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=i.media._predefinedRangeSets[i.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];this._resizeProxy=e.proxy(n,this)};r.prototype.exit=function(){o.call(this)};r.prototype.onBeforeRendering=function(e){if(this.getColumnsM()>this.getColumnsL()||this.getColumnsL()>this.getColumnsXL()){throw new Error("Column size not correct defined for "+this)}o.call(this)};r.prototype.onAfterRendering=function(e){this._sResizeListener=s.register(this,this._resizeProxy);n.call(this)};r.prototype.toggleContainerExpanded=function(e){e.$().toggleClass("sapUiFormCLContainerColl",!e.getExpanded())};r.prototype.onLayoutDataChange=function(e){this.invalidate()};r.prototype.onsapup=function(e){this.onsapleft(e)};r.prototype.onsapdown=function(e){this.onsapright(e)};r.prototype.getContainerRenderedDomRef=function(e){return e.getDomRef()};r.prototype.getElementRenderedDomRef=function(e){return e.getDomRef()};r.prototype._getContainerSize=function(e){var t=this.getParent();var a=this.getLayoutDataForElement(e,"sap.ui.layout.form.ColumnContainerData");var i=t.getVisibleFormContainers();var s=i.length;var l=this.getColumnsM();var r=this.getColumnsL();var o=this.getColumnsXL();var n={S:{Size:1,Break:false,FirstRow:false},M:{Size:1,Break:false,FirstRow:false},L:{Size:1,Break:false,FirstRow:false},XL:{Size:1,Break:false,FirstRow:false}};var f=function(e,t,a,i,s){if(a<e){t.Size=Math.floor(e/a);if(s&&t.Size*a<e){t.Size=t.Size+e-t.Size*a}}t.Break=e>1&&i>0&&i%e===0;t.FirstRow=a>1&&i<e};if(a){n.M.Size=a.getColumnsM();n.L.Size=a.getColumnsL();n.XL.Size=a.getColumnsXL();if(n.M.Size>l||n.L.Size>r||n.XL.Size>o){throw new Error("More cells defined for FormContainer "+e.getId()+" than columns on "+this)}}if(s===1){if(!a){n.M.Size=l;n.L.Size=r;n.XL.Size=o}n.S.FirstRow=true;n.M.FirstRow=true;n.L.FirstRow=true;n.XL.FirstRow=true}else{var u=0;var g=0;var p=0;var C;var m=false;var L=0;var d=l;var S=r;var h=o;var v=0;for(v=0;v<s;v++){if(e===i[v]){u=v;C=a}else{C=this.getLayoutDataForElement(i[v],"sap.ui.layout.form.ColumnContainerData")}if(!C){var y=i[v].getVisibleFormElements();if(g<y.length){g=y.length;p=v}L++}else{m=true;d=d-C.getColumnsM();S=S-C.getColumnsL();h=h-C.getColumnsXL()}}n.S.FirstRow=s>1&&u===0;n.S.Break=u>0;if(!m){f(l,n.M,s,u,u===p);f(r,n.L,s,u,u===p);f(o,n.XL,s,u,u===p)}else{if(!a){if(L<d){f(d,n.M,L,u,u===p)}if(L<S){f(S,n.L,L,u,u===p)}if(L<h){f(h,n.XL,L,u,u===p)}}var F={M:{rowColumns:0,lineBreak:false,first:true},L:{rowColumns:0,lineBreak:false,first:true},XL:{rowColumns:0,lineBreak:false,first:true}};var k=function(e,t,a){if(a){if(e.rowColumns+a<=t){e.rowColumns=e.rowColumns+a;e.lineBreak=false}else{e.rowColumns=a;if(t>1){e.lineBreak=true}e.first=false}}else{if(e.rowColumns<t){e.rowColumns++;e.lineBreak=false}else{e.rowColumns=1;if(t>1){e.lineBreak=true}e.first=false}}};for(v=0;v<s;v++){if(e===i[v]){C=a}else{C=this.getLayoutDataForElement(i[v],"sap.ui.layout.form.ColumnContainerData")}k(F.M,l,C?C.getColumnsM():0);k(F.L,r,C?C.getColumnsL():0);k(F.XL,o,C?C.getColumnsXL():0);if(e===i[v]){n.M.Break=F.M.lineBreak;n.L.Break=F.L.lineBreak;n.XL.Break=F.XL.lineBreak;n.M.FirstRow=F.M.first;n.L.FirstRow=F.L.first;n.XL.FirstRow=F.XL.first;break}}}}return n};r.prototype._getFieldSize=function(t){var a=12;var i=this.getLayoutDataForElement(t,"sap.ui.layout.form.ColumnElementData");var s={S:{Size:a,Break:false,Space:0},L:{Size:a,Break:false,Space:0}};var l=a;var r=this.getLabelCellsLarge();if(i){s.S.Size=i.getCellsSmall();s.L.Size=i.getCellsLarge()}var o=t.getParent();var n=o.getLabelControl();if(n===t){if(!i){s.S.Size=l;s.L.Size=r}}else{var f=o.getFields();var u=f.length;var g=a;var p=a-this.getEmptyCellsLarge();if(n){var C=this.getLayoutDataForElement(n,"sap.ui.layout.form.ColumnElementData");if(C){l=C.getCellsSmall();r=C.getCellsLarge()}if(l<a){g=g-l}if(r<a){p=p-r}}else{l=0;r=0}if(u===1){if(!i){s.S.Size=g;s.L.Size=p}else if(n){if(s.S.Size>g){s.S.Break=true}if(s.L.Size>p){s.L.Break=true}}}else{var m=0;var L=[];var d=[];var S={availableCells:g,first:0,last:999,firstDefault:-1,defaultFields:0};var h=0;var v=0;var y=0;var F;L.push(e.extend({},S));S.availableCells=p;d.push(e.extend({},S));var k=function(t,a,i,s){t[a].last=i-1;t.push(e.extend({},S));a++;t[a].first=i;t[a].availableCells=s;return a};var D=function(e,t,i,s,l){if(e[t].availableCells-e[t].defaultFields<i){if(i<=s){t=k(e,t,l,s)}else{t=k(e,t,l,a)}}e[t].availableCells=e[t].availableCells-i;return t};var c=function(e,t,a,i){if(e[t].availableCells===e[t].defaultFields){t=k(e,t,i,a)}if(e[t].firstDefault<0){e[t].firstDefault=i}e[t].defaultFields++;return t};for(m=0;m<u;m++){if(t!==f[m]){F=this.getLayoutDataForElement(f[m],"sap.ui.layout.form.ColumnElementData")}else{F=i;y=m}if(F){h=D(L,h,F.getCellsSmall(),g,m);v=D(d,v,F.getCellsLarge(),p,m)}else{h=c(L,h,g,m);v=c(d,v,p,m)}}var z=function(e,t,i,s,l){var r=0;var o;for(m=0;m<e.length;m++){if(t>=e[m].first&&t<=e[m].last){o=e[m];break}}if(!i){s.Size=Math.floor(o.availableCells/o.defaultFields)}if(t===o.first&&t>0){s.Break=true;if(l>0&&l<a&&s.Size<=a-l){s.Space=l}}if(t===o.firstDefault){r=o.availableCells-o.defaultFields*s.Size;if(r>0){s.Size=s.Size+r}}};z(L,y,i,s.S,l);z(d,y,i,s.L,r)}}return s};function o(){if(this._sResizeListener){s.deregister(this._sResizeListener);this._sResizeListener=undefined}}function n(e,t){var a=this.getDomRef();if(!a){o.call(this);return}var i=this.$();if(!i.is(":visible")){return}var s=a.clientWidth;var l=1;if(s<=this._iBreakPointTablet){i.toggleClass("sapUiFormCLMedia-Std-Phone",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false)}else if(s>this._iBreakPointTablet&&s<=this._iBreakPointDesktop){i.toggleClass("sapUiFormCLMedia-Std-Tablet",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsM()}else if(s>this._iBreakPointDesktop&&s<=this._iBreakPointLargeDesktop){i.toggleClass("sapUiFormCLMedia-Std-Desktop",true);i.toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsL()}else{i.toggleClass("sapUiFormCLMedia-Std-LargeDesktop",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false);l=this.getColumnsXL()}var r=this.getLabelCellsLarge()<12&&s/l>this._iBreakPointTablet;i.toggleClass("sapUiFormCLWideColumns",r);i.toggleClass("sapUiFormCLSmallColumns",!r)}return r});