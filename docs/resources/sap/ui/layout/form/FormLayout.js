/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/layout/library","./FormLayoutRenderer"],function(e,t,r,n){"use strict";var i=r.BackgroundDesign;var a=t.extend("sap.ui.layout.form.FormLayout",{metadata:{library:"sap.ui.layout",properties:{backgroundDesign:{type:"sap.ui.layout.BackgroundDesign",group:"Appearance",defaultValue:i.Translucent}}}});a.prototype.contentOnAfterRendering=function(t,n){if(r.form.FormHelper.bArrowKeySupport){e(n.getFocusDomRef()).data("sap.InNavArea",true)}if(n.getWidth&&(!n.getWidth()||n.getWidth()=="auto")&&(!n.getFormDoNotAdjustWidth||!n.getFormDoNotAdjustWidth())){n.$().css("width","100%")}};a.prototype.toggleContainerExpanded=function(e){var t=e.getExpanded();if(this.getDomRef()){if(t){e.$("content").css("display","")}else{e.$("content").css("display","none")}}};a.prototype.getLayoutDataForElement=function(e,t){var r=e.getLayoutData();if(!r){return undefined}else if(r.isA(t)){return r}else if(r.isA("sap.ui.core.VariantLayoutData")){var n=r.getMultipleLayoutData();for(var i=0;i<n.length;i++){var a=n[i];if(a.isA(t)){return a}}}};a.prototype.onsapright=function(e){if(r.form.FormHelper.bArrowKeySupport){var t=sap.ui.getCore().getConfiguration().getRTL();if(!t){this.navigateForward(e)}else{this.navigateBack(e)}}};a.prototype.onsapleft=function(e){if(r.form.FormHelper.bArrowKeySupport){var t=sap.ui.getCore().getConfiguration().getRTL();if(!t){this.navigateBack(e)}else{this.navigateForward(e)}}};a.prototype.onsapdown=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i;var a=this.findElement(n);var o=a.element;n=a.rootControl;if(o&&o.isA("sap.ui.layout.form.FormElement")){i=this.findFieldBelow(n,o)}else if(o&&o.isA("sap.ui.layout.form.FormContainer")){i=this.findFirstFieldOfNextElement(o,0)}if(i){e.sap.focus(i);t.preventDefault()}}};a.prototype.onsapup=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;n=o.rootControl;if(f&&f.isA("sap.ui.layout.form.FormElement")){a=this.findFieldAbove(n,f)}else if(f&&f.isA("sap.ui.layout.form.FormContainer")){var l=f.getParent();i=l.indexOfFormContainer(f);a=this.findLastFieldOfLastElementInPrevContainer(l,i-1)}if(a){e.sap.focus(a);t.preventDefault()}}};a.prototype.onsaphome=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;var l=f.getParent();var s=l.getParent();i=s.indexOfFormContainer(l);a=this.findFirstFieldOfFirstElementInNextContainer(s,i);if(a){e.sap.focus(a);t.preventDefault()}}};a.prototype.onsaptop=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i=this.findElement(n);var a=i.element;var o;var f;if(a&&a.isA("sap.ui.layout.form.FormElement")){f=a.getParent()}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){f=a}var l=f.getParent();o=this.findFirstFieldOfForm(l);if(o){e.sap.focus(o);t.preventDefault()}}};a.prototype.onsapend=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;var l=f.getParent();var s=l.getParent();i=s.indexOfFormContainer(l);a=this.findLastFieldOfLastElementInPrevContainer(s,i);if(a){e.sap.focus(a);t.preventDefault()}}};a.prototype.onsapbottom=function(t){if(r.form.FormHelper.bArrowKeySupport){var n=t.srcControl;var i=this.findElement(n);var a=i.element;var o;var f;if(a&&a.isA("sap.ui.layout.form.FormElement")){f=a.getParent()}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){f=a}var l=f.getParent();var s=l.getFormContainers();var d=s.length;o=this.findLastFieldOfLastElementInPrevContainer(l,d-1);if(o){e.sap.focus(o);t.preventDefault()}}};a.prototype.onsapexpand=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;var i;if(n.isA("sap.ui.layout.form.FormContainer")){i=n}else{i=n.getParent()}if(i.getExpandable()&&t===i._oExpandButton){i.setExpanded(true)}};a.prototype.onsapcollapse=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;var i;if(n.isA("sap.ui.layout.form.FormContainer")){i=n}else{i=n.getParent()}if(i.getExpandable()&&t===i._oExpandButton){i.setExpanded(false)}};a.prototype.onsapskipforward=function(t){var r=t.srcControl;var n=this.findElement(r);var i=n.element;r=n.rootControl;var a;var o;if(i&&i.isA("sap.ui.layout.form.FormElement")){o=i.getParent()}else if(i&&i.isA("sap.ui.layout.form.FormContainer")){o=i}var f=o.getParent();var l=f.indexOfFormContainer(o);a=this.findFirstFieldOfFirstElementInNextContainer(f,l+1);if(a){e.sap.focus(a);t.preventDefault()}};a.prototype.onsapskipback=function(t){var r=t.srcControl;var n=this.findElement(r);var i=n.element;r=n.rootControl;var a;var o;if(i&&i.isA("sap.ui.layout.form.FormElement")){o=i.getParent()}else if(i&&i.isA("sap.ui.layout.form.FormContainer")){o=i}var f=o.getParent();var l=f.getFormContainers();var s=f.indexOfFormContainer(o);while(!a&&s>0){var d=l[s-1];if(!d.getExpandable()||d.getExpanded()){a=this.findFirstFieldOfFirstElementInPrevContainer(f,s-1)}s=s-1}if(a){e.sap.focus(a);t.preventDefault()}};a.prototype.onBeforeFastNavigationFocus=function(t){if(e.contains(this.getDomRef(),t.source)){t.srcControl=e(t.source).control(0);if(t.forward){this.onsapskipforward(t)}else{this.onsapskipback(t)}}else{var r=t.forward?this.findFirstFieldOfForm(this.getParent()):this.findFirstFieldOfLastContainerOfForm(this.getParent());if(r){e.sap.focus(r);t.preventDefault()}}};a.prototype.findElement=function(e){var t=e.getParent();var r=e;while(t&&!t.isA("sap.ui.layout.form.FormElement")&&!t.isA("sap.ui.layout.form.FormContainer")&&!t.isA("sap.ui.layout.form.Form")){r=t;t=t.getParent()}return{rootControl:r,element:t}};a.prototype.navigateForward=function(t){var r=t.srcControl;var n=0;var i;var a=this.findElement(r);var o=a.element;r=a.rootControl;if(o&&o.isA("sap.ui.layout.form.FormElement")){if(r==o.getLabelControl()){n=-1}else{n=o.indexOfField(r)}i=this.findNextFieldOfElement(o,n+1);if(!i){var f=o.getParent();n=f.indexOfFormElement(o);i=this.findFirstFieldOfNextElement(f,n+1);if(!i){var l=f.getParent();n=l.indexOfFormContainer(f);i=this.findFirstFieldOfFirstElementInNextContainer(l,n+1)}}}else if(o&&o.isA("sap.ui.layout.form.FormContainer")){i=this.findFirstFieldOfNextElement(o,0)}if(i){e.sap.focus(i);t.preventDefault()}};a.prototype.tabForward=function(t){var r;var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;n=o.rootControl;if(f&&f.isA("sap.ui.layout.form.FormElement")){if(n==f.getLabelControl()){i=-1}else{i=f.indexOfField(n)}a=this.findNextFieldOfElement(f,i+1,true);if(!a){var l=f.getParent();i=l.indexOfFormElement(f);a=this.findFirstFieldOfNextElement(l,i+1,true);if(!a){r=l.getParent();i=r.indexOfFormContainer(l);a=this.findFirstFieldOfFirstElementInNextContainer(r,i+1,true)}}}else if(f&&f.isA("sap.ui.layout.form.FormContainer")){a=this.findFirstFieldOfNextElement(f,0,true);if(!a){r=f.getParent();i=r.indexOfFormContainer(f);a=this.findFirstFieldOfFirstElementInNextContainer(r,i+1,true)}}if(a){e.sap.focus(a);t.preventDefault()}};a.prototype.findNextFieldOfElement=function(e,t,r){var n=e.getFields();var i=n.length;var a;for(var o=t;o<i;o++){var f=n[o];var l=this._getDomRef(f);if(r==true){if((!f.getEditable||f.getEditable())&&(!f.getEnabled||f.getEnabled())&&l){a=l;break}}else{if((!f.getEnabled||f.getEnabled())&&l){a=l;break}}}return a};a.prototype.findFirstFieldOfNextElement=function(e,t,r){var n=e.getFormElements();var i=n.length;var a;var o=t;while(!a&&o<i){var f=n[o];if(r==true){a=this.findNextFieldOfElement(f,0,true)}else{a=this.findNextFieldOfElement(f,0)}o++}return a};a.prototype.findFirstFieldOfForm=function(e){var t=e.getFormContainers();var r;var n=t[0];if(!n.getExpandable()||n.getExpanded()){r=this.findFirstFieldOfNextElement(n,0)}return r};a.prototype.findFirstFieldOfLastContainerOfForm=function(e){var t;var r=e.getFormContainers();var n=r.length;while(!t&&n>=0){var i=r[n-1];if(!i.getExpandable()||i.getExpanded()){t=this.findFirstFieldOfFirstElementInPrevContainer(e,n-1)}n=n-1}return t};a.prototype.findFirstFieldOfFirstElementInNextContainer=function(e,t,r){var n=e.getFormContainers();var i=n.length;var a;var o=t;while(!a&&o<i){var f=n[o];if(f.getExpandable()&&r){a=f._oExpandButton.getFocusDomRef();if(a){break}}if(!f.getExpandable()||f.getExpanded()){if(r==true){a=this.findFirstFieldOfNextElement(f,0,true)}else{a=this.findFirstFieldOfNextElement(f,0)}}o++}return a};a.prototype.findFirstFieldOfFirstElementInPrevContainer=function(e,t){var r=e.getFormContainers();var n=r.length;var i;var a=t;while(!i&&a<n&&a>=0){var o=r[a];if(!o.getExpandable()||o.getExpanded()){i=this.findFirstFieldOfNextElement(o,0)}a++}return i};a.prototype.navigateBack=function(t){var r;var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;n=o.rootControl;if(f&&f.isA("sap.ui.layout.form.FormElement")){if(n==f.getLabelControl()){i=0}else{i=f.indexOfField(n)}a=this.findPrevFieldOfElement(f,i-1);if(!a){var l=f.getParent();i=l.indexOfFormElement(f);a=this.findLastFieldOfPrevElement(l,i-1);if(!a){r=l.getParent();i=r.indexOfFormContainer(l);a=this.findLastFieldOfLastElementInPrevContainer(r,i-1)}}}else if(f&&f.isA("sap.ui.layout.form.FormContainer")){r=f.getParent();i=r.indexOfFormContainer(f);a=this.findLastFieldOfLastElementInPrevContainer(r,i-1)}if(a){e.sap.focus(a);t.preventDefault()}};a.prototype.tabBack=function(t){var r;var n=t.srcControl;var i=0;var a;var o=this.findElement(n);var f=o.element;n=o.rootControl;if(f&&f.isA("sap.ui.layout.form.FormElement")){if(n==f.getLabelControl()){i=0}else{i=f.indexOfField(n)}a=this.findPrevFieldOfElement(f,i-1,true);if(!a){var l=f.getParent();i=l.indexOfFormElement(f);a=this.findLastFieldOfPrevElement(l,i-1,true);if(!a){r=l.getParent();i=r.indexOfFormContainer(l);if(l.getExpandable()){a=l._oExpandButton.getFocusDomRef()}if(!a){a=this.findLastFieldOfLastElementInPrevContainer(r,i-1,true)}}}}else if(f&&f.isA("sap.ui.layout.form.FormContainer")){r=f.getParent();i=r.indexOfFormContainer(f);a=this.findLastFieldOfLastElementInPrevContainer(r,i-1,true)}if(a){e.sap.focus(a);t.preventDefault()}};a.prototype.findPrevFieldOfElement=function(e,t,r){var n=e.getFields();var i;for(var a=t;a>=0;a--){var o=n[a];var f=this._getDomRef(o);if(r==true){if((!o.getEditable||o.getEditable())&&(!o.getEnabled||o.getEnabled())&&f){i=f;break}}else{if((!o.getEnabled||o.getEnabled())&&f){i=f;break}}}return i};a.prototype.findLastFieldOfPrevElement=function(e,t,r){var n=e.getFormElements();var i;var a=t;while(!i&&a>=0){var o=n[a];var f=o.getFields().length;if(r==true){i=this.findPrevFieldOfElement(o,f-1,true)}else{i=this.findPrevFieldOfElement(o,f-1)}a--}return i};a.prototype.findLastFieldOfLastElementInPrevContainer=function(e,t,r){var n=e.getFormContainers();var i;var a=t;while(!i&&a>=0){var o=n[a];if(o.getExpandable()&&!o.getExpanded()&&r){i=o._oExpandButton.getFocusDomRef();if(i){break}}if(!o.getExpandable()||o.getExpanded()){var f=o.getFormElements().length;if(r==true){i=this.findLastFieldOfPrevElement(o,f-1,true)}else{i=this.findLastFieldOfPrevElement(o,f-1,0)}}a--}return i};a.prototype.findFieldBelow=function(e,t){var r=t.getParent();var n=r.indexOfFormElement(t);var i=this.findFirstFieldOfNextElement(r,n+1);if(!i){var a=r.getParent();n=a.indexOfFormContainer(r);i=this.findFirstFieldOfFirstElementInNextContainer(a,n+1)}return i};a.prototype.findFieldAbove=function(e,t){var r=t.getParent();var n=r.indexOfFormElement(t);var i=r.getFormElements();var a;var o=n-1;while(!a&&o>=0){var f=i[o];a=this.findPrevFieldOfElement(f,0);o--}if(!a){var l=r.getParent();n=l.indexOfFormContainer(r);a=this.findLastFieldOfLastElementInPrevContainer(l,n-1)}return a};a.prototype._getDomRef=function(t){var r=t.getFocusDomRef();if(!e(r).is(":sapFocusable")){r=undefined}return r};a.prototype.getContainerRenderedDomRef=function(t){if(this.getDomRef()){return e.sap.domById(t.getId())}else{return null}};a.prototype.getElementRenderedDomRef=function(t){if(this.getDomRef()){return e.sap.domById(t.getId())}else{return null}};return a});