/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","./library","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/ui/core/RenderManager","./SplitterRenderer"],function(e,t,i,s,r,a,n){"use strict";var o=s.Orientation;var h=t.extend("sap.ui.layout.Splitter",{metadata:{library:"sap.ui.layout",properties:{orientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:o.Horizontal},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"}},defaultAggregation:"contentAreas",aggregations:{contentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"contentArea"}},events:{resize:{parameters:{id:{type:"string"},oldSizes:{type:"int[]"},newSizes:{type:"int[]"}}}},designtime:"sap/ui/layout/designtime/Splitter.designtime"}});var l=sap.ui.getCore().getLibraryResourceBundle("sap.ui.layout");h.prototype.init=function(){this._needsInvalidation=false;this._liveResize=true;this._keyboardEnabled=true;this._bHorizontal=true;this._calculatedSizes=[];this._move={};this._resizeTimeout=null;this._resizeCallback=this._delayedResize.bind(this);this._resizeHandlerId=null;this._autoResize=true;this.enableAutoResize();this._boundBarMoveEnd=this._onBarMoveEnd.bind(this);this._boundBarMove=this._onBarMove.bind(this);this._switchOrientation();this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",20),decrease:this._onKeyboardResize.bind(this,"dec",20),increaseMore:this._onKeyboardResize.bind(this,"incMore",20),decreaseMore:this._onKeyboardResize.bind(this,"decMore",20),max:this._onKeyboardResize.bind(this,"max",20),min:this._onKeyboardResize.bind(this,"min",20)};this._enableKeyboardListeners();this._bUseIconForSeparator=true};h.prototype.exit=function(){this.disableAutoResize();delete this._resizeCallback;delete this._boundBarMoveEnd;delete this._boundBarMove;delete this._$SplitterOverlay;delete this._$SplitterOverlayBar};h.prototype.triggerResize=function(e){if(e){this._resize()}else{this._delayedResize()}};h.prototype.getCalculatedSizes=function(){return this._calculatedSizes};h.prototype.enableAutoResize=function(e){if(e&&!this._autoResize){return}this._autoResize=true;var t=this;sap.ui.getCore().attachInit(function(){t._resizeHandlerId=r.register(t,t._resizeCallback)});this._delayedResize()};h.prototype.disableAutoResize=function(e){r.deregister(this._resizeHandlerId);if(!e){this._autoResize=false}};h.prototype.enableLiveResize=function(){this._liveResize=true;this.$().toggleClass("sapUiLoSplitterAnimated",false)};h.prototype.disableLiveResize=function(){this._liveResize=false;this.$().toggleClass("sapUiLoSplitterAnimated",true)};h.prototype.enableKeyboardSupport=function(){var e=this.$().find(".sapUiLoSplitterBar");e.attr("tabindex","0");this._enableKeyboardListeners()};h.prototype.disableKeyboardSupport=function(){var e=this.$().find(".sapUiLoSplitterBar");e.attr("tabindex","-1");this._disableKeyboardListeners()};h.prototype.onBeforeRendering=function(){this._switchOrientation()};h.prototype.onAfterRendering=function(){this._$SplitterOverlay=this.$("overlay");this._$SplitterOverlayBar=this.$("overlayBar");this._$SplitterOverlay.detach();this._resize()};h.prototype.onLayoutDataChange=function(){this._delayedResize()};h.prototype.ontouchstart=function(e){if(this._ignoreTouch){return}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!=0){return}if(!e.changedTouches||!e.changedTouches[0]){return}this._ignoreMouse=true;this._onBarMoveStart(e.changedTouches[0],true)};h.prototype.onmousedown=function(e){if(this._ignoreMouse){return}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!=0){return}this._ignoreTouch=true;this._onBarMoveStart(e)};h.prototype._onBarMoveStart=function(t,i){var s=this.getId();this.disableAutoResize(true);var r=t[this._moveCord];var a=parseInt(t.target.id.substr((s+"-splitbar-").length),10);var n=e(t.target);var o=this.getCalculatedSizes();var h=this._bHorizontal?n.innerWidth():n.innerHeight();var l=this._getContentAreas();var u=l[a].getLayoutData();var p=l[a+1].getLayoutData();if(!u.getResizable()||!p.getResizable()){d(i);return}var c=0-h;for(var v=0;v<=a;++v){c+=o[v]+h}this._move={start:r,relStart:c,barNum:a,bar:e(t.target),c1Size:o[a],c1MinSize:u?parseInt(u.getMinSize(),10):0,c2Size:o[a+1],c2MinSize:p?parseInt(p.getMinSize(),10):0};if(i){document.addEventListener("touchend",this._boundBarMoveEnd);document.addEventListener("touchmove",this._boundBarMove)}else{document.addEventListener("mouseup",this._boundBarMoveEnd);document.addEventListener("mousemove",this._boundBarMove)}this._$SplitterOverlay.css("display","block");this._$SplitterOverlay.appendTo(this.getDomRef());this._$SplitterOverlayBar.css(this._sizeDirNot,"");this._move["bar"].css("visibility","hidden");this._onBarMove(t)};h.prototype._onBarMove=function(e){if(e.preventDefault){e.preventDefault()}var t=e;if(e.changedTouches&&e.changedTouches[0]){t=e.changedTouches[0]}var i=t[this._moveCord];var s=i-this._move.start;if(this.getOrientation()==o.Horizontal&&this._bRtl){s=-s}var r=this._move.c1Size+s;var a=this._move.c2Size-s;var n=r>=0&&a>=0&&r>=this._move.c1MinSize&&a>=this._move.c2MinSize;if(n){this._$SplitterOverlayBar.css(this._sizeDir,this._move.relStart+s);if(this._liveResize){var h=this._move["start"]-t[this._moveCord];if(this.getOrientation()==o.Horizontal&&this._bRtl){h=-h}this._resizeContents(this._move["barNum"],-h,false)}}};h.prototype._onBarMoveEnd=function(t){this._ignoreMouse=false;this._ignoreTouch=false;var i=t;if(t.changedTouches&&t.changedTouches[0]){i=t.changedTouches[0]}var s=i[this._moveCord];var r=this._move["start"]-s;if(this.getOrientation()==o.Horizontal&&this._bRtl){r=-r}this._resizeContents(this._move["barNum"],-r,true);this._move["bar"].css("visibility","");this._$SplitterOverlay.css("display","");document.removeEventListener("mouseup",this._boundBarMoveEnd);document.removeEventListener("mousemove",this._boundBarMove);document.removeEventListener("touchend",this._boundBarMoveEnd);document.removeEventListener("touchmove",this._boundBarMove);this.enableAutoResize(true);e.sap.focus(this._move.bar)};h.prototype._resizeContents=function(t,i,s){if(isNaN(i)){e.sap.log.warning("Splitter: Received invalid resizing values - resize aborted.");return}var r=this._getContentAreas();var a=r[t].getLayoutData();var n=r[t+1].getLayoutData();var o=a.getSize();var h=n.getSize();var l=this.$("content-"+t);var u=this.$("content-"+(t+1));var d=this._move.c1Size+i;var p=this._move.c2Size-i;var c=parseInt(a.getMinSize(),10);var v=parseInt(n.getMinSize(),10);var _;if(d<c){_=c-d;i+=_;d=c;p-=_}else if(p<v){_=v-p;i-=_;p=v;d-=_}if(s){if(o==="auto"&&h!=="auto"){n.setSize(p+"px")}else if(o!=="auto"&&h==="auto"){a.setSize(d+"px")}else{a.setSize(d+"px");n.setSize(p+"px")}}else{l.css(this._sizeType,d+"px");u.css(this._sizeType,p+"px")}};h.prototype._delayedResize=function(t){if(t===undefined){t=0}if(this.getDomRef()){e.sap.clearDelayedCall(this._resizeTimeout);e.sap.delayedCall(t,this,"_resize",[])}};h.prototype._resizeBars=function(e){var t,i;var s=this.$();for(t=0;t<e.length-1;++t){i=this.$("splitbar-"+t);i.css(this._sizeTypeNot,"")}for(t=0;t<e.length-1;++t){i=this.$("splitbar-"+t);var r=this._bHorizontal?s.height():s.width();i.css(this._sizeType,"");i.css(this._sizeTypeNot,r+"px")}};h.prototype._resize=function(){var e=this.getDomRef();if(!e||a.getPreserveAreaRef().contains(e)){return}var t=0,i;var s=this._getContentAreas();this._resizeBars(s);var r=this.getCalculatedSizes();this._recalculateSizes();var n=this.getCalculatedSizes();var o=false;for(t=0;t<n.length;++t){if(n[t]!==0){o=true;break}}if(!o){this._delayedResize(100);return}var h=true;for(t=0;t<s.length;++t){var l=this.$("content-"+t);var d=s[t];l.css(this._sizeType,n[t]+"px");l.css(this._sizeTypeNot,"");var p=d.getLayoutData();var c=p&&p.getResizable();if(t>0){var v=c&&h;i=this.$("splitbar-"+(t-1));i.toggleClass("sapUiLoSplitterNoResize",!v);i.attr("tabindex",v&&this._keyboardEnabled?"0":"-1")}h=c}this._resizeBars(s);if(u(r,n)){this.fireResize({oldSizes:r,newSizes:n})}};h.prototype._calculateAvailableContentSize=function(e){var t=0;var i=this.$();var s=this._bHorizontal?i.innerWidth():i.innerHeight();var r=0;var a=false;for(t=0;t<e.length;++t){var n=e[t];if(n.indexOf("%")>-1){r++}if(e[t]=="auto"){a=true}}r+=a?1:0;s-=r;var o=e.length-1;var h=0;for(t=0;t<o;++t){h+=this._bHorizontal?this.$("splitbar-"+t).innerWidth():this.$("splitbar-"+t).innerHeight()}return s-h};h.prototype._recalculateSizes=function(){var t,i,s,r,a;var n=[];var o=this._getContentAreas();for(t=0;t<o.length;++t){s=o[t].getLayoutData();i=s?s.getSize():"auto";n.push(i)}this._calculatedSizes=[];var h=this._calculateAvailableContentSize(n);var l=[];var u=[];var d=[];var p=h;for(t=0;t<n.length;++t){i=n[t];var c;if(i.indexOf("px")>-1){c=parseInt(i,10);p-=c;this._calculatedSizes[t]=c}else if(i.indexOf("%")>-1){d.push(t)}else if(n[t]=="auto"){s=o[t].getLayoutData();if(s&&parseInt(s.getMinSize(),10)!=0){u.push(t)}else{l.push(t)}}else{e.sap.log.error("Illegal size value: "+n[t])}}var v=false;if(p<0){v=true;p=0}var _=d.length;for(t=0;t<_;++t){a=d[t];r=Math.floor(parseFloat(n[a])/100*h);this._calculatedSizes[a]=r;p-=r}h=p;if(h<0){v=true;h=0}r=Math.floor(h/(u.length+l.length),0);var g=u.length;for(t=0;t<g;++t){a=u[t];var f=parseInt(o[a].getLayoutData().getMinSize(),10);if(f>r){this._calculatedSizes[a]=f;h-=f}else{this._calculatedSizes[a]=r;h-=r}}if(h<0){v=true;h=0}p=h;var z=l.length;r=Math.floor(h/z,0);for(t=0;t<z;++t){a=l[t];this._calculatedSizes[a]=r;p-=r}if(v){e.sap.log.info("[Splitter] The set sizes and minimal sizes of the splitter contents are bigger "+"than the available space in the UI.")}};h.prototype._switchOrientation=function(){this._bHorizontal=this.getOrientation()===o.Horizontal;if(this._bHorizontal){this._sizeDirNot="top";this._sizeTypeNot="height";this._sizeType="width";this._moveCord="pageX";if(this._bRtl){this._sizeDir="right"}else{this._sizeDir="left"}}else{this._moveCord="pageY";this._sizeType="height";this._sizeTypeNot="width";this._sizeDir="top";this._sizeDirNot="left"}var e=this.$();e.toggleClass("sapUiLoSplitterH",this._bHorizontal);e.toggleClass("sapUiLoSplitterV",!this._bHorizontal)};h.prototype._onKeyboardResize=function(t,i,s){var r=this.getId()+"-splitbar-";if(!s||!s.target||!s.target.id||s.target.id.indexOf(r)!==0){return}var a=999999;var n=parseInt(s.target.id.substr(r.length),10);var o=this.getCalculatedSizes();this._move.c1Size=o[n];this._move.c2Size=o[n+1];var h=0;switch(t){case"inc":h=i;break;case"incMore":h=i*10;break;case"dec":h=0-i;break;case"decMore":h=0-i*10;break;case"max":h=a;break;case"min":h=0-a;break;default:e.sap.log.warn("[Splitter] Invalid keyboard resize type");break}this._resizeContents(n,h,true)};h.prototype._enableKeyboardListeners=function(){this.onsapright=this._keyListeners.increase;this.onsapdown=this._keyListeners.increase;this.onsapleft=this._keyListeners.decrease;this.onsapup=this._keyListeners.decrease;this.onsappageup=this._keyListeners.decreaseMore;this.onsappagedown=this._keyListeners.increaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true};h.prototype._disableKeyboardListeners=function(){delete this.onsapincreasemodifiers;delete this.onsapdecreasemodifiers;delete this.onsapendmodifiers;delete this.onsaphomemodifiers;this._keyboardEnabled=false};h.prototype._getText=function(e,t){return l?l.getText(e,t):e};function u(e,t){if(e===t){return false}if(!e||!t||e.length===undefined||t.length===undefined){return true}if(e.length!=t.length){return true}for(var i=0;i<e.length;++i){if(e[i]!==t[i]){return true}}return false}function d(e){var t=function(e){e.preventDefault()};var i=null;i=function(){document.removeEventListener("touchend",i);document.removeEventListener("touchmove",t);document.removeEventListener("mouseup",i);document.removeEventListener("mousemove",t)};if(e){this._ignoreMouse=true;document.addEventListener("touchend",i);document.addEventListener("touchmove",t)}else{document.addEventListener("mouseup",i);document.addEventListener("mousemove",t)}}function p(t){var i=t.getLayoutData();if(i&&(!i.getResizable||!i.getSize||!i.getMinSize)){e.sap.log.warning('Content "'+t.getId()+'" for the Splitter contained wrong LayoutData. '+"The LayoutData has been replaced with default values.");i=null}if(!i){t.setLayoutData(new sap.ui.layout.SplitterLayoutData)}}h.prototype.invalidate=function(e){var i=e&&this.indexOfContentArea(e)!=-1||e&&e instanceof sap.ui.core.CustomData&&e.getWriteToDom()||e===undefined;if(i||this._needsInvalidation){this._needsInvalidation=false;t.prototype.invalidate.apply(this,arguments)}};h.prototype.setOrientation=function(e){var t=this.setProperty("orientation",e,true);this._switchOrientation();this._delayedResize();this.$().find(".sapUiLoSplitterBar").attr("aria-orientation",this._bHorizontal?"vertical":"horizontal");return t};h.prototype.setWidth=function(e){this.setProperty("width",e,true);this.$().css("width",this.getProperty("width"));return this};h.prototype.setHeight=function(e){this.setProperty("height",e,true);this.$().css("height",this.getProperty("height"));return this};h.prototype.addContentArea=function(e){this._needsInvalidation=true;p(e);return this.addAggregation("contentAreas",e)};h.prototype.removeContentArea=function(e){this._needsInvalidation=true;return this.removeAggregation("contentAreas",e)};h.prototype.removeAllContentArea=function(){this._needsInvalidation=true;return this.removeAllAggregation("contentAreas")};h.prototype.destroyContentArea=function(){this._needsInvalidation=true;return this.destroyAggregation("contentAreas")};h.prototype.insertContentArea=function(e,t){this._needsInvalidation=true;p(e);return this.insertAggregation("contentAreas",e,t)};h.prototype._getContentAreas=function(){return this.getContentAreas()};return h});