/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/EnabledPropagator","sap/ui/core/ResizeHandler","./library","sap/ui/core/delegate/ScrollEnablement","./FixFlexRenderer"],function(e,i,t,r,l,s,o){"use strict";var n=i.extend("sap.ui.layout.FixFlex",{metadata:{library:"sap.ui.layout",properties:{vertical:{type:"boolean",group:"Appearance",defaultValue:true},fixFirst:{type:"boolean",group:"Misc",defaultValue:true},fixContentSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minFlexSize:{type:"int",defaultValue:0}},aggregations:{fixContent:{type:"sap.ui.core.Control",multiple:true,singularName:"fixContent"},flexContent:{type:"sap.ui.core.Control",multiple:false}},designtime:"sap/ui/layout/designtime/FixFlex.designtime"}});t.call(n.prototype);n.prototype.init=function(){this._scroller=new s(this,null,{scrollContainerId:this.getId()});this._innerScroller=new s(this,this.getId()+"-FlexibleContainer",{scrollContainerId:this.getId()+"-Flexible"})};n.prototype.getScrollDelegate=function(){return this._innerScroller};n.prototype._handlerResizeNoFlexBoxSupport=function(){var e=this.$(),i,t;if(!e.is(":visible")){return}i=this.$("Fixed");t=this.$("Flexible");i.removeAttr("style");t.removeAttr("style");if(this.getVertical()){if(this.getFixContentSize()!=="auto"){i.height(this.getFixContentSize())}t.height(Math.floor(e.height()-i.height()))}else{if(this.getFixContentSize()!=="auto"){i.width(this.getFixContentSize());t.width(Math.floor(e.width()-i.width()))}else{t.width(Math.floor(e.width()-i.width()));i.width(Math.floor(i.width()))}}};n.prototype._deregisterControl=function(){if(this.sResizeListenerNoFlexBoxSupportId){r.deregister(this.sResizeListenerNoFlexBoxSupportId);this.sResizeListenerNoFlexBoxSupportId=null}if(this.sResizeListenerNoFlexBoxSupportFixedId){r.deregister(this.sResizeListenerNoFlexBoxSupportFixedId);this.sResizeListenerNoFlexBoxSupportFixedId=null}if(this.sResizeListenerFixFlexScroll){r.deregister(this.sResizeListenerFixFlexScroll);this.sResizeListenerFixFlexScroll=null}if(this.sResizeListenerFixFlexScrollFlexPart){r.deregister(this.sResizeListenerFixFlexScrollFlexPart);this.sResizeListenerFixFlexScrollFlexPart=null}if(this.sResizeListenerFixFlexContainerScroll){r.deregister(this.sResizeListenerFixFlexContainerScroll);this.sResizeListenerFixFlexContainerScroll=null}};n.prototype._changeScrolling=function(){var e,i,t=this.$(),r=this.getMinFlexSize(),l=this.getVertical();if(l){e=this.$().height()-this.$("Fixed").height();i="height"}else{e=this.$().width()-this.$("Fixed").width();i="width"}if(e<=parseInt(this.getMinFlexSize(),10)){t.addClass("sapUiFixFlexScrolling");t.removeClass("sapUiFixFlexInnerScrolling");if(l){this._scroller.setVertical(true);this._innerScroller.setVertical(false)}else{this._scroller.setHorizontal(true);this._innerScroller.setHorizontal(false)}if(this.$("FlexibleContainer").children().height()>r){this.$("Flexible").attr("style","min-"+i+":"+r+"px")}else{this.$("Flexible").attr("style",i+":"+r+"px")}}else{t.addClass("sapUiFixFlexInnerScrolling");t.removeClass("sapUiFixFlexScrolling");if(l){this._scroller.setVertical(false);this._innerScroller.setVertical(true)}else{this._scroller.setHorizontal(false);this._innerScroller.setHorizontal(true)}this._changeFlexibleContainerScroll();this.$("Flexible").removeAttr("style")}};n.prototype._changeFlexibleContainerScroll=function(){var e=this.$("FlexibleContainer"),i=e.height(),t=e.children().height();if(i==t){return}if(i>t){e.removeClass("sapUiFixFlexFlexibleContainerGrowing")}else{e.addClass("sapUiFixFlexFlexibleContainerGrowing")}};n.prototype.exit=function(){this._deregisterControl();if(this._scroller){this._scroller.destroy();this._scroller=null}if(this._innerScroller){this._innerScroller.destroy();this._innerScroller=null}};n.prototype.onBeforeRendering=function(){var e=this._scroller,i=this._innerScroller,t=this.getMinFlexSize()!=0;this._deregisterControl();e.setVertical(false);e.setHorizontal(false);i.setVertical(t);i.setHorizontal(t)};n.prototype.onAfterRendering=function(){if(!e.support.hasFlexBoxSupport){this.sResizeListenerNoFlexBoxSupportFixedId=r.register(this.getDomRef("Fixed"),e.proxy(this._handlerResizeNoFlexBoxSupport,this));this.sResizeListenerNoFlexBoxSupportId=r.register(this.getDomRef(),e.proxy(this._handlerResizeNoFlexBoxSupport,this));this._handlerResizeNoFlexBoxSupport()}if(this.getMinFlexSize()!==0){this.sResizeListenerFixFlexScroll=r.register(this.getDomRef(),e.proxy(this._changeScrolling,this));this.sResizeListenerFixFlexScrollFlexPart=r.register(this.getDomRef("Fixed"),e.proxy(this._changeScrolling,this));var i=this.$("FlexibleContainer").children()[0];if(i){this.sResizeListenerFixFlexContainerScroll=r.register(i,e.proxy(this._changeFlexibleContainerScroll,this))}this._changeScrolling()}};return n});