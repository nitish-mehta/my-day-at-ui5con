/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/ChangeHandlerMediator"],function(e,n){"use strict";var t={};var r="sap.ui.core.Title";var i="sap.m.Toolbar";var a="sap.m.Label";var o="sap.ui.comp.smartfield.SmartLabel";t.applyChange=function(t,l,d){var c=t.getDefinition();var f=t.getDependentControl("targetContainerHeader",d);var g=n.getChangeHandlerSettings({scenario:"addODataFieldWithLabel",oDataServiceVersion:c.content&&c.content.oDataServiceVersion});var v=g&&g.content&&g.content.createFunction;var p=function(e){var n=e.content;var t=false;if(n){t=e.content.newFieldSelector&&e.content.newFieldIndex!==undefined&&e.content.bindingPath&&e.content.oDataServiceVersion&&v}return n&&t};var s=d.modifier;if(p(c)){var h=c.content;var u=h.newFieldSelector;var b=h.bindingPath;var w=h.newFieldIndex;var C=s.getAggregation(l,"content");var S=C.slice();var m=C.indexOf(f);var I=0;var D=0;if(C.length===1||C.length===m+1){I=C.length}else{var F=0;for(F=m+1;F<C.length;F++){var x=s.getControlType(C[F]);if(x===a||x===o){if(D==w){I=F;break}D++}if(x===r||x===i){I=F;break}if(F===C.length-1){I=C.length}}}var P={appComponent:d.appComponent,view:d.view,fieldSelector:u,bindingPath:b};var V=v(s,P);S.splice(I,0,V.label,V.control);s.removeAllAggregation(l,"content");for(var H=0;H<S.length;++H){s.insertAggregation(l,"content",S[H],H,d.view)}return true}else{e.log.error("Change does not contain sufficient information to be applied or ChangeHandlerMediator could not be retrieved: ["+c.layer+"]"+c.namespace+"/"+c.fileName+"."+c.fileType)}};t.completeChangeContent=function(e,n,t){var r=t.appComponent;var i=t.view;var a=e.getDefinition();if(!a.content){a.content={}}if(n.parentId){var o=t.modifier.bySelector(n.parentId,r,i);var l=o.getTitle()||o.getToolbar();if(l){e.addDependentControl(l.getId(),"targetContainerHeader",t)}}else{throw new Error("oSpecificChangeInfo.parentId attribute required")}if(n.bindingPath){a.content.bindingPath=n.bindingPath}else{throw new Error("oSpecificChangeInfo.bindingPath attribute required")}if(n.newControlId){a.content.newFieldSelector=t.modifier.getSelector(n.newControlId,r)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(n.index===undefined){throw new Error("oSpecificChangeInfo.targetIndex attribute required")}else{a.content.newFieldIndex=n.index}if(n.oDataServiceVersion===undefined){throw new Error("oSpecificChangeInfo.oDataServiceVersion attribute required")}else{a.content.oDataServiceVersion=n.oDataServiceVersion}};return t},true);