/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/JsControlTreeModifier"],function(e){"use strict";var t={};var n=function(e,t){var n=t.getControlType(e);return n==="sap.ui.core.Title"||n==="sap.m.Title"||n==="sap.m.Toolbar"||n==="sap.m.OverflowToolbar"};var r=function(e,t){var r;for(r=0;r<e.length;++r){if(n(e[r],t)){return e[r]}}};t.applyChange=function(e,t,i){try{var o=i.modifier;var a=i.view;var l=i.appComponent;var s=e.getDefinition();var g=o.bySelector(s.content.elementSelector||s.content.sHideId,l,a);var f=o.getAggregation(t,"content");var m=-1;var u=this._getState(t,o);e.setRevertData(u);o.removeAllAggregation(t,"content");for(var c=0;c<f.length;++c){o.insertAggregation(t,"content",f[c],c,a)}if(s.changeType==="hideSimpleFormField"){f.some(function(e,t){if(e===g){m=t;o.setVisible(e,false)}if(m>=0&&t>m){if(o.getControlType(e)==="sap.m.Label"||o.getControlType(e)==="sap.ui.comp.smartfield.SmartLabel"||n(e,o)){return true}else{o.setVisible(e,false)}}})}else if(s.changeType==="removeSimpleFormGroup"){var v=r(f,o);var p=v&&!g;f.some(function(e,r){if(!v){o.setVisible(e,false)}else if(p){m=0;o.setVisible(e,false);p=false}else{if(e===g){m=r}if(m>=0&&r>m){if(n(e,o)){if(m===0){o.removeAggregation(t,"content",e,a);o.insertAggregation(t,"content",e,0,a)}return true}else{o.setVisible(e,false)}}}});if(g){o.removeAggregation(t,"content",g,a)}}return true}catch(t){e.resetRevertData();jQuery.sap.log.error(t.message||t.name)}};t._getStableElement=function(e){if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){return e.getTitle()||e.getToolbar()}else if(e.getMetadata().getName()==="sap.ui.layout.form.FormElement"){return e.getLabel()}else{return e}};t.completeChangeContent=function(t,n,r){var i=t.getDefinition();if(n.removedElement&&n.removedElement.id){var o=this._getStableElement(sap.ui.getCore().byId(n.removedElement.id));i.content.elementSelector=e.getSelector(o,r.appComponent);t.addDependentControl(o,"elementSelector",r)}else{throw new Error("oSpecificChangeInfo.removedElement.id attribute required")}};t._getState=function(e,t){var n=t.getAggregation(e,"content");return{content:n.map(function(e){return{element:e,visible:e.getVisible?e.getVisible():undefined,index:n.indexOf(e)}})}};t.revertChange=function(e,t,n){var r=e.getRevertData();t.removeAllContent();r.content.forEach(function(e){t.insertContent(e.element,e.index);if(e.element.setVisible){e.element.setVisible(e.visible)}});e.resetRevertData();return true};return t},true);