/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/ChangeHandlerMediator"],function(e,n){"use strict";var t={};t.applyChange=function(t,r,i){var o=t.getDefinition();var a=i.view;var d=o.content.newFieldIndex;var c=i.modifier;var l=t.getDependentControl("parentFormContainer",i);var f=n.getChangeHandlerSettings({scenario:"addODataFieldWithLabel",oDataServiceVersion:o.content&&o.content.oDataServiceVersion});var g=f&&f.content&&f.content.createFunction;var p=function(e){var n=e.content;var t=false;if(n){t=e.content.newFieldSelector&&e.content.newFieldIndex!==undefined&&e.content.bindingPath&&e.content.oDataServiceVersion&&g}return n&&t};if(p(o)){var u=o.content;var s=u.newFieldSelector;var v=jQuery.extend({},u.newFieldSelector);v.id=v.id+"-field";var h=u.bindingPath;var C={appComponent:i.appComponent,view:i.view,fieldSelector:v,bindingPath:h};var w=g(c,C),S=c.createControl("sap.ui.layout.form.FormElement",i.appComponent,a,s);c.insertAggregation(S,"label",w.label,0,a);c.insertAggregation(S,"fields",w.control,0,a);c.insertAggregation(l,"formElements",S,d,a);return true}else{e.log.error("Change does not contain sufficient information to be applied or ChangeHandlerMediator could not be retrieved: ["+o.layer+"]"+o.namespace+"/"+o.fileName+"."+o.fileType)}};t.completeChangeContent=function(e,n,t){var r=t.appComponent;var i=e.getDefinition();if(!i.content){i.content={}}if(n.parentId){e.addDependentControl(n.parentId,"parentFormContainer",t)}else{throw new Error("oSpecificChangeInfo.parentId attribute required")}if(n.bindingPath){i.content.bindingPath=n.bindingPath}else{throw new Error("oSpecificChangeInfo.bindingPath attribute required")}if(n.newControlId){i.content.newFieldSelector=t.modifier.getSelector(n.newControlId,r)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(n.index===undefined){throw new Error("oSpecificChangeInfo.targetIndex attribute required")}else{i.content.newFieldIndex=n.index}if(n.oDataServiceVersion===undefined){throw new Error("oSpecificChangeInfo.oDataServiceVersion attribute required")}else{i.content.oDataServiceVersion=n.oDataServiceVersion}};return t},true);