/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/JsControlTreeModifier"],function(e,n,t){"use strict";var r={};r.CONTENT_AGGREGATION="content";var o=function(e,n,t){for(var r=0;r<t.length;r++){var o=e.getControlType(t[r]);if(n.indexOf(o)===-1){if(e.getVisible(t[r])){return true}}else{return false}}};var i=function(e,n,t,r){var i;var a=-1;if(r===0){return r}if(o(e,n,t)){a++}for(var l=0;l<t.length;l++){var f=e.getControlType(t[l]);if(n.indexOf(f)>-1){a++;if(a===r){i=t[l];return t.indexOf(i)}}}return t.length};r.applyChange=function(n,t,o){var a=o.modifier;var l=o.view;var f=o.appComponent;var u=n.getDefinition();if(u.texts&&u.texts.groupLabel&&u.texts.groupLabel.value&&u.content&&u.content.group&&(u.content.group.selector||u.content.group.id)){var c=u.content.group.selector;var p;if(c){if(c.idIsLocal){p=f.createId(c.id)}else{p=c.id}}else{p=u.content.group.id}var g=u.texts.groupLabel.value;var s=a.getAggregation(t,r.CONTENT_AGGREGATION);var d;var v;if(typeof u.content.group.index==="number"){d=u.content.group.index}else{v=u.content.group.relativeIndex;d=i(a,["sap.ui.core.Title","sap.m.Title","sap.m.Toolbar","sap.m.OverflowToolbar"],s,v)}var C=a.createControl("sap.ui.core.Title",f,l,p);a.setProperty(C,"text",g);a.insertAggregation(t,"content",C,d,l)}else{e.log.error("Change does not contain sufficient information to be applied: ["+u.layer+"]"+u.namespace+"/"+u.fileName+"."+u.fileType)}return true};r.completeChangeContent=function(e,r,o){var i=e.getDefinition();var a=o.appComponent;if(r.newLabel){n.setTextInChange(i,"groupLabel",r.newLabel,"XFLD")}else{throw new Error("oSpecificChangeInfo.newLabel attribute required")}if(!i.content){i.content={}}if(!i.content.group){i.content.group={}}if(r.newControlId){i.content.group.selector=t.getSelector(r.newControlId,a)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(r.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required")}else{i.content.group.relativeIndex=r.index}};r.getControlIdFromChangeContent=function(e){var n;if(e&&e._oDefinition){n=e._oDefinition.content.group.id}return n};return r},true);