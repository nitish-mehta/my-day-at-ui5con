/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Splitter","./SplitterRenderer","jquery.sap.global"],function(e,t,i){"use strict";var s=e.extend("sap.ui.layout.AssociativeSplitter",{metadata:{associations:{associatedContentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"associatedContentArea"}}},renderer:t});s.prototype.init=function(){e.prototype.init.call(this);this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",1),decrease:this._onKeyboardResize.bind(this,"dec",1),increaseMore:this._onKeyboardResize.bind(this,"incMore",2),decreaseMore:this._onKeyboardResize.bind(this,"decMore",2),max:this._onKeyboardResize.bind(this,"max",1),min:this._onKeyboardResize.bind(this,"min",1)};this._enableKeyboardListeners()};s.prototype._enableKeyboardListeners=function(){e.prototype._enableKeyboardListeners.call(this);this.onsaprightmodifiers=this._keyListeners.increase;this.onsapleftmodifiers=this._keyListeners.decrease;this.onsapupmodifiers=this._keyListeners.decrease;this.onsapdownmodifiers=this._keyListeners.increase;this.onsapright=this._keyListeners.increaseMore;this.onsapdown=this._keyListeners.increaseMore;this.onsapleft=this._keyListeners.decreaseMore;this.onsapup=this._keyListeners.decreaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true};s.prototype.addAssociatedContentArea=function(e){this._needsInvalidation=true;a(e);return this.addAssociation("associatedContentAreas",e)};s.prototype.indexOfAssociatedContentArea=function(e){var t=this._getContentAreas();for(var i=0;i<t.length;i++){if(e==t[i]){return i}}return-1};s.prototype.insertAssociatedContentArea=function(e,t){var i=e.getId();this._needsInvalidation=true;a(e);var s=this.getAssociatedContentAreas();for(var n=0;n<s.length;n++){if(s[n]===i){s.splice(n,1)}}s.splice(t,0,i);this.setAssociation("associatedContentAreas",null);var r=this;s.forEach(function(e){r.addAssociation("associatedContentAreas",e)})};s.prototype.removeAssociatedContentArea=function(e){this.removeAssociation("associatedContentAreas",e)};s.prototype._getContentAreas=function(){var e=this.getAssociatedContentAreas()||[];var t=this.getContentAreas();var i=e.map(function(e){return sap.ui.getCore().byId(e)}).filter(function(e){return e});return t.concat(i)};s.prototype.onmousedown=function(e){if(this._ignoreMouse){return}if(i(e.target).hasClass("sapUiLoSplitterBarIcon")){e.target=e.target.parentElement}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!==0){return}this._ignoreTouch=true;this._onBarMoveStart(e);this._oLastDOMclicked=e.target};s.prototype.ondblclick=function(e){var t=this.getId(),i,s;if(!(e.target.contains(this._oLastDOMclicked)&&this._oLastDOMclicked.id.indexOf(t+"-splitbar")>-1)){return}i=parseInt(this._oLastDOMclicked.id.substr((t+"-splitbar-").length),10);s=this._getContentAreas()[i];s._currentPosition=this.getCalculatedSizes()[i];s._lastPosition=s._lastPosition||s._currentPosition;if(s._currentPosition===s._lastPosition){this._resizeContents(i,this.getCalculatedSizes()[i]*-1,true)}else{this._resizeContents(i,s._lastPosition,true);s._lastPosition=null}};s.prototype.ontouchstart=function(e){if(this._ignoreTouch){return}if(i(e.target).hasClass("sapUiLoSplitterBarIcon")){e.target=e.target.parentElement}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!==0){return}if(!e.changedTouches||!e.changedTouches[0]){return}this._ignoreMouse=true;this._onBarMoveStart(e.changedTouches[0],true)};s.prototype._onBarMoveStart=function(e,t){var s=this.getId();this.disableAutoResize(true);var a=e[this._moveCord];var r=parseInt(e.target.id.substr((s+"-splitbar-").length),10);var o=parseInt(e.target.parentElement.id.substr((s+"-splitbar-").length),10);var h=r+1?r:o;var l=i(e.target);if(l.attr("class")==="sapUiLoSplitterBarIcon"){l=l.parent()}var u=this.getCalculatedSizes();var c=this._bHorizontal?l.innerWidth():l.innerHeight();var d=this._getContentAreas();var p=d[h].getLayoutData();var g=d[h+1].getLayoutData();if(!p.getResizable()||!g.getResizable()){n(t);return}var v=0-c;for(var f=0;f<=h;++f){v+=u[f]+c}this._move={start:a,relStart:v,barNum:h,bar:i(e.target),c1Size:u[h],c1MinSize:p?parseInt(p.getMinSize(),10):0,c2Size:u[h+1],c2MinSize:g?parseInt(g.getMinSize(),10):0};if(t){document.addEventListener("touchend",this._boundBarMoveEnd);document.addEventListener("touchmove",this._boundBarMove)}else{document.addEventListener("mouseup",this._boundBarMoveEnd);document.addEventListener("mousemove",this._boundBarMove)}this._$SplitterOverlay.css("display","block");this._$SplitterOverlay.appendTo(this.getDomRef());this._$SplitterOverlayBar.css(this._sizeDirNot,"");this._move["bar"].css("visibility","hidden");this._onBarMove(e)};s.prototype._resizeContents=function(e,t,s){var a,n,r,o,h,l,u,c,d,p,g,v,f,_,y,z,m=parseFloat(this._move.c1Size).toFixed(5),S=parseFloat(this._move.c2Size).toFixed(5),b=parseFloat(m),L=parseFloat(S);if(isNaN(t)){i.sap.log.warning("Splitter: Received invalid resizing values - resize aborted.");return}a=this._getContentAreas();n=a[e].getLayoutData();r=a[e+1].getLayoutData();o=n.getSize();h=r.getSize();l=this.$("content-"+e);u=this.$("content-"+(e+1));c=b+t;d=L-t;p=parseInt(n.getMinSize(),10);g=parseInt(r.getMinSize(),10);v=this.getOrientation();f=v==="Horizontal"?this.$().width():this.$().height();if(c<p){z=p-c;t+=z;c=p;d-=z}else if(d<g){z=g-d;t-=z;d=g;c-=z}if(s){if(o==="auto"&&h!=="auto"){y=this._pxToPercent(d,f);r.setSize(y)}else if(o!=="auto"&&h==="auto"){_=this._pxToPercent(c,f);n.setSize(_)}else{_=this._pxToPercent(c,f);y=this._pxToPercent(d,f);n.setSize(_);r.setSize(y)}}else{_=this._pxToPercent(c,f);y=this._pxToPercent(d,f);l.css(this._sizeType,_);u.css(this._sizeType,y)}};s.prototype._pxToPercent=function(e,t){return e*100/t+"%"};s.prototype._recalculateSizes=function(){var e,t,s,a,n,r;var o=[];var h=this._getContentAreas();var l=this.getOrientation();var u=[];var c=[];var d=[];for(e=0;e<h.length;++e){s=h[e].getLayoutData();t=s?s.getSize():"auto";o.push(t)}var p=this._calculateAvailableContentSize(o)+1;this._calculatedSizes=[];for(e=0;e<o.length;++e){t=o[e];if(t.indexOf("px")>-1){r=parseInt(t,10);p-=r;this._calculatedSizes[e]=r}else if(t.indexOf("%")>-1){d.push(e)}else if(t==="auto"){s=h[e].getLayoutData();if(s&&parseInt(s.getMinSize(),10)!==0){c.push(e)}else{u.push(e)}}else{i.sap.log.error("Illegal size value: "+o[e])}}var g=false;if(p<0){g=true;p=0}var v=p;p=l==="Horizontal"?this.$().width():this.$().height();var f=d.length;for(e=0;e<f;++e){n=d[e];if(f===1&&h.length===1){a=p}else{a=parseFloat(o[n])/100*p}this._calculatedSizes[n]=a;v-=a}p=v;if(p<0){g=true;p=0}a=Math.floor(p/(c.length+u.length),0);var _=c.length;for(e=0;e<_;++e){n=c[e];var y=parseInt(h[n].getLayoutData().getMinSize(),10);if(y>a){this._calculatedSizes[n]=y;p-=y}else{this._calculatedSizes[n]=a;p-=a}}if(p<0){g=true;p=0}v=p;var z=u.length;a=Math.floor(p/z,0);for(e=0;e<z;++e){n=u[e];this._calculatedSizes[n]=a;v-=a}if(g){i.sap.log.info("[Splitter] The set sizes and minimal sizes of the splitter contents are bigger "+"than the available space in the UI.")}this._calculatedSizes=this._calculatedSizes};s.prototype._ensureAllSplittersCollapsed=function(e){var t=this._getContentAreas();var i=false;for(var s=0;s<t.length;s++){var a=t[s].getLayoutData().getSize().slice(0,-2);if(a==="0"||a==="au"){i=true;continue}else if(s===t.length-1&&i){this._getContentAreas()[e+1].setLayoutData(new sap.ui.layout.SplitterLayoutData({size:"100%"}))}}};function a(e){var t=e.getLayoutData();if(t&&(!t.getResizable||!t.getSize||!t.getMinSize)){i.sap.log.warning('Content "'+e.getId()+'" for the Splitter contained wrong LayoutData. '+"The LayoutData has been replaced with default values.");t=null}if(!t){e.setLayoutData(new sap.ui.layout.SplitterLayoutData)}}function n(e){var t=function(e){e.preventDefault()};var i=null;i=function(){document.removeEventListener("touchend",i);document.removeEventListener("touchmove",t);document.removeEventListener("mouseup",i);document.removeEventListener("mousemove",t)};if(e){this._ignoreMouse=true;document.addEventListener("touchend",i);document.addEventListener("touchmove",t)}else{document.addEventListener("mouseup",i);document.addEventListener("mousemove",t)}}return s});