/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/ManagedObject","sap/ui/base/BindingParser","sap/ui/core/Control","sap/ui/core/RenderManager","jquery.sap.sjax"],function(e,t,r,a,n){"use strict";var i=t.extend("sap.ui.core.tmpl.Template",{constructor:function(e,r){t.apply(this,arguments)},metadata:{stereotype:"template",abstract:true,library:"sap.ui.core",properties:{content:{type:"string",group:"Data",defaultValue:null}},publicMethods:["declareControl","createControl","placeAt","createMetadata","createRenderer"]}});var o={};i.prototype.register=function(){var t=this.getId(),r=o[t],a;if(r&&this!==r){a="adding template with duplicate id '"+t+"'";e.sap.log.error(a);throw new Error("Error: "+a)}o[t]=this};i.prototype.deregister=function(){delete o[this.getId()]};i.byId=function(e){return o[e]};i.prototype.getInterface=function(){return this};i._mSupportedTypes={};i.registerType=function(e,t){i._mSupportedTypes[e]=t};i.unregisterType=function(e){delete i._mSupportedTypes[e]};i.parsePath=function(e){var t,r=e.indexOf(">");if(r>0){t=e.substr(0,r);e=e.substr(r+1)}return{path:e,model:t}};i.prototype.init=function(e,n){if(this.getMetadata().getName()==="sap.ui.core.tmpl.Template"){throw new Error("The class 'sap.ui.core.tmpl.Template' is abstract and must not be instantiated!")}if(t.bindingParser===r.complexParser){i.prototype.extractBindingInfo=function(e,n,i){t.bindingParser=r.simpleParser;var o=a.prototype.extractBindingInfo.apply(this,arguments);t.bindingParser=r.complexParser;return o}}};i.prototype.declareControl=function(t){e.sap.assert(!!t,"A fully qualified name must be specified!");if(t){var r=this.createMetadata(),a=this.createRenderer(),n=this;var i=sap.ui.requireSync("sap/ui/core/tmpl/TemplateControl");i.extend(t,{metadata:r,init:function(){i.prototype.init.apply(this,arguments);this.setTemplate(n)},renderer:{renderTemplate:a,hasControlData:r._hasControlData}});return e.sap.getObject(t)}};i.prototype.createControl=function(e,t,r){var a=sap.ui.requireSync("sap/ui/core/tmpl/TemplateControl");var n=new a({id:e,template:this,context:t});n.setTemplateRenderer(this.createRenderer(r));return n};i.prototype.placeAt=function(t,r,i,o){if(typeof r==="string"||typeof r==="number"){i=r;r=undefined}var s;if(!(t instanceof a)&&o){var p=typeof t==="string"?e.sap.byId(t):e(t);if(p.length>0){s=p.attr("id");t=p.get(0);var l=p.attr("data-context");r=r||l&&e.parseJSON(l);n.markInlineTemplate(p)}}var c=this.createControl(s,r);c.placeAt(t,i);return c};i.prototype.createMetadata=function(){e.sap.log.error("The function createMetadata is an abstract function which needs to be implemented by subclasses.")};i.prototype.createRenderer=function(){e.sap.log.error("The function createRenderer is an abstract function which needs to be implemented by subclasses.")};sap.ui.template=function(t){if(!t){var r=[];e.each(i._mSupportedTypes,function(t,a){e("script[type='"+t+"'], [data-type='"+t+"']").each(function(e,n){r.push(sap.ui.template({id:n.id,domref:n,type:t,_class:a}))})});return r}else{if(typeof t==="string"){return sap.ui.template({id:t})}else if(t&&t.tagName&&t.nodeName&&t.ownerDocument&&t.nodeType===1){return sap.ui.template({id:t.id,domref:t})}t=e.extend({type:i.DEFAULT_TEMPLATE},t);var a,n,o,s,p=false,l=typeof t.src==="string",c=false;if(l){var u=e.sap.sjax({url:t.src,dataType:"text"});if(u.success){a=t.id;n=t.type;o=t.control;s=u.data;var d=/^<!--\sUI5:Template\stype=([a-z\/\-]*)\s(?:controller=([A-Za-z.]*)\s)?-->/,f=s.match(d);if(f){n=f[1];if(f.length==3){p=f[2]}s=s.substr(f[0].length)}}else{throw new Error("The template could not be loaded from "+t.src+"!")}}else{var m=t.domref||e.sap.domById(t.id),y=e(m);c=false;a=t.id||m&&m.id;n=y.attr("type")||t.type;o=y.attr("data-control")||t.control;if(a){var h=sap.ui.getCore().getTemplate(a);if(!h instanceof i){throw new Error('Object for id "'+a+'" is no sap.ui.core.tmpl.Template!')}else{if(h){return h}}}if(y.length===0){throw new Error('DOM element for the Template with the id "'+a+'" not found!')}s=y.html();var g=m.tagName.toLowerCase();if(g!=="script"){c=y.parents("body").length===1}}var T=t._class;if(!T){T=i._mSupportedTypes[n];if(!T){throw new Error('The type "'+n+'" is not supported.')}}e.sap.require(T);var b=e.sap.getObject(T);var v=new b({id:a,content:s});if(o){v.declareControl(o)}if(p){v._sControllerName=p}if(c){v.placeAt(a,t.context,undefined,true)}return v}};i.DEFAULT_TEMPLATE="text/x-handlebars-template";i.registerType(i.DEFAULT_TEMPLATE,"sap.ui.core.tmpl.HandlebarsTemplate");return i});