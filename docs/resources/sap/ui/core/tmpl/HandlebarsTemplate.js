/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Core","./Template","./TemplateControl","sap/ui/thirdparty/handlebars","sap/ui/base/ManagedObject"],function(e,t,a,r,n,o){"use strict";var i=a.extend("sap.ui.core.tmpl.HandlebarsTemplate",{constructor:function(e,t){a.apply(this,arguments)}});a.registerType("text/x-handlebars-template","sap.ui.core.tmpl.HandlebarsTemplate");function s(e){for(var t in e){e[t]=e[t].replace("&gt;",">").replace("&lt;","<").replace("&quot;",'"').replace("&amp;","&")}}function h(e,t){var a=/^((\w+)>)?(.*)/,r=a.exec(e),n=r[2],o=a.exec(t),i=o[2];var r=a.exec(e);if(t&&n==i){return t+r[3]}else{return e}}i.RENDER_HELPERS=function(){var t=n.helpers["each"],a=n.helpers["with"],r=n.helpers["if"],i=n.helpers["unless"],l=sap.ui.getCore().createRenderManager();l.renderControl=function(e){this.writeControlData(e);this.writeClasses(e);this.writeStyles(e)};var p={each:function(e,a){a=a||e;if(!a.hash.path){return t.apply(this,arguments)}else{s(a.hash);var r=a.data.renderManager,o=a.data.rootControl,i=a.data.path,l=a.data.parentControl,p=h(a.hash.path,i),g=o.bindList(p),f=[],d;if(a.data){d=n.createFrame(a.data)}if(g){for(var u in g){if(d){d.renderManager=r;d.rootControl=o;d.path=p+"/"+u+"/";d.parentControl=l}f.push(a.fn({},{data:d}))}}if(!l){return new n.SafeString(f.join(""))}}},with:function(e,t){t=t||e;if(!t.hash.path){return a.apply(this,arguments)}},if:function(e,t){t=t||e;if(!t.hash.path){return r.apply(this,arguments)}else{s(t.hash);var a=t.data.rootControl,n=t.data.path,o=h(t.hash.path,n);if(o){var i=a.bindProp(o);if(i){return t.fn(this)}else{return t.inverse(this)}}}},unless:function(e,t){t=t||e;if(!t.hash.path){return i.apply(this,arguments)}else{s(t.hash);var a=t.data.rootControl,r=t.data.path,n=h(t.hash.path,r);if(n){var o=a.bindProp(n);if(!o){return t.fn(this)}else{return t.inverse(this)}}}},text:function(t,a){a=a||t;s(a.hash);var r=a.data.rootControl,o=a.data.path,i=h(a.hash.path,o);if(i){var l=r.bindProp(i);return l&&new n.SafeString(e.sap.encodeHTML(l))}else{throw new Error('The expression "text" requires the option "path"!')}},element:function(e,t){t=t||e;s(t.hash);var a=t.data.renderManager,r=t.data.rootControl,o=r.createDOMElement(t.hash,t.data.path),i=t.data.parentElement;if(t.fn){t.fn({},{data:{renderManager:a,rootControl:r,parentElement:o}})}if(i){i.addElement(o);return}return new n.SafeString(a.getHTML(o))},control:function(t,a){a=a||t;s(a.hash);var r=a.data.renderManager,i=a.data.control;if(i){return new n.SafeString(r.getHTML(i))}var h=a.data.rootControl,l=a.data.path,p=a.data.children,g=a.hash["sap-ui-type"],f=e.sap.getObject(g),d=f&&f.getMetadata(),u=a.hash["sap-ui-default-aggregation"]||d&&d.getDefaultAggregationName(),c=a.data.view;if(!f){throw new Error("Control of type "+g+" cannot be found.")}var v={};if(a.fn){a.fn({},{data:{rootControl:h,path:l,children:v,defaultAggregation:u,view:c}})}var m=e.extend({},a.hash),C;for(var w in m){if(w==="sap-ui-class"&&typeof m[w]==="string"){C=m["sap-ui-class"]&&m["sap-ui-class"].split(" ");delete m[w]}else if(v[w]){delete m[w]}}var M=h.createControl(m,a.data.path,!!p,c);if(C&&C.length>0){C.forEach(M.addStyleClass.bind(M))}if(!e.isEmptyObject(v)){m=a.hash;var y=d.getAllAggregations();for(var E in v){var S=v[E];for(var T=0,b=S.length;T<b;T++){var x=S[T],A=y[E],H=A&&A.multiple;if(typeof m[E]==="string"){var L=o.bindingParser(m[E],c&&c.getController());L.template=x;M.bindAggregation(E,L)}else{if(H){M.addAggregation(E,x)}else{M.setAggregation(E,x)}}}}}if(p){var E=a.hash["sap-ui-aggregation"]||a.data.defaultAggregation;p[E]=p[E]||[];p[E].push(M);return}return new n.SafeString(r.getHTML(M))},property:function(e,t){t=t||e;s(t.hash);var a=t.data.rootControl,r=a.getMetadata(),n=t.hash.name,o=r.getProperty(n)._sGetter;return a[o]()},aggregation:function(t,a){a=a||t;s(a.hash);if(a.data.children){var r=a.hash.name;if(a.fn){var o=e.extend({},a.data,{defaultAggregation:r});a.fn({},{data:o})}}else{var i=a.data.renderManager,h=a.data.rootControl,l=h.getMetadata(),r=a.hash.name,p=l.getAggregation(r)._sGetter,g=[];var f=h[p]();if(f){for(var d=0,u=f.length;d<u;d++){if(a.fn){g.push(a.fn({},{data:{renderManager:i,rootControl:h,control:f[d]}}))}else{g.push(i.getHTML(f[d]))}}}return new n.SafeString(g.join(""))}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;var a=t.data.rootControl;return new n.SafeString(l.getHTML(a))}};return p}();i.prototype.createMetadata=function(){var t=this.getContent(),a=this._fnTemplate=this._fnTemplate||n.compile(t);var o={},i=r.getMetadata().getAllSettings(),h=r.getMetadata().getAllPrivateAggregations();var l={property:function(t,a){a=a||t;s(a.hash);var r=a.hash.name;if(r&&r!=="id"&&!i[r]){o.properties=o.properties||{};o.properties[r]=e.extend({},{type:"string"},a.hash)}else{throw new Error('The property name "'+r+'" is reserved.')}},aggregation:function(t,a){a=a||t;s(a.hash);var r=a.hash.name;if(r&&!i[r]&&!h[r]){a.hash.multiple=a.hash.multiple=="true";o.aggregations=o.aggregations||{};o.aggregations[r]=e.extend({},a.hash)}else{throw new Error('The aggregation name "'+r+'" is reserved.')}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;o._hasControlData=true}};["each","if","unless","with"].forEach(function(e){l[e]=function(){}});a({},{helpers:l});return o};i.prototype.createRenderer=function(e){var t=this.getContent(),a=this._fnTemplate=this._fnTemplate||n.compile(t);var r=function(t,r){var n=a(r.getContext()||{},{data:{renderManager:t,rootControl:r,view:e},helpers:i.RENDER_HELPERS});t.write(n)};return r};return i});