/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/DeclarativeSupport","sap/ui/core/library","sap/ui/core/UIArea","./DOMElement","./Template","./TemplateControlRenderer"],function(t,e,n,i,r,o,a,p){"use strict";var s=e.extend("sap.ui.core.tmpl.TemplateControl",{metadata:{library:"sap.ui.core",properties:{context:{type:"object",group:"Data",defaultValue:null}},aggregations:{controls:{type:"sap.ui.core.Control",multiple:true,singularName:"control",visibility:"hidden"}},associations:{template:{type:"sap.ui.core.tmpl.Template",multiple:false}},events:{afterRendering:{},beforeRendering:{}}}});s.prototype.init=function(){this._aBindingInfos=[]};s.prototype.isInline=function(){var e=false,n=this.getParent();if(n instanceof r&&t(n.getRootNode()).attr("id")===this.getId()){e=true}return e};s.prototype.placeAt=function(t,n){var i=this.isInline();var r=this.$(),o=this.getUIArea();e.prototype.placeAt.apply(this,arguments);if(i&&r.length===1){r.remove();o.destroyContent()}};s.prototype.getTemplateRenderer=function(){return this.fnRenderer};s.prototype.setTemplateRenderer=function(t){this.fnRenderer=t;return this};s.prototype._cleanup=function(){this.destroyAggregation("controls");this._aBindingInfos.forEach(function(t){var e=t.binding;if(e){e.detachChange(t.changeHandler);e.destroy()}});this._aBindingInfos=[]};s.prototype._compile=function(){var t=sap.ui.getCore().byId(this.getTemplate()),e=t&&t.getDeclarativeSupport();if(e){var i=this;setTimeout(function(){n.compile(i.getDomRef())})}};s.prototype.exit=function(){this._cleanup()};s.prototype.onBeforeRendering=function(){this.fireBeforeRendering();this._cleanup()};s.prototype.onAfterRendering=function(){this.fireAfterRendering()};s.prototype.clone=function(){var t=e.prototype.clone.apply(this,arguments);t.fnRenderer=this.fnRenderer;return t};s.prototype.updateBindings=function(t,n){e.prototype.updateBindings.apply(this,arguments);if(this.getDomRef()){this.invalidate()}};s.prototype.bind=function(e,n){var i=a.parsePath(e),r=this.getModel(i.model),e=i.path,o=n?"bind"+t.sap.charToUpperCase(n):"bindProperty",p=r&&r[o](e),s={binding:p,path:i.path,model:i.model};if(p){s.changeHandler=function(){t.sap.log.debug("TemplateControl#"+this.getId()+": "+n+' binding changed for path "'+e+'"');this.invalidate()}.bind(this);p.attachChange(s.changeHandler)}this._aBindingInfos.push(s);return p};s.prototype.calculatePath=function(e,n){var i=this.getBindingContext(),r=i&&i.getPath();if(e&&r&&!t.sap.startsWith(e,"/")){if(!t.sap.endsWith(r,"/")){r+="/"}e=r+e}return e};s.prototype.bindProp=function(t){var e=this.bind(this.calculatePath(t),"property");return e&&e.getExternalValue()};s.prototype.bindList=function(t){var e=this.bind(this.calculatePath(t),"list"),n=e&&e.getModel(),t=e&&e.getPath();return e&&n.getProperty(t)};s.prototype.createDOMElement=function(t,e,n){var i=new o(t);if(e){i.bindObject(e)}if(!n){this.addAggregation("controls",i)}return i};s.prototype.createControl=function(e,i,r,o){var a={};t.each(e,function(e,n){a["data-"+t.sap.hyphen(e)]=n});var p=t("<div/>",a);var s=n._createControl(p.get(0),o);if(i){s.bindObject(i)}if(!r){this.addAggregation("controls",s)}return s};return s});