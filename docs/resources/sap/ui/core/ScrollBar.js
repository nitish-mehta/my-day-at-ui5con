/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","./Control","./library","./ScrollBarRenderer","jquery.sap.script","jquery.sap.trace"],function(t,e,o,i,r){"use strict";var s=i.ScrollBarAction;var l=o.extend("sap.ui.core.ScrollBar",{metadata:{library:"sap.ui.core",properties:{vertical:{type:"boolean",group:"Behavior",defaultValue:true},scrollPosition:{type:"int",group:"Behavior",defaultValue:null},size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},contentSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},steps:{type:"int",group:"Dimension",defaultValue:null}},events:{scroll:{parameters:{action:{type:"sap.ui.core.ScrollBarAction"},forward:{type:"boolean"},newScrollPos:{type:"int"},oldScrollPos:{type:"int"}}}}}});l.prototype.init=function(){this._$ScrollDomRef=null;this._iOldScrollPos=0;this._iOldStep=0;this._bScrollPosIsChecked=false;this._bRTL=sap.ui.getCore().getConfiguration().getRTL();this._bSuppressScroll=false;this._iMaxContentDivSize=1e6;if(t.sap.touchEventMode==="ON"){sap.ui.requireSync("sap/ui/thirdparty/zyngascroll");this._iLastTouchScrollerPosition=null;this._iTouchStepTreshold=24;this._bSkipTouchHandling=false;this._oTouchScroller=new window.Scroller(t.proxy(this._handleTouchScroll,this),{bouncing:false})}};l.prototype.onBeforeRendering=function(){this.$("sb").unbind("scroll",this.onscroll)};l.prototype.onAfterRendering=function(){this._iSteps=this.getSteps();var o=this.getContentSize();this._bStepMode=!o;var i=this.getSize();if(t.sap.endsWith(i,"px")){i=i.substr(0,i.length-2)}else{i=this.getVertical()?this.$().height():this.$().width()}var r=null;var s=this.$("ffsize");if(e.browser.firefox){r=s.outerHeight();if(r===0){r=window.getComputedStyle(t("body").get(0))["font-size"];if(t.sap.endsWith(r,"px")){r=r.substr(0,r.length-2)}r=parseInt(r,10)}}s.remove();if(e.browser.webkit){if(!document.width){r=Math.round(40/(window.outerWidth/t(document).width()))}else{r=Math.round(40/(document.width/t(document).width()))}}if(this.getVertical()){if(e.browser.firefox){this._iFactor=r}else if(e.browser.webkit){this._iFactor=r}else{this._iFactor=Math.floor(i*.125)}this._iFactorPage=e.browser.firefox?i-r:Math.floor(i*.875)}else{if(e.browser.firefox){this._iFactor=10;this._iFactorPage=Math.floor(i*.8)}else if(e.browser.webkit){this._iFactor=r;this._iFactorPage=Math.floor(i*.875)}else{this._iFactor=7;this._iFactorPage=i-14}}this._$ScrollDomRef=this.$("sb");if(this._bStepMode){if(this.getVertical()){var l=this._iSteps*this._iFactor;if(l>this._iMaxContentDivSize){this._iFactor=this._iFactor/(l/this._iMaxContentDivSize)}var h=this._$ScrollDomRef.height()+Math.ceil(this._iSteps*this._iFactor);this._$ScrollDomRef.find("div").height(h)}else{var h=this._$ScrollDomRef.width()+this._iSteps*this._iFactor;this._$ScrollDomRef.find("div").width(h)}}this.setCheckedScrollPosition(this.getScrollPosition()?this.getScrollPosition():0,true);this._$ScrollDomRef.bind("scroll",t.proxy(this.onscroll,this));if(t.sap.touchEventMode==="ON"){this._bSkipTouchHandling=true;var n={width:0,height:0};n[this.getVertical()?"height":"width"]=this._bStepMode?this.getSteps()*this._iTouchStepTreshold:parseInt(this.getContentSize(),10);this._oTouchScroller.setDimensions(0,0,n.width,n.height);var c=this._$ScrollDomRef.get(0);if(c){var a=c.getBoundingClientRect();this._oTouchScroller.setPosition(a.left+c.clientLeft,a.top+c.clientTop);this._bSkipTouchHandling=false}}};l.prototype.onmousewheel=function(e){if(this.$().is(":visible")){var o=e.originalEvent;var i=o.detail?o.detail:o.wheelDelta*-1/40;var r=i>0?true:false;if(t.sap.containsOrEquals(this._$ScrollDomRef[0],e.target)){this._doScroll(s.MouseWheel,r)}else{this._bMouseWheel=true;var l=null;if(this._bStepMode){l=i+this._iOldStep}else{l=i*this._iFactor+this._iOldScrollPos}this.setCheckedScrollPosition(l,true)}e.preventDefault();e.stopPropagation();return false}};l.prototype.ontouchstart=function(t){var e=t.touches;var o=e[0];if(o&&o.target&&o.target.tagName.match(/input|textarea|select/i)){return}if(this._oTouchScroller){this._oTouchScroller.doTouchStart(e,t.timeStamp)}if(e.length==1){t.preventDefault()}};l.prototype.ontouchmove=function(t){if(this._oTouchScroller){this._oTouchScroller.doTouchMove(t.touches,t.timeStamp,t.scale)}};l.prototype.ontouchend=function(t){if(this._oTouchScroller){this._oTouchScroller.doTouchEnd(t.timeStamp)}};l.prototype.ontouchcancel=function(t){if(this._oTouchScroller){this._oTouchScroller.doTouchEnd(t.timeStamp)}};l.prototype.onscroll=function(t){if(this._bSuppressScroll){this._bSuppressScroll=false;t.preventDefault();t.stopPropagation();return false}var o=null;if(this._$ScrollDomRef){if(this.getVertical()){o=Math.round(this._$ScrollDomRef.scrollTop())}else{o=Math.round(this._$ScrollDomRef.scrollLeft());if(e.browser.firefox&&this._bRTL){o=Math.abs(o)}else if(e.browser.webkit&&this._bRTL){var i=this._$ScrollDomRef.get(0);o=i.scrollWidth-i.clientWidth-i.scrollLeft}}}var r=o-this._iOldScrollPos;var l=r>0?true:false;if(r<0){r=r*-1}var h=s.Drag;if(r==this._iFactor){h=s.Step}else if(r==this._iFactorPage){h=s.Page}else if(this._bMouseWheel){h=s.MouseWheel}if(this._bLargeDataScrolling&&h===s.Drag){this._eAction=h;this._bForward=l;if(e.browser.msie){if(this._scrollTimeout){window.clearTimeout(this._scrollTimeout)}this._scrollTimeout=window.setTimeout(this._onScrollTimeout.bind(this),300)}}else{this._doScroll(h,l)}t.preventDefault();t.stopPropagation();return false};l.prototype._onScrollTimeout=function(){this._scrollTimeout=undefined;this._doScroll(this._eAction,this._bForward);this._eAction=undefined;this._bForward=undefined;this._bTouchScroll=undefined};l.prototype.onmouseup=function(){if(this._bLargeDataScrolling&&(this._eAction||this._bForward||this._bTouchScroll)&&!e.browser.msie){this._doScroll(this._eAction,this._bForward);this._eAction=undefined;this._bForward=undefined;this._bTouchScroll=undefined}};l.prototype.ontouchend=l.prototype.onmouseup;l.prototype._handleTouchScroll=function(t,e,o){if(this._bSkipTouchHandling){return}var i=this.getVertical()?e:t;var r;if(this._bStepMode){r=Math.max(Math.round(i/this._iTouchStepTreshold),0)}else{r=Math.round(i)}if(this._iLastTouchScrollerPosition!==r){this._iLastTouchScrollerPosition=r;this.setCheckedScrollPosition(r,true);if(this._bLargeDataScrolling){this._bTouchScroll=true}else{this.fireScroll()}}};l.prototype.unbind=function(o){if(o){this._$OwnerDomRef=t(o);if(this.getVertical()){this._$OwnerDomRef.unbind(e.browser.firefox?"DOMMouseScroll":"mousewheel",this.onmousewheel)}if(t.sap.touchEventMode==="ON"){this._$OwnerDomRef.unbind(this._getTouchEventType("touchstart"),t.proxy(this.ontouchstart,this));this._$OwnerDomRef.unbind(this._getTouchEventType("touchmove"),t.proxy(this.ontouchmove,this));this._$OwnerDomRef.unbind(this._getTouchEventType("touchend"),t.proxy(this.ontouchend,this));this._$OwnerDomRef.unbind(this._getTouchEventType("touchcancel"),t.proxy(this.ontouchcancel,this))}}};l.prototype.bind=function(o){if(o){this._$OwnerDomRef=t(o);if(this.getVertical()){this._$OwnerDomRef.bind(e.browser.firefox?"DOMMouseScroll":"mousewheel",t.proxy(this.onmousewheel,this))}if(t.sap.touchEventMode==="ON"){this._$OwnerDomRef.bind(this._getTouchEventType("touchstart"),t.proxy(this.ontouchstart,this));this._$OwnerDomRef.bind(this._getTouchEventType("touchmove"),t.proxy(this.ontouchmove,this));this._$OwnerDomRef.bind(this._getTouchEventType("touchend"),t.proxy(this.ontouchend,this));this._$OwnerDomRef.bind(this._getTouchEventType("touchcancel"),t.proxy(this.ontouchcancel,this))}}};l.prototype._getTouchEventType=function(e){return t.sap.touchEventMode==="SIM"?"sap"+e:e};l.prototype.pageUp=function(){this._doScroll(s.Page,false)};l.prototype.pageDown=function(){this._doScroll(s.Page,true)};l.prototype.setScrollPosition=function(t){if(this._$ScrollDomRef){this.setCheckedScrollPosition(t,true)}else{this.setProperty("scrollPosition",t)}return this};l.prototype.setCheckedScrollPosition=function(o,i){var r=Math.max(o,0);if(this._bStepMode===undefined){this._bStepMode=!this.getContentSize()}var s=r;if(this._bStepMode){r=Math.min(r,this.getSteps());s=r*this._iFactor}r=Math.round(r);this._bSuppressScroll=!i;this.setProperty("scrollPosition",r,true);if(this.getVertical()){this._$ScrollDomRef.scrollTop(s)}else{if(e.browser.firefox&&this._bRTL){this._$ScrollDomRef.scrollLeft(-s)}else if(e.browser.webkit&&this._bRTL){var l=this._$ScrollDomRef.get(0);this._$ScrollDomRef.scrollLeft(l.scrollWidth-l.clientWidth-s)}else{this._$ScrollDomRef.scrollLeft(s)}}if(t.sap.touchEventMode==="ON"){var h=r;if(this._bStepMode){h=Math.round(r*this._iTouchStepTreshold)}this._oTouchScroller.__scrollTop=this.getVertical()?h:0;this._oTouchScroller.__scrollLeft=this.getVertical()?0:h}};l.prototype.setContentSize=function(t){this.setProperty("contentSize",t,true);this._bStepMode=false;var e=this.$("sbcnt");if(e){if(this.getVertical()){e.height(t)}else{e.width(t)}}return this};l.prototype._doScroll=function(o,i){var r=null;if(this._$ScrollDomRef){if(this.getVertical()){r=Math.round(this._$ScrollDomRef.scrollTop())}else{r=Math.round(this._$ScrollDomRef.scrollLeft());if(e.browser.firefox&&this._bRTL){r=Math.abs(r)}else if(e.browser.webkit&&this._bRTL){var s=this._$ScrollDomRef.get(0);r=s.scrollWidth-s.clientWidth-s.scrollLeft}}}if(this._bStepMode){var l=Math.round(r/this._iFactor);var h=this._iOldStep;if(h!==l){this.setCheckedScrollPosition(l,false);t.sap.log.debug("-----STEPMODE-----: New Step: "+l+" --- Old Step: "+h+" --- Scroll Pos in px: "+r+" --- Action: "+o+" --- Direction is forward: "+i);this.fireScroll({action:o,forward:i,newScrollPos:l,oldScrollPos:h});this._iOldStep=l}}else{r=Math.round(r);this.setProperty("scrollPosition",r,true);t.sap.log.debug("-----PIXELMODE-----: New ScrollPos: "+r+" --- Old ScrollPos: "+this._iOldScrollPos+" --- Action: "+o+" --- Direction is forward: "+i);this.fireScroll({action:o,forward:i,newScrollPos:r,oldScrollPos:this._iOldScrollPos})}if(Math.round(this._iFactor)==this._iFactor||!e.browser.msie){this._bSuppressScroll=false}this._iOldScrollPos=r;this._bMouseWheel=false;t.sap.interaction.notifyScrollEvent({type:o})};l.prototype.onThemeChanged=function(){this.rerender()};l.prototype.getNativeScrollPosition=function(){if(this._$ScrollDomRef){if(this.getVertical()){return Math.round(this._$ScrollDomRef.scrollTop())}else{return Math.round(this._$ScrollDomRef.scrollLeft())}}return 0};l.prototype.setNativeScrollPosition=function(t){var e=Math.round(t);if(this._$ScrollDomRef){if(this.getVertical()){this._$ScrollDomRef.scrollTop(e)}else{this._$ScrollDomRef.scrollLeft(e)}}};return l});