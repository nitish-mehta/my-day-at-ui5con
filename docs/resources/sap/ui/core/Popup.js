/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/base/Object","sap/ui/base/ObjectPool","./Control","./IntervalTrigger","./RenderManager","./Element","./ResizeHandler","./library","jquery.sap.script","jquery.sap.dom"],function(t,e,i,o,s,n,a,r,l,p,u){"use strict";var f=u.CSSSize;var h=u.OpenState;var d=i.extend("sap.ui.core.Popup",{constructor:function(e,o,s,n){t.sap.assert(arguments.length==0||e&&typeof e==="object","oContent must be an object or there may be no arguments at all");t.sap.assert(o===undefined||o===true||o===false,"bModal must be true, false, or undefined");t.sap.assert(s===undefined||s===true||s===false,"bShadow must be true, false, or undefined");t.sap.assert(n===undefined||n===true||n===false,"bAutoClose must be true, false, or undefined");i.apply(this);this._popupUID=t.sap.uid();this.bOpen=false;this.eOpenState=h.CLOSED;this._mEvents={};this._mEvents["sap.ui.core.Popup.addFocusableContent-"+this._popupUID]=this._addFocusableArea;this._mEvents["sap.ui.core.Popup.removeFocusableContent-"+this._popupUID]=this._removeFocusableArea;this._mEvents["sap.ui.core.Popup.closePopup-"+this._popupUID]=this._closePopup;this._mEvents["sap.ui.core.Popup.onFocusEvent-"+this._popupUID]=this.onFocusEvent;this._mEvents["sap.ui.core.Popup.increaseZIndex-"+this._popupUID]=this._increaseMyZIndex;this._mEvents["sap.ui.core.Popup.contains-"+this._popupUID]=this._containsEventBusWrapper;if(e){this.setContent(e)}this._oDefaultPosition={my:d.Dock.CenterCenter,at:d.Dock.CenterCenter,of:document,offset:"0 0",collision:"flip"};this._oPosition=t.extend({},this._oDefaultPosition);this._bModal=!!o;this._oPreviousFocus=null;this._sInitialFocusId=null;this._bShadow=typeof s==="boolean"?s:true;this._bAutoClose=!!n;this._animations={open:null,close:null};this._durations={open:"fast",close:"fast"};this._iZIndex=-1;this._oBlindLayer=null;this.setNavigationMode();if(this.touchEnabled){this._fAutoCloseHandler=function(t){if(t.isMarked("delayedMouseEvent")||t.isMarked("cancelAutoClose")){return}if(this.eOpenState===h.CLOSING||this.eOpenState===h.CLOSED){return}if(!this._contains(t.target)){this.close()}}}this._F6NavigationHandler=function(e){var i={},o=this._sF6NavMode,s;if(o=="DOCK"){if(this._bModal){o="NONE"}else if(this._oLastPosition&&this._oLastPosition.of){s=this._getOfDom(this._oLastPosition.of);if(!s||s===document){s=null;o="NONE"}}}switch(o){case"SCOPE":i.scope=this._$()[0];break;case"DOCK":i.target=s;var n=t(s).parents("[data-sap-ui-popup]");i.scope=n.length?n[0]:null;break;default:i.skip=true}t.sap.handleF6GroupNavigation(e,i)}},metadata:{library:"sap.ui.core",publicMethods:["open","close","setContent","getContent","setPosition","setShadow","setModal","getModal","setAutoClose","setAutoCloseAreas","isOpen","getAutoClose","getOpenState","setAnimations","setDurations","attachOpened","attachClosed","detachOpened","detachClosed"],associations:{childPopups:{type:"sap.ui.core.Popup",multiple:true,visibility:"hidden"}},events:{opened:{},closed:{}}}});d._activateBlindLayer=true;d.blStack=[];d.Dock={BeginTop:"begin top",BeginCenter:"begin center",BeginBottom:"begin bottom",LeftTop:"left top",LeftCenter:"left center",LeftBottom:"left bottom",CenterTop:"center top",CenterCenter:"center center",CenterBottom:"center bottom",RightTop:"right top",RightCenter:"right center",RightBottom:"right bottom",EndTop:"end top",EndCenter:"end center",EndBottom:"end bottom"};d.prototype.touchEnabled=e.support.touch||t.sap.simulateMobileOnDesktop;d.prototype.preventBrowserFocus=(e.support.touch||t.sap.simulateMobileOnDesktop)&&!e.system.combi;o.extend("sap.ui.core.Popup.Layer",{constructor:function(){var e=this.getDomString();this._$Ref=t(e).appendTo(sap.ui.getCore().getStaticAreaRef())}});d.Layer.prototype.init=function(t,e){this._$Ref.css({visibility:"visible","z-index":e});this.update(t,e);this._$Ref.insertAfter(t).show()};d.Layer.prototype.update=function(t,e){if(t.length){var i=t.rect();this._$Ref.css({left:i.left,top:i.top});if(t.css("right")!="auto"&&t.css("right")!="inherit"){this._$Ref.css({right:t.css("right"),width:"auto"})}else{this._$Ref.css({width:i.width,right:"auto"})}if(t.css("bottom")!="auto"&&t.css("bottom")!="inherit"){this._$Ref.css({bottom:t.css("bottom"),height:"auto"})}else{this._$Ref.css({height:i.height,bottom:"auto"})}if(typeof e==="number"){this._$Ref.css("z-index",e)}}};d.Layer.prototype.reset=function(){if(this._$Ref.length){this._$Ref[0].style.display="none";this._$Ref[0].style.visibility="hidden";this._$Ref.appendTo(sap.ui.getCore().getStaticAreaRef())}};d.Layer.prototype.getDomString=function(){t.sap.log.error("sap.ui.core.Popup.Layer: getDomString function must be overwritten!");return""};d.Layer.extend("sap.ui.core.Popup.BlindLayer",{constructor:function(){d.Layer.apply(this)}});d.BlindLayer.prototype.getDomString=function(){return'<div class="sapUiBliLy" id="sap-ui-blindlayer-'+t.sap.uid()+'"><iframe scrolling="no" tabIndex="-1"></iframe></div>'};d.prototype.oBlindLayerPool=new s(d.BlindLayer);d.Layer.extend("sap.ui.core.Popup.ShieldLayer",{constructor:function(){d.Layer.apply(this)}});d.ShieldLayer.prototype.getDomString=function(){return'<div class="sapUiPopupShield" id="sap-ui-shieldlayer-'+t.sap.uid()+'"></div>'};d.prototype.oShieldLayerPool=new s(d.ShieldLayer);(function(){var t=0;var e=Math.pow(2,32)-1;d.setInitialZIndex=function(i){if(i>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}t=Math.max(i,this.getLastZIndex())};d.getLastZIndex=function(){return t};d.prototype.getLastZIndex=function(){return d.getLastZIndex()};d.getNextZIndex=function(){t+=10;if(t>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}return t};d.prototype.getNextZIndex=function(){return d.getNextZIndex()}})();var c=function(t,e){var i=3;var o=Math.abs(t.left-e.left);var s=Math.abs(t.top-e.top);var n=Math.abs(t.width-e.width);var a=Math.abs(t.height-e.height);if(o>i||s>i||n>i||a>i){return false}return true};d.prototype.open=function(e,i,o,s,a,r,p){t.sap.assert(this.oContent,"Popup content must have been set by now");if(this.eOpenState!=h.CLOSED){return}this.eOpenState=h.OPENING;var u;try{u=sap.ui.getCore().getStaticAreaRef();u=sap.ui.getCore().getUIArea(u)}catch(e){t.sap.log.error(e);throw new Error("Popup cannot be opened because static UIArea cannot be determined.")}this._bContentAddedToStatic=false;if(this.oContent instanceof n&&!this.oContent.getParent()){u.addContent(this.oContent,true);this._bContentAddedToStatic=true}if(this.oContent.getUIArea){var f=this.oContent.getUIArea();if(f===null){t.sap.log.warning("The Popup content is NOT connected with a UIArea and may not work properly!")}else if(d._bEnableUIAreaCheck&&f.getRootNode().id!==u.getRootNode().id){t.sap.log.warning("The Popup content is NOT connected with the static-UIArea and may not work properly!")}}if(typeof e=="string"){p=r;r=a;a=s;s=o;o=i;i=e;e=-1}if(e===undefined){e=-1}t.sap.assert(e===-1||typeof e==="number"&&e%1==0,"iDuration must be an integer (or omitted)");t.sap.assert(i===undefined||typeof i==="string","my must be a string or empty");t.sap.assert(o===undefined||typeof o==="string","at must be a string or empty");t.sap.assert(!s||typeof s==="object"||typeof s==="function","of must be empty or an object");t.sap.assert(!a||typeof a==="string","offset must be empty or a string");t.sap.assert(!r||typeof r==="string","collision must be empty or a string");this._oPreviousFocus=d.getCurrentFocusInfo();if(this.isInPopup(s)||this.isInPopup(this._oPosition.of)){var c=this.getParentPopupId(s)||this.getParentPopupId(this._oPosition.of);var _="";var g=this.getContent();if(g instanceof l){_=g.getId()}else if(typeof g==="object"){_=g.id}this.addChildToPopup(c,_);this.addChildToPopup(c,this._popupUID)}var y=this._$(true);var v="fast";if(e===0||e>0){v=e}else if(this._durations.open===0||this._durations.open>0){v=this._durations.open}var m;if(i||o||s||a||r){m=this._createPosition(i,o,s,a,r);this._oPosition=m}else{m=this._oPosition}if(!m.of){m.of=this._oPosition.of||document}this._iZIndex=this._iZIndex===this.getLastZIndex()?this._iZIndex:this.getNextZIndex();var b=sap.ui.getCore().getStaticAreaRef();y.css({position:"absolute",visibility:"hidden"});if(!(y[0].parentNode==b)){y.appendTo(b)}y.css("z-index",this._iZIndex);t.sap.log.debug("position popup content "+y.attr("id")+" at "+(window.JSON?JSON.stringify(m.at):String(m.at)));this._applyPosition(m);if(p!==undefined){this.setFollowOf(p)}y.toggleClass("sapUiShd",this._bShadow);var C=y[0];if(C){C.style.display="none";C.style.visibility="visible"}this._duringOpen();if(v==0){this._opened()}else if(this._animations.open){this._animations.open.call(null,y,v,this._opened.bind(this))}else{y.fadeIn(v,this._opened.bind(this))}};d.prototype._opened=function(){if(this.eOpenState!==h.OPENING){return}this.bOpen=true;var e=this._$(false,true);if(e[0]&&e[0].style){e[0].style.display="block"}if(this._bModal||this._bAutoClose||this._sInitialFocusId){var i=null;if(this._sInitialFocusId){var o=sap.ui.getCore().byId(this._sInitialFocusId);if(o){i=o.getFocusDomRef()}i=i||t.sap.domById(this._sInitialFocusId)}t.sap.focus(i||e.firstFocusableDomRef());var s=this._getOfDom(this._oLastPosition.of);var n=t(s).rect();if(this._oLastOfRect&&n&&!c(this._oLastOfRect,n)){this._applyPosition(this._oLastPosition)}}this.eOpenState=h.OPEN;if(this.getFollowOf()){d.DockTrigger.addListener(d.checkDocking,this)}this._updateBlindLayer();this.fireOpened()};d.prototype._duringOpen=function(){var i=this._$(false,true);if(t.sap.isMouseEventDelayed){if(this._oTopShieldLayer){t.sap.clearDelayedCall(this._iTopShieldRemoveTimer);this._iTopShieldRemoveTimer=null}else{this._oTopShieldLayer=this.oShieldLayerPool.borrowObject(i,this._iZIndex+1)}this._iTopShieldRemoveTimer=t.sap.delayedCall(500,this,function(){this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null})}if(!!e.browser.msie&&!e.os.windows_phone&&d._activateBlindLayer){this._oBlindLayer=this.oBlindLayerPool.borrowObject(i,this._iZIndex-1)}if(this._bModal){this._showBlockLayer()}if(this.oContent instanceof l){this.oContent.addDelegate(this)}this.bOpen=true;this._activateFocusHandle();this._$(false,true).on("keydown",t.proxy(this._F6NavigationHandler,this));if(this._oBlindLayer){this._resizeListenerId=p.register(this._$().get(0),t.proxy(this.onresize,this))}};d.prototype._contains=function(e){var i=this._$().get(0);if(!i){return false}var o=t.sap.containsOrEquals(i,e);var s;if(!o){s=this.getChildPopups();o=s.some(function(i){var o=t.sap.domById(i);var s=t.sap.containsOrEquals(o,e);if(!s){var n="sap.ui.core.Popup.contains-"+i;var a={domRef:e};sap.ui.getCore().getEventBus().publish("sap.ui",n,a);s=a.contains}return s})}return o};d.prototype._containsEventBusWrapper=function(t,e,i){i.contains=this._contains(i.domRef)};d.prototype.onFocusEvent=function(i){var o=t.event.fix(i);if(arguments.length>1&&arguments[1]==="sap.ui.core.Popup.onFocusEvent-"+this._popupUID){o=t.event.fix(arguments[2])}var s=o.type=="focus"||o.type=="activate"?"focus":"blur";var n=false;if(s=="focus"){var a=this._$().get(0);if(a){n=this._contains(o.target);t.sap.log.debug("focus event on "+o.target.id+", contains: "+n);if(this._bModal&&!n){var r=d.blStack.length>0&&d.blStack[d.blStack.length-1].popup===this;if(r){if(e.system.desktop||t(o.target).is(":input")){if(this.oLastBlurredElement){t.sap.delayedCall(0,this,function(){t.sap.focus(this.oLastBlurredElement)})}else{t.sap.focus(a)}}}}else if(this._bAutoClose&&n&&this._sTimeoutId){t.sap.clearDelayedCall(this._sTimeoutId);this._sTimeoutId=null}}}else if(s=="blur"){t.sap.log.debug("blur event on "+o.target.id);if(this._bModal){this.oLastBlurredElement=o.target}else if(this._bAutoClose){if(!this.touchEnabled&&!this._sTimeoutId){if(o.target===document.activeElement){return}var l=typeof this._durations.close==="string"?0:this._durations.close;this._sTimeoutId=t.sap.delayedCall(l,this,function(){this.close(l,"autocloseBlur");var t=this._oLastPosition&&this._oLastPosition.of;if(t){var e=this.getParentPopupId(t);if(e){var i="sap.ui.core.Popup.onFocusEvent-"+e;sap.ui.getCore().getEventBus().publish("sap.ui",i,o)}}})}}}};d.prototype.setInitialFocusId=function(e){t.sap.assert(!e||typeof e==="string","sId must be a string or empty");this._sInitialFocusId=e};d.prototype.close=function(e){if(d._autoCloseDebug){return}if(this._sTimeoutId){t.sap.clearDelayedCall(this._sTimeoutId);this._sTimeoutId=null;if(arguments.length>1){var i=arguments[1];if(typeof i=="string"&&i=="autocloseBlur"&&this._isFocusInsidePopup()){return}}}t.sap.assert(e===undefined||typeof e==="number"&&e%1==0,"iDuration must be empty or an integer");if(this.eOpenState==h.CLOSED||this.eOpenState==h.CLOSING){return}var o="fast";if(e===0||e>0){o=e}else if(this._durations.close===0||this._durations.close>0){o=this._durations.close}this.eOpenState=h.CLOSING;if(this.getFollowOf()){d.DockTrigger.removeListener(d.checkDocking,this)}if(this.oContent&&this._bContentAddedToStatic){sap.ui.getCore().getEventBus().publish("sap.ui","__beforePopupClose",{domNode:this._$().get(0)});var s=sap.ui.getCore().getStaticAreaRef();s=sap.ui.getCore().getUIArea(s);s.removeContent(s.indexOfContent(this.oContent),true)}this._bContentAddedToStatic=false;this._sTimeoutId=null;this._deactivateFocusHandle();this._$(false,true).off("keydown",this._F6NavigationHandler);if(this.oContent instanceof l){this.oContent.removeDelegate(this)}var n=this._$();if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._oBlindLayer){this.oBlindLayerPool.returnObject(this._oBlindLayer)}this._oBlindLayer=null;if(t.sap.isMouseEventDelayed){if(this._oBottomShieldLayer){t.sap.clearDelayedCall(this._iBottomShieldRemoveTimer);this._iBottomShieldRemoveTimer=null}else{this._oBottomShieldLayer=this.oShieldLayerPool.borrowObject(n,this._iZIndex-3)}this._iBottomShieldRemoveTimer=t.sap.delayedCall(500,this,function(){this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null})}if(this.isInPopup(this._oLastPosition.of)){var a=this.getParentPopupId(this._oLastPosition.of);var r="";var p=this.getContent();if(p instanceof l){r=p.getId()}else if(typeof p==="object"){r=p.id}this.removeChildFromPopup(a,r);this.removeChildFromPopup(a,this._popupUID)}if(this._bModal&&this.preventBrowserFocus){n.one("mousedown",function(t){t.preventDefault()})}this._duringClose();if(o==0){this._closed()}else if(this._animations.close){this._animations.close.call(null,n,o,this._closed.bind(this))}else{n.fadeOut(o,this._closed.bind(this))}};d.prototype._closed=function(){if(this._bModal){this._hideBlockLayer()}var t=this._$(false,true);if(t.length){var e=t.get(0);if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}t=this._$(false,true);e=t.length?t[0]:null;if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}}if(this._bModal){d.applyFocusInfo(this._oPreviousFocus);this._oPreviousFocus=null;this.oLastBlurredElement=null}this.bOpen=false;this.eOpenState=h.CLOSED;var i=this.getChildPopups();for(var o=0,s=i.length;o<s;o++){this.closePopup(i[o])}this.fireClosed()};d.prototype._duringClose=function(){if(this._resizeListenerId){p.deregister(this._resizeListenerId);this._resizeListenerId=null}};d.getCurrentFocusInfo=function(){var t=null;var e=sap.ui.getCore().getCurrentFocusedControlId();if(e){var i=sap.ui.getCore().byId(e);t={sFocusId:e,oFocusInfo:i?i.getFocusInfo():{}}}else{try{var o=document.activeElement;if(o&&o.nodeName){t={sFocusId:o.id,oFocusedElement:o,oFocusInfo:{}}}}catch(e){t=null}}if(t){t.popup=this}return t};d.applyFocusInfo=function(e){if(e){var i=sap.ui.getCore().byId(e.sFocusId);if(i){i.applyFocusInfo(e.oFocusInfo)}else{var o=t.sap.domById(e.sFocusId)||e.oFocusedElement;t.sap.focus(o)}}};d.prototype.setContent=function(e){t.sap.assert(typeof e==="object","oContent must be an object");this.oContent=e;return this};d.prototype.getContent=function(){return this.oContent};d.prototype.setPosition=function(e,i,o,s,n){t.sap.assert(typeof e==="string","my must be a string");t.sap.assert(typeof i==="string"||typeof i==="object"&&typeof i.left==="number"&&typeof i.top==="number","my must be a string or an object with 'left' and 'top' properties");t.sap.assert(!o||typeof o==="object"||typeof o==="function","of must be empty or an object");t.sap.assert(!s||typeof s==="string","offset must be empty or a string");t.sap.assert(!n||typeof n==="string","collision must be empty or a string");this._oPosition=this._createPosition(e,i,o,s,n);if(this.eOpenState!=h.CLOSED){this._applyPosition(this._oPosition);this._oBlindLayer&&this._oBlindLayer.update(this._$())}return this};d.prototype._createPosition=function(e,i,o,s,n){var a=false;if(e&&(e.indexOf("+")>=0||e.indexOf("-")>=0)){a=true;if(s&&s!="0 0"){t.sap.log.warning("offset used in my and in offset, the offset value will be ignored","sap.ui.core.Popup","setPosition")}s=null}var r=t.extend({},this._oDefaultPosition,{my:e||this._oDefaultPosition.my,at:i||this._oDefaultPosition.at,of:o,offset:s,collision:n});if(!t.ui.version){if(d._bNewOffset==null){d._bNewOffset=true;var l=t(document.createElement("div"));l.position({of:window,using:function(t,e){d._bNewOffset=e!==undefined}})}}var p=[];var u=[];if(d._bNewOffset||t.sap.Version(t.ui.version).compareTo("1.8.23")>0){if(s&&s!="0 0"){p=r.my.split(" ");u=s.split(" ");var f=[parseInt(u[0],10)<0?"":"+",parseInt(u[1],10)<0?"":"+"];r.my=p[0]+f[0]+u[0]+" "+p[1]+f[1]+u[1];r.offset=null}}else if(a){p=r.my.split(" ");u=["",""];var h=p[0].indexOf("+");if(h<0){h=p[0].indexOf("-")}if(h>=0){u[0]=p[0].slice(h);p[0]=p[0].slice(0,h)}h=p[1].indexOf("+");if(h<0){h=p[1].indexOf("-")}if(h>=0){u[1]=p[1].slice(h);p[1]=p[1].slice(0,h)}r.my=p[0]+" "+p[1];r.offset=u[0]+" "+u[1]}return r};d.prototype._getPositionOffset=function(){var t=[];if(this._oPosition.my&&(this._oPosition.my.indexOf("+")>=0||this._oPosition.my.indexOf("-")>=0)){var e=this._oPosition.my.split(" ");var i=e[0].indexOf("+");if(i<0){i=e[0].indexOf("-")}if(i>=0){t[0]=e[0].slice(i)}i=e[1].indexOf("+");if(i<0){i=e[1].indexOf("-")}if(i>=0){t[1]=e[1].slice(i)}}else if(this._oPosition.offset){t=this._oPosition.offset.split(" ")}return t};d.prototype._applyPosition=function(t){var e=sap.ui.getCore().getConfiguration().getRTL();var i=this._$();if(i.length){var o=t.at;var s=i.get(0);if(typeof o==="string"){s.style.display="block";s.style.left="";s.style.right="";i.position(this._resolveReference(this._convertPositionRTL(t,e)));this._fixPositioning(t,e)}else if(f.isValid(o.left)&&f.isValid(o.top)){i.css({left:o.left,top:o.top})}else if(f.isValid(o.right)&&f.isValid(o.top)){i.css({right:o.right,top:o.top})}else if(typeof o.left==="number"&&typeof o.top==="number"){var n=i[0];if(n&&n.style.right){var a=i.outerWidth();i.css({right:document.documentElement.clientWidth-(o.left+a)+"px",top:o.top+"px"})}else{i.css({left:o.left+"px",top:o.top+"px"})}}this._oLastPosition=t;this._oLastOfRect=this._calcOfRect(t.of)}};d.prototype._calcOfRect=function(e){var i=this._getOfDom(e);if(i){return t(i).rect()}return null};d.prototype._getOfDom=function(e){if(e instanceof t.Event){return null}var i;if(typeof e==="string"){i=t.sap.byId(e)}else if(e instanceof t){i=e}else{i=t(e instanceof l?e.getDomRef():e)}return i[0]};d.prototype._convertPositionRTL=function(e,i){var o=t.extend({},e);if(i){var s=false;if(o.my&&(o.my.indexOf("+")>=0||o.my.indexOf("-")>=0)){s=true}if((o.offset||s)&&(o.my.indexOf("begin")>-1||o.my.indexOf("end")>-1)&&(o.at.indexOf("begin")>-1||o.at.indexOf("end")>-1)){if(s){var n=o.my.split(" ");if(n.length==2){o.my="";if(n[0]){if(n[0].indexOf("begin")>-1||n[0].indexOf("end")>-1){if(n[0].indexOf("+")>-1){n[0]=n[0].replace("+","-")}else if(n[0].indexOf("-")>-1){n[0]=n[0].replace("-","+")}}o.my=n[0]}if(n[1]){if(n[1].indexOf("begin")>-1||n[1].indexOf("end")>-1){if(n[1].indexOf("+")>-1){n[1]=n[1].replace("+","-")}else if(n[1].indexOf("-")>-1){n[1]=n[1].replace("-","+")}}if(n[0]){o.my=o.my+" "}o.my=o.my+n[1]}}}else{o.offset=this._mirrorOffset(o.offset)}}o.my=o.my.replace("begin","right").replace("end","left");o.at=o.at.replace("begin","right").replace("end","left")}else{o.my=o.my.replace("end","right").replace("begin","left");o.at=o.at.replace("end","right").replace("begin","left")}return o};d.prototype._mirrorOffset=function(e){var i=t.trim(e).split(/\s/);var o=parseInt(i[0],10);return-o+" "+i[i.length-1]};d.prototype._fixPositioning=function(e,i){var o=e.my;var s=this._$();var n=0;if(typeof o==="string"){if(i&&(o.indexOf("right")>-1||o.indexOf("begin")>-1||o.indexOf("center")>-1)){s=this._$();n=t(window).width()-s.outerWidth()-s.offset().left;s.css({right:n+"px",left:""})}else if(o.indexOf("right")>-1||o.indexOf("end")>-1){s=this._$();n=t(window).width()-s.outerWidth()-s.offset().left;s.css({right:n+"px",left:""})}}};d.prototype._resolveReference=function(e){var i=e;if(e.of instanceof l){i=t.extend({},e,{of:e.of.getDomRef()})}return i};d.prototype.setShadow=function(e){t.sap.assert(typeof e==="boolean","bShowShadow must be boolean");this._bShadow=e;if(this.eOpenState!=h.CLOSED){this._$().toggleClass("sapUiShd",e)}return this};d.prototype.setModal=function(e,i){t.sap.assert(typeof e==="boolean","bModal must be boolean");t.sap.assert(!i||typeof i==="string","sModalCSSClass must be empty or a string");var o=this._bModal;this._bModal=e;this._sModalCSSClass=i;if(this.isOpen()){if(o!==e){if(e){this._showBlockLayer()}else{this._hideBlockLayer()}if(this.touchEnabled&&this._bAutoClose){if(!e){t(document).on("touchstart mousedown",t.proxy(this._fAutoCloseHandler,this))}else{t(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}}return this};d.prototype.getModal=function(){return this._bModal};d.prototype.setNavigationMode=function(t){if(t!="NONE"&&t!="DOCK"&&t!="SCOPE"){this._sF6NavMode="NONE"}this._sF6NavMode=t};d.prototype.setAutoClose=function(e){t.sap.assert(typeof e==="boolean","bAutoClose must be boolean");if(this.touchEnabled&&this.isOpen()&&this._bAutoClose!==e){if(!this._bModal){if(e){t(document).on("touchstart mousedown",t.proxy(this._fAutoCloseHandler,this))}else{t(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}this._bAutoClose=e;return this};d.prototype.setAutoCloseAreas=function(i){t.sap.assert(Array.isArray(i),"aAutoCloseAreas must be an array which contains either sap.ui.core.Element, DOM Element or an ID");if(!this._aAutoCloseAreas){this._aAutoCloseAreas=[]}var o=function(i){return{onBeforeRendering:function(){var i=n.getDomRef();if(i&&this.isOpen()){if(e.browser.msie){t(i).unbind("deactivate."+this._popupUID,this.fEventHandler)}else{i.removeEventListener("blur",this.fEventHandler,true)}}},onAfterRendering:function(){var i=n.getDomRef();if(i&&this.isOpen()){if(e.browser.msie){t(i).bind("deactivate."+this._popupUID,this.fEventHandler)}else{i.addEventListener("blur",this.fEventHandler,true)}}}}};var s,n,a,r;for(var p=0,u=i.length;p<u;p++){n=i[p];if(n instanceof l){s=n.getId()}else if(typeof n==="object"){s=n.id}else if(typeof n==="string"){s=n}if(this.getChildPopups().indexOf(s)===-1){this.addChildPopup(s);r={id:s};if(n instanceof l){a=o(n);n.addEventDelegate(a,this);r.delegate=a}this._aAutoCloseAreas.push(r)}}return this};d.prototype.setAnimations=function(e,i){t.sap.assert(e===null||typeof e==="function","fnOpen must be a function");t.sap.assert(i===null||typeof i==="function","fnClose must be a function");if(e&&typeof e=="function"){this._animations.open=e}if(i&&typeof i=="function"){this._animations.close=i}return this};d.prototype.setDurations=function(e,i){t.sap.assert(e===null||typeof e==="number"&&e%1==0,"iOpenDuration must be null or an integer");t.sap.assert(!i||typeof i==="number"&&i%1==0,"iOpenDuration must be undefined or an integer");if(e>0||e===0){this._durations.open=e}if(i>0||i===0){this._durations.close=i}return this};d.CLOSE_ON_SCROLL="close_Popup_if_of_is_moved";d.prototype._fnCloseOnScroll=function(t){this.close()};d.prototype.setFollowOf=function(e){d.DockTrigger.removeListener(d.checkDocking,this);var i=false;this._bFollowOf=true;this._followOfHandler=null;if(typeof e==="function"){this._followOfHandler=e;i=true}else if(typeof e==="boolean"){i=e}else if(e===d.CLOSE_ON_SCROLL){this._followOfHandler=this._fnCloseOnScroll;i=true}else{this._bFollowOf=false;if(e!==null){t.sap.log.error("Trying to set an invalid type to 'followOf: "+e)}}if(i&&this._oLastPosition){this._oLastOfRect=this._calcOfRect(this._oLastPosition.of)}if(this._bFollowOf&&this.getOpenState()===h.OPEN){d.DockTrigger.addListener(d.checkDocking,this)}};d.prototype.getAutoClose=function(){return this._bAutoClose};d.prototype.getFollowOf=function(){if(this._bFollowOf){return typeof this._followOfHandler==="function"?this._followOfHandler:true}return false};d.prototype.isOpen=function(){return this.bOpen};d.prototype.getOpenState=function(){return this.eOpenState};d.prototype.destroy=function(){if(this._resizeListenerId){p.deregister(this._resizeListenerId);this._resizeListenerId=null}this.close(0);this.oContent=null;if(this._bFollowOf){this.setFollowOf(null)}if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._iTopShieldRemoveTimer){t.sap.clearDelayedCall(this._iTopShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}if(this._iBottomShieldRemoveTimer){t.sap.clearDelayedCall(this._iBottomShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}if(this._aAutoCloseAreas){var e;this._aAutoCloseAreas.forEach(function(i){if(i.delegate){e=t.sap.byId(i.id).control(0);if(e){e.removeEventDelegate(i.delegate)}}})}i.prototype.destroy.apply(this,arguments)};d.prototype.exit=function(){delete this._mEvents};d.prototype._addFocusEventListeners=function(i,o,s){if(!this.fEventHandler){this.fEventHandler=t.proxy(this.onFocusEvent,this)}var n=this._$();var a=this.getChildPopups();var r={};var l=0,p=0;if(n.length){if(document.addEventListener&&!e.browser.msie){document.addEventListener("focus",this.fEventHandler,true);n.get(0).addEventListener("blur",this.fEventHandler,true);for(l=0,p=a.length;l<p;l++){r=t.sap.domById(a[l]);if(r){r.addEventListener("blur",this.fEventHandler,true)}}}else{t(document).bind("activate."+this._popupUID,this.fEventHandler);n.bind("deactivate."+this._popupUID,this.fEventHandler);for(l=0,p=a.length;l<p;l++){r=t.sap.domById(a[l]);if(r){t(r).bind("deactivate."+this._popupUID,this.fEventHandler)}}}}};d.prototype._removeFocusEventListeners=function(i,o,s){var n=this._$(false,true);if(!n.length){return}var a=this.getChildPopups();var r={};var l=0,p=0;if(document.removeEventListener&&!e.browser.msie){document.removeEventListener("focus",this.fEventHandler,true);n.get(0).removeEventListener("blur",this.fEventHandler,true);for(l=0,p=a.length;l<p;l++){r=t.sap.domById(a[l]);if(r){r.removeEventListener("blur",this.fEventHandler,true)}this.closePopup(a[l])}}else{t(document).unbind("activate."+this._popupUID,this.fEventHandler);n.unbind("deactivate."+this._popupUID,this.fEventHandler);for(l=0,p=a.length;l<p;l++){r=t.sap.domById(a[l]);if(r){t(r).unbind("deactivate."+this._popupUID,this.fEventHandler)}}}this.fEventHandler=null};d.prototype._activateFocusHandle=function(){if(this._bModal||this._bAutoClose){this._addFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){t(document).on("touchstart mousedown",t.proxy(this._fAutoCloseHandler,this))}};d.prototype._deactivateFocusHandle=function(){if(this.fEventHandler){this._removeFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){t(document).off("touchstart mousedown",this._fAutoCloseHandler)}};d.prototype._registerEventBusEvents=function(e,i,o){var s=this;t.each(s._mEvents,function(t,e){sap.ui.getCore().getEventBus().subscribe("sap.ui",t,e,s)});this._bEventBusEventsRegistered=true};d.prototype._unregisterEventBusEvents=function(e,i,o){var s=this;t.each(s._mEvents,function(t,e){sap.ui.getCore().getEventBus().unsubscribe("sap.ui",t,e,s)});delete this._bEventBusEventsRegistered};d.prototype._addFocusableArea=function(t,e,i){if(this.getChildPopups().indexOf(i.id)===-1){this.addChildPopup(i.id)}};d.prototype._removeFocusableArea=function(t,e,i){this.removeChildPopup(i.id)};d.prototype._closePopup=function(t,e,i){this.close(typeof this._durations.close==="string"?0:this._durations.close)};d.prototype._setIdentity=function(e){if(typeof e==="object"){e.attr("data-sap-ui-popup",this._popupUID)}else{t.sap.log.warning("Incorrect DomRef-type for 'setIdentity': "+e,this);return}if(!this._bEventBusEventsRegistered){this._registerEventBusEvents()}};d.prototype._$=function(e,i){var o;if(this.oContent instanceof n){o=this.oContent.$();if(e||o.length===0&&!i){t.sap.log.info("Rendering of popup content: "+this.oContent.getId());if(o.length>0){r.preserveContent(o[0],true,false)}sap.ui.getCore().getRenderManager().render(this.oContent,sap.ui.getCore().getStaticAreaRef());o=this.oContent.$()}}else if(this.oContent instanceof l){o=this.oContent.$()}else{o=t(this.oContent)}this._setIdentity(o);return o};d.prototype._showBlockLayer=function(){var e=t("#sap-ui-blocklayer-popup"),i="sapUiBLy"+(this._sModalCSSClass?" "+this._sModalCSSClass:"");if(e.length===0){e=t('<div id="sap-ui-blocklayer-popup" tabindex="0" class="'+i+'"></div>');e.appendTo(sap.ui.getCore().getStaticAreaRef())}else{e.removeClass().addClass(i)}d.blStack.push({zIndex:this._iZIndex-2,popup:this});e.css({"z-index":this._iZIndex-2,visibility:"visible"}).show();t("html").addClass("sapUiBLyBack")};d.prototype._hideBlockLayer=function(){d.blStack.pop();var e=t("#sap-ui-blocklayer-popup");if(e.length){var i=e.get(0);if(d.blStack.length>0){i.style.zIndex=d.blStack[d.blStack.length-1].zIndex;i.style.visibility="visible";i.style.display="block"}else{i.style.visibility="hidden";i.style.display="none";window.requestAnimationFrame(function(){t("html").removeClass("sapUiBLyBack")})}}};d.prototype._isFocusInsidePopup=function(){var e=this._$(false).get(0);if(e&&t.sap.containsOrEquals(e,document.activeElement)){return true}return false};d.DockTrigger=new a(200);d.checkDocking=function(){if(this.getOpenState()===h.OPEN){var e=this._getOfDom(this._oLastPosition.of),i=t(e).rect();if(!i){this.close();return}else if(i.left===0&&i.top===0&&i.height===0&&i.height===0&&this._oLastPosition.of.id){this._oLastPosition.of=t.sap.domById(this._oLastPosition.of.id);e=this._getOfDom(this._oLastPosition.of);i=t(e).rect();if(!i){this.close();return}}if(!t.sap.containsOrEquals(document.documentElement,e)){if(e.id&&e.id!==""){var o=t.sap.domById(e.id);var s=t(o).rect();if(s&&!c(i,s)){i=s;delete this._oLastPosition.of;this._oLastPosition.of=o}}}if(this._oLastOfRect){if(!c(this._oLastOfRect,i)){if(this._followOfHandler){var n=t.extend(true,{},this._oLastPosition),a=t.extend(true,{},this._oLastOfRect);this._followOfHandler({lastPosition:n,lastOfRect:a,currentOfRect:i})}else{this._applyPosition(this._oLastPosition)}}}}};d.prototype.ontouchstart=function(t){this.onmousedown(t,true);this._bMousedownCalled=true};d.prototype.onmousedown=function(t,e){if(this._bMousedownCalled&&!e){this._bMousedownCalled=false;return}if(this._iZIndex===this.getLastZIndex()||this.getModal()){return}this._increaseMyZIndex("","mousedown",t)};d.prototype._increaseMyZIndex=function(e,i,o){var s=this.getParentPopup(this._oLastPosition.of);if(o&&o.type==="mousedown"||o&&o.isFromParentPopup||s.length===0){this._iZIndex=this.getNextZIndex();var n=this._$(false,true);n.css("z-index",this._iZIndex);if(this._oBlindLayer){this._oBlindLayer.update(n,this._iZIndex-1)}if(o&&!o.type||o&&o.type!="mousedown"||i==="mousedown"){var a=this.getChildPopups();for(var r=0,l=a.length;r<l;r++){this.increaseZIndex(a[r],true)}}}else if(s.length>0){var p=t(s.get(0)).attr("data-sap-ui-popup");this.increaseZIndex(p,false)}};d.prototype.onAfterRendering=function(e){var i=this.getContent();var o=i instanceof l?i.$():t(i);o.toggleClass("sapUiShd",this._bShadow);o.css("position","absolute");this._setIdentity(o);var s=o[0];var n=s.style.left;var a=s.style.right;var r=s.style.top;var u=s.style.bottom;if(!(n&&n!="auto"||a&&a!="auto"||r&&r!="auto"||u&&u!="auto")){t.sap.log.debug("reposition popup content "+o.attr("id")+" at "+(window.JSON?JSON.stringify(this._oLastPosition.at):String(this._oLastPosition.at)));this._applyPosition(this._oLastPosition)}o.show().css({visibility:"visible","z-index":this._iZIndex});if(this._oBlindLayer){this._resizeListenerId=p.register(this._$().get(0),t.proxy(this.onresize,this))}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._addFocusEventListeners()}this._$(false,true).on("keydown",t.proxy(this._F6NavigationHandler,this))};d.prototype.onBeforeRendering=function(t){if(this._resizeListenerId){p.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._removeFocusEventListeners()}this._$(false,true).off("keydown",this._F6NavigationHandler)};d.prototype.onresize=function(t){if(this.eOpenState!=h.CLOSED&&this._oBlindLayer){var e=this;setTimeout(function(){e._updateBlindLayer()},0)}};d.prototype._updateBlindLayer=function(){if(this.eOpenState!=h.CLOSED&&this._oBlindLayer){this._oBlindLayer.update(this._$(false,true))}};d.prototype.isInPopup=function(t){var e=this.getParentPopup(t);return e&&e.length>0};d.prototype.getParentPopup=function(e){var i=e?e:this;var o=t(i instanceof l?i.getDomRef():i);return o.closest("[data-sap-ui-popup]")};d.prototype.getParentPopupId=function(t){var e=this.getParentPopup(t);return e.attr("data-sap-ui-popup")};d.prototype.addChildToPopup=function(t,e){var i="sap.ui.core.Popup.addFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};d.prototype.removeChildFromPopup=function(t,e){var i="sap.ui.core.Popup.removeFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};d.prototype.closePopup=function(t){var e="sap.ui.core.Popup.closePopup-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",e)};d.prototype.increaseZIndex=function(t,e){var i="sap.ui.core.Popup.increaseZIndex-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{isFromParentPopup:e?e:false})};d.prototype.focusTabChain=function(e){var i=e.event.target,o=e.that.getMetadata().getName(),s;if(!e.$FocusablesContent||!e.$FocusablesFooter||!e.$FocusablesContent.length&&!e.$FocusablesFooter.length){return}if(i.id===e.firstFocusable){t.sap.log.debug("First dummy focus element was focused","",o);if(e.$FocusablesFooter.length>0){t.sap.log.debug("Last footer element will be focused","",o);s=e.$FocusablesFooter[e.$FocusablesFooter.length-1]}else{t.sap.log.debug("Last content element will be focused","",o);s=e.$FocusablesContent[e.$FocusablesContent.length-1]}}else if(i.id===e.lastFocusable){t.sap.log.debug("Last dummy focus element was focues","",o);if(e.$FocusablesContent.length>0){t.sap.log.debug("First content element will be focused","",o);s=e.$FocusablesContent[0]}else{t.sap.log.debug("First footer element will be focused","",o);s=e.$FocusablesFooter[0]}}if(s){t.sap.delayedCall(0,this,function(){var e=sap.ui.getCore().byId(s.id);if(e instanceof n){t.sap.log.debug("Focus will be handled by "+e.getMetadata().getName(),"",o)}else{t.sap.log.debug("oFocusDomRef will be focused","",o)}t.sap.focus(e?e:s);return e?e.getId():s.id})}};return d});