/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/thirdparty/URI","../Element","jquery.sap.sjax"],function(e,r,a){"use strict";var t=window["sap-ui-config"]||{};var n=0;if(t["xx-nosync"]==="warn"||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){n=1}if(t["xx-nosync"]===true||t["xx-nosync"]==="true"||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){n=2}var i={};var s=null;var o=null;var f=[];var u=/url[\s]*\('?"?([^\'")]*)'?"?\)/;function l(){s=null}function c(e,a){var t=u.exec(e);if(t){var n=new r(t[1]);if(n.is("relative")){var i=n.absoluteTo(a).normalize().path();e="url('"+i+"')"}}return e}function p(e,r,a){for(var t in r){if(typeof e[t]==="undefined"){e[t]=c(r[t],a)}}return e}function g(e,r){if(typeof e["default"]!=="object"){e={default:e,scopes:{}}}s=s||{};s["default"]=s["default"]||{};s["scopes"]=s["scopes"]||{};p(s["default"],e["default"],r);if(typeof e["scopes"]==="object"){for(var a in e["scopes"]){s["scopes"][a]=s["scopes"][a]||{};p(s["scopes"][a],e["scopes"][a],r)}}}function m(r){e("link[id^=sap-ui-theme-]").each(function(){r(this.getAttribute("id"))})}function d(a){var t=document.getElementById(a);if(!t){e.sap.log.warning("Could not find stylesheet element with ID",a,"sap.ui.core.theming.Parameters");return}var i=t.href;var s=new r(i).filename("").query("").toString();if(e.sap.getUriParameters().get("sap-ui-xx-no-inline-theming-parameters")!=="true"){var o=e(t);var f=o.css("background-image");var u=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(f);if(u&&u.length>=2){var l=u[1];if(l.charAt(0)!=="{"&&l.charAt(l.length-1)!=="}"){try{l=decodeURIComponent(l)}catch(r){e.sap.log.warning("Could not decode theme parameters URI from "+i)}}try{var c=e.parseJSON(l);g(c,s);return}catch(r){e.sap.log.warning("Could not parse theme parameters from "+i+". Loading library-parameters.json as fallback solution.")}}}var p,m;var d=i.replace(/\/library([^\/.]*)\.(?:css|less)($|[?#])/,function(e,r,a){return"/library-parameters.json"+(a?a:"")});if(n===2){e.sap.log.error("[nosync] Loading library-parameters.json ignored",d,"sap.ui.core.theming.Parameters");return}else if(n===1){e.sap.log.error("[nosync] Loading library-parameters.json with sync XHR",d,"sap.ui.core.theming.Parameters")}p=e.sap.sjax({url:d,dataType:"json"});if(p.success){m=p.data;if(Array.isArray(m)){for(var v=0;v<m.length;v++){var c=m[v];g(c,s)}}else{g(m,s)}}else{e.sap.log.error("Could not load theme parameters from: "+d,p.error)}}function v(){if(!s){g({},"");o=sap.ui.getCore().getConfiguration().getTheme();m(d)}return s}function h(){f.forEach(d);f=[]}i._addLibraryTheme=function(e){if(s){f.push("sap-ui-theme-"+e)}};function y(e){var r=v();if(e.scopeName){r=r["scopes"][e.scopeName]}else{r=r["default"]}var a=r[e.parameterName];if(typeof a==="undefined"&&typeof e.parameterName==="string"){var t=e.parameterName.indexOf(":");if(t!==-1){e.parameterName=e.parameterName.substr(t+1)}a=r[e.parameterName]}if(e.loadPendingParameters&&typeof a==="undefined"){h();a=y({parameterName:e.parameterName,scopeName:e.scopeName,loadPendingParameters:false})}return a}function x(e,r){for(var a=0;a<r.length;a++){var t=r[a];for(var n=0;n<t.length;n++){var i=t[n];var s=y({parameterName:e,scopeName:i});if(s){return s}}}return y({parameterName:e})}i._getScopes=function(e){if(e&&!s){return}var r=v();var a=Object.keys(r["scopes"]);return a};i.getActiveScopesFor=function(e){var r=[];if(e instanceof a){var t=e.getDomRef();h();var n=this._getScopes();if(t){var i=function(e){var r=t.classList;return r&&r.contains(e)};while(t){var s=n.filter(i);if(s.length>0){r.push(s)}t=t.parentNode}}else{var o=function(r){return typeof e.hasStyleClass==="function"&&e.hasStyleClass(r)};while(e){var s=n.filter(o);if(s.length>0){r.push(s)}e=typeof e.getParent==="function"&&e.getParent()}}}return r};i.get=function(r,t){var n;if(!sap.ui.getCore().isInitialized()){e.sap.log.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.")}if(arguments.length===0){h();var s=v();return e.extend({},s["default"])}if(!r){return undefined}if(t instanceof a){h();var o=this.getActiveScopesFor(t);if(typeof r==="string"){return x(r,o)}else if(Array.isArray(r)){var f={};for(var u=0;u<r.length;u++){var l=r[u];f[l]=x(l,o)}return f}}else{if(typeof r==="string"){n=y({parameterName:r,loadPendingParameters:true});return n}else if(Array.isArray(r)){var f={};for(var c=0;c<r.length;c++){var l=r[c];f[l]=i.get(l)}return f}}};i._setOrLoadParameters=function(r){s={default:{},scopes:{}};o=sap.ui.getCore().getConfiguration().getTheme();m(function(a){var t=a.substr(13);if(r[t]){e.extend(s["default"],r[t])}else{d(a)}})};i.reset=function(){var e=arguments[0]===true;if(!e||sap.ui.getCore().getConfiguration().getTheme()!==o){l()}};i._getThemeImage=function(e,r){e=e||"sapUiGlobalLogo";var a=i.get(e);if(a){var t=u.exec(a);if(t){a=t[1]}else if(a==="''"||a==="none"){a=null}}if(!!r&&!a){return sap.ui.resource("sap.ui.core","themes/base/img/1x1.gif")}return a};return i},true);