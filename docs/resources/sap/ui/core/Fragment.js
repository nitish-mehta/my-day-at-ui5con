/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","../base/ManagedObject","./Element","./DeclarativeSupport","./XMLTemplateProcessor"],function(e,t,n,i,r){"use strict";var a={},o={};var s=t.extend("sap.ui.core.Fragment",{metadata:{properties:{type:"string"},specialSettings:{fragmentName:"string",fragmentContent:"any",containingView:{type:"sap.ui.core.mvc.View",visibility:"hidden"},oController:{type:"sap.ui.core.mvc.Controller",visibility:"hidden"},sId:{type:"sap.ui.core.ID",visibility:"hidden"}}},constructor:function(e,n){t.apply(this,arguments);if(this._aContent&&this._aContent.length==1){return this._aContent[0]}else{return this._aContent}}});s.registerType=function(t,n){if(!typeof t==="string"){e.sap.log.error("Ignoring non-string Fragment type: "+t);return}if(o[t]){e.sap.log.warning("sap.ui.core.Fragment.registerType(): Fragment type '"+t+"' is already defined. Overriding this type now!")}o[t]=n};s.prototype._initCompositeSupport=function(e){if(!e){throw new Error("Settings must be set")}if(!(e.fragmentName||e.fragmentContent)){throw new Error("Please provide a fragment name")}if(e.oController){this.oController=e.oController}this._sExplicitId=e.sId||e.id;this._sFragmentName=e.fragmentName;var t=o[e.type];if(t){t.init.apply(this,[e])}else{throw new Error("No type for the fragment has been specified: "+e.type)}};s.prototype.getFragmentName=function(){return this._sFragmentName};s.prototype.getController=function(){return this.oController};s.byId=function(t,n){if(!(typeof t==="string"&&typeof n==="string")){e.sap.log.error("sap.ui.core.Fragment.byId: two strings must be given as parameters, but are: "+t+" and "+n);return undefined}return sap.ui.getCore().byId(t+"--"+n)};s.createId=function(t,n){if(!(typeof t==="string"&&typeof n==="string")){e.sap.log.error("sap.ui.core.Fragment.createId: two strings must be given as parameters, but are: "+t+" and "+n);return undefined}return t+"--"+n};s.prototype.createId=function(e){var t=this._sExplicitId?this._sExplicitId+"--"+e:e;if(this._oContainingView&&this._oContainingView!=this){t=this._oContainingView.createId(t)}return t};s.prototype.isSubView=function(){return true};sap.ui.fragment=function(t,n,i){var r={};if(typeof t==="string"){r.fragmentName=t;r.oController=i;r.type=n}else if(typeof t==="object"){r=t;if(n){r.oController=n}}else{e.sap.log.error("sap.ui.fragment() must be called with Fragment name or config object as first parameter, but is: "+t)}return new s(r)};sap.ui.xmlfragment=function(e,t,n){if(typeof e==="string"){if(typeof t==="string"){return sap.ui.fragment({fragmentName:t,sId:e,type:"XML"},n)}else{return sap.ui.fragment(e,"XML",t)}}else{e.type="XML";return sap.ui.fragment(e,t)}};sap.ui.jsfragment=function(t,n){if(typeof t==="string"&&typeof n==="object"){if(n.createContent){a[t]=n;e.sap.declare({modName:t,type:"fragment"},false)}else{return sap.ui.fragment(t,"JS",n)}}else if(typeof t==="string"&&n===undefined){return sap.ui.fragment(t,"JS")}else{if(typeof t==="object"){t.type="JS";return sap.ui.fragment(t,n)}else if(arguments&&arguments.length>=3){return sap.ui.fragment({id:t,fragmentName:n,type:"JS"},arguments[2])}else{e.sap.log.error("sap.ui.jsfragment() was called with wrong parameter set: "+t+" + "+n)}}};sap.ui.htmlfragment=function(e,t,n){if(typeof e==="string"){if(typeof t==="string"){return sap.ui.fragment({fragmentName:t,sId:e,type:"HTML"},n)}else{return sap.ui.fragment(e,"HTML",t)}}else{e.type="HTML";return sap.ui.fragment(e,t)}};s.registerType("XML",{init:function(i){if(i.fragmentContent){if(typeof i.fragmentContent==="string"){this._xContent=e.parseXML(i.fragmentContent).documentElement}else{this._xContent=i.fragmentContent}}else{this._xContent=r.loadTemplate(i.fragmentName,"fragment")}this._oContainingView=this._sExplicitId?this:i.containingView||this;if(this._oContainingView===this){this._oContainingView.oController=i.containingView&&i.containingView.oController||i.oController}var a=this;t.runWithPreprocessors(function(){a._aContent=r.parseTemplate(a._xContent,a);if(a._aContent&&a._aContent.length&&i.objectBindings){a._aContent.forEach(function(e,t){if(e instanceof n){for(var r in i.objectBindings){e.bindObject(i.objectBindings[r])}}})}},{settings:a._oContainingView._fnSettingsPreprocessor})}});s.registerType("JS",{init:function(n){if(!a[n.fragmentName]){e.sap.require({modName:n.fragmentName,type:"fragment"})}e.extend(this,a[n.fragmentName]);this._oContainingView=n.containingView||this;var i=this;t.runWithPreprocessors(function(){var e=i.createContent(n.oController||i._oContainingView.oController);i._aContent=[];i._aContent=i._aContent.concat(e)},{settings:i._oContainingView._fnSettingsPreprocessor})}});(function(){var n={};var r=function(t){var i=e.sap.getModulePath(t,".fragment.html");var r=n[i];var a;if(!r){a=e.sap.getResourceName(t,".fragment.html");r=e.sap.loadResource(a);n[i]=r}return r};s.registerType("HTML",{init:function(n){this._aContent=[];this.getContent=function(){return this._aContent};this.addContent=function(e){this._aContent.push(e)};this._oContainingView=n.containingView||this;var a=n.fragmentContent||r(n.fragmentName);this._oTemplate=document.createElement("div");if(typeof a==="string"){this._oTemplate.innerHTML=a}else{var o=a;var s=document.createDocumentFragment();for(var p=0;p<o.length;p++){s.appendChild(o.item(p))}this._oTemplate.appendChild(s)}var g=this._oTemplate.getElementsByTagName("template")[0];var f=this.getMetadata().getAllProperties();if(g){var m=this;e.each(g.attributes,function(e,t){var r=i.convertAttributeToSettingName(t.name,m.getId());var a=t.value;var o=f[r];if(!n[r]){if(o){n[r]=i.convertValueToType(i.getPropertyDataType(o),a)}else if(sap.ui.core.mvc.HTMLView._mAllowedSettings[r]){n[r]=a}}});this._oTemplate=g}if(this._oTemplate.content){var s=this._oTemplate.content;this._oTemplate=document.createElement("div");this._oTemplate.appendChild(s)}var m=this;t.runWithPreprocessors(function(){i.compile(m._oTemplate,m);var e=m.getContent();if(e&&e.length===1){m._aContent=[e[0]]}},{settings:m._oContainingView._fnSettingsPreprocessor})}})})();return s});