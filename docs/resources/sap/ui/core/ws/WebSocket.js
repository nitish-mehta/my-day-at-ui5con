/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/base/EventProvider","./ReadyState","sap/ui/thirdparty/URI"],function(t,e,o,n,r){"use strict";var s=o.extend("sap.ui.core.ws.WebSocket",{constructor:function(t,n){o.apply(this);if(!e.support.websocket){throw new Error("Browser does not support WebSockets.")}if(typeof t!=="string"){throw new Error("sUrl must be a string.")}if(typeof n!=="undefined"&&!Array.isArray(n)&&typeof n!=="string"){throw new Error("aProtocols must be a string, array of strings or undefined.")}this._openConnection(t,n)},metadata:{publicMethods:["send","close","getReadyState","getProtocol"]}});s.prototype.getInterface=function(){return this};s.M_EVENTS={Open:"open",Close:"close",Error:"error",Message:"message"};s.prototype.attachOpen=function(t,e,o){this.attachEvent("open",t,e,o);return this};s.prototype.detachOpen=function(t,e){this.detachEvent("open",t,e);return this};s.prototype.fireOpen=function(t){this.fireEvent("open",t);return this};s.prototype.attachClose=function(t,e,o){this.attachEvent("close",t,e,o);return this};s.prototype.detachClose=function(t,e){this.detachEvent("close",t,e);return this};s.prototype.fireClose=function(t){this.fireEvent("close",t);return this};s.prototype.attachError=function(t,e,o){this.attachEvent("error",t,e,o);return this};s.prototype.detachError=function(t,e){this.detachEvent("error",t,e);return this};s.prototype.fireError=function(t){this.fireEvent("error",t);return this};s.prototype.attachMessage=function(t,e,o){this.attachEvent("message",t,e,o);return this};s.prototype.detachMessage=function(t,e){this.detachEvent("message",t,e);return this};s.prototype.fireMessage=function(t){this.fireEvent("message",t);return this};s.prototype._resolveFullUrl=function(t){var e=new r(t);var o=new r(document.baseURI);o.search("");o.protocol(o.protocol()==="https"?"wss":"ws");e=e.absoluteTo(o);return e.toString()};s.prototype._openConnection=function(e,o){var e=this._resolveFullUrl(e);this._oWs=typeof o==="undefined"?new window.WebSocket(e):new window.WebSocket(e,o);this._oWs.onopen=t.proxy(this._onopen,this);this._oWs.onclose=t.proxy(this._onclose,this);this._oWs.onmessage=t.proxy(this._onmessage,this);this._oWs.onerror=t.proxy(this._onerror,this)};s.prototype._onopen=function(){this.fireOpen()};s.prototype._onclose=function(t){this.fireClose({code:t.code,reason:t.reason,wasClean:t.wasClean})};s.prototype._onerror=function(t){this.fireError()};s.prototype._onmessage=function(t){this.fireMessage({data:t.data})};s.prototype.send=function(e){if(this.getReadyState()===n.OPEN){this._oWs.send(e)}else if(this.getReadyState()===n.CONNECTING){this.attachEventOnce("open",function(t){this._oWs.send(e)})}else{t.sap.log.warning("Unable to send WebSocket message. "+"Connection is already closed or closing. message: "+e)}return this};s.prototype.close=function(e,o){if(typeof e==="string"){o=e;e=undefined}e=typeof e==="undefined"?1e3:e;o=typeof o==="undefined"?"":o;if(this.getReadyState()===n.OPEN){this._oWs.close(e,o)}else if(this.getReadyState()===n.CONNECTING){this.attachEventOnce("open",function(t){this._oWs.close(e,o)})}else{var r="";switch(this.getReadyState()){case n.CLOSED:r="Connection is already closed.";break;case n.CLOSING:r="Connection is already closing.";break}t.sap.log.warning("Unable to close WebSocket connection. "+r)}return this};s.prototype.getReadyState=function(){return this._oWs.readyState};s.prototype.getProtocol=function(){return this._oWs.protocol};return s});