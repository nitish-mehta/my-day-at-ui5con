/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","jquery.sap.script"],function(e,t){"use strict";var r=t.extend("sap.ui.core.util.LibraryInfo",{constructor:function(){t.apply(this);this._oLibInfos={}},destroy:function(){t.prototype.destroy.apply(this,arguments);this._oLibInfos={}},getInterface:function(){return this}});r.prototype._loadLibraryMetadata=function(t,r){t=t.replace(/\//g,".");if(this._oLibInfos[t]){e.sap.delayedCall(0,window,r,[this._oLibInfos[t]]);return}var a=this,o,n,i=/themelib_(.*)/i.exec(t);if(!i){n=".library";o=e.sap.getModulePath(t,"/")}else{n=".theme";o=e.sap.getModulePath("sap.ui.core","/themes/"+i[1]+"/")}e.ajax({url:o+n,dataType:"xml",error:function(i,l,f){e.sap.log.error("failed to load library details from '"+o+n+": "+l+", "+f);a._oLibInfos[t]={name:t,data:null,url:o};r(a._oLibInfos[t])},success:function(e,n,i){a._oLibInfos[t]={name:t,data:e,url:o};r(a._oLibInfos[t])}})};r.prototype._getLibraryInfo=function(t,a){this._loadLibraryMetadata(t,function(t){var o={libs:[],library:t.name,libraryUrl:t.url};if(t.data){var n=e(t.data);o.vendor=n.find("vendor").text();o.copyright=n.find("copyright").text();o.version=n.find("version").text();o.documentation=n.find("documentation").text();o.releasenotes=n.find("releasenotes").attr("url");o.componentInfo=r.prototype._getLibraryComponentInfo(n)}a(o)})};r.prototype._getThirdPartyInfo=function(t,r){this._loadLibraryMetadata(t,function(t){var a={libs:[],library:t.name,libraryUrl:t.url};if(t.data){var o=e(t.data).find("appData").find("thirdparty").children();o.each(function(r,o){if(o.nodeName==="lib"){var n=e(o);var i=n.children("license");a.libs.push({displayName:n.attr("displayName"),homepage:n.attr("homepage"),license:{url:i.attr("url"),type:i.attr("type"),file:t.url+i.attr("file")}})}})}r(a)})};r.prototype._getDocuIndex=function(t,r){this._loadLibraryMetadata(t,function(t){var a=t.name,o=t.url,n={docu:{},library:a,libraryUrl:o};if(!t.data){r(n);return}var i=e(t.data).find("appData").find("documentation");var l=i.attr("indexUrl");if(!l){r(n);return}if(i.attr("resolve")=="lib"){l=t.url+l}e.ajax({url:l,dataType:"json",error:function(t,a,o){e.sap.log.error("failed to load library docu from '"+l+"': "+a+", "+o);r(n)},success:function(e,t,n){e.library=a;e.libraryUrl=o;r(e)}})})};r.prototype._getReleaseNotes=function(t,r,a){this._loadLibraryMetadata(t,function(o){if(!o.data){a({});return}var n=r.split(".").length===3&&!/-SNAPSHOT/.test(r);var i=e.sap.Version(r);var l=i.getMajor();var f=i.getMinor();var s=i.getPatch();var p=e(o.data).find("appData").find("releasenotes");var u=p.attr("url");if(!u){e.sap.log.warning("failed to load release notes for library "+t);a({});return}if(i.getSuffix()==="-SNAPSHOT"){if(f%2!=0){f=f+1;s=0}r=l+"."+f+"."+s}var d=window.location.href,c=/\/\d.\d{1,2}.\d{1,2}\//;if(p.attr("resolve")=="lib"){if(c.test(d)||n===false){u=o.url+u}else{u="{major}.{minor}.{patch}/"+o.url+u}}u=u.replace(/\{major\}/g,l);u=u.replace(/\{minor\}/g,f);u=u.replace(/\{patch\}/g,s);e.ajax({url:u,dataType:"json",error:function(r,o,n){if(o==="parsererror"){e.sap.log.error("failed to parse release notes for library '"+t+", "+n)}else{e.sap.log.warning("failed to load release notes for library '"+t+", "+n)}a({})},success:function(e,t,o){a(e,r)}})})};r.prototype._getLibraryComponentInfo=function(e){var t={};var r=[];var a="";e.find("ownership > component").each(function(e,t){if(t.childElementCount===0){a=t.textContent}else{var o=t.getElementsByTagName("name");if(o&&o.length>0){o=o[0].textContent;var n=t.getElementsByTagName("module");if(o&&n&&n.length>0){var i=[];for(var l=0;l<n.length;l++){var f=n[l].textContent.replace(/\//g,".");if(f){i.push(f)}}if(i.length>0){r.push({component:o,modules:i})}}}}});t["defaultComponent"]=a;if(r&&r.length>0){t["specialCases"]=r}return t};r.prototype._getActualComponent=function(t,r){function a(e,t){e=e.toLowerCase();t=t.toLowerCase();return e===t||t.match(/\*$/)&&e.indexOf(t.slice(0,-1))===0||t.match(/\.\*$/)&&e===t.slice(0,-2)}if(r){for(var o in t){if(!t[o]){e.sap.log.error("No library information deployed for "+o);continue}var n;if(r.indexOf(o)===0){n=t[o].defaultComponent}var i=t[o].specialCases;if(i){for(var l=0;l<i.length;l++){var f=i[l].modules;for(var s=0;s<f.length;s++){if(a(r,f[s])){n=i[l].component}}}}if(n){return n}}}};r.prototype._getDefaultComponent=function(e){return e&&e.componentInfo&&e.componentInfo.defaultComponent};return r});