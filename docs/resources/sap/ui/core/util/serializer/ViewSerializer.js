/*
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","./HTMLViewSerializer","./XMLViewSerializer"],function(e,i,t,r){"use strict";var o=i.extend("sap.ui.core.util.serializer.ViewSerializer",{constructor:function(e,t,r){i.apply(this);this._oRootControl=e;this._oWindow=t||window;this._mViews={};this._sDefaultXmlNamespace=r}});o.prototype.serializeToXML=function(){return this.serialize("XML")};o.prototype.serializeToHTML=function(){return this.serialize("HTML")};o.prototype.serialize=function(e){this._mViews={};this._sConvertToViewType=e||undefined;return this._serializeRecursive(this._oRootControl)};o.prototype._getViewType=function(e){if(!this._sConvertToViewType){if(e instanceof this._oWindow.sap.ui.core.mvc.HTMLView){return"HTML"}else if(e instanceof this._oWindow.sap.ui.core.mvc.XMLView){return"XML"}}return this._sConvertToViewType};o.prototype._serializeRecursive=function(i){e.sap.assert(typeof i!=="undefined","The control must not be undefined");if(i instanceof this._oWindow.sap.ui.core.mvc.View){var t=this._getViewSerializer(i,this._getViewType(i));if(t){var r=i.getViewName()||i.getControllerName();if(!this._mViews[r]){this._mViews[r]=t.serialize(this._getViewType(i))}}}if(i.getMetadata().getClass()===this._oWindow.sap.ui.core.UIArea){var o=i.getContent();for(var n=0;n<o.length;n++){this._serializeRecursive(o[n])}}else if(i.getMetadata().getClass()===this._oWindow.sap.ui.core.ComponentContainer){this._serializeRecursive(i.getComponentInstance().getRootControl())}else{var s=i.getMetadata().getAllAggregations();if(s){for(var a in s){var u=s[a];var l=i[u._sGetter]();if(l&&l.length){for(var n=0;n<l.length;n++){var c=l[n];if(c instanceof this._oWindow.sap.ui.core.Element){this._serializeRecursive(c)}}}else if(l instanceof this._oWindow.sap.ui.core.Element){this._serializeRecursive(l)}}}}return this._mViews};o.prototype._getViewSerializer=function(e,i){var o=function(i){if(i.fFunction&&i.fFunction._sapui_handlerName){var t=i.fFunction._sapui_handlerName;var r=e.getController();if(r[t]||sap.ui.getCore().getConfiguration().getControllerCodeDeactivated()){return t}}};var n=function(i){if(i._sapui_controlId){return i._sapui_controlId}return i.getId().replace(e.createId(""),"")};if(i==="HTML"){return new t(e,this._oWindow,n,o)}else if(i==="XML"){return new r(e,this._oWindow,this._sDefaultXmlNamespace,n,o)}else{var i=e?e.constructor:"?";throw Error("View type '"+i+"' is not supported for conversion. Only HTML and XML is supported")}};return o});