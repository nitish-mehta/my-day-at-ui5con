/*
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Delegate"],function(t,e){"use strict";var r=e.extend("sap.ui.core.util.serializer.delegate.XML",{constructor:function(t,r,a,i){e.apply(this);this._sDefaultNamespace=t;this._fnGetControlId=r;this._fnMemorizePackage=i;this._fnGetEventHandlerName=a}});r.prototype.startAggregation=function(t,e){return"<"+this._createAggregationName(t,e)+">"};r.prototype.endAggregation=function(t,e){return"</"+this._createAggregationName(t,e)+">"};r.prototype.start=function(t,e,r){return"<"+this._createTagName(t)};r.prototype.end=function(t,e,r){return"</"+this._createTagName(t)+">"};r.prototype.middle=function(e,r,a){var i=[];var n=this._fnGetControlId?this._fnGetControlId(e):e.getId();if(n.indexOf("__")!==0){i.push(this._createAttribute("id",n))}if(e.aCustomStyleClasses){var s=e.aCustomStyleClasses;var o=[];for(var u=0;u<s.length;u++){var g=s[u];if(!t.sap.startsWith(g,"sapM")&&!t.sap.startsWith(g,"sapUi")){o.push(g)}}if(o.length>0){i.push(this._createAttribute("class",o.join(" ")))}}if(this._fnGetEventHandlerName){var f=e.getMetadata().getAllEvents();for(var p in f){if(e.hasListeners(p)){var l=e.mEventRegistry[p];for(var u=0;u<l.length;u++){var c=this._fnGetEventHandlerName(l[u]);if(c){i.push(this._createAttribute(p,c));break}}}}}var d=e.getMetadata().getAllAssociations();this._createAttributes(i,e,d,function(t,e){if(d[t].multiple){return e.join(" ")}return e},function(t,e){return e!==null&&typeof e!==undefined&&e!==""});var h=e.getMetadata().getAllProperties();var v=e.getMetadata().getPropertyDefaults();this._createAttributes(i,e,h,null,function(e,r){return!t.sap.equal(r,v[e])});var _=e.getMetadata().getAllAggregations();this._createAttributes(i,e,_,null,function(t,r){if(!e.getBindingInfo(t)&&(!r||typeof r!=="string")){return false}return true});i.push(">");return i.join("")};r.prototype._createAttributes=function(t,e,r,a,i){for(var n in r){var s=r[n];var o=s._sGetter;if(e[o]){var u=e[o]();u=a?a(n,u):u;if(!e.getBindingInfo(n)){if(!i||i(n,u)){t.push(this._createAttribute(n,u))}}else{t.push(this._createDataBindingAttribute(e,n,u))}}}};r.prototype._createDataBindingAttribute=function(t,e,r){var a=t.getBindingInfo(e);var i=null;var n=r;if(!a.bindingString){if(a.binding){var s=a.binding.getMetadata().getName();if(s==="sap.ui.model.PropertyBinding"||s==="sap.ui.model.resource.ResourcePropertyBinding"){i=a.binding.getValue()}}if(a.parts){a=a.parts[0]}var o=a.model;if(i===r||i===null){n="{"+(o?o+">"+a.path:a.path)+"}"}}else{n=a.bindingString}return this._createAttribute(e,n)};r.prototype._createAttribute=function(e,r){var a=t.type(r)==="string"?t.sap.encodeHTML(r):r;return" "+e+'="'+a+'"'};r.prototype._createTagName=function(t){var e=t.getMetadata()._sClassName;var r=e.lastIndexOf(".");var a=r===-1?e:e.substring(r+1);var i=r===-1?e:e.substring(0,r);if(this._fnMemorizePackage){this._fnMemorizePackage(t,i)}return this._createNamespace(i,a)};r.prototype._createAggregationName=function(t,e){var r=t.getMetadata()._sClassName;var a=r.lastIndexOf(".");var i=a===-1?r:r.substring(0,a);return this._createNamespace(i,e)};r.prototype._createNamespace=function(t,e){if(this._sDefaultNamespace&&this._sDefaultNamespace===t){return e}else{return t+":"+e}};return r});