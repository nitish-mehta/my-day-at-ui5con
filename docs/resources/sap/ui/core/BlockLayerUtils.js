/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(e){"use strict";var t={},a=["focusin","focusout","keydown","keypress","keyup","mousedown","touchstart","touchmove","mouseup","touchend","click"],i=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr|tr)$/i;t.block=function(t,a,s){var o,l,u,c;if(t){o=t.getDomRef(s);if(!o){o=t.getDomRef()}if(!o){e.sap.log.warning("BlockLayer could not be rendered. The outer Control instance is not valid anymore or was not rendered yet.");return}l=o.tagName;if(i.test(l)){e.sap.log.warning("BusyIndicator cannot be placed in elements with tag '"+l+"'.");return}c=n(o,a);u={$parent:e(o),$blockLayer:e(c)};if(u.$parent.css("position")=="static"){u.originalPosition="static";u.$parent.css("position","relative")}r.call(u,true)}else{e.sap.log.warning("BlockLayer couldn't be created. No Control instance given.")}return u};t.unblock=function(e){if(e){if(e.originalPosition){e.$parent.css("position",e.originalPosition)}r.call(e,false);e.$blockLayer.remove()}};t.addAriaAttributes=function(e){e.setAttribute("role","progressbar");e.setAttribute("aria-valuemin","0");e.setAttribute("aria-valuemax","100");e.setAttribute("alt","");e.setAttribute("tabIndex","0")};t.toggleAnimationStyle=function(t,a){var i=e(t.$blockLayer.get(0));if(a){i.removeClass("sapUiHiddenBusyIndicatorAnimation");i.removeClass("sapUiBlockLayerOnly")}else{i.addClass("sapUiBlockLayerOnly");i.addClass("sapUiHiddenBusyIndicatorAnimation")}};function n(e,a){var i=document.createElement("div");i.id=a;i.className="sapUiBlockLayer ";t.addAriaAttributes(i);e.appendChild(i);return i}function r(t){if(t){var i=this.$parent.get(0);if(i){this.fnRedirectFocus=r.bind(this);this.oTabbableBefore=s(this.fnRedirectFocus);this.oTabbableAfter=s(this.fnRedirectFocus);i.parentNode.insertBefore(this.oTabbableBefore,i);i.parentNode.insertBefore(this.oTabbableAfter,i.nextSibling);this._fnSuppressDefaultAndStopPropagationHandler=n.bind(this);this._aSuppressHandler=l.call(this,this._fnSuppressDefaultAndStopPropagationHandler)}else{e.sap.log.warning("fnHandleInteraction called with bEnabled true, but no DOMRef exists!")}}else{if(this.oTabbableBefore){o(this.oTabbableBefore,this.fnRedirectFocus);delete this.oTabbableBefore}if(this.oTabbableAfter){o(this.oTabbableAfter,this.fnRedirectFocus);delete this.oTabbableAfter}delete this.fnRedirectFocus;u.call(this,this._fnSuppressDefaultAndStopPropagationHandler)}function n(t){var a=t.target===this.$blockLayer.get(0),i;if(a&&t.type==="keydown"&&t.keyCode===9){e.sap.log.debug("Local Busy Indicator Event keydown handled: "+t.type);i=t.shiftKey?this.oTabbableBefore:this.oTabbableAfter;i.setAttribute("tabindex",-1);this.bIgnoreFocus=true;i.focus();this.bIgnoreFocus=false;i.setAttribute("tabindex",0);t.stopImmediatePropagation()}else if(a&&(t.type==="mousedown"||t.type==="touchstart")){e.sap.log.debug("Local Busy Indicator click handled on busy area: "+t.target.id);t.stopImmediatePropagation()}else{e.sap.log.debug("Local Busy Indicator Event Suppressed: "+t.type);t.preventDefault();t.stopImmediatePropagation()}}function r(){if(!this.bIgnoreFocus){this.$blockLayer.get(0).focus()}}function s(e){var t=document.createElement("span");t.setAttribute("tabindex",0);t.addEventListener("focusin",e);return t}function o(e,t){if(e.parentNode){e.parentNode.removeChild(e)}e.removeEventListener("focusin",t)}function l(t){var i=[],n=this.$parent.get(0),r=this.$blockLayer.get(0);for(var s=0;s<a.length;s++){n.addEventListener(a[s],t,{capture:true,passive:false});i.push(e.sap._suppressTriggerEvent(a[s],n,r))}this.$blockLayer.bind("keydown",t);return i}function u(t){var i,n=this.$parent.get(0),r=this.$blockLayer.get(0);if(n){for(i=0;i<a.length;i++){n.removeEventListener(a[i],t,{capture:true,passive:false})}}if(this._aSuppressHandler){for(i=0;i<this._aSuppressHandler.length;i++){e.sap._releaseTriggerEvent(this._aSuppressHandler[i])}}if(r){this.$blockLayer.unbind("keydown",t)}}}return t});