/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/library","./HashChanger"],function(t,i,s){"use strict";var h=i.routing.HistoryDirection;var e=function(i){this._iHistoryLength=window.history.length;this.aHistory=[];this._bIsInitial=true;if(!i){t.sap.log.error("sap.ui.core.routing.History constructor was called and it did not get a hashChanger as parameter")}this._setHashChanger(i);this._reset()};e.prototype.destroy=function(t){this._unRegisterHashChanger()};e.prototype.getDirection=function(t){if(t!==undefined&&this._bIsInitial){return undefined}if(t===undefined){return this._sCurrentDirection}return this._getDirection(t)};e.prototype.getPreviousHash=function(){return this.aHistory[this.iHistoryPosition-1]};e.prototype._setHashChanger=function(t){if(this._oHashChanger){this._unRegisterHashChanger()}this._oHashChanger=t;this._oHashChanger.attachEvent("hashChanged",this._onHashChange,this);this._oHashChanger.attachEvent("hashReplaced",this._hashReplaced,this);this._oHashChanger.attachEvent("hashSet",this._hashSet,this)};e.prototype._unRegisterHashChanger=function(){this._oHashChanger.detachEvent("hashChanged",this._onHashChange,this);this._oHashChanger.detachEvent("hashReplaced",this._hashReplaced,this);this._oHashChanger.detachEvent("hashSet",this._hashSet,this);this._oHashChanger=null};e.prototype._reset=function(){this.aHistory.length=0;this.iHistoryPosition=0;this._bUnknown=true;this.aHistory[0]=this._oHashChanger.getHash()};e.prototype._getDirection=function(t,i,s){if(s&&this._oNextHash&&this._oNextHash.sHash===t){return h.NewEntry}if(i){return h.NewEntry}if(this._bUnknown){return h.Unknown}if(this.aHistory[this.iHistoryPosition+1]===t&&this.aHistory[this.iHistoryPosition-1]===t){return h.Unknown}if(this.aHistory[this.iHistoryPosition-1]===t){return h.Backwards}if(this.aHistory[this.iHistoryPosition+1]===t){return h.Forwards}return h.Unknown};e.prototype._onHashChange=function(t){this._hashChange(t.getParameter("newHash"))};e.prototype._hashChange=function(t){var i=window.history.length,s;if(this._oNextHash&&this._oNextHash.bWasReplaced&&this._oNextHash.sHash===t){this.aHistory[this.iHistoryPosition]=t;this._oNextHash=null;if(!this._bIsInitial){this._sCurrentDirection=h.Unknown}return}this._bIsInitial=false;s=this._sCurrentDirection=this._getDirection(t,this._iHistoryLength<window.history.length,true);this._iHistoryLength=i;if(this._oNextHash){this._oNextHash=null}if(s===h.Unknown){this._reset();return}this._bUnknown=false;if(s===h.NewEntry){if(this.iHistoryPosition+1<this.aHistory.length){this.aHistory=this.aHistory.slice(0,this.iHistoryPosition+1)}this.aHistory.push(t);this.iHistoryPosition+=1;return}if(s===h.Forwards){this.iHistoryPosition++;return}if(s===h.Backwards){this.iHistoryPosition--}};e.prototype._hashSet=function(t){this._hashChangedByApp(t.getParameter("sHash"),false)};e.prototype._hashReplaced=function(t){this._hashChangedByApp(t.getParameter("sHash"),true)};e.prototype._hashChangedByApp=function(t,i){this._oNextHash={sHash:t,bWasReplaced:i}};var n=new e(s.getInstance());e.getInstance=function(){return n};return e},true);