/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","./Target","./async/Targets","./sync/Targets"],function(t,e,i,r,a){"use strict";var n=e.extend("sap.ui.core.routing.Targets",{constructor:function(i){var n,s;e.apply(this);this._mTargets={};this._oConfig=i.config;this._oViews=i.views;if(!this._oConfig){this._oConfig={_async:false}}function o(){if(t.sap.getUriParameters().get("sap-ui-xx-asyncRouting")==="true"){t.sap.log.warning("Activation of async view loading in routing via url parameter is only temporarily supported and may be removed soon","Targets");return true}return false}if(this._oConfig._async===undefined){this._oConfig._async=this._oConfig.async===undefined?o():this._oConfig.async}var h=this._oConfig._async?r:a;for(var g in h){this[g]=h[g]}for(n in i.targets){if(i.targets.hasOwnProperty(n)){this._createTarget(n,i.targets[n])}}for(s in this._mTargets){if(this._mTargets.hasOwnProperty(s)){this._addParentTo(this._mTargets[s])}}},destroy:function(){var t;e.prototype.destroy.apply(this);for(t in this._mTargets){if(this._mTargets.hasOwnProperty(t)){this._mTargets[t].destroy()}}this._mTargets=null;this._oViews=null;this._oConfig=null;this.bIsDestroyed=true;return this},getViews:function(){return this._oViews},getTarget:function(e){var i=this,r=[];if(Array.isArray(e)){e.forEach(function(e){var a=i._mTargets[e];if(a){r.push(a)}else{t.sap.log.error('The target you tried to get "'+e+'" does not exist!',i)}});return r}return this._mTargets[e]},addTarget:function(e,i){var r=this.getTarget(e),a;if(r){t.sap.log.error("Target with name "+e+" already exists",this)}else{a=this._createTarget(e,i);this._addParentTo(a)}return this},attachDisplay:function(t,e,i){return this.attachEvent(this.M_EVENTS.DISPLAY,t,e,i)},detachDisplay:function(t,e){return this.detachEvent(this.M_EVENTS.DISPLAY,t,e)},fireDisplay:function(t){return this.fireEvent(this.M_EVENTS.DISPLAY,t)},attachTitleChanged:function(t,e,i){this.attachEvent(this.M_EVENTS.TITLE_CHANGED,t,e,i);return this},detachTitleChanged:function(t,e){return this.detachEvent(this.M_EVENTS.TITLE_CHANGED,t,e)},fireTitleChanged:function(t){return this.fireEvent(this.M_EVENTS.TITLE_CHANGED,t)},M_EVENTS:{DISPLAY:"display",TITLE_CHANGED:"titleChanged"},_createTarget:function(e,i){var r,a;a=t.extend(true,{name:e},this._oConfig,i);r=this._constructTarget(a);r.attachDisplay(function(t){var i=t.getParameters();this.fireDisplay({name:e,view:i.view,control:i.control,config:i.config,data:i.data})},this);this._mTargets[e]=r;return r},_addParentTo:function(e){var i,r=e._oOptions.parent;if(!r){return}i=this._mTargets[r];if(!i){t.sap.log.error("The target '"+e._oOptions.name+" has a parent '"+r+"' defined, but it was not found in the other targets",this);return}e._oParent=i},_constructTarget:function(t,e){return new i(t,this._oViews,e)},_setRootViewId:function(t){var e,i;for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){i=this._mTargets[e]._oOptions;if(i.rootView===undefined){i.rootView=t}}}},_getTitleTargetName:function(t,e){var i,r;r=e||typeof t==="string"&&t;if(!r){t.some(function(t){i=this.getTarget(t);while(i&&i._oParent&&i._oParent._oOptions.title){i=i._oParent}if(i&&i._oOptions.title){r=i._oOptions.name;return true}}.bind(this))}return r},_forwardTitleChanged:function(t){this.fireTitleChanged({name:t.getParameter("name"),title:t.getParameter("title")})},_attachTitleChanged:function(e,i){var r;i=this._getTitleTargetName(e,i);r=this.getTarget(i);if(this._oLastTitleTarget){this._oLastTitleTarget.detachTitleChanged(this._forwardTitleChanged,this);this._oLastTitleTarget._bIsDisplayed=false}if(r){r.attachTitleChanged({name:r._oOptions.name},this._forwardTitleChanged,this);this._oLastTitleTarget=r}else if(i){t.sap.log.error('The target with the name "'+i+'" where the titleChanged event should be fired does not exist!',this)}}});return n});