/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/routing/Target","sap/ui/core/routing/async/Route","sap/ui/core/routing/sync/Route","sap/ui/core/Component"],function(t,e,r,n,a,o){"use strict";var i=e.extend("sap.ui.core.routing.Route",{metadata:{publicMethods:["getURL","getPattern"]},constructor:function(o,i,u){e.apply(this,arguments);if(!i.name){t.sap.log.error("A name has to be specified for every route",this)}this._aPattern=[];this._aRoutes=[];this._oParent=u;this._oConfig=i;this._oRouter=o;var s=this,h=i.pattern,c,d,f=o._isAsync();d=f?n:a;for(var g in d){this[g]=d[g]}if(!t.isArray(h)){h=[h]}if(i.parent){var p=this._getParentRoute(i.parent);if(!p){t.sap.log.error("No parent route with '"+i.parent+"' could be found",this)}else if(p._aPattern.length>1){t.sap.log.error("Routes with multiple patterns cannot be used as parent for nested routes",this);return}else{this._oNestingParent=p;h.forEach(function(t,e){var r=p._aPattern[0];r=r.charAt(r.length)==="/"?r:r+"/";h[e]=r+t})}}if(t.isArray(i.subroutes)){c=i.subroutes;i.subroutes={};t.each(c,function(t,e){i.subroutes[e.name]=e})}if(!i.target){i._async=f;this._oTarget=new r(i,o._oViews,u&&u._oTarget);this._oTarget._bUseRawViewId=true}if(i.subroutes){t.each(i.subroutes,function(t,e){if(e.name===undefined){e.name=t}o.addRoute(e,s)})}if(i.pattern===undefined){return}t.each(h,function(e,r){s._aPattern[e]=r;s._aRoutes[e]=o._oRouter.addRoute(r);s._aRoutes[e].greedy=i.greedy;s._aRoutes[e].matched.add(function(){var r={};t.each(arguments,function(t,n){r[s._aRoutes[e]._paramsIds[t]]=n});s._routeMatched(r,true)})})},destroy:function(){e.prototype.destroy.apply(this);this._aPattern=null;this._aRoutes=null;this._oParent=null;this._oConfig=null;this.bIsDestroyed=true;return this},getURL:function(t){return this._aRoutes[0].interpolate(t)},getPattern:function(){return this._aPattern[0]},attachMatched:function(t,e,r){return this.attachEvent("matched",t,e,r)},detachMatched:function(t,e){return this.detachEvent("matched",t,e)},attachBeforeMatched:function(t,e,r){return this.attachEvent("beforeMatched",t,e,r)},detachBeforeMatched:function(t,e){return this.detachEvent("beforeMatched",t,e)},fireBeforeMatched:function(t){this.fireEvent("beforeMatched",t);return this},attachPatternMatched:function(t,e,r){return this.attachEvent("patternMatched",t,e,r)},detachPatternMatched:function(t,e){return this.detachEvent("patternMatched",t,e)},_convertToTargetOptions:function(e){return t.extend(true,{},e,{rootView:e.targetParent,controlId:e.targetControl,controlAggregation:e.targetAggregation,clearControlAggregation:e.clearTarget,viewName:e.view,viewType:e.viewType,viewId:e.viewId})},_getParentRoute:function(e){var r=e.split(":");if(r.length===1||r.length===2&&!r[0]){return this._oRouter.getRoute(r[r.length-1])}else{t.sap.assert(this._oRouter._oOwner,"No owner component for "+this._oRouter._oOwner.getId());var n=o.getOwnerComponentFor(this._oRouter._oOwner);while(n){if(n.getMetadata().getName()===r[0]){var a=n.getRouter();return a.getRoute(r[1])}n=o.getOwnerComponentFor(n)}return null}}});i.M_EVENTS={BeforeMatched:"beforeMatched",Matched:"matched",PatternMatched:"patternMatched"};return i});