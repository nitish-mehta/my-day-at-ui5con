/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","./Plugin","sap/ui/Device","jquery.sap.dom","jquery.sap.encoder","jquery.sap.script"],function(e,t,i,o){"use strict";var n=t.extend("sap.ui.core.support.Support",{constructor:function(i){if(!p){throw Error()}t.apply(this);var a=this;this._sType=i;this._sLocalOrigin=window.location.protocol+"//"+window.location.host;var u=e.proxy(this._receiveEvent,this);if(window.addEventListener){window.addEventListener("message",u,false)}else{window.attachEvent("onmessage",u)}switch(i){case r.APPLICATION:this._isOpen=false;this.attachEvent(s.TEAR_DOWN,function(t){a._isOpen=false;if(o.browser.msie){e.sap.byId(f+"-frame").remove()}else{c(a._oRemoteWindow)}a._oRemoteWindow=null;n.exitPlugins(a,false)});this.attachEvent(s.LIBS,function(e){var t=n.getDiagnosticLibraries(),i=[];for(var o=0;o<t.length;o++){i.push(t[o].name)}a.sendEvent(s.LIBS,i)});this.attachEvent(s.SETUP,function(e){a._isOpen=true;n.initPlugins(a,false)});break;case r.IFRAME:this._oRemoteWindow=window.parent;this._sRemoteOrigin=e.sap.getUriParameters().get("sap-ui-xx-support-origin");this.openSupportTool();e(window).bind("unload",function(e){c(a._oOpenedWindow)});break;case r.TOOL:this._oRemoteWindow=window.opener;this._sRemoteOrigin=e.sap.getUriParameters().get("sap-ui-xx-support-origin");e(window).bind("unload",function(e){a.sendEvent(s.TEAR_DOWN);n.exitPlugins(a,true)});this.attachEvent(s.LIBS,function(t){var i=t.mParameters;if(!Array.isArray(i)){i=Object.keys(i).map(function(e){return i[e]})}sap.ui.getCore().loadLibraries(i,true).then(function(){e(function(){n.initPlugins(a,true).then(function(){a.sendEvent(s.SETUP)})})})});this.sendEvent(s.LIBS);break}}});var r={APPLICATION:"APPLICATION",IFRAME:"IFRAME",TOOL:"TOOL"};var s={LIBS:"sapUiSupportLibs",SETUP:"sapUiSupportSetup",TEAR_DOWN:"sapUiSupportTeardown"};n.StubType=r;n.EventType=s;var a=[];n.getStub=function(e){if(u){return u}if(e!=r.APPLICATION&&e!=r.IFRAME&&e!=r.TOOL){e=r.APPLICATION}p=true;u=new n(e);p=false;return u};n.getToolPlugins=function(){var e=[];for(var t=0;t<a.length;t++){if(a[t]instanceof i&&a[t].isToolPlugin()){e.push(a[t])}}return e};n.getAppPlugins=function(){var e=[];for(var t=0;t<a.length;t++){if(a[t]instanceof i&&a[t].isAppPlugin()){e.push(a[t])}}return e};n.prototype.getType=function(){return this._sType};n.prototype.isToolStub=function(){return this._sType===n.StubType.TOOL};n.prototype.isAppStub=function(){return this._sType===n.StubType.APPLICATION};n.prototype._receiveEvent=function(e){var t=e.data;if(typeof t==="string"&&t.indexOf("SAPUI5SupportTool*")===0){t=t.substr(18)}else{return}if(e.source!=this._oRemoteWindow){return}this._oRemoteOrigin=e.origin;if(this._sType===r.IFRAME){var i=this;setTimeout(function(){i._oOpenedWindow.sap.ui.core.support.Support.getStub(r.TOOL)._receiveEvent({source:window,data:e.data,origin:i._sLocalOrigin})},0)}else{var o=JSON.parse(t);var n=o.eventId;var s=o.params;this.fireEvent(n,s)}};n.prototype.sendEvent=function(t,i){if(!this._oRemoteWindow){return}i=i?i:{};if(o.browser.msie&&this._sType===r.TOOL){this._oRemoteWindow.sap.ui.core.support.Support.getStub(r.IFRAME).sendEvent(t,i)}else{var n=i;if(o.browser.msie){n={};e.extend(true,n,i)}var s={eventId:t,params:n};var a="SAPUI5SupportTool*"+JSON.stringify(s);this._oRemoteWindow.postMessage(a,this._sRemoteOrigin)}};n.prototype.openSupportTool=function(){var t=e.sap.getModulePath("sap.ui.core.support","/support.html");var i="?sap-ui-xx-noless=true&sap-ui-xx-support-origin="+e.sap.encodeURL(this._sLocalOrigin);var n;if(this._sType===r.APPLICATION){var s=e.sap.domById("sap-ui-bootstrap");if(s){var a=e.sap.getModulePath("./");var p=s.getAttribute("src");if(typeof p==="string"&&p.indexOf(a)===0){n=p.substr(a.length)}}}else if(this._sType===r.IFRAME){n=e.sap.getUriParameters().get("sap-ui-xx-support-bootstrap")}if(n&&n!=="sap-ui-core.js"&&n.indexOf("/")===-1){i+="&sap-ui-xx-support-bootstrap="+e.sap.encodeURL(n)}function u(e){return e.indexOf(".")==0||e.indexOf("/")==0||e.indexOf("://")<0}if(this._sType===r.APPLICATION){if(!this._isOpen){if(o.browser.msie){var c=e.sap.getModulePath("sap.ui.core.support","/msiebridge.html");d().html("").append('<iframe id="'+f+'-frame" src="'+c+i+'" onload="sap.ui.core.support.Support._onSupportIFrameLoaded();"></iframe>');this._sRemoteOrigin=u(c)?this._sLocalOrigin:c}else{this._oRemoteWindow=l(t+i);this._sRemoteOrigin=u(t)?this._sLocalOrigin:t}}else{this._oRemoteWindow.focus()}}else if(this._sType===r.IFRAME){this._oOpenedWindow=l(t+i)}};n._onSupportIFrameLoaded=function(){u._oRemoteWindow=e.sap.byId(f+"-frame")[0].contentWindow};n.prototype.toString=function(){return"sap.ui.core.support.Support"};var p=false;var u;var f="sap-ui-support";function d(){var t=e.sap.byId(f);if(t.length===0){t=e("<DIV/>",{id:f}).addClass("sapUiHidden").appendTo(document.body)}return t}function l(e){return window.open(e,"sapUiSupportTool","width=800,height=700,status=no,toolbar=no,menubar=no,resizable=yes,location=no,directories=no,scrollbars=yes")}function c(e){if(!e){return}try{e.close()}catch(e){}}n.getDiagnosticLibraries=function(){var e=sap.ui.getCore().getLoadedLibraries(),t=[];for(var i in e){var o=e[i];if(o.extensions&&o.extensions["sap.ui.support"]&&o.extensions["sap.ui.support"].diagnosticPlugins){t.push(o)}}return t};n.initPlugins=function(e,t){return new Promise(function(t,o){a=[];var r=n.getDiagnosticLibraries();for(var s=0;s<r.length;s++){var p=r[s],u=p.extensions["sap.ui.support"].diagnosticPlugins;if(Array.isArray(u)){for(var f=0;f<u.length;f++){if(a.indexOf(u[f])===-1){a.push(u[f])}}}}var d=[],l=[],s;for(s=0;s<a.length;s++){if(typeof a[s]==="string"){d.push(a[s]);l.push(s)}}sap.ui.require(d,function(){var o,n,r;for(n=0;n<arguments.length;n++){r=arguments[n];o=l[n];if(e.isToolStub()&&r.prototype.isToolPlugin()){a[o]=new r(e);g(a[o])}else if(e.isAppStub()&&r.prototype.isAppPlugin()){a[o]=new r(e)}}for(o=0;o<a.length;o++){if(a[o]instanceof i){if(e.isToolStub()&&a[o].isToolPlugin()){a[o].init(e)}else if(e.isAppStub()&&a[o].isAppPlugin()){a[o].init(e)}}}t()})})};n.exitPlugins=function(e,t){for(var o=0;o<a.length;o++){if(a[o]instanceof i){if(a[o].isToolPlugin()&&e.isToolStub()&&t){a[o].exit(e,true)}else if(a[o].isAppPlugin()&&e.isAppStub()&&!t){a[o].exit(e,false)}}}};function g(e){e.$().replaceWith("<div  id='"+e.getId()+"-Panel' class='sapUiSupportPnl'>"+"<div id='"+e.getId()+"-PanelHeader' class='sapUiSupportPnlHdr'>"+"<div id='"+e.getId()+"-PanelHandle' class='sapUiSupportPnlHdrHdl sapUiSupportPnlHdrHdlClosed'>"+"</div>"+"<div class='sapUiSupportPanelTitle'>"+e.getTitle()+"</div>"+"</div>"+"<div id='"+e.getId()+"-PanelContent' class='sapUiSupportPnlCntnt sapUiSupportHidden'>"+"<div id='"+e.getId()+"' class='sapUiSupportPlugin'></div>"+"</div>"+"</div>");e.$("PanelHeader").click(function(){var t=e.$("PanelHandle");if(t.hasClass("sapUiSupportPnlHdrHdlClosed")){t.removeClass("sapUiSupportPnlHdrHdlClosed");e.$("PanelContent").removeClass("sapUiSupportHidden")}else{t.addClass("sapUiSupportPnlHdrHdlClosed");e.$("PanelContent").addClass("sapUiSupportHidden")}})}n.initializeSupportMode=function(e,t){if(e.indexOf("true")>-1||e.indexOf("viewinfo")>-1){n._initializeSupportInfo(t)}};n._initializeSupportInfo=function(t){var i=[],o=[],r=[],s="support:data",a="support",p="http://schemas.sap.com/sapui5/extension/sap.ui.core.support.Support.info/1",u={};var f=function(){var e="sap-ui-support.probe",t;try{localStorage.setItem(e,e);t=localStorage.getItem(e);localStorage.removeItem(e);return t===e}catch(e){return false}}();function d(){if(f){localStorage.setItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href,JSON.stringify(o))}}function l(){if(f){localStorage.setItem("sap-ui-support.aSupportXMLModifications/"+document.location.href,JSON.stringify(r))}}if(f){var c=localStorage.getItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href);if(c){o=JSON.parse(c)}var c=localStorage.getItem("sap-ui-support.aSupportXMLModifications/"+document.location.href);if(c){r=JSON.parse(c)}}n.info=function(t){t._idx=i.length;if(t._idx>0&&!t.context){t.context=i[i.length-1].context}if(!t.context){e.sap.log.debug("Support Info does not have a context and is ignored");return t}if(t.context&&t.context.ownerDocument&&t.context.nodeType===1){var n=t._idx+"";if(!t.context.hasAttributeNS(p,"data")){t.context.setAttribute("xmlns:"+a,p)}else{n=t.context.getAttributeNS(p,"data")+","+n}t.context.setAttributeNS(p,s,n)}i.push(t);if(o.indexOf(t._idx)>-1){e.sap.log.info(t);e.sap.log.info("To remove this breakpoint execute:","\nsap.ui.core.support.Support.info.removeBreakpointAt("+t._idx+")");debugger}return t._idx};n.info.getAll=function(e){if(e===undefined){return i}else{return i.filter(function(t){return t.env&&t.env.caller===e})}};n.info.getInfos=function(e){if(e&&typeof e==="string"){e=e.split(",")}else{e=[]}var t=[];for(var o=0;o<e.length;o++){if(i[e[o]]){t.push(i[e[o]])}}return t};n.info.byIndex=function(e){return i[e]};n.info.getAllBreakpoints=function(){return o};n.info.hasBreakpointAt=function(e){return o.indexOf(e)>-1};n.info.addBreakpointAt=function(e){if(o.indexOf(e)>-1){return}o.push(e);d()};n.info.removeBreakpointAt=function(e){var t=o.indexOf(e);if(t>-1){o.splice(t,1);d()}};n.info.removeAllBreakpoints=function(){o=[];d()};n.info.addSupportInfo=function(e,t){if(e&&t){if(u[e]){u[e]+=","+t}else{u[e]=t}}};n.info.byId=function(e){return u[e]||null};n.info.getIds=function(e){var t=[];for(var i in u){var o=u[i];if(o&&o.indexOf(e)>-1){t.push(i)}}return t};n.info.getElements=function(e){var t=[];for(var i in u){var o=u[i];if(o&&o.indexOf(e)===0){var n=sap.ui.getCore().byId(i);if(n){t.push(sap.ui.getCore().byId(i))}}}return t};n.info.getAllXMLModifications=function(){return r};n.info.hasXMLModifications=function(){return r.length>0};n.info.addXMLModification=function(e,t,i){r.push({id:e,idx:t,change:i});l()};n.info.removeXMLModification=function(e){var t=r.indexOf(e);if(t>-1){r.splice(t,1);l()}};n.info.removeAllXMLModification=function(){r=[];l()};n.info.modifyXML=function(e,t){if(!n.info.hasXMLModifications()){return}var i=t;if(!i||!i.nodeType||!(i.nodeType==1||i.nodeType==9)){return}if(i.nodeType===9){i=i.firstChild}var o=i.querySelectorAll("*");var s=[i];for(var a=0;a<o.length;a++){s.push(o[a])}for(var a=0;a<r.length;a++){var p=r[a],u=p.change;if(p.id===e){var f=s[p.idx];if(f.nodeType===1&&u.setAttribute){var d=f.getAttribute(u.setAttribute[0]);f.setAttribute(u.setAttribute[0],u.setAttribute[1]);if(!f._modified){f._modified=[]}f._modified.push(u.setAttribute[0]);if(!f._oldValues){f._oldValues=[]}f._oldValues.push(d)}}}};n.info._breakAtProperty=function(e){return function(t){if(t.getParameter("name")===e){debugger}}};n.info._breakAtMethod=function(e){return function(){debugger;return e.apply(this,arguments)}};var g=["sap/ui/base/ManagedObject","sap/ui/core/mvc/View","sap/ui/core/XMLTemplateProcessor","sap/ui/thirdparty/datajs"];function v(t,i,o,r){t._supportInfo=n.info;i._supportInfo=n.info;o._supportInfo=n.info;if(window.datajs){window.datajs._sap={_supportInfo:n.info}}e.sap.log.info("sap.ui.core.support.Support.info initialized.")}if(t){sap.ui.require(g,v)}else{v.apply(null,g.map(sap.ui.requireSync))}};return n});