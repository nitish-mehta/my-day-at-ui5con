/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","jquery.sap.trace"],function(e,t){"use strict";var s=function(){var s=/sap-ui-xx-e2e-trace-level=(low|medium|high)/.exec(location.search);var i;if(s&&s.length>=2){i=s[1]}else{i="medium"}var r="/sap/bc/sdf/E2E_Trace_upl";var n;var a=false;var o=function(e){this.idx=e.xidx;this.dsrGuid=e.xDsrGuid;this.method=e.xmethod;this.url=e.xurl;this.reqHeader=e.xRequestHeaders;this.respHeader=e.getAllResponseHeaders();this.statusCode=e.status;this.status=e.statusText;this.startTimestamp=e.xstartTimestamp;this.firstByteSent=e.xfirstByteSent?e.xfirstByteSent:e.xstartTimestamp;this.lastByteSent=this.firstByteSent;this.firstByteReceived=e.xfirstByteReceived?e.xfirstByteReceived:e.xlastByteReceived;this.lastByteReceived=e.xlastByteReceived;this.sentBytes=0;this.receivedBytes=e.responseText.length;this.getDuration=function(){return this.lastByteReceived-this.startTimestamp};this.getRequestLine=function(){return this.method+" "+this.url+" HTTP/?.?"};this.getRequestHeader=function(){var e=this.getRequestLine()+"\r\n";for(var t=0,s=this.reqHeader?this.reqHeader.length:0;t<s;t+=1){e+=this.reqHeader[t][0]+": "+this.reqHeader[t][1]+"\r\n"}e+="\r\n";return e};this.getResponseHeader=function(){var e="HTTP?/? "+this.statusCode+" "+this.status+"\r\n";e+=this.respHeader;e+="\r\n";return e}};var d=function(t,s,i,n){this.busTrx=t;this.trxStepIdx=s;this.name="Step-"+(s+1);this.date=i;this.trcLvl=n;this.messages=[];this.msgIdx=-1;this.pendingMessages=0;this.transactionStepTimeoutId=null;this.messageStarted=function(){this.msgIdx+=1;this.pendingMessages+=1;return this.msgIdx};this.onMessageFinished=function(t,s){if(t.xurl===r){return}e.sap.log.info(s+", "+this.xidx+": MessageFinished");t.xlastByteReceived=s;this.messages.push(new o(t));this.pendingMessages-=1;if(this.pendingMessages===0){if(this.transactionStepTimeoutId){clearTimeout(this.transactionStepTimeoutId)}this.transactionStepTimeoutId=setTimeout(p,3e3)}};this.getId=function(){return this.busTrx.id+"-"+this.trxStepIdx};this.getTraceFlagsAsString=function(){return this.trcLvl[1].toString(16)+this.trcLvl[0].toString(16)}};var u=function(e,t,s,i){this.id=e;this.date=t;this.trcLvl=s;this.trxSteps=[];this.fnCallback=i;this.createTransactionStep=function(){var e=new d(this,this.trxSteps.length,new Date,this.trcLvl);this.trxSteps.push(e)};this.getCurrentTransactionStep=function(){return this.trxSteps[this.trxSteps.length-1]};this.getBusinessTransactionXml=function(){var e='<?xml version="1.0" encoding="UTF-8"?><BusinessTransaction id="'+this.id+'" time="'+c(this.date)+'" name="'+(window.document.title||"SAPUI5 Business Transaction")+'">';for(var t=0,s=this.trxSteps.length;t<s;t+=1){var i=this.trxSteps[t];e+='<TransactionStep id="'+i.getId()+'" time="'+c(i.date)+'" name="'+i.name+'" traceflags="'+i.getTraceFlagsAsString()+'">';var r=i.messages;for(var n=0,a=r.length;n<a;n+=1){var o=r[n];e+='<Message id="'+o.idx+'" dsrGuid="'+o.dsrGuid+'">';e+="<x-timestamp>"+c(new Date(o.startTimestamp))+"</x-timestamp>";e+="<duration>"+Math.ceil(o.getDuration())+"</duration>";e+="<returnCode>"+o.statusCode+"</returnCode>";e+="<sent>"+o.sentBytes+"</sent>";e+="<rcvd>"+o.receivedBytes+"</rcvd>";if(o.firstByteSent&&o.lastByteReceived){e+="<firstByteSent>"+c(new Date(o.firstByteSent))+"</firstByteSent>";e+="<lastByteSent>"+c(new Date(o.lastByteSent))+"</lastByteSent>";e+="<firstByteReceived>"+c(new Date(o.firstByteReceived))+"</firstByteReceived>";e+="<lastByteReceived>"+c(new Date(o.lastByteReceived))+"</lastByteReceived>"}e+="<requestLine><![CDATA["+o.getRequestLine()+"]]></requestLine>";e+="<requestHeader><![CDATA["+o.getRequestHeader()+"]]></requestHeader>";e+="<responseHeader><![CDATA["+o.getResponseHeader()+"]]></responseHeader>";e+="</Message>"}e+="</TransactionStep>"}e+="</BusinessTransaction>";return e}};var p=function(){if(n.getCurrentTransactionStep().pendingMessages===0&&n.getCurrentTransactionStep().messages.length>0){var t=confirm("End of transaction step detected.\nNumber of new message(s): "+n.getCurrentTransactionStep().messages.length+"\n\nDo you like to record another transaction step?");if(t){n.createTransactionStep()}else{var s=n.getBusinessTransactionXml();if(n.fnCallback&&typeof n.fnCallback==="function"){n.fnCallback(s)}var i="----------ieoau._._+2_8_GoodLuck8.3-ds0d0J0S0Kl234324jfLdsjfdAuaoei-----";var o=i+"\r\nContent-Disposition: form-data\r\nContent-Type: application/xml\r\n"+s+"\r\n"+i;var d=new window.XMLHttpRequest;d.open("HEAD",r,false);d.send();if(d.status==200){var u=new window.XMLHttpRequest;u.open("POST",r,false);u.setRequestHeader("Content-type",'multipart/form-data; boundary="'+i+'"');u.send(o);alert(u.responseText)}else{try{var p=true;while(p){var c=window.prompt("Please enter a valid URL for the store server","http://<host>:<port>");if(c===""||c===null){break}var h=new RegExp("(https?://(?:www.|(?!www))[^s.]+.[^s]{2,}|www.[^s]+.[^s]{2,})");var f=h.test(c);if(f){var u=new window.XMLHttpRequest;u.open("POST",c+"/E2EClientTraceUploadW/UploadForm.jsp",false);u.setRequestHeader("Content-type",'multipart/form-data; boundary="'+i+'"');u.send(o);break}}}catch(t){e.sap.log.error(t.name+": "+t.message,"","sap.ui.core.support.trace.E2eTraceLib")}}n=null;a=false}}};var c=function(e){var t="";t+=e.getUTCDate()<10?"0"+e.getUTCDate():e.getUTCDate();t+="."+(e.getUTCMonth()<9?"0"+(e.getUTCMonth()+1):e.getUTCMonth()+1);t+="."+e.getUTCFullYear();t+=" "+(e.getUTCHours()<10?"0"+e.getUTCHours():e.getUTCHours());t+=":"+(e.getUTCMinutes()<10?"0"+e.getUTCMinutes():e.getUTCMinutes());t+=":"+(e.getUTCSeconds()<10?"0"+e.getUTCSeconds():e.getUTCSeconds());t+="."+(e.getUTCMilliseconds()<100?e.getUTCMilliseconds()<10?"00"+e.getUTCMilliseconds():"0"+e.getUTCMilliseconds():e.getUTCMilliseconds());t+=" UTC";return t};(function(){var s,i;var r=function(t){e.sap.log.info(t,"","E2ETraceLibIE");return t};if(window.performance&&performance.timing&&performance.timing.navigationStart){if(t.browser.chrome&&t.browser.version>=49){r=function(t){e.sap.log.info(t,"","E2ETraceLibCR");return performance.timing.navigationStart+t}}else if(t.browser.firefox&&t.browser.version>=48){r=function(t){e.sap.log.info(t,"","E2ETraceLibFF");return performance.timing.navigationStart+t}}}function o(t){e.sap.log.info(r(t.timeStamp)+", "+this.xidx+": loadstart");this.xfirstByteSent=r(t.timeStamp)}function d(t){e.sap.log.info(r(t.timeStamp)+", "+this.xidx+": progress");if(t.loaded>0){if(!this.xfirstByteReceived){this.xfirstByteReceived=r(t.timeStamp)}this.xlastByteReceived=r(t.timeStamp)}}function u(t){var s=r(t.timeStamp);e.sap.log.info(s+", "+this.xidx+": error");n.getCurrentTransactionStep().onMessageFinished(this,s)}function p(t){var s=r(t.timeStamp);e.sap.log.info(s+", "+this.xidx+": abort");n.getCurrentTransactionStep().onMessageFinished(this,s)}function c(t){var s=r(t.timeStamp);e.sap.log.info(s+", "+this.xidx+": load");n.getCurrentTransactionStep().onMessageFinished(this,s)}e.sap.passport.setActive(true);s=window.XMLHttpRequest.prototype.open;i=window.XMLHttpRequest.prototype.setRequestHeader;window.XMLHttpRequest.prototype.setRequestHeader=function(){i.apply(this,arguments);if(a){if(!this.xRequestHeaders){this.xRequestHeaders=[]}this.xRequestHeaders.push(arguments)}};window.XMLHttpRequest.prototype.open=function(){s.apply(this,arguments);if(a){var t=n.getCurrentTransactionStep().messageStarted();this.xidx=t;if(window.performance&&performance.timing.navigationStart&&performance.now!==undefined){this.xstartTimestamp=performance.timing.navigationStart+performance.now()}else{this.xstartTimestamp=Date.now()}this.xmethod=arguments[0];this.xurl=arguments[1];this.xDsrGuid=e.sap.fesr.getCurrentTransactionId();this.setRequestHeader("X-CorrelationID",n.getCurrentTransactionStep().getId()+"-"+t);this.addEventListener("loadstart",o,false);this.addEventListener("progress",d,false);this.addEventListener("error",u,false);this.addEventListener("abort",p,false);this.addEventListener("load",c,false);t+=1}}})();var h={start:function(t,s){if(!a){if(!t){t=i}n=new u(e.sap.fesr.getRootId(),new Date,e.sap.passport.traceFlags(t),s);n.createTransactionStep();a=true}},isStarted:function(){return a}};if(/sap-ui-xx-e2e-trace=(true|x|X)/.test(location.search)){h.start()}return h}();return s},true);