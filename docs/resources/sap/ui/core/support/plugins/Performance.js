/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/support/Plugin"],function(e,t){"use strict";var i=[];var r=0;var a=0;var n=250;var s=false;var d;var o={selectedInterval:{start:0,end:0},nodes:{slider:null,handle:null,leftResizeHandle:null,rightResizeHandle:null},consts:{LEFT_HANDLE_ID:"left",RIGHT_HANDLE_ID:"right"},sizes:{width:0,handleWidth:0,handleMinWidth:10},drag:{handleClickOffsetX:0,handleOffsetLeft:0,isResize:false,whichResizeHandle:""}};var l=t.extend("sap.ui.core.support.plugins.Performance",{constructor:function(e){t.apply(this,["sapUiSupportPerf","Performance",e]);d=this;this._oStub=e;if(this.runsAsToolPlugin()){this._aEventIds=[this.getId()+"SetMeasurements",this.getId()+"SetActive"]}else{this._aEventIds=[this.getId()+"Refresh",this.getId()+"Clear",this.getId()+"Start",this.getId()+"End",this.getId()+"Activate"]}}});l.prototype.init=function(e){t.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){u.call(this,e)}else{f.call(this,e)}};l.prototype.exit=function(e){t.prototype.exit.apply(this,arguments)};function u(e){var t=sap.ui.getCore().createRenderManager();t.write(g());t.flush(this.$().get(0));t.destroy();H()}function f(e){c.call(this)}function c(t){var i=e.sap.measure.getAllMeasurements(true);this._oStub.sendEvent(this.getId()+"SetMeasurements",{measurements:i})}l.prototype.onsapUiSupportPerfSetMeasurements=function(e){var t=e.getParameter("measurements");this.setData(t)};l.prototype.onsapUiSupportPerfRefresh=function(e){c.call(this)};l.prototype.onsapUiSupportPerfClear=function(t){e.sap.measure.clear();this._oStub.sendEvent(this.getId()+"SetMeasurements",{measurements:[]})};l.prototype.onsapUiSupportPerfStart=function(t){e.sap.measure.start(this.getId()+"-perf","Measurement by support tool")};l.prototype.onsapUiSupportPerfEnd=function(t){e.sap.measure.end(this.getId()+"-perf");c.call(this)};l.prototype.onsapUiSupportPerfActivate=function(t){e.sap.measure.setActive(true)};l.prototype.setData=function(e){var t=document.querySelector("#sapUiSupportNoDataOverlay");var r=document.querySelector("#slider");var n=document.querySelector("#sapUiSupportPerfHeaderTimelineOverview .timeline");if(e.length===0){t.style.display="block";r.classList.add("sapUiSupportHidden");n.innerHTML="";return}else{r.classList.remove("sapUiSupportHidden");t.style.display=""}i=JSON.parse(JSON.stringify(e));i=i.sort(function(e,t){return e.start-t.start});var s=e[0].start;i=i.map(function(e){e.start=parseFloat((e.start-s).toFixed(2));e.end=parseFloat((e.end-s).toFixed(2));e.uid=S();return e});a=i[i.length-1].end-i[0].start;o.selectedInterval.start=i[0].start;o.selectedInterval.end=i[i.length-1].end;N();T(i);I(i);A()};var p=10;var h=0;var v;function m(e){clearInterval(v);if(s){s=false;d._oStub.sendEvent(d.getId()+"End");e.target.setAttribute("data-state","Start recording ("+(h/1e3).toFixed(2)+" s)")}else{h=0;s=true;d._oStub.sendEvent(d.getId()+"Activate");d._oStub.sendEvent(d.getId()+"Clear");d._oStub.sendEvent(d.getId()+"Start");e.target.setAttribute("data-state","Stop recording ("+(h/1e3).toFixed(2)+" s)");v=setInterval(function(){h+=p;e.target.setAttribute("data-state","Stop recording ("+(h/1e3).toFixed(2)+" s)")},p)}}function g(){return""+'<section id="sapUiSupportPerf">'+'<section id="sapUiSupportNoDataOverlay"></section>'+'<section id="sapUiSupportPerfHeader">'+'<div class="sapUiSupportToolbar">'+'<label class="sapUiSupportLabel">Order:</label>'+'<select id="sapUiSupportPerfHeaderFilterSort" class="sapUiSupportTxtFld sapUiSupportSelect" name="orderBy">'+'<option value="chronologically">Chronologically</option>'+'<option value="time">By Time</option>'+'<option value="duration">By Duration</option>'+"</select>"+'<label class="sapUiSupportLabel">Min. Duration:</label>'+'<input id="sapUiSupportPerfHeaderFilterMinDuration" type="number" min="0" value="0" />'+'<label class="sapUiSupportLabel"> ms.</label>'+'<div class="flex-spacer"></div>'+'<div id="categories"></div>'+"</div>"+'<section id="sapUiSupportPerfHeaderTimelineOverview">'+'<div class="timeline"></div>'+'<button id="sapUiSupportPerfToggleRecordingBtn"></button>'+'<div id="slider">'+'<div id="slideHandle">'+'<span id="leftHandle"></span>'+'<span id="rightHandle"></span>'+"</div>"+"</div>"+"</section>"+"</section>"+'<section id="sapUiSupportPerfHeaderTimeline">'+'<div id="sapUiSupportPerfHeaderTimelineBarInfoWrapper"></div>'+'<div id="sapUiSupportPerfHeaderTimelineBarWrapper"></div>'+"</section>"+"</section>"}function y(e){return i.reduce(function(t,i){if(i.uid===e){t=i}return t},null)}function S(){return"uID-"+(S.id!==undefined?++S.id:S.id=0)}function H(){document.querySelector("#sapUiSupportPerfHeaderFilterSort").addEventListener("change",I,false);document.querySelector("#sapUiSupportPerfHeaderFilterMinDuration").addEventListener("change",I,false);document.querySelector("#categories").addEventListener("change",I,false);document.querySelector("#sapUiSupportPerfHeaderTimelineBarWrapper").addEventListener("mouseover",_,false);document.querySelector("#sapUiSupportPerfHeaderTimelineBarInfoWrapper").addEventListener("mouseover",_,false);window.addEventListener("resize",function(){I();k()},false);window.addEventListener("keydown",V);e("#slideHandle").on("dblclick",N);e("#sapUiSupportPerfToggleRecordingBtn").click(m).attr("data-state","Start recording")}function L(e,t){return"Duration: "+e.toFixed(2)+" ms.\nTime: "+t.toFixed(2)+" ms."}function x(e){var t=50;var i=a/t;var r=[];for(var n=0;n<t;n++){var s=i*n;var d=s+i;var o=D({start:s,end:d},e);var l=o.map(function(e){return{category:e.categories[0],duration:e.duration}});var u={_total:0};l.map(function(e){if(!u[e.category]){u[e.category]=0}u._total+=e.duration;u[e.category]=u[e.category]+e.duration});var f=o.map(function(e){return{category:e.categories[0],time:e.time}});var c={_total:0};f.map(function(e){if(!c[e.category]){c[e.category]=0}c._total+=e.time;c[e.category]=c[e.category]+e.time});r.push({duration:u,time:c})}return r}function T(e){var t=document.querySelector("#sapUiSupportPerfHeaderTimelineOverview .timeline");var i="<ol>";var r=JSON.parse(JSON.stringify(e));var a=r.map(function(e){return e.duration}).reduce(function(e,t){return e+t});var n=r.map(function(e){return e.time}).reduce(function(e,t){return e+t});var s=x(r);var d={time:{_total:0}};var o={duration:{_total:0}};s.forEach(function(e){if(d.time._total<e.time._total){d=e}if(o.duration._total<e.duration._total){o=e}});n=d.time._total;a=o.duration._total;function l(e,t){var i="";Object.keys(e.duration).sort().forEach(function(r){if(r!=="_total"){var a=e[t][r]/e[t]._total*100;i+='<div class="'+E(r)+'" style="height: '+a.toFixed(2)+'%;"></div>'}});return i}s.forEach(function(e){var t=Math.ceil(e.duration._total/a*100);var r=Math.ceil(e.time._total/n*100);var s="height: "+t+"%;";if(t>0){s+=" min-height: 1px;"}var d="height: "+r+"%;";if(r>0){d+=" min-height: 1px;"}i+="<li>";i+='<div class="bars-wrapper" title="'+L(e.duration._total,e.time._total)+'">';i+='<div class="duration" style="'+s+'">';i+=l(e,"duration");i+="</div>";i+='<div class="time" style="'+d+'">';i+=l(e,"time");i+="</div>";i+="</div></li>"});i+="</ol>";t.innerHTML=i}function I(){var e="<ol>";var t="<ol>";var r=q();var a=W(i,r);if(a.length===0){e+='<li class="line nodata" data-uid="'+-1+'"></li>';t+='<li class="line nodata" data-uid="'+-1+'"><div class="info line">No data</div></li>'}a.forEach(function(i){var a=y(i.uid);e+='<li data-uid="'+i.uid+'" class="line" title="'+M(a)+'"'+O(a)+"  >";e+='<div class="bar '+U(a.duration)+'" style="width: '+z(i.duration)+" margin-left: "+w(i,r.filterByTime.start)+'">';e+='<div class="sub-bar '+U(a.time)+'" style="width: '+z(i.time)+'"></div>';e+="</div>";e+="</li>";t+='<li data-uid="'+i.uid+'" title="'+M(a)+'" class="line '+E(a.categories[0])+'" '+O(a)+">";t+='<div class="info line">'+b(a)+" ("+a.time.toFixed(0)+" ms)</div>";t+="</li>"});e+="</ol>";t+="</ol>";document.querySelector("#sapUiSupportPerfHeaderTimelineBarWrapper").innerHTML=e;document.querySelector("#sapUiSupportPerfHeaderTimelineBarInfoWrapper").innerHTML=t;C(r);B()}function z(e){var t=e*r;var i=Math.max(t,1);return i+"px;"}function w(e,t){var i=(e.start-t)*r;return i.toFixed(0)+"px"}function M(t){return e.sap.escapeHTML(t.info+"\nduration: "+t.duration.toFixed(2)+" ms. \ntime: "+t.time.toFixed(2)+" ms. \nstart: "+t.start.toFixed(2)+" ms.\nend: "+t.end.toFixed(2)+" ms.")}function b(t){var i=t.info;i=i.substring(i.lastIndexOf("/")+1,i.length);i=i.substring(i.lastIndexOf("sap.m."),i.length);i=i.replace("Rendering of ","");return e.sap.escapeHTML(i)}function E(t){var i="unknownType";if(t.indexOf("require")!==-1){i="requireModuleType"}else if(t.indexOf("xmlhttprequest")!==-1){i="requestType"}else if(t.indexOf("javascript")!==-1){i="afterRenderingType"}else if(t.indexOf("rendering")!==-1){i="renderingType"}return e.sap.escapeHTML(i)}function U(e){var t="";if(e>200){t="oneTimeStyle"}if(e>500){t="twoTimeStyle"}if(e>1e3){t="threeTimeStyle"}if(e>2e3){t="fourTimeStyle"}if(e>3e3){t="fiveTimeStyle"}if(e>4e3){t="sixTimeStyle"}return t}function P(e){var t=[];e.forEach(function(e){if(t.indexOf(e.categories[0])===-1){t.push(e.categories[0])}});return t}function O(e){return"data-item-category = "+e.categories[0]}function _(e){var t=e.srcElement;if(t.classList.contains("info")&&t.nodeName==="DIV"){t=t.parentNode}if(t.nodeName==="LI"){var i=t.getAttribute("data-uid");var r=document.querySelector("#sapUiSupportPerfHeaderTimelineBarInfoWrapper li.hover");var a=document.querySelector("#sapUiSupportPerfHeaderTimelineBarWrapper li.hover");if(r&&a){r.classList.remove("hover");a.classList.remove("hover")}var n=document.querySelector('#sapUiSupportPerfHeaderTimelineBarInfoWrapper li[data-uid="'+i+'"]');var s=document.querySelector('#sapUiSupportPerfHeaderTimelineBarWrapper li[data-uid="'+i+'"]');if(n&&s){n.classList.add("hover");s.classList.add("hover")}}}function W(e,t){var i=JSON.parse(JSON.stringify(e));var a=document.querySelector("#sapUiSupportPerfHeaderTimeline").offsetWidth-document.querySelector("#sapUiSupportPerfHeaderTimelineBarInfoWrapper").offsetWidth;var n=20;var s=1;i=D(t.filterByTime,i);i=F(t.orderByValue,i);i=R(t.minValue,i);if(i.length){s=t.filterByTime.end-t.filterByTime.start}r=(a-n)/s;return i}function q(){var e={};var t=document.querySelector("#sapUiSupportPerfHeaderFilterSort");e.orderByValue=t.options[t.selectedIndex].value;e.minValue=document.querySelector("#sapUiSupportPerfHeaderFilterMinDuration").valueAsNumber||0;e.filterByTime={start:o.selectedInterval.start,end:o.selectedInterval.end};return e}function B(){var e=document.querySelectorAll("#categories input");function t(e,t){var i=E(e);var r=document.querySelectorAll('li[data-item-category="'+e+'"]');var a=document.querySelectorAll(".timeline .bars-wrapper ."+i);for(var n=0;n<r.length;n++){r[n].style.display=t?"":"none"}for(var s=0;s<a.length;s++){a[s].style.display=t?"":"none"}}for(var i=0;i<e.length;i++){t(e[i].name,e[i].checked)}}function F(e,t){if(e==="time"||e==="duration"){document.querySelector("body").classList.add("flattenBarOffset")}else{document.querySelector("body").classList.remove("flattenBarOffset")}if(e==="time"){t=t.sort(function(e,t){if(e.time>t.time){return-1}if(e.time<t.time){return 1}return 0})}if(e==="duration"){t=t.sort(function(e,t){if(e.duration>t.duration){return-1}if(e.duration<t.duration){return 1}return 0})}return t}function R(e,t){return t.filter(function(t){return t.duration>=e})}function D(e,t){return t.filter(function(t){return!(t.end<=e.start||t.start>=e.end)}).map(function(t){var i=Math.max(e.start-t.start,0);var r=Math.max(t.start+t.time-e.end,0);t.time=t.time-i-r;var a=Math.max(e.start-t.start,0);var n=Math.max(t.start+t.duration-e.end,0);t.duration=t.duration-a-n;t.start=Math.max(t.start,e.start);t.end=Math.min(t.end,e.end);return t})}function A(){var t="";var r=P(i);r.forEach(function(i){i=e.sap.escapeHTML(i);t+='<label title="'+i+'"><input class="'+E(i)+'" checked type="checkbox" name="'+i+'" />'+i+"</label>"});var a=document.querySelector("#categories");a.innerHTML=t}function C(e){var t=document.getElementById("sapUiSupportPerfHeaderTimelineBarWrapper");var i=Math.round(t.offsetWidth/10);var r=e.filterByTime.end-e.filterByTime.start;var a=parseInt(r/i,10);if(document.getElementById("grid")){document.getElementById("grid").parentNode.removeChild(document.getElementById("grid"))}var n=document.createElement("div");n.innerHTML='<div class="header"></div><div class="body"></div>';n.id="grid";for(var s=1;s<=i;s++){var d=document.createElement("div");var o=document.createElement("div");if(s%5===0||s===1){var l=parseInt(e.filterByTime.start,10);if(s!==1){l+=s*a}l=l>500?(l/1e3).toFixed(2)+" s":l+" ms";o.setAttribute("data-time",l)}n.querySelector(".body").appendChild(d);n.querySelector(".header").appendChild(o)}document.querySelector("#sapUiSupportPerf").appendChild(n)}function N(){o.nodes.slider=o.nodes.slider||document.querySelector("#slider");o.nodes.handle=o.nodes.handle||document.querySelector("#slideHandle");o.nodes.leftResizeHandle=o.nodes.leftResizeHandle||document.querySelector("#leftHandle");o.nodes.rightResizeHandle=o.nodes.rightResizeHandle||document.querySelector("#rightHandle");o.nodes.handle.style.left=0;o.nodes.handle.style.width="100%";k();o.nodes.slider.addEventListener("mousedown",X)}function k(){var e=window.getComputedStyle(o.nodes.handle).width;var t=o.sizes.width;o.sizes.handleWidth=parseInt(e,10);o.sizes.width=o.nodes.slider.offsetWidth;if(o.sizes.width!==o.sizes.handleWidth){K(t)}G()}function X(e){var t=e.target.id;var i=n+o.sizes.handleWidth/2;var r=Math.max(e.clientX-i,0);var a=o.sizes.width-o.sizes.handleWidth;var s=Math.min(r,a);if(t===o.nodes.slider.id){o.nodes.handle.style.left=s+"px";o.drag.handleOffsetLeft=o.nodes.handle.offsetLeft;o.drag.isResize=false}else if(t===o.nodes.handle.id){o.drag.handleClickOffsetX=e.offsetX;o.drag.isResize=false}else if(t===o.nodes.leftResizeHandle.id){o.drag.whichResizeHandle=o.consts.LEFT_HANDLE_ID;o.drag.isResize=true}else if(t===o.nodes.rightResizeHandle.id){o.drag.whichResizeHandle=o.consts.RIGHT_HANDLE_ID;o.drag.isResize=true}else{return}window.addEventListener("mousemove",J);window.addEventListener("mouseup",j)}function J(e){e.stopImmediatePropagation();var t;var i=e.clientX-n;if(o.drag.isResize){$(e);return}var r=o.sizes.width-o.sizes.handleWidth+o.drag.handleClickOffsetX;t=Math.max(Math.min(i,r),o.drag.handleClickOffsetX);o.nodes.handle.style.left=t-o.drag.handleClickOffsetX+"px"}function V(e){var t=0;var i=37;var r=39;var a=5;if(e.keyCode!=i&&e.keyCode!=r){return}else if(e.keyCode==i){t=-a}else if(e.keyCode==r){t=a}var n=Math.min(o.drag.handleOffsetLeft+t,o.sizes.width-o.sizes.handleWidth);o.drag.handleOffsetLeft=Math.max(n,0);o.nodes.handle.style.left=o.drag.handleOffsetLeft+"px";Q();I()}function j(e){e.stopImmediatePropagation();window.removeEventListener("mousemove",J);window.removeEventListener("mouseup",j);G()}function G(){var e=window.getComputedStyle(o.nodes.handle).width;o.sizes.handleWidth=parseInt(e,10);o.drag.handleOffsetLeft=o.nodes.handle.offsetLeft;var t="(Double click to expand)";o.nodes.slider.setAttribute("title",t);Q();I()}function $(e){e.stopImmediatePropagation();var t;var i;var r;var a;var s;var d;var l=e.clientX-n;var u=9;if(o.drag.whichResizeHandle===o.consts.RIGHT_HANDLE_ID){a=l-o.drag.handleOffsetLeft;t=Math.max(a,o.sizes.handleMinWidth);i=o.sizes.width-o.drag.handleOffsetLeft;r=Math.min(t,i);o.nodes.handle.style.width=r+"px"}if(o.drag.whichResizeHandle===o.consts.LEFT_HANDLE_ID){t=o.drag.handleOffsetLeft+o.sizes.handleWidth-o.sizes.handleMinWidth;l=Math.max(Math.min(l,t),0);i=o.drag.handleOffsetLeft+o.sizes.handleWidth;s=Math.min(l,o.sizes.width);d=Math.max(Math.max(s,-2*o.sizes.handleMinWidth),u);r=i-d+9;if(r<=u+o.sizes.handleMinWidth){r-=u;d+=u}o.nodes.handle.style.left=d-u+"px";o.nodes.handle.style.width=r+"px"}}function K(e){var t=o.sizes.width-e;var i=o.sizes.width-o.drag.handleOffsetLeft;var r=o.sizes.handleWidth+t;o.sizes.handleWidth=Math.max(o.sizes.handleMinWidth,Math.min(r,i));o.nodes.handle.style.width=o.sizes.handleWidth+"px";if(o.sizes.width<o.drag.handleOffsetLeft+o.sizes.handleWidth){o.drag.handleOffsetLeft=o.sizes.width-o.sizes.handleWidth;o.nodes.handle.style.left=o.drag.handleOffsetLeft+"px"}}function Q(){if(!i.length){return}var e=o.drag.handleOffsetLeft/o.sizes.width*100;var t=e+o.sizes.handleWidth/o.sizes.width*100;var r=i[i.length-1].end/100;o.selectedInterval.start=(e*r).toFixed(0);o.selectedInterval.end=(t*r).toFixed(0)}return l});