/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/core/ElementMetadata","../Plugin"],function(t,e,a,i){"use strict";var n=t;var r=i.extend("sap.ui.core.support.plugins.Breakpoint",{constructor:function(t){i.apply(this,["sapUiSupportBreakpoint","",t]);this._oStub=t;this._methodType={clazz:1,proto:2};this._mBreakpointData={classes:{},instances:{}};this._idPrefix="id_";this._methodPrefix="method_";this._classPrefix="class_";this._bAlertNoDebugger=false;this._aEventIds=[this.getId()+"RequestInstanceMethods",this.getId()+"ChangeInstanceBreakpoint",this.getId()+"RequestClasses",this.getId()+"RequestClassMethods",this.getId()+"ChangeClassBreakpoint",this.getId()+"RemoveAllClassBreakpoints"]}});r.prototype.isToolPlugin=function(){return false};r.prototype.isAppPlugin=function(){return true};r.prototype.init=function(t){i.prototype.init.apply(this,arguments);window.bp=this;this.requestClasses("sapUiSupportDebuggingReceiveClasses")};r.prototype.onsapUiSupportBreakpointRequestInstanceMethods=function(t){var e=t.getParameter("callback"),a=t.getParameter("controlId");var i=this.getInstanceMethods(a);this._oStub.sendEvent(e,{methods:JSON.stringify(i),breakpointCount:JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length}),controlId:a})};r.prototype.onsapUiSupportBreakpointChangeInstanceBreakpoint=function(t){var e={controlId:t.getParameter("controlId"),methodName:t.getParameter("methodName"),active:t.getParameter("active")},a=t.getParameter("callback");this.changeInstanceBreakpoint(e.controlId,e.methodName,e.active);var i=this.getInstanceMethods(e.controlId);e.breakpointCount=JSON.stringify({active:i.filter(function(t){return t.active}).length,all:i.length});e.methods=JSON.stringify(i);this._oStub.sendEvent(a,e)};r.prototype.requestClasses=function(t){this._oStub.sendEvent(t,{classes:JSON.stringify(this.getClasses())})};r.prototype.onsapUiSupportBreakpointRequestClasses=function(t){this.requestClasses(t.getParameter("callback"))};r.prototype.onsapUiSupportBreakpointRequestClassMethods=function(t){var e=t.getParameter("callback"),a=t.getParameter("className");var i=this.getClassMethods(a);this._oStub.sendEvent(e,{methods:JSON.stringify(i),breakpointCount:JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length}),className:a})};r.prototype.onsapUiSupportBreakpointChangeClassBreakpoint=function(t){var e={className:t.getParameter("className"),methodName:t.getParameter("methodName"),active:t.getParameter("active"),type:t.getParameter("type")},a=t.getParameter("callback");this.changeClassBreakpoint(e.className,e.methodName,e.active,e.type);var i=this.getClassMethods(e.className);e.breakpointCount=JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length});e.methods=JSON.stringify(i);this._oStub.sendEvent(a,e)};r.prototype.onsapUiSupportBreakpointRemoveAllClassBreakpoints=function(t){var e=t.getParameter("className");var a=this._mBreakpointData.classes[this._classPrefix+e];for(var i in a){this.changeClassBreakpoint(e,i.replace(this._methodPrefix,""),false)}};r.prototype.getInstanceMethods=function(t){var e=sap.ui.getCore().byId(t),a=[];if(!e){return a}for(var i in e){if(!n.isFunction(e[i])){continue}a.push({name:i,active:this.isInstanceBreakpointActive(e,i)})}return a.sort(function(t,e){if(t.name<e.name){return-1}else if(t.name>e.name){return 1}else{return 0}})};r.prototype.getClassMethods=function(e){var a=t.sap.getObject(e);var i=[],r;if(!a){return i}for(r in a){if(!n.isFunction(a[r])){continue}i.push({name:r,type:this._methodType.clazz,active:this.isClassBreakpointActive(e,r)})}function s(t){return i.some(function(e){return e.name===t})}for(r in a.prototype){if(!n.isFunction(a.prototype[r])){continue}if(s(r)){continue}i.push({name:r,type:this._methodType.proto,active:this.isClassBreakpointActive(e,r)})}return i.sort(function(t,e){if(t.name<e.name){return-1}else if(t.name>e.name){return 1}else{return 0}})};r.prototype.getClasses=function(){function e(){var e=[];var i=t.sap.getAllDeclaredModules();for(var n=0;n<i.length;n++){if(e.indexOf(i[n])>-1){continue}var r=t.sap.getObject(i[n]);if(typeof r==="undefined"||r===null){continue}if(typeof r.getMetadata==="function"&&r.getMetadata()instanceof a){e.push(r.getMetadata().getName())}}return e}return e().sort()};r.prototype.changeInstanceBreakpoint=function(t,e,a){var i=sap.ui.getCore().byId(t);if(!i||!e||!i[e]){return}if(this.isInstanceBreakpointActive(i,e)===a){return}if(a){this.applyInstanceMethodHook(t,i,e)}else{this.removeInstanceMethodHook(t,i,e)}};r.prototype.changeClassBreakpoint=function(e,a,i,n){var r=t.sap.getObject(e);if(!r||!a){return}if(this.isClassBreakpointActive(e,a)===i){return}if(i){this.applyClassMethodHook(e,r,a,n)}else{this.removeClassMethodHook(e,r,a)}};r.prototype.getInstanceBreakpointData=function(t,e){if(typeof e==="undefined"){e=false}var a=this._mBreakpointData.instances[this._classPrefix+t.getMetadata().getName()];if(!a){if(e){this._mBreakpointData.instances[this._classPrefix+t.getMetadata().getName()]=a={}}else{return null}}var i=a[this._idPrefix+t.getId()];if(!i){if(e){a[this._idPrefix+t.getId()]=i={}}else{return null}}return i};r.prototype.getClassBreakpointData=function(t,e){if(typeof e==="undefined"){e=false}var a=this._mBreakpointData.classes[this._classPrefix+t];if(!a){if(e){this._mBreakpointData.classes[this._classPrefix+t]=a={}}else{return null}}return a};r.prototype.isInstanceBreakpointActive=function(t,e){var a=this.getInstanceBreakpointData(t);if(!a){return false}var i=a[this._methodPrefix+e];if(!i){return false}return i.active};r.prototype.isClassBreakpointActive=function(t,e){var a=this.getClassBreakpointData(t);if(!a){return false}var i=a[this._methodPrefix+e];if(!i){return false}return i.active};r.prototype.applyInstanceMethodHook=function(t,e,a){var i=this.getInstanceBreakpointData(e,true),n=i[this._methodPrefix+a]||(i[this._methodPrefix+a]={});n.originalMethod=e[a];n.active=true;e[a]=this.methodHook(n.originalMethod)};r.prototype.removeInstanceMethodHook=function(t,e,a){var i=this.getInstanceBreakpointData(e,true),n=i[this._methodPrefix+a];e[a]=n.originalMethod;delete n.originalMethod;n.active=false};r.prototype.applyClassMethodHook=function(t,e,a,i){var n=this.getClassBreakpointData(t,true),r=n[this._methodPrefix+a]||(n[this._methodPrefix+a]={});if(i===this._methodType.clazz){r.originalMethod=e[a];e[a]=this.methodHook(r.originalMethod)}else{r.originalMethod=e.prototype[a];e.prototype[a]=this.methodHook(r.originalMethod)}r.type=i;r.active=true};r.prototype.removeClassMethodHook=function(t,e,a){var i=this.getClassBreakpointData(t,true),n=i[this._methodPrefix+a];if(n.type===this._methodType.clazz){e[a]=n.originalMethod}else{e.prototype[a]=n.originalMethod}delete n.originalMethod;n.active=false};r.prototype.methodHook=function(t){var e=this;return function(){var a=(new Date).getTime();debugger;if((new Date).getTime()-a<50){e._alertNoDebugger()}return t.apply(this,arguments)}};r.prototype._alertNoDebugger=function(){if(this._bAlertNoDebugger){return}var t=null;if(e.browser.chrome){t="Please open your debugger by pressing CTRL + SHIFT + I."}if(e.browser.msie){t="Please open your debugger using F12, go to the 'Script' tab and attach it by pressing F5."}if(t==null){t="Please open your debugger."}this._bAlertNoDebugger=true;alert("There is no debugger attached.\n\n"+t)};return r});