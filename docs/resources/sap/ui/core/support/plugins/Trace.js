/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/support/Plugin","sap/ui/core/format/DateFormat"],function(e,t,i){"use strict";var l=t.extend("sap.ui.core.support.plugins.Trace",{constructor:function(l){t.apply(this,["sapUiSupportTrace","JavaScript Trace",l]);this._aEventIds=this.runsAsToolPlugin()?[this.getId()+"Entry"]:[];if(this.runsAsToolPlugin()){this._aLogEntries=[];this._iLogLevel=e.sap.log.Level.ALL;this._oDateFormat=i.getDateTimeInstance()}else{var r=this;this._oldLogLevel=e.sap.log.getLevel();e.sap.log.setLevel(e.sap.log.Level.ALL);e.sap.log.addLogListener({onLogEntry:function(e){if(r.isActive()){l.sendEvent(r.getId()+"Entry",{entry:e})}}})}}});l.prototype.onsapUiSupportTraceEntry=function(e){r(this,e.getParameter("entry"))};l.prototype.init=function(e){t.prototype.init.apply(this,arguments);if(!this.runsAsToolPlugin()){return}var i=this;var l=sap.ui.getCore().createRenderManager();l.write("<div class='sapUiSupportToolbar'>");l.write("<button id='"+this.getId()+"-clear' class='sapUiSupportRoundedButton'>Clear</button>");l.write("<label class='sapUiSupportLabel'>Filter:</label><input type='text' id='"+this.getId()+"-filter' class='sapUiSupportTxtFld'/>");l.write("<label class='sapUiSupportLabel'>Log Level:</label><select id='"+this.getId()+"-loglevel' class='sapUiSupportTxtFld sapUiSupportSelect'>");l.write("<option value='0'>FATAL</option>");l.write("<option value='1'>ERROR</option>");l.write("<option value='2'>WARNING</option>");l.write("<option value='3'>INFO</option>");l.write("<option value='4'>DEBUG</option>");l.write("<option value='5'>TRACE</option>");l.write("<option value='6' selected=''>ALL</option>");l.write("</select>");l.write("</div><div class='sapUiSupportTraceCntnt'></div>");l.flush(this.$().get(0));l.destroy();this._fClearHandler=function(){r(i)};this._fLogLevelHandler=function(){i._iLogLevel=i.$("loglevel").val();var e=[];for(var t=0;t<i._aLogEntries.length;t++){if(a(i._filter,i._iLogLevel,i._aLogEntries[t])){e.push(s(i,i._aLogEntries[t]))}}r(i,e.join(""))};this._fFilterHandler=function(){i._filter=i.$("filter").val();i._filter=i._filter?i._filter.toLowerCase():"";var e=[];for(var t=0;t<i._aLogEntries.length;t++){if(a(i._filter,i._iLogLevel,i._aLogEntries[t])){e.push(s(i,i._aLogEntries[t]))}}r(i,e.join(""))};this.$("clear").bind("click",this._fClearHandler);this.$("filter").bind("change",this._fFilterHandler);this.$("loglevel").bind("change",this._fLogLevelHandler)};l.prototype.exit=function(i){if(this.runsAsToolPlugin()){if(this._fClearHandler){this.$("clear").unbind("click",this._fClearHandler);this._fClearHandler=null}if(this._fFilterHandler){this.$("filter").unbind("change",this._fFilterHandler);this._fFilterHandler=null}if(this._fLogLevelHandler){this.$("loglevel").unbind("change",this._fLogLevelHandler);this._fLogLevelHandler=null}}else{e.sap.log.setLevel(this._oldLogLevel);this._oldLogLevel=null}t.prototype.exit.apply(this,arguments)};function r(t,i){var l=e(".sapUiSupportTraceCntnt",t.$());if(!i){l.html("");t._aLogEntries=[]}else if(typeof i==="string"){l.html(e.sap.encodeHTML(i));l[0].scrollTop=l[0].scrollHeight}else{i._levelInfo=o(i.level);if(a(t._filter,t._iLogLevel,i)){l.append(s(t,i));l[0].scrollTop=l[0].scrollHeight}t._aLogEntries.push(i)}}function s(t,i){var l=i._levelInfo;var r=" style='color:"+l[1]+";'";var s="<div class='sapUiSupportTraceEntry'><span class='sapUiSupportTraceEntryLevel'"+r+">"+l[0]+"</span><span class='sapUiSupportTraceEntryTime'"+r+">"+t._oDateFormat.format(new Date(i.timestamp))+"</span><span class='sapUiSupportTraceEntryMessage'>"+e.sap.escapeHTML(i.message||"")+"</div>";return s}function a(e,t,i){var l=i._levelInfo;if(i._levelInfo[2]<=t){if(e){var r=e.split(" ");var s=true;for(var a=0;a<r.length;a++){s=s&&i.message.toLowerCase().indexOf(r[a])>=0||l[0].toLowerCase().indexOf(r[a])>=0}return s}return true}return false}function o(t){switch(t){case e.sap.log.Level.FATAL:return["FATAL","#E60000",t];case e.sap.log.Level.ERROR:return["ERROR","#E60000",t];case e.sap.log.Level.WARNING:return["WARNING","#FFAA00",t];case e.sap.log.Level.INFO:return["INFO","#000000",t];case e.sap.log.Level.DEBUG:return["DEBUG","#000000",t];case e.sap.log.Level.TRACE:return["TRACE","#000000",t]}return["unknown","#000000",t]}return l});