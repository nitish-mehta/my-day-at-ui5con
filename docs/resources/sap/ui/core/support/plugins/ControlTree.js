/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/support/Plugin","sap/ui/core/util/serializer/ViewSerializer","sap/ui/thirdparty/jszip","sap/ui/base/DataType","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/ui/core/UIArea","sap/ui/core/mvc/View","sap/ui/core/mvc/Controller","sap/ui/model/Binding","sap/ui/model/CompositeBinding","jquery.sap.keycodes"],function(t,e,i,r,o,a,n,s,p,l,d,c){"use strict";var u=t;var g=e.extend("sap.ui.core.support.plugins.ControlTree",{constructor:function(t){e.apply(this,["sapUiSupportControlTree","Control Tree",t]);this._oStub=t;if(this.runsAsToolPlugin()){this._aEventIds=["sapUiSupportSelectorSelect",this.getId()+"ReceiveControlTree",this.getId()+"ReceiveControlTreeExport",this.getId()+"ReceiveControlTreeExportError",this.getId()+"TriggerRequestProperties",this.getId()+"ReceiveProperties",this.getId()+"ReceiveBindingInfos",this.getId()+"ReceiveMethods",this.getId()+"ReceivePropertiesMethods"];this._breakpointId="sapUiSupportBreakpoint";this._tab={properties:"Properties",bindinginfos:"BindingInfos",breakpoints:"Breakpoints",exports:"Export"};this._currentTab=this._tab.properties}else{this._aEventIds=[this.getId()+"RequestControlTree",this.getId()+"RequestControlTreeSerialize",this.getId()+"RequestProperties",this.getId()+"RequestBindingInfos",this.getId()+"ChangeProperty",this.getId()+"RefreshBinding"];var i=this;sap.ui.getCore().registerPlugin({startPlugin:function(t){i.oCore=t},stopPlugin:function(){i.oCore=undefined}})}}});g.prototype.init=function(t){e.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){h.call(this,t)}else{b.call(this,t)}};function h(t){u(document).on("click","li img.sapUiControlTreeIcon",u.proxy(this._onIconClick,this)).on("click","li.sapUiControlTreeElement div",u.proxy(this._onNodeClick,this)).on("click","li.sapUiControlTreeLink div",u.proxy(this._onControlTreeLinkClick,this)).on("click","#sapUiSupportControlTabProperties",u.proxy(this._onPropertiesTab,this)).on("click","#sapUiSupportControlTabBindingInfos",u.proxy(this._onBindingInfosTab,this)).on("click","#sapUiSupportControlTabBreakpoints",u.proxy(this._onMethodsTab,this)).on("click","#sapUiSupportControlTabExport",u.proxy(this._onExportTab,this)).on("change","[data-sap-ui-name]",u.proxy(this._onPropertyChange,this)).on("change","[data-sap-ui-method]",u.proxy(this._onPropertyBreakpointChange,this)).on("keyup",'.sapUiSupportControlMethods input[type="text"]',u.proxy(this._autoComplete,this)).on("blur",'.sapUiSupportControlMethods input[type="text"]',u.proxy(this._updateSelectOptions,this)).on("change",".sapUiSupportControlMethods select",u.proxy(this._selectOptionsChanged,this)).on("click","#sapUiSupportControlAddBreakPoint",u.proxy(this._onAddBreakpointClicked,this)).on("click","#sapUiSupportControlExportToXml",u.proxy(this._onExportToXmlClicked,this)).on("click","#sapUiSupportControlExportToHtml",u.proxy(this._onExportToHtmlClicked,this)).on("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint",u.proxy(this._onRemoveBreakpointClicked,this)).on("click","#sapUiSupportControlPropertiesArea a.control-tree",u.proxy(this._onNavToControl,this)).on("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding",u.proxy(this._onRefreshBinding,this));this.renderContentAreas()}g.prototype.exit=function(t){e.prototype.exit.apply(this,arguments);if(this.runsAsToolPlugin()){u(document).off("click","li img.sapUiControlTreeIcon").off("click","li div").off("click","li.sapUiControlTreeLink").off("click","#sapUiSupportControlTabProperties").off("click","#sapUiSupportControlTabBindings").off("click","#sapUiSupportControlTabBreakpoints").off("click","#sapUiSupportControlTabExport").off("change","[data-sap-ui-name]").off("change","[data-sap-ui-method]").off("keyup",'.sapUiSupportControlMethods input[type="text"]').off("blur",".sapUiSupportControlMethods select").off("change",".sapUiSupportControlMethods select").off("click","#sapUiSupportControlAddBreakPoint").off("click","#sapUiSupportControlExportToXml").off("click","#sapUiSupportControlExportToHtml").off("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint").off("click","#sapUiSupportControlPropertiesArea a.control-tree").off("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding")}};function f(t){if(t==null){return""}t=String(t);return t.slice(1+t.lastIndexOf("."))}function v(e){return e==null?"":t.sap.encodeHTML(String(e))}g.prototype.renderContentAreas=function(){var t=sap.ui.getCore().createRenderManager();t.write('<div style="padding: 0.5rem">You can find a control in this tree by clicking it in the application UI while pressing the Ctrl+Alt+Shift keys.</div>');t.write('<div id="sapUiSupportControlTreeArea"><ul class="sapUiSupportControlTreeList"></ul></div>');t.write('<div id="sapUiSupportControlTabs" style="visibility:hidden">');t.write('<button id="sapUiSupportControlTabProperties" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabLeft">Properties</button>');t.write('<button id="sapUiSupportControlTabBindingInfos" class="sapUiSupportBtn sapUiSupportTab">Binding Infos</button>');t.write('<button id="sapUiSupportControlTabBreakpoints" class="sapUiSupportBtn sapUiSupportTab">Breakpoints</button>');t.write('<button id="sapUiSupportControlTabExport" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabRight">Export</button>');t.write("</div>");t.write('<div id="sapUiSupportControlPropertiesArea"></div>');t.flush(this.$().get(0));t.destroy()};g.prototype.renderControlTree=function(t){var e=sap.ui.getCore().createRenderManager();function i(t,r){var o=r.aggregation.length>0||r.association.length>0;e.write('<li id="sap-debug-controltree-'+v(r.id)+'" class="sapUiControlTreeElement">');var a=o?"minus":"space";e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" src="../../debug/images/'+a+'.gif" />');if(r.isAssociation){e.write('<img title="Association" class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" src="../../debug/images/link.gif" />')}var n=f(r.type);e.write("<div>");e.write('<span class="name" title="'+v(r.type)+'">'+v(n)+" - "+v(r.id)+"</span>");e.write('<span class="sapUiSupportControlTreeBreakpointCount" title="Number of active breakpoints / methods" style="display:none;"></span>');e.write("</div>");if(r.aggregation.length>0){e.write("<ul>");u.each(r.aggregation,i);e.write("</ul>")}if(r.association.length>0){e.write("<ul>");u.each(r.association,function(t,r){if(r.isAssociationLink){var o=f(r.type);e.write('<li data-sap-ui-controlid="'+v(r.id)+'" class="sapUiControlTreeLink">');e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" align="middle" src="../../debug/images/space.gif" />');e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" align="middle" src="../../debug/images/link.gif" />');e.write("<div><span title=\"Association '"+v(r.name)+"' to '"+v(r.id)+"' with type '"+v(r.type)+"'\">"+v(o)+" - "+v(r.id)+" ("+v(r.name)+")</span></div>");e.write("</li>")}else{i(0,r)}});e.write("</ul>")}e.write("</li>")}u.each(t,i);e.flush(this.$().find("#sapUiSupportControlTreeArea > ul.sapUiSupportControlTreeList").get(0));e.destroy()};g.prototype.renderPropertiesTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+v(e)+'">');u.each(t,function(t,e){i.write("<li>");i.write("<span><label class='sapUiSupportLabel'>BaseType:</label> <code>"+v(e.control)+"</code></span>");if(e.properties.length>0||e.aggregations.length>0){i.write('<div class="get" title="Activate debugger for get-method">G</div><div class="set" title="Activate debugger for set-method">S</div>');i.write('<div class="sapUiSupportControlProperties"><table><colgroup><col width="50%"/><col width="50%"/></colgroup>');u.each(e.properties,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+v(e.name)+(e.isBound?'<img title="Value is bound (see Binding Infos)" src="../../debug/images/link.gif" style="vertical-align:middle;margin-left:3px">':"")+"</label>");i.write("</td><td>");if(e.type==="boolean"){i.write("<input type='checkbox' ");i.write("data-sap-ui-name='"+v(e.name)+"' ");if(e.value==true){i.write("checked='checked'")}i.write("/>")}else if(e.enumValues){i.write("<div><select ");i.write("data-sap-ui-name='"+v(e.name)+"'>");u.each(e.enumValues,function(t,r){i.write("<option");if(t===e.value){i.write(" selected")}i.write(">");i.writeEscaped(""+t);i.write("</option>")});i.write("</select></div>")}else{i.write("<div><input type='text' ");i.write("data-sap-ui-name='"+v(e.name)+"' ");if(e.value){i.write("value='");i.writeEscaped(""+e.value);i.write("'")}i.write("/></div>")}i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+v(e._sGetter)+'" title="Activate debugger for '+v(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("/></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+v(e._sMutator)+'" title="Activate debugger for '+v(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("/></td>");i.write("</tr>")});u.each(e.aggregations,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+v(e.name)+"</label>");i.write("</td><td>");i.write(v(e.value));i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+v(e._sGetter)+'" title="Activate debugger for '+v(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("/></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+v(e._sMutator)+'" title="Activate debugger for '+v(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("/></td>");i.write("</tr>")});i.write("</table></div>")}i.write("</li>")});i.write("</ul>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.$().find("#sapUiSupportControlTabs").css("visibility","");this.selectTab(this._tab.properties)};g.prototype.renderBindingsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();if(t.contexts.length>0){i.write('<h2 style="padding-left:5px">Contexts</h2>');i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+v(e)+'">');u.each(t.contexts,function(t,e){i.write("<li>");i.write('<span><label class="sapUiSupportLabel">Model Name: '+v(e.modelName)+"</label></span>");i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(e.invalidPath){i.write(' style="color:red"')}i.write(">"+v(e.path));if(e.invalidPath){i.write(" (invalid)")}i.write("</span></div>");i.write("</td></tr>");if(e.location){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Inherited from</label>');i.write("</td><td>");i.write('<div><a class="control-tree sapUiSupportLink" title="'+v(e.location.name)+'" data-sap-ui-control-id="'+v(e.location.id)+'" href="#">'+v(f(e.location.name))+" ("+v(e.location.id)+")</a></div>");i.write("</td></tr>")}i.write("</tbody></table></div></li>")});i.write("</ul>")}if(t.bindings.length>0){i.write('<h2 style="padding-left:5px">Bindings</h2>');i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+v(e)+'">');u.each(t.bindings,function(t,e){i.write('<li data-sap-ui-binding-name="'+v(e.name)+'">');i.write("<span>");i.write('<label class="sapUiSupportLabel" style="vertical-align: middle">'+v(e.name)+"</label>");i.write('<img class="sapUiSupportRefreshBinding" title="Refresh Binding" '+'src="../../debug/images/refresh.gif" style="cursor:pointer;margin-left:5px;vertical-align:middle">');i.write("</span>");u.each(e.bindings,function(t,r){i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(r.invalidPath){i.write(' style="color:red"')}i.write(">"+v(r.path));if(r.invalidPath){i.write(" (invalid)")}i.write("</span></div>");i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Absolute Path</label>');i.write("</td><td>");if(typeof r.absolutePath!=="undefined"){i.write("<div>"+v(r.absolutePath)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Relative</label>');i.write("</td><td>");if(typeof r.isRelative!=="undefined"){i.write("<div>"+v(r.isRelative)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Type</label>');i.write("</td><td>");if(!e.type){i.write("<div>No binding</div>")}else{i.write('<div title="'+v(e.type)+'">'+v(f(e.type))+"</div>")}i.write("</td></tr>");if(r.mode){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Mode</label>');i.write("</td><td>");i.write("<div>"+v(r.mode)+"</div>");i.write("</td></tr>")}i.write("<tr><td>");i.write('<label class="sapUiSupportLabel">Model</label>');i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Name</label>');i.write("</td><td>");if(r.model&&r.model.name){i.write("<div>"+v(r.model.name)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Type</label>');i.write("</td><td>");if(r.model&&r.model.type){i.write('<div><span title="'+v(r.model.type)+'">'+v(f(r.model.type))+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Default Binding Mode</label>');i.write("</td><td>");if(r.model&&r.model.bindingMode){i.write("<div><span>"+v(r.model.bindingMode)+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Location</label>');i.write("</td><td>");if(r.model&&r.model.location&&r.model.location.type){if(r.model.location.type==="control"){i.write('<div><a class="control-tree sapUiSupportLink" title="'+v(r.model.location.name)+'" data-sap-ui-control-id="'+v(r.model.location.id)+'" href="#">'+v(f(r.model.location.name))+" ("+v(r.model.location.id)+")</a></div>")}else{i.write('<div><span title="sap.ui.getCore()">Core</span></div>')}}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("</tbody></table></div>")});i.write("</li>")});i.write("</ul>")}i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy()};g.prototype.renderBreakpointsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<div class="sapUiSupportControlMethods" data-sap-ui-controlid="'+v(e)+'">');i.write('<select id="sapUiSupportControlMethodsSelect" class="sapUiSupportAutocomplete sapUiSupportSelect"><option></option>');u.each(t,function(t,e){if(!e.active){i.write("<option>"+v(e.name)+"</option>")}});i.write("</select>");i.write('<input class="sapUiSupportControlBreakpointInput sapUiSupportAutocomplete" type="text"/>');i.write('<button id="sapUiSupportControlAddBreakPoint" class="sapUiSupportRoundedButton ">Add breakpoint</button>');i.write('<hr class="no-border"/><ul id="sapUiSupportControlActiveBreakpoints" class="sapUiSupportList sapUiSupportBreakpointList">');u.each(t,function(t,e){if(!e.active){return}i.write("<li><span>"+v(e.name)+"</span>"+'<img class="remove-breakpoint" style="cursor:pointer;margin-left:5px" '+'src="../../debug/images/delete.gif"></li>')});i.write("</ul></div>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.selectTab(this._tab.breakpoints);this.$().find(".sapUiSupportControlBreakpointInput").focus()};g.prototype.renderExportTab=function(){var t=sap.ui.getCore().createRenderManager();t.write('<button id="sapUiSupportControlExportToXml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To XML</button>');t.write("<br><br>");t.write('<button id="sapUiSupportControlExportToHtml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To HTML</button>');t.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));t.destroy();this.selectTab(this._tab.exports)};g.prototype.requestProperties=function(t){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceivePropertiesMethods"})};g.prototype.updateBreakpointCount=function(t,e){var i=u("#sap-debug-controltree-"+t+" > div span.sapUiSupportControlTreeBreakpointCount");if(e.active>0){i.text(e.active+" / "+e.all).show()}else{i.text("").hide()}};g.prototype.onsapUiSupportControlTreeTriggerRequestProperties=function(t){this.requestProperties(t.getParameter("controlId"))};g.prototype.onsapUiSupportControlTreeReceivePropertiesMethods=function(t){var e=t.getParameter("controlId");this._oStub.sendEvent(this.getId()+"RequestProperties",{id:e,breakpointMethods:t.getParameter("methods")});this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};g.prototype.onsapUiSupportControlTreeReceiveControlTree=function(t){this.renderControlTree(JSON.parse(t.getParameter("controlTree")))};g.prototype.onsapUiSupportControlTreeReceiveControlTreeExportError=function(t){var e=t.getParameter("errorMessage");this._drawAlert(e)};g.prototype._drawAlert=function(t){alert("ERROR: The selected element cannot not be exported.\nPlease choose an other one.\n\nReason:\n"+t)};g.prototype.onsapUiSupportControlTreeReceiveControlTreeExport=function(t){var e;var i=JSON.parse(t.getParameter("serializedViews"));var o=t.getParameter("sType");if(!u.isEmptyObject(i)){e=new r;for(var a in i){var n=i[a];e.file(a.replace(/\./g,"/")+".view."+o.toLowerCase(),n)}}if(e){var s=e.generate({base64:true});var p=window.atob(s);var l=new Uint8Array(p.length);for(var d=0;d<l.length;++d){l[d]=p.charCodeAt(d)}var c=new Blob([l],{type:"application/zip"});var g=document.createEvent("HTMLEvents");g.initEvent("click");u("<a>",{download:o.toUpperCase()+"Export.zip",href:window.URL.createObjectURL(c)}).get(0).dispatchEvent(g)}};g.prototype.onsapUiSupportSelectorSelect=function(t){this.selectControl(t.getParameter("id"))};g.prototype.onsapUiSupportControlTreeReceiveProperties=function(t){this.renderPropertiesTab(JSON.parse(t.getParameter("properties")),t.getParameter("id"))};g.prototype.onsapUiSupportControlTreeReceiveBindingInfos=function(t){this.renderBindingsTab(JSON.parse(t.getParameter("bindinginfos")),t.getParameter("id"))};g.prototype.onsapUiSupportControlTreeReceiveMethods=function(t){var e=t.getParameter("controlId");this.renderBreakpointsTab(JSON.parse(t.getParameter("methods")),e);this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};g.prototype._onNodeClick=function(t){var e=u(t.target);var i=e.closest("li");if(i.hasClass("sapUiControlTreeElement")){u(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");i.children("div").addClass("sapUiSupportControlTreeSelected");this._oStub.sendEvent("sapUiSupportSelectorHighlight",{id:i.attr("id").substring("sap-debug-controltree-".length)});var r=i.attr("id").substring("sap-debug-controltree-".length);if(e.hasClass("sapUiSupportControlTreeBreakpointCount")){this._currentTab=this._tab.breakpoints}this.onAfterControlSelected(r)}t.stopPropagation()};g.prototype._onIconClick=function(t){var e=u(t.target);if(e.parent().attr("data-sap-ui-collapsed")){e.attr("src",e.attr("src").replace("plus","minus")).parent().removeAttr("data-sap-ui-collapsed");e.siblings("ul").show()}else{e.attr("src",e.attr("src").replace("minus","plus")).parent().attr("data-sap-ui-collapsed","true");e.siblings("ul").hide()}if(t.stopPropagation){t.stopPropagation()}};g.prototype._onControlTreeLinkClick=function(t){this.selectControl(u(t.target).closest("li").attr("data-sap-ui-controlid"))};g.prototype._onPropertiesTab=function(t){if(this.selectTab(this._tab.properties)){this.requestProperties(this.getSelectedControlId())}};g.prototype._onBindingInfosTab=function(t){if(this.selectTab(this._tab.bindinginfos)){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};g.prototype._onMethodsTab=function(t){if(this.selectTab(this._tab.breakpoints)){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:this.getSelectedControlId(),callback:this.getId()+"ReceiveMethods"})}};g.prototype._onExportTab=function(t){if(this.selectTab(this._tab.exports)){this.renderExportTab()}};g.prototype._autoComplete=function(e){if(e.keyCode==t.sap.KeyCodes.ENTER){this._updateSelectOptions(e);this._onAddBreakpointClicked()}if(e.keyCode>=t.sap.KeyCodes.ARROW_LEFT&&e.keyCode<=t.sap.KeyCodes.ARROW_DOWN){return}var i=u(e.target),r=i.prev("select"),o=i.val();if(o==""){return}var a=r.find("option").map(function(){return u(this).val()}).get();var n;for(var s=0;s<a.length;s++){n=a[s];if(n.toUpperCase().indexOf(o.toUpperCase())==0){var p=i.cursorPos();if(e.keyCode==t.sap.KeyCodes.BACKSPACE){p--}i.val(n);i.selectText(p,n.length);break}}return};g.prototype._updateSelectOptions=function(t){var e=t.target;if(e.tagName=="INPUT"){var i=e.value;e=e.previousSibling;var r=e.options;for(var o=0;o<r.length;o++){var a=r[o].value||r[o].text;if(a.toUpperCase()==i.toUpperCase()){e.selectedIndex=o;break}}}var n=e.selectedIndex;var s=e.options[n].value||e.options[n].text;if(e.nextSibling&&e.nextSibling.tagName=="INPUT"){e.nextSibling.value=s}};g.prototype._onAddBreakpointClicked=function(t){var e=this.$().find("#sapUiSupportControlMethodsSelect");this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.val(),active:true,callback:this.getId()+"ReceiveMethods"})};g.prototype._onExportToXmlClicked=function(t){this._startSerializing("XML")};g.prototype._onExportToHtmlClicked=function(t){this._startSerializing("HTML")};g.prototype._startSerializing=function(t){var e=this.getSelectedControlId();if(e){this._oStub.sendEvent(this.getId()+"RequestControlTreeSerialize",{controlID:e,sType:t})}else{this._drawAlert("Nothing to export. Please select an item in the control tree.")}};g.prototype._onRemoveBreakpointClicked=function(t){var e=u(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.siblings("span").text(),active:false,callback:this.getId()+"ReceiveMethods"})};g.prototype._selectOptionsChanged=function(t){var e=t.target;var i=e.nextSibling;i.value=e.options[e.selectedIndex].value};g.prototype._onPropertyChange=function(t){var e=t.target;var i=u(e);var r=i.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var o=i.val();if(i.attr("type")==="checkbox"){o=""+i.is(":checked")}this._oStub.sendEvent(this.getId()+"ChangeProperty",{id:r,name:i.attr("data-sap-ui-name"),value:o})};g.prototype._onPropertyBreakpointChange=function(t){var e=u(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.attr("data-sap-ui-method"),active:e.is(":checked"),callback:this.getId()+"TriggerRequestProperties"})};g.prototype._onNavToControl=function(t){var e=u(t.target);var i=e.attr("data-sap-ui-control-id");if(i!==this.getSelectedControlId()){this.selectControl(i)}};g.prototype._onRefreshBinding=function(t){var e=u(t.target);var i=e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var r=e.closest("[data-sap-ui-binding-name]").attr("data-sap-ui-binding-name");this._oStub.sendEvent(this.getId()+"RefreshBinding",{id:i,name:r})};g.prototype.selectTab=function(t){var e=this.$().find("#sapUiSupportControlTab"+t);if(e.hasClass("active")){return false}this.$().find("#sapUiSupportControlTabs button").removeClass("active");e.addClass("active");this._currentTab=t;return true};g.prototype.getSelectedControlId=function(){var t=this.$().find(".sapUiSupportControlTreeSelected");if(t.length===0){return undefined}else{return t.parent().attr("id").substring("sap-debug-controltree-".length)}};g.prototype.selectControl=function(t){if(!t){return}u(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");var e=this;u.sap.byId("sap-debug-controltree-"+t).parents("[data-sap-ui-collapsed]").each(function(t,i){e._onIconClick({target:u(i).find("img:first").get(0)})});var i=u.sap.byId("sap-debug-controltree-"+t).children("div").addClass("sapUiSupportControlTreeSelected").position();var r=this.$().find("#sapUiSupportControlTreeArea").scrollTop();this.$().find("#sapUiSupportControlTreeArea").scrollTop(r+i.top);this.onAfterControlSelected(t)};g.prototype.onAfterControlSelected=function(t){if(this._currentTab==this._tab.properties){this.requestProperties(t)}else if(this._currentTab==this._tab.breakpoints){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceiveMethods"})}else if(this._currentTab==this._tab.bindinginfos){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};function b(t){this.onsapUiSupportControlTreeRequestControlTree()}g.prototype.onsapUiSupportControlTreeRequestControlTree=function(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTree",{controlTree:JSON.stringify(this.getControlTree())})};g.prototype.onsapUiSupportControlTreeRequestControlTreeSerialize=function(t){var e=this.oCore.byId(t.getParameter("controlID"));var r=t.getParameter("sType");var o;var a;sap.ui.controller(r+"ViewController",{});sap.ui.jsview(r+"ViewExported",{getControllerName:function(){return r+"ViewController"},createContent:function(t){}});sap.ui.controller(r+"ViewController",{});sap.ui.jsview(r+"ViewExported",{getControllerName:function(){return r+"ViewController"},createContent:function(t){}});try{if(e){var n=e.getParent();var s;s=n.indexOfContent(e);if(e instanceof p){o=new i(e,window,"sap.m")}else{var l=sap.ui.jsview(r+"ViewExported");l.addContent(e);o=new i(l,window,"sap.m")}a=r&&r!=="XML"?o.serializeToHTML():o.serializeToXML();if(s){n.insertContent(e,s)}else{n.addContent(e)}}else{var d=this.oCore.getUIArea(t.getParameter("controlID"));var l=sap.ui.jsview(r+"ViewExported");var c=d.getContent();for(var u=0;u<c.length;u++){l.addContent(c[u])}o=new i(l,window,"sap.m");a=r&&r!=="XML"?o.serializeToHTML():o.serializeToXML();for(var u=0;u<c.length;u++){d.addContent(c[u])}}if(o){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExport",{serializedViews:JSON.stringify(a),sType:r})}}catch(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExportError",{errorMessage:t.message})}};g.prototype.onsapUiSupportControlTreeRequestProperties=function(t){var e=JSON.parse(t.getParameter("breakpointMethods"));var i=this.getControlProperties(t.getParameter("id"),e);this._oStub.sendEvent(this.getId()+"ReceiveProperties",{id:t.getParameter("id"),properties:JSON.stringify(i)})};g.prototype.onsapUiSupportControlTreeChangeProperty=function(t){var e=t.getParameter("id");var i=this.oCore.byId(e);if(i){var r=t.getParameter("name");var a=t.getParameter("value");var n=i.getMetadata().getProperty(r);if(n&&n.type){var s=o.getType(n.type);if(s instanceof o){var p=s.parseValue(a);if(s.isValid(p)&&p!=="(null)"){i[n._sMutator](p)}}else if(s){if(s[a]){i[n._sMutator](a)}}}}};g.prototype.onsapUiSupportControlTreeRequestBindingInfos=function(t){var e=t.getParameter("id");this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};g.prototype.onsapUiSupportControlTreeRefreshBinding=function(t){var e=t.getParameter("id");var i=t.getParameter("name");this.refreshBinding(e,i);this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};g.prototype.getControlTree=function(){var e=this.oCore,i=[],r={};function o(t){var e={id:t.getId(),type:"",aggregation:[],association:[]};r[e.id]=e.id;if(t instanceof s){e.library="sap.ui.core";e.type="sap.ui.core.UIArea";u.each(t.getContent(),function(t,i){var r=o(i);e.aggregation.push(r)})}else{e.library=t.getMetadata().getLibraryName();e.type=t.getMetadata().getName();if(t.mAggregations){for(var i in t.mAggregations){var n=t.mAggregations[i];if(n){var p=u.isArray(n)?n:[n];u.each(p,function(t,i){if(i instanceof a){var r=o(i);e.aggregation.push(r)}})}}}if(t.mAssociations){var l=t.getMetadata().getAllAssociations();for(var d in t.mAssociations){var c=t.mAssociations[d];var g=l[d]?l[d].type:null;if(c&&g){var h=u.isArray(c)?c:[c];u.each(h,function(t,i){e.association.push({id:i,type:g,name:d,isAssociationLink:true})})}}}}return e}u.each(e.mUIAreas,function(t,e){var r=o(e);i.push(r)});function n(i,a){for(var s=0;s<a.association.length;s++){var p=a.association[s];if(!r[p.id]){var l=t.sap.getObject(p.type);if(!(typeof l==="function")){continue}var d=l.getMetadata().getStereotype(),c=null;switch(d){case"element":case"control":c=e.byId(p.id);break;case"component":c=e.getComponent(p.id);break;case"template":c=e.getTemplate(p.id);break;default:break}if(!c){continue}a.association[s]=o(c);a.association[s].isAssociation=true;n(0,a.association[s])}}u.each(a.aggregation,n)}u.each(i,n);return i};g.prototype.getControlProperties=function(t,e){var i=/^((boolean|string|int|float)(\[\])?)$/;var r=[];var a=this.oCore.byId(t);if(!a&&this.oCore.getUIArea(t)){r.push({control:"sap.ui.core.UIArea",properties:[],aggregations:[]})}else if(a){var s=a.getMetadata();while(s instanceof n){var p={control:s.getName(),properties:[],aggregations:[]};var l=s.getProperties();u.each(l,function(t,i){var r={};u.each(i,function(t,a){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){r[t]=a}if(t=="_sGetter"||t=="_sMutator"){r["bp"+t]=e.filter(function(t){return t.name===a&&t.active}).length===1}var n=o.getType(i.type);if(n&&!(n instanceof o)){r["enumValues"]=n}});r.value=a.getProperty(t);r.isBound=!!a.mBindingInfos[t];p.properties.push(r)});var d=s.getAggregations();u.each(d,function(t,r){if(r.altTypes&&r.altTypes[0]&&i.test(r.altTypes[0])&&typeof a.getAggregation(t)!=="object"){var o={};u.each(r,function(t,i){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){o[t]=i}if(t=="_sGetter"||t=="_sMutator"){o["bp"+t]=e.filter(function(t){return t.name===i&&t.active}).length===1}});o.value=a.getAggregation(t);p.aggregations.push(o)}});r.push(p);s=s.getParent()}}return r};g.prototype.getControlBindingInfos=function(t){var e={bindings:[],contexts:[]};var i=this.oCore.byId(t);if(!i){return e}var r=i.mBindingInfos;var o=this;for(var a in r){if(r.hasOwnProperty(a)){var n=r[a];var s=[];var p,l=[];if(u.isArray(n.parts)){p=n.parts}else{p=[n]}if(n.binding instanceof c){l=n.binding.getBindings()}else if(n.binding instanceof d){l=[n.binding]}u.each(p,function(t,e){var r={};r.invalidPath=true;r.path=e.path;r.mode=e.mode;r.model={name:e.model};if(l.length>t&&l[t]){var a=l[t],n=a.getModel();var p;if(n){p=n.resolve(a.getPath(),a.getContext());if(n.getProperty(p)!=null){r.invalidPath=false}}r.absolutePath=typeof p==="undefined"?"Unresolvable":p;r.isRelative=a.isRelative();r.model=o.getBindingModelInfo(a,i)}s.push(r)});e.bindings.push({name:a,type:n.binding?n.binding.getMetadata().getName():undefined,bindings:s})}}function g(t,e){var i={modelName:e==="undefined"?"none (default)":e,path:t.getPath()};if(!t.getObject()==null){i.invalidPath=true}return i}var h=i.oBindingContexts;for(var f in h){if(h.hasOwnProperty(f)){e.contexts.push(g(h[f],f))}}var h=i.oPropagatedProperties.oBindingContexts;for(var f in h){if(h.hasOwnProperty(f)&&!i.oBindingContexts[f]){var v=g(h[f],f);var b=i;do{if(b.oBindingContexts[f]==h[f]){v.location={id:b.getId(),name:b.getMetadata().getName()};break}}while(b=b.getParent());e.contexts.push(v)}}return e};g.prototype.getBindingModelInfo=function(t,e){var i={};var r=t.getModel();function o(t){for(var e in t){if(t.hasOwnProperty(e)){if(t[e]===r){return e}}}return null}i.name=o(e.oModels)||o(e.oPropagatedProperties.oModels);if(i.name){var a=e;do{if(a.oModels[i.name]===r){i.location={type:"control",id:a.getId(),name:a.getMetadata().getName()};break}}while(a=a.getParent());if(!i.location){var n=null;if(i.name==="undefined"){n=this.oCore.getModel()}else{n=this.oCore.getModel(i.name)}if(n){i.location={type:"core"}}}}i.type=r.getMetadata().getName();i.bindingMode=r.getDefaultBindingMode();i.name=i.name==="undefined"?"none (default)":i.name;return i};g.prototype.refreshBinding=function(t,e){var i=this.oCore.byId(t);var r=i.mBindingInfos[e];if(!i||!r){return}var o=r.binding;if(!o){return}if(o instanceof c){var a=o.getBindings();for(var n=0;n<a.length;n++){a[n].refresh()}}else{o.refresh()}};return g});