/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object"],function(e,s){"use strict";var t=s.extend("sap.ui.core.support.RuleEngineOpaExtension",{metadata:{publicMethods:["getAssertions"]},onAfterInit:function(){var s=sap.ui.getCore().getLoadedLibraries()["sap.ui.support"],t=e.Deferred();if(!s){sap.ui.require(["sap/ui/support/Bootstrap"],function(e){e.initSupportRules(["true","silent"],{onReady:function(){t.resolve()}})})}else{t.resolve()}return t.promise()},getAssertions:function(){var s=function(){return e.sap.getUriParameters().get("sap-skip-rules-issues")=="true"};return{noRuleFailures:function(t){var r=e.Deferred(),i=t[0]&&t[0]["failOnAnyIssues"],u=t[0]&&t[0]["failOnHighIssues"],n=t[0]&&t[0].rules,o=t[0]&&t[0].executionScope;e.sap.support.analyze(o,n).then(function(){var t=e.sap.support.getAnalysisHistory(),n={issues:[]};if(t.length){n=t[t.length-1]}var o=n.issues.reduce(function(e,s){e[s.severity.toLowerCase()]+=1;return e},{high:0,medium:0,low:0});var a=n.issues.length===0;if(u){a=o.high===0}else if(i===false||u===false){a=true}if(s()){a=true}r.resolve({result:a,message:"Support Assistant issues found: [High: "+o.high+", Medium: "+o.medium+", Low: "+o.low+"]",expected:"0 high 0 medium 0 low",actual:o.high+" high "+o.medium+" medium "+o.low+" low"})});return r.promise()},getFinalReport:function(){var t=e.Deferred(),r=e.sap.support.getFormattedAnalysisHistory(),i=e.sap.support.getAnalysisHistory(),u=i.reduce(function(e,s){return e+s.issues.length},0),n=u===0,o="Support Assistant Analysis History",a=o;if(n){o+=" - no issues found"}else if(s()){n=true;o+=' - issues are found. To see them remove the "sap-skip-rules-issues=true" URI parameter'}t.resolve({result:n,message:o,actual:a,expected:r});return t.promise()}}}});return t});