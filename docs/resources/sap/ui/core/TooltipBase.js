/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Control","./Popup","./library","jquery.sap.keycodes"],function(t,e,o,i){"use strict";var s=i.OpenState;var r=e.extend("sap.ui.core.TooltipBase",{metadata:{abstract:true,library:"sap.ui.core",properties:{text:{type:"string",group:"Misc",defaultValue:""},openDuration:{type:"int",group:"Behavior",defaultValue:200},closeDuration:{type:"int",group:"Behavior",defaultValue:200},myPosition:{type:"sap.ui.core.Dock",group:"Behavior",defaultValue:"begin top"},atPosition:{type:"sap.ui.core.Dock",group:"Behavior",defaultValue:"begin bottom"},offset:{type:"string",group:"Behavior",defaultValue:"10 3"},collision:{type:"sap.ui.core.Collision",group:"Behavior",defaultValue:"flip"},openDelay:{type:"int",group:"Misc",defaultValue:500},closeDelay:{type:"int",group:"Misc",defaultValue:100}},events:{closed:{}}}});r.prototype._getPopup=t.sap.getter(function(){var t=new o;t.setShadow(true);return t}());r.prototype.onfocusin=function(e){var o=t(e.target).control(0);if(o!=null){var i=o.getFocusDomRef();this.sStoredTooltip=null;if(i.title&&i.title!=""){this.sStoredTooltip=i.title;i.title=""}var s=this._getPopup();if(!(s.isOpen()&&s.getContent()==this)){sap.ui.getCore().getRenderManager().render(this,sap.ui.getCore().getStaticAreaRef(),true)}var r=i.getAttribute("aria-describedby");var a=this.getId()+"-title "+this.getId()+"-txt";if(r==null||r==""){i.setAttribute("aria-describedby",a)}else if(r.indexOf(a)==-1){i.setAttribute("aria-describedby",r+" "+a)}}};r.prototype.onfocusout=function(e){var o=t(e.target).control(0);if(o!=null){var i=o.getFocusDomRef();if(this.sStoredTooltip){i.title=this.sStoredTooltip}var s=i.getAttribute("aria-describedby");var a=this.getId()+"-title "+this.getId()+"-txt";if(s&&s.indexOf(a)>=0){if(s.trim()==a){i.removeAttribute("aria-describedby")}else{s=s.replace(a,"");i.setAttribute("aria-describedby",s)}}}if(r.sOpenTimeout){t.sap.clearDelayedCall(r.sOpenTimeout);r.sOpenTimeout=undefined}this.sCloseNowTimeout=t.sap.delayedCall(this.getCloseDelay(),this,"closePopup")};r.prototype.isStandardTooltip=function(t){return typeof t==="string"&&!!t.trim()};r.prototype.onmouseover=function(e){var o=t(e.target).control(0),i=t(e.currentTarget).control(0),s=t(e.relatedTarget).control(0);if(!o){return}if(o===this){if(this.sCloseNowTimeout){t.sap.clearDelayedCall(this.sCloseNowTimeout);this.sCloseNowTimeout=null}e.stopPropagation();e.preventDefault();return}if(i===o||!this.isStandardTooltip(o.getTooltip())){if(this.sCloseNowTimeout){t.sap.clearDelayedCall(this.sCloseNowTimeout);this.sCloseNowTimeout=null;e.stopPropagation();e.preventDefault()}}if(s){if(s.getParent()){if(s.getParent()===i&&i===o){var a=s.getTooltip();if(!this.isStandardTooltip(a)&&(!a||!(a instanceof r))){if(this.sCloseNowTimeout){t.sap.clearDelayedCall(this.sCloseNowTimeout);this.sCloseNowTimeout=null;e.stopPropagation();e.preventDefault()}}}}}if(this._currentControl===o||!this.isStandardTooltip(o.getTooltip())){this.removeStandardTooltips();if(r.sOpenTimeout){t.sap.clearDelayedCall(r.sOpenTimeout)}r.sOpenTimeout=t.sap.delayedCall(this.getOpenDelay(),this,"openPopup",[this._currentControl]);e.stopPropagation();e.preventDefault()}};r.prototype.onmouseout=function(e){if(r.sOpenTimeout){t.sap.clearDelayedCall(r.sOpenTimeout);r.sOpenTimeout=undefined}if(!this.sCloseNowTimeout){this.sCloseNowTimeout=t.sap.delayedCall(this.getCloseDelay(),this,"closePopup")}this.restoreStandardTooltips();e.stopPropagation();e.preventDefault()};r.prototype.closePopup=function(){var e=this._getPopup();if(this.sCloseNowTimeout){t.sap.clearDelayedCall(this.sCloseNowTimeout)}this.sCloseNowTimeout=undefined;e.attachClosed(this.handleClosed,this);e.close();this.restoreStandardTooltips()};r.prototype.handleClosed=function(){this._getPopup().detachClosed(this.handleClosed,this);this.fireClosed()};r.prototype.openPopup=function(e){if(!this.getVisible()){return}if(e.getTooltip()!=null){if(this.sCloseNowTimeout){t.sap.clearDelayedCall(this.sCloseNowTimeout);this.sCloseNowTimeout=null;return}var o=this._getPopup();if(o.isOpen()&&o.getContent()==this){return}sap.ui.getCore().getRenderManager().render(this,sap.ui.getCore().getStaticAreaRef(),true);var i=e.getDomRef();o.setContent(this);o.setPosition(this.getMyPosition(),this.getAtPosition(),i,this.getOffset(),this.getCollision());o.setDurations(this.getOpenDuration(),this.getCloseDuration());o.open();this.removeStandardTooltips()}};r.prototype.removeStandardTooltips=function(){var t=this._currentControl.getDomRef();if(!this.aStoredTooltips){this.aStoredTooltips=[]}else{return}var e="";while(t&&!(t===document)){e=t.title;if(e){this.aStoredTooltips.push({domref:t,tooltip:e});t.title=""}t=t.parentNode}if(this._currentControl.getTooltipDomRefs){var o=this._currentControl.getTooltipDomRefs();for(var i=0;i<o.length;i++){t=o[i];if(t){e=t.title;if(e){this.aStoredTooltips.push({domref:t,tooltip:e});t.title=""}}}}};r.prototype.restoreStandardTooltips=function(){var t=this._getPopup();var e=t.getOpenState();if(e===s.OPEN||e===s.OPENING){return}if(r.sOpenTimeout){return}if(this.aStoredTooltips){for(var o=0;o<this.aStoredTooltips.length;o++){var i=this.aStoredTooltips[o].domref;i.title=this.aStoredTooltips[o].tooltip}}this.aStoredTooltips=null};r.prototype._setParent=r.prototype.setParent;r.prototype.setParent=function(t,e){var o=this._getPopup();if(o&&o.isOpen()){this.closePopup()}this._setParent.apply(this,arguments)};r.prototype.onkeydown=function(e){if(e.ctrlKey&&e.which==t.sap.KeyCodes.I){var o=t(e.target).control(0);if(o!=null){if(this._currentControl===o||!this.isStandardTooltip(o.getTooltip())){this.removeStandardTooltips();this.openPopup(this._currentControl);e.preventDefault();e.stopPropagation()}}}else if(e.which==t.sap.KeyCodes.ESCAPE){if(r.sOpenTimeout){t.sap.clearDelayedCall(r.sOpenTimeout);r.sOpenTimeout=undefined}var i=this.oPopup&&this.oPopup.isOpen();this.closePopup();if(i){e.preventDefault();e.stopPropagation()}}};r.prototype._closeOrPreventOpen=function(){var e=this._getPopup();if(e.isOpen()){this.closePopup()}else if(r.sOpenTimeout){t.sap.clearDelayedCall(r.sOpenTimeout);r.sOpenTimeout=undefined}};return r});