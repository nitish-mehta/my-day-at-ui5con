/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./View","./HTMLViewRenderer","sap/base/util/extend","sap/ui/base/ManagedObject","sap/ui/core/DeclarativeSupport","sap/ui/core/library","sap/ui/model/resource/ResourceModel"],function(e,t,r,n,o,i,a,l){"use strict";var s=a.mvc.ViewType;var u=t.extend("sap.ui.core.mvc.HTMLView",{metadata:{library:"sap.ui.core"}});u.create=function(e){var r=n(true,{},e);r.type=s.HTML;return t.create(r)};sap.ui.htmlview=function(e,t){return sap.ui.view(e,t,s.HTML)};u._sType=s.HTML;u.asyncSupport=true;u._mTemplates={};u._mAllowedSettings={viewName:true,controller:true,viewContent:true,definition:true,controllerName:true,resourceBundleName:true,resourceBundleUrl:true,resourceBundleLocale:true,resourceBundleAlias:true};u._getTemplate=function(e,t){var r=this._getViewUrl(e);var n=this._mTemplates[r];if(!n){n=this._loadTemplate(e,t);if(t&&t.async){var o=this;return n.then(function(e){o._mTemplates[r]=e;return Promise.resolve(e)})}else{this._mTemplates[r]=n}}return t.async?Promise.resolve(n):n};u.prototype.getControllerName=function(){return this._controllerName};u._getViewUrl=function(t){return e.sap.getModulePath(t,".view.html")};u._loadTemplate=function(t,r){var n=e.sap.getResourceName(t,".view.html");return e.sap.loadResource(n,r)};u.prototype.initViewSettings=function(t){if(!t){throw new Error("mSettings must be given")}if(t.viewName&&t.viewContent){throw new Error("View name and view content are given. There is no point in doing this, so please decide.")}else if(!t.viewName&&!t.viewContent){throw new Error("Neither view name nor view content is given. One of them is required.")}var r=this;function n(){r._oTemplate=document.createElement("div");if(typeof o==="string"){r._oTemplate.innerHTML=o}else{var n=o;var a=document.createDocumentFragment();for(var s=0;s<n.length;s++){a.appendChild(n.item(s))}r._oTemplate.appendChild(a)}var c=r._oTemplate.getElementsByTagName("template")[0];var m=r.getMetadata().getAllProperties();if(c){e.each(c.attributes,function(e,n){var o=i.convertAttributeToSettingName(n.name,r.getId());var a=n.value;var l=m[o];if(!t[o]){if(l){t[o]=i.convertValueToType(i.getPropertyDataType(l),a)}else if(u._mAllowedSettings[o]){t[o]=a}}});r._oTemplate=c}if(r._oTemplate.content){var a=r._oTemplate.content;r._oTemplate=document.createElement("div");r._oTemplate.appendChild(a)}if(t.controllerName){r._controllerName=t.controllerName}if((t.resourceBundleName||t.resourceBundleUrl)&&(!t.models||!t.models[t.resourceBundleAlias])){var p=new l({bundleName:t.resourceBundleName,bundleUrl:t.resourceBundleUrl,bundleLocale:t.resourceBundleLocale});r.setModel(p,t.resourceBundleAlias)}}var o=t.viewContent;if(!o){o=u._getTemplate(t.viewName,{async:t.async})}if(t.async){return o.then(function(e){o=e;n()})}n()};u.prototype.onControllerConnected=function(e){var t=this;o.runWithPreprocessors(function(){i.compile(t._oTemplate,t)},{settings:this._fnSettingsPreprocessor})};u.prototype.exit=function(){this._oTemplate=null;t.prototype.exit.call(this);if(this._connectedControls){for(var e=0;e<this._connectedControls.length;e++){this._connectedControls[e].destroy()}this._connectedControls=null}};u.prototype.connectControl=function(e){this._connectedControls=this._connectedControls||[];this._connectedControls.push(e)};return u});