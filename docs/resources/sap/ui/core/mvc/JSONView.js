/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./View","./JSONViewRenderer","./EventHandlerResolver","sap/base/util/extend","sap/ui/base/ManagedObject","sap/ui/core/library","sap/ui/model/resource/ResourceModel"],function(e,t,n,r,i,o,s,a){"use strict";var u=s.mvc.ViewType;var w=t.extend("sap.ui.core.mvc.JSONView",{metadata:{library:"sap.ui.core"}});w.create=function(n){var r=i(true,{},n);for(var o in r){if(o==="preprocessors"){delete r[o];e.sap.log.warning("JSView.create does not support the option preprocessors!")}}r.type=u.JSON;return t.create(r)};sap.ui.jsonview=function(e,t){return sap.ui.view(e,t,u.JSON)};w._sType=u.JSON;w.asyncSupport=true;w.prototype.initViewSettings=function(t){if(!t){throw new Error("mSettings must be given")}if(t.viewName&&t.viewContent){throw new Error("View name and view content are given. There is no point in doing this, so please decide.")}else if(!t.viewName&&!t.viewContent){throw new Error("Neither view name nor view content is given. One of them is required.")}var n=this;var r=function(){if((n._oJSONView.resourceBundleName||n._oJSONView.resourceBundleUrl)&&(!t.models||!t.models[n._oJSONView.resourceBundleAlias])){var e=new a({bundleName:n._oJSONView.resourceBundleName,bundleUrl:n._oJSONView.resourceBundleUrl});n.setModel(e,n._oJSONView.resourceBundleAlias)}};if(t.viewName){if(t.async){return this._loadTemplate(t.viewName,{async:true}).then(r)}else{this._loadTemplate(t.viewName);r()}}else if(t.viewContent){this.mProperties["viewContent"]=t.viewContent;if(typeof t.viewContent==="string"){this._oJSONView=e.parseJSON(t.viewContent);if(!this._oJSONView){throw new Error("error when parsing viewContent: "+t.viewContent)}}else if(typeof t.viewContent==="object"){this._oJSONView=t.viewContent}else{throw new Error("viewContent must be a JSON string or object, but is a "+typeof t.viewContent)}if(t.async){return Promise.resolve().then(r)}else{r()}}};w.prototype.onControllerConnected=function(e){var t=this;o.runWithPreprocessors(function(){t.applySettings({content:t._oJSONView.content},e)},{id:function(e){return t.createId(e)},settings:function(n){var i=this.getMetadata(),o=i.getJSONKeys(),s,a,u;for(s in n){if((u=o[s])!==undefined){a=n[s];switch(u._iKind){case 3:if(typeof a==="string"){n[s]=t.createId(a)}break;case 5:if(typeof a==="string"){n[s]=r.resolveEventHandler(a,e)}break}}}}})};w.prototype._loadTemplate=function(t,n){var r=e.sap.getResourceName(t,".view.json");if(!n||!n.async){this._oJSONView=e.sap.loadResource(r)}else{var i=this;return e.sap.loadResource(r,n).then(function(e){i._oJSONView=e})}};w.prototype.getControllerName=function(){return this._oJSONView.controllerName};return w});