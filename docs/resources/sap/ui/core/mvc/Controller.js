/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/base/util/extend","sap/ui/base/EventProvider","sap/ui/base/ManagedObject","sap/ui/core/mvc/ControllerMetadata","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution"],function(e,t,n,r,o,i,s){"use strict";var a={};var l={};var f=n.extend("sap.ui.core.mvc.Controller",{metadata:{stereotype:"controller",methods:{byId:{public:true,final:true},getView:{public:true,final:true},getInterface:{public:false,final:true},onInit:{public:false,final:false,overrideExecution:s.After},onExit:{public:false,final:false,overrideExecution:s.Before},onBeforeRendering:{public:false,final:false,overrideExecution:s.Before},onAfterRendering:{public:false,final:false,overrideExecution:s.After}}},constructor:function(t){var r=null;if(typeof t=="string"){if(!a[t]){e.sap.log.warning("Do not call sap.ui.core.mvc.Controller constructor for non typed scenario!")}r=a[t]}n.apply(this,arguments);if(r){e.extend(this,a[t])}if(this.extension){throw new Error("The keyword 'extension' cannot be used as a member of a controller")}this["_sapui_Extensions"]={};f.extendByMember(this,false);this._sapui_isExtended=false},_isExtended:function(){return this._sapui_isExtended},getInterface:function(){var t={};var n=this.getMetadata();var r=n.getAllPublicMethods();r.forEach(function(e){var n=this[e];if(typeof n==="function"){t[e]=function(){var e=n.apply(this,arguments);return e instanceof f?e.getInterface():e}.bind(this)}}.bind(this));this.getInterface=e.sap.getter(t);return t}},o);function d(t,n,r){var o=n.getMetadata().getName();var s=t.getMetadata();var a=t["_sapui_Extensions"];var l=t.getInterface();var f=i.getMetadata().getLifecycleConfiguration();var d={namespace:o,extension:n,reloadNeeded:false};n._setController(l);if(n.getMetadata().hasOverrides()){var u,c,g,p,v=n.getMetadata().getOverrides(),h=n.getMetadata().getStaticOverrides();for(p in h){g=n.getMetadata();if(!g.isMethodFinal(p)){i.overrideMethod(p,n,h,n,g.getOverrideExecution(p))}else{e.sap.log.error("Method '"+p+"' of extension '"+o+"' is flagged final and cannot be overridden by calling 'override'")}}for(p in v){if(p!=="extension"){if(p in n.base){e.sap.log.debug("Overriding  member '"+p+"' of original controller.");var x=v[p];var y=t[p];if(typeof y=="object"&&typeof x=="object"){c=a[p];g=c.extension.getMetadata();for(u in x){if(!g.isMethodFinal(u)){i.overrideMethod(u,y,x,n,g.getOverrideExecution(u))}else{e.sap.log.error("Method '"+u+"' of extension '"+c.namespace+"' is flagged final and cannot be overridden by extension '"+o+"'")}}}else if(!s.isMethodFinal(p)){i.overrideMethod(p,t,v,n,s.getOverrideExecution(p))}else{e.sap.log.error("Method '"+p+"' of controller '"+t.getMetadata().getName()+"' is flagged final and cannot be overridden by extension '"+o+"'")}}else if(p in f){i.overrideMethod(p,t,v,n,s.getOverrideExecution(p))}else{e.sap.log.error("Method '"+u+"' of extension '"+c.namespace+" does not exist in controller "+t.getMetadata().getName()+" and cannot be overridden")}}if(v.extension){for(var E in v.extension){g=a[E].extension.getMetadata();var b=e.sap.getObject(E,null,t.extension);var M=a[E].extension;var m=v.extension[E];for(u in m){if(!g.isMethodFinal(u)){i.overrideMethod(u,b,m,n,g.getOverrideExecution(u));i.overrideMethod(u,M,m,n,g.getOverrideExecution(u))}else{e.sap.log.error("Method '"+u+"' of extension '"+E+"' is flagged final and cannot be overridden by extension '"+o+"'")}}}}d.reloadNeeded=true}}var w=n.getInterface();if(r){a[r]=d;d.location=r;t[r]=w;l[r]=w}else{a[o]=d;d.location="extension."+o;e.sap.setObject("extension."+o,w,t);e.sap.setObject("extension."+o,w,l)}}function u(e,t,n){if(t instanceof i){d(e,t,n)}else if(t.getMetadata&&t.getMetadata().getStereotype()=="controllerextension"){var r=new t;d(e,r,n)}else{var o=i.getMetadata().getLifecycleConfiguration();for(var s in t){if(s in o){i.overrideMethod(s,e,t,e,o[s].overrideExecution)}else{i.overrideMethod(s,e,t)}}}}function c(t,n){if(!t){throw new Error("Controller name ('sName' parameter) is required")}var r=t.replace(/\./g,"/"),o=i(sap.ui.require(r));function i(n){if(n){return n}else if(a[t]){return f}else{return e.sap.getObject(t)}}r=r+".controller";if(n){return new Promise(function(e,t){if(!o){sap.ui.require([r],function(t){e(i(t))})}else{e(o)}})}else if(!o){o=sap.ui.requireSync(r);return i(o)}else{return o}}function g(e,t){var n=f._sExtensionProvider.replace(/\./g,"/"),r=l[n];if(t){return new Promise(function(e,t){if(n){if(r){e(r)}else{sap.ui.require([n],function(t){r=new t;l[n]=r;e(r)})}}else{e()}})}else if(n){if(r){return r}else{var o=sap.ui.requireSync(n);r=new o;l[n]=r;return r}}}function p(e,t){var n;if(a[t]){n=new e(t)}else{n=new e}if(!n){throw new Error("Controller "+t+" couldn't be instantiated")}return n}f.extendByMember=function(e,t){var n;for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){e[n]=new e[n]}}for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){u(e,e[n],n)}}if(t){return Promise.resolve(e)}else{return e}};f.extendByCustomizing=function(t,n,o){var i=sap.ui.require("sap/ui/core/CustomizingConfiguration");if(!i){return o?Promise.resolve(t):t}function s(t,n){return c(t,o).then(function(e){if((e=a[t])!==undefined){u(n,e);return n}},function(n){e.sap.log.error("Attempt to load Extension Controller "+t+" was not successful - is the Controller correctly defined in its file?")})}var l,f=[],d,g=o?Promise.resolve(t):t,p=i.getControllerExtension(n,r._sOwnerId);if(p){d=typeof p==="string"?p:p.controllerName;f=p.controllerNames||[];if(d){f.unshift(d)}}for(var v=0,h=f.length;v<h;v++){var x=f[v];if(typeof x==="string"){e.sap.log.info("Customizing: Controller '"+n+"' is now extended by '"+x+"'");if(o){g=g.then(s.bind(null,x,t))}else{if(!a[x]&&!sap.ui.require(x)){c(x)}if((l=a[x])!==undefined){u(t,l)}else{e.sap.log.error("Attempt to load Extension Controller "+x+" was not successful - is the Controller correctly defined in its file?")}}}}return g};f.extendByProvider=function(t,n,r,o){if(!f._sExtensionProvider){return o?Promise.resolve(t):t}e.sap.log.info("Customizing: Controller '"+n+"' is now extended by Controller Extension Provider '"+f._sExtensionProvider+"'");var i,s;if(o){return g(t,o).then(function(e){return e.getControllerExtensions(n,r,o)}).then(function(e){if(e&&e.length){for(var n=0,r=e.length;n<r;n++){u(t,e[n])}}return t},function(n){e.sap.log.error("Controller Extension Provider: Error '"+n+"' thrown in "+f._sExtensionProvider+"extension provider ignored.");return t})}else{s=g(t,o);i=s.getControllerExtensions(n,r,o);if(i&&Array.isArray(i)){for(var a=0,l=i.length;a<l;a++){u(t,i[a])}}else{e.sap.log.error("Controller Extension Provider: Error in ExtensionProvider.getControllerExtensions: "+f._sExtensionProvider+" - no valid extensions returned")}}return t};f.create=function(e){return v(e.name,undefined,true)};sap.ui.controller=function(t,n,r){if(r){e.sap.log.info("Do not use deprecated factory function 'sap.ui.controller("+t+")'. Use 'sap.ui.core.mvc.Controller.create(...)' instead.")}else{e.sap.log.warning("Do not use synchronous controller creation for controller '"+t+"'! Use the new asynchronous factory 'sap.ui.core.mvc.Controller.create(...)' instead.")}return v.apply(this,arguments)};function v(t,n,o){var i,s,l=r._sOwnerId;if(typeof n==="boolean"){n=undefined}if(!n){if(o){return c(t,o).then(function(e){return p(e,t)}).then(function(e){return f.extendByCustomizing(e,t,o)}).then(function(e){return f.extendByProvider(e,t,l,o)}).then(function(e){e._sapui_isExtended=true;return e})}else{s=c(t,o);i=p(s,t);i=f.extendByCustomizing(i,t,o);i=f.extendByProvider(i,t,l,o);i._sapui_isExtended=true}return i}else{a[t]=n;e.sap.log.info("For defining controllers use Controller.extend instead")}}f.prototype.getPublicMethods=function(){var t={},n=this.getMetadata(),r=n.getAllMethods(),o=n.getLifecycleConfiguration();Object.keys(r).forEach(function(e){if(n.isMethodPublic(e)){t[e]=r[e];t[e].reloadNeeded=!!(e in o)}});delete t.extension;var i=this["_sapui_Extensions"];Object.keys(i).forEach(function(n){var r=i[n];var o=r.extension.getInterface();var s=r.extension.getMetadata().getAllMethods();Object.keys(o).forEach(function(n){delete t[r.location];var o=e.extend({},s[n],{reloadNeeded:r.reloadNeeded});t[r.location+"."+n]=o})});return t};f.prototype.destroy=function(){Object.keys(this["_sapui_Extensions"]).forEach(function(t){e.sap.setObject(t.location,null,this)}.bind(this));delete this["_sapui_Extensions"];delete this["_sapui_Interface"];n.prototype.destroy.apply(this,arguments)};f.prototype.getView=function(){return this.oView};f.prototype.byId=function(e){return this.oView?this.oView.byId(e):undefined};f.prototype.createId=function(e){return this.oView?this.oView.createId(e):undefined};f.prototype.getOwnerComponent=function(){var e=sap.ui.requireSync("sap/ui/core/Component");return e.getOwnerComponentFor(this.getView())};f.prototype.connectToView=function(e){this.oView=e;if(this.onInit){e.attachAfterInit(this.onInit,this)}if(this.onExit){e.attachBeforeExit(this.onExit,this)}if(this.onAfterRendering){e.attachAfterRendering(this.onAfterRendering,this)}if(this.onBeforeRendering){e.attachBeforeRendering(this.onBeforeRendering,this)}};f._sExtensionProvider=null;f.registerExtensionProvider=function(e){f._sExtensionProvider=e};return f});