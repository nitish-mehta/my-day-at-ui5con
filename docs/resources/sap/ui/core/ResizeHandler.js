/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","jquery.sap.act","jquery.sap.script"],function(e,t){"use strict";var i=e.sap.log.getLogger("sap.ui.core.ResizeHandler",e.sap.log.Level.ERROR);var s=null;var r=t.extend("sap.ui.core.ResizeHandler",{constructor:function(i){t.apply(this);s=i;this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.iIdCounter=0;this.fDestroyHandler=this.destroy.bind(this);e(window).bind("unload",this.fDestroyHandler);e.sap.act.attachActivate(o,this)}});function n(){if(this.bRegistered){this.bRegistered=false;sap.ui.getCore().detachIntervalTimer(this.checkSizes,this)}}function o(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;sap.ui.getCore().attachIntervalTimer(this.checkSizes,this)}}r.prototype.destroy=function(t){e.sap.act.detachActivate(o,this);e(window).unbind("unload",this.fDestroyHandler);s=null;this.aResizeListeners=[];this.aSuspendedDomRefs=[];n.call(this)};r.prototype.attachListener=function(e,s){var r=t.isA(e,"sap.ui.core.Control"),n=r?e.getDomRef():e,a=n?n.offsetWidth:0,d=n?n.offsetHeight:0,l="rs-"+Date.now()+"-"+this.iIdCounter++,u;if(r){u="Control "+e.getId()}else if(e.id){u=e.id}else{u=String(e)}this.aResizeListeners.push({sId:l,oDomRef:r?null:e,oControl:r?e:null,fHandler:s,iWidth:a,iHeight:d,dbg:u});i.debug("registered "+u);o.call(this);return l};r.prototype.detachListener=function(e){var t=this.aResizeListeners;for(var s=0;s<t.length;s++){if(t[s].sId===e){t.splice(s,1);i.debug("deregistered "+e);break}}if(t.length===0){n.call(this)}};r.prototype.checkSizes=function(){var t=i.isLoggable();if(t){i.debug("checkSizes:")}this.aResizeListeners.forEach(function(s){if(s){var r=!!s.oControl,n=r?s.oControl.getDomRef():s.oDomRef;if(n&&e.contains(document.documentElement,n)&&!this._isSuspended(n)){var o=s.iWidth,a=s.iHeight,d=n.offsetWidth,l=n.offsetHeight;if(o!=d||a!=l){s.iWidth=d;s.iHeight=l;var u=e.Event("resize");u.target=n;u.currentTarget=n;u.size={width:d,height:l};u.oldSize={width:o,height:a};u.control=r?s.oControl:null;if(t){i.debug("resize detected for '"+s.dbg+"': "+u.oldSize.width+"x"+u.oldSize.height+" -> "+u.size.width+"x"+u.size.height)}s.fHandler(u)}}}},this);if(r._keepActive!=true&&r._keepActive!=false){r._keepActive=false}if(!e.sap.act.isActive()&&!r._keepActive){n.call(this)}};r.register=function(e,t){if(!s||!s.oResizeHandler){return null}return s.oResizeHandler.attachListener(e,t)};r.deregister=function(e){if(!s||!s.oResizeHandler){return}s.oResizeHandler.detachListener(e)};r.deregisterAllForControl=function(e){if(!s||!s.oResizeHandler){return}s.oResizeHandler.aResizeListeners.filter(function(t){return t&&t.oControl&&t.oControl.getId()===e}).forEach(function(e){r.deregister(e.sId)})};r.suspend=function(t){if(!s||!s.oResizeHandler){return false}if(!t||!e.contains(document.documentElement,t)){return false}var i=s.oResizeHandler;if(i.aSuspendedDomRefs.indexOf(t)===-1){i.aSuspendedDomRefs.push(t)}return true};r.resume=function(e){if(!s||!s.oResizeHandler){return false}var t=s.oResizeHandler,i=t.aSuspendedDomRefs.indexOf(e);if(i===-1){return false}t.aSuspendedDomRefs.splice(i,1);t.checkSizes();return true};r.prototype._isSuspended=function(t){var i=this.aSuspendedDomRefs,s;for(var r=0;r<i.length;r++){s=i[r];if(s===t||e.contains(s,t)){return true}}return false};return r});