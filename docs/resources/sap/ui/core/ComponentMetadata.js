/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/ManagedObjectMetadata","sap/ui/core/Manifest","sap/ui/thirdparty/URI","jquery.sap.resources"],function(e,t,n,a){"use strict";var o=window["sap-ui-config"]||{};var i=0;if(o["xx-nosync"]==="warn"||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){i=1}if(o["xx-nosync"]===true||o["xx-nosync"]==="true"||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){i=2}var s=function(e,n){t.apply(this,arguments)};s.prototype=Object.create(t.prototype);s.preprocessClassInfo=function(e){if(e&&typeof e.metadata==="string"){e.metadata={_src:e.metadata}}return e};s.prototype.applySettings=function(n){var a=this._oStaticInfo=n.metadata;var o=this.getName(),i=o.replace(/\.\w+?$/,"");if(a._src){if(a._src=="component.json"){e.sap.log.warning("Usage of declaration \"metadata: 'component.json'\" is deprecated (component "+o+"). Use \"metadata: 'json'\" instead.")}else if(a._src!="json"){throw new Error("Invalid metadata declaration for component "+o+': "'+a._src+'"! Use "metadata: \'json\'" to load metadata from component.json.')}var s=i.replace(/\./g,"/")+"/component.json";e.sap.log.info("The metadata of the component "+o+" is loaded from file "+s+".");try{var r=e.sap.loadResource(s,{dataType:"json"});e.extend(a,r)}catch(t){e.sap.log.error('Failed to load component metadata from "'+s+'" (component '+o+")! Reason: "+t)}}t.prototype.applySettings.call(this,n);this._sComponentName=i;this._bInitialized=false;this._iInstanceCount=0;var p=a["manifest"];if(p){a.__metadataVersion=2;if(typeof p==="string"&&p==="json"){return}}else{a.__metadataVersion=1;p={}}this._applyManifest(p)};s.prototype._applyManifest=function(t){if(this._oManifest){e.sap.log.warning("Can't apply manifest to ComponentMetadata as it has already been created.",this.getName(),"sap.ui.core.ComponentMetadata");return}t["name"]=t["name"]||this.getName();t["sap.app"]=t["sap.app"]||{id:this.getComponentName()};t["sap.ui5"]=t["sap.ui5"]||{};if(!this.isBaseClass()){t["sap.ui5"]["extends"]=t["sap.ui5"]["extends"]||{}}this._convertLegacyMetadata(this._oStaticInfo,t);this._oManifest=new n(t,{componentName:this.getComponentName(),baseUrl:e.sap.getModulePath(this.getComponentName(),"/"),process:this._oStaticInfo.__metadataVersion===2})};s.prototype.init=function(){if(this._iInstanceCount===0){var e=this.getParent();if(e instanceof s){e.init()}this.getManifestObject().init();this._bInitialized=true}this._iInstanceCount++};s.prototype.exit=function(){var e=Math.max(this._iInstanceCount-1,0);if(e===0){this.getManifestObject().exit();var t=this.getParent();if(t instanceof s){t.exit()}this._bInitialized=false}this._iInstanceCount=e};s.prototype.onInitComponent=function(t){e.sap.log.error("The function ComponentMetadata#onInitComponent will be removed soon!")};s.prototype.onExitComponent=function(t){e.sap.log.error("The function ComponentMetadata#onExitComponent will be removed soon!")};s.prototype.isBaseClass=function(){return/^sap\.ui\.core\.(UI)?Component$/.test(this.getName())};s.prototype.getMetadataVersion=function(){return this._oStaticInfo.__metadataVersion};s.prototype.getManifestObject=function(){if(!this._oManifest){var t=this._oStaticInfo["manifest"];if(typeof t==="string"&&t==="json"){var n=this.getName();var a=this.getComponentName();var o=a.replace(/\./g,"/")+"/manifest.json";var s=e.sap.isResourceLoaded(o);if(!s&&i===2){e.sap.log.error("[nosync] Loading manifest of the component "+n+" ignored.",o,"sap.ui.core.ComponentMetadata");t={}}else{if(!s&&i===1){e.sap.log.error("[nosync] The manifest of the component "+n+" is loaded with sync XHR.",o,"sap.ui.core.ComponentMetadata")}else{e.sap.log.info("The manifest of the component "+n+" is loaded from file "+o+".")}try{var r=e.sap.loadResource(o,{dataType:"json"});t=r}catch(a){e.sap.log.error('Failed to load component manifest from "'+o+'" (component '+n+")! Reason: "+a);t={}}}this._applyManifest(t)}}return this._oManifest};s.prototype.getManifest=function(){if(this.getMetadataVersion()===1){return this.getManifestObject().getRawJson()}return this.getManifestObject().getJson()};s.prototype._getManifest=function(){e.sap.log.warning("ComponentMetadata#_getManifest: do not use deprecated functions anymore!");return this.getManifestObject().getJson()};s.prototype.getRawManifest=function(){return this.getManifestObject().getRawJson()};s.prototype._getRawManifest=function(){e.sap.log.warning("ComponentMetadata#_getRawManifest: do not use deprecated functions anymore!");return this.getManifestObject().getRawJson()};s.prototype.getManifestEntry=function(t,n){var a=this.getManifestObject().getEntry(t);if(a!==undefined&&!e.isPlainObject(a)){return a}var o,i;if(n&&(o=this.getParent())instanceof s){i=o.getManifestEntry(t,n)}if(i||a){a=e.extend(true,{},i,a)}return a};s.prototype.getCustomEntry=function(t,n){if(!t||t.indexOf(".")<=0){e.sap.log.warning("Component Metadata entries with keys without namespace prefix can not be read via getCustomEntry. Key: "+t+", Component: "+this.getName());return null}var a,o=this._oStaticInfo[t]||{};if(!e.isPlainObject(o)){e.sap.log.warning("Custom Component Metadata entry with key '"+t+"' must be an object. Component: "+this.getName());return null}if(n&&(a=this.getParent())instanceof s){return e.extend(true,{},a.getCustomEntry(t,n),o)}return e.extend(true,{},o)};s.prototype.getComponentName=function(){return this._sComponentName};s.prototype.getDependencies=function(){if(!this._oLegacyDependencies){var e=this.getManifestEntry("/sap.ui5/dependencies"),t=e&&e.minUI5Version||null,n=e&&e.libs||{},a=e&&e.components||{};var o={ui5version:t,libs:[],components:[]};for(var i in n){o.libs.push(i)}for(var s in a){o.components.push(s)}this._oLegacyDependencies=o}return this._oLegacyDependencies};s.prototype.getIncludes=function(){if(!this._aLegacyIncludes){var e=[],t=this.getManifestEntry("/sap.ui5/resources")||{},n=t&&t.css||[],a=t&&t.js||[];for(var o=0,i=n.length;o<i;o++){if(n[o]&&n[o].uri){e.push(n[o].uri)}}for(var o=0,i=a.length;o<i;o++){if(a[o]&&a[o].uri){e.push(a[o].uri)}}this._aLegacyIncludes=e.length>0?e:null}return this._aLegacyIncludes};s.prototype.getUI5Version=function(){return this.getManifestEntry("/sap.ui5/dependencies/minUI5Version")};s.prototype.getComponents=function(){return this.getDependencies().components};s.prototype.getLibs=function(){return this.getDependencies().libs};s.prototype.getVersion=function(){return this.getManifestEntry("/sap.app/applicationVersion/version")};s.prototype.getConfig=function(e,t){var n=this.getManifestEntry("/sap.ui5/config",!t);if(!n){return{}}if(!e){return n}return n.hasOwnProperty(e)?n[e]:{}};s.prototype.getCustomizing=function(e){return this.getManifestEntry("/sap.ui5/extends/extensions",!e)};s.prototype.getModels=function(t){if(!this._oLegacyModels){this._oLegacyModels={};var n=this.getManifestEntry("/sap.ui5/models")||{};for(var a in n){var o=n[a];this._oLegacyModels[a]=o.settings||{};this._oLegacyModels[a].type=o.type;this._oLegacyModels[a].uri=o.uri}}var i,r=e.extend(true,{},this._oLegacyModels);if(!t&&(i=this.getParent())instanceof s){r=e.extend(true,{},i.getModels(),r)}return r};s.prototype.handleValidation=function(){return this.getManifestEntry("/sap.ui5/handleValidation")};s.prototype.getServices=function(){e.sap.log.warning("Usage of sap.ui.core.ComponentMetadata.protoype.getServices is deprecated!");return this._oStaticInfo.services||{}};s.prototype._convertLegacyMetadata=function(e,t){var n=function(e,t){var n={};if(e){for(var a=0,o=e.length;a<o;a++){var i=e[a];if(typeof i==="string"){n[i]=typeof t==="function"&&t(i)||{}}}}return n};var a=t["sap.app"];var o=t["sap.ui5"];for(var i in e){var s=e[i];if(s!==undefined){switch(i){case"name":t[i]=t[i]||s;a["id"]=a["id"]||s;break;case"description":case"keywords":a[i]=a[i]||s;break;case"version":var r=a.applicationVersion=a.applicationVersion||{};r.version=r.version||s;break;case"config":o[i]=o[i]||s;break;case"customizing":var p=o["extends"]=o["extends"]||{};p.extensions=p.extensions||s;break;case"dependencies":if(!o[i]){o[i]={};o[i].minUI5Version=s.ui5version;o[i].libs=n(s.libs);o[i].components=n(s.components)}break;case"includes":if(!o["resources"]){o["resources"]={};if(s&&s.length>0){for(var c=0,f=s.length;c<f;c++){var u=s[c];var d=u.match(/\.(css|js)$/i);if(d){o["resources"][d[1]]=o["resources"][d[1]]||[];o["resources"][d[1]].push({uri:u})}}}}break;case"handleValidation":if(o[i]===undefined){o[i]=s}break;case"models":if(!o["models"]){var g={};for(var h in s){var l=s[h];var m={};for(var y in l){var v=l[y];switch(y){case"type":case"uri":m[y]=v;break;default:m.settings=m.settings||{};m.settings[y]=v}}g[h]=m}o["models"]=g}break}}}};return s},true);