/*
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Manifest","./ComponentMetadata","./Core","sap/base/util/extend","sap/ui/base/ManagedObject","sap/ui/thirdparty/URI","jquery.sap.trace"],function(e,t,n,a,r,i,o){"use strict";var s={JSON:"JSON",XML:"XML",HTML:"HTML",JS:"JS",Template:"Template"};function u(e){["sap-client","sap-server"].forEach(function(t){if(!e.hasSearch(t)){var n=sap.ui.getCore().getConfiguration().getSAPParam(t);if(n){e.addSearch(t,n)}}})}function f(e,t,n,a){if(n){for(var r in e){if(!t[r]&&n[r]&&n[r].uri){t[r]=a}}}}function p(t,a,r,i){var o=a.getEntry(r);if(o!==undefined&&!e.isPlainObject(o)){return o}var s,u;if(i&&(s=t.getParent())instanceof n){u=s.getManifestEntry(r,i)}if(u||o){o=e.extend(true,{},u,o)}return o}function c(e,t){var n=Object.create(Object.getPrototypeOf(e));n._oMetadata=e;n._oManifest=t;for(var a in e){if(!/^(getManifest|getManifestObject|getManifestEntry|getMetadataVersion)$/.test(a)&&typeof e[a]==="function"){n[a]=e[a].bind(e)}}n.getManifest=function(){return t&&t.getJson()};n.getManifestObject=function(){return t};n.getManifestEntry=function(n,a){return p(e,t,n,a)};n.getMetadataVersion=function(){return 2};return n}function d(t,n,a){e.sap.assert(typeof t==="function","fn must be a function");var r=i._sOwnerId;try{i._sOwnerId=n;return t.call(a)}finally{i._sOwnerId=r}}var l=i.extend("sap.ui.core.Component",{constructor:function(e,t){var n=Array.prototype.slice.call(arguments);if(typeof e!=="string"){t=e;e=undefined}if(t&&typeof t._metadataProxy==="object"){this._oMetadataProxy=t._metadataProxy;this._oManifest=t._metadataProxy._oManifest;delete t._metadataProxy;this.getMetadata=function(){return this._oMetadataProxy}}if(t&&typeof t._cacheTokens==="object"){this._mCacheTokens=t._cacheTokens;delete t._cacheTokens}if(t&&typeof t._manifestModels==="object"){this._mManifestModels=t._manifestModels;delete t._manifestModels}else{this._mManifestModels={}}this._mServices={};i.apply(this,n)},metadata:{stereotype:"component",abstract:true,specialSettings:{componentData:"any"},version:"0.0",includes:[],dependencies:{libs:[],components:[],ui5version:""},config:{},customizing:{},library:"sap.ui.core"}},n);l.prototype.getManifest=function(){if(!this._oManifest){return this.getMetadata().getManifest()}else{return this._oManifest.getJson()}};l.prototype.getManifestEntry=function(e){return this._getManifestEntry(e)};l.prototype._getManifestEntry=function(e,t){if(!this._oManifest){return this.getMetadata().getManifestEntry(e,t)}else{return p(this.getMetadata(),this._oManifest,e,t)}};l.prototype.getManifestObject=function(){if(!this._oManifest){return this.getMetadata().getManifestObject()}else{return this._oManifest}};l.prototype._isVariant=function(){if(this._oManifest){var e=this._oMetadataProxy._oMetadata.getManifestEntry("/sap.app/id");return e!==this.getManifestEntry("/sap.app/id")}else{return false}};l.activateCustomizing=function(e){};l.deactivateCustomizing=function(e){};l.getOwnerIdFor=function(t){e.sap.assert(t instanceof i,"oObject must be given and must be a ManagedObject");var n=t instanceof i&&t._sOwnerId;return n||undefined};l.getOwnerComponentFor=function(e){return l.get(l.getOwnerIdFor(e))};l.prototype.runAsOwner=function(e){return d(e,this.getId())};l.prototype.getInterface=function(){return this};l.prototype._initCompositeSupport=function(t){this.oComponentData=t&&t.componentData;if(!this._isVariant()){this.getMetadata().init()}else{this._oManifest.init(this)}this.initComponentModels();if(this.onWindowError){this._fnWindowErrorHandler=e.proxy(function(e){var t=e.originalEvent;this.onWindowError(t.message,t.filename,t.lineno)},this);e(window).bind("error",this._fnWindowErrorHandler)}if(this.onWindowBeforeUnload){this._fnWindowBeforeUnloadHandler=e.proxy(this.onWindowBeforeUnload,this);e(window).bind("beforeunload",this._fnWindowBeforeUnloadHandler)}if(this.onWindowUnload){this._fnWindowUnloadHandler=e.proxy(this.onWindowUnload,this);e(window).bind("unload",this._fnWindowUnloadHandler)}};l.prototype.destroy=function(){for(var t in this._mServices){if(this._mServices[t].instance){this._mServices[t].instance.destroy()}}delete this._mServices;for(var n in this._mManifestModels){this._mManifestModels[n].destroy()}delete this._mManifestModels;if(this._fnWindowErrorHandler){e(window).unbind("error",this._fnWindowErrorHandler);delete this._fnWindowErrorHandler}if(this._fnWindowBeforeUnloadHandler){e(window).unbind("beforeunload",this._fnWindowBeforeUnloadHandler);delete this._fnWindowBeforeUnloadHandler}if(this._fnWindowUnloadHandler){e(window).unbind("unload",this._fnWindowUnloadHandler);delete this._fnWindowUnloadHandler}if(this._oEventBus){this._oEventBus.destroy();delete this._oEventBus}i.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);if(!this._isVariant()){this.getMetadata().exit()}else{this._oManifest.exit(this);delete this._oManifest}};l.prototype.getComponentData=function(){return this.oComponentData};l.prototype.getEventBus=function(){if(!this._oEventBus){var e=sap.ui.requireSync("sap/ui/core/EventBus");this._oEventBus=new e}return this._oEventBus};l.prototype.initComponentModels=function(){var e=this.getMetadata();if(e.isBaseClass()){return}var t=this._getManifestEntry("/sap.app/dataSources",true)||{};var n=this._getManifestEntry("/sap.ui5/models",true)||{};this._initComponentModels(n,t,this._mCacheTokens)};l.prototype._initComponentModels=function(e,t,n){var a=l._createManifestModelConfigurations({models:e,dataSources:t,component:this,mergeParent:true,cacheTokens:n});if(!a){return}var r={};for(var i in a){if(!this._mManifestModels[i]){r[i]=a[i]}}var o=l._createManifestModels(r,this.toString());for(var i in o){this._mManifestModels[i]=o[i]}for(var i in this._mManifestModels){var s=this._mManifestModels[i];this.setModel(s,i||undefined)}};l.prototype.getService=function(t){if(!this._mServices[t]){this._mServices[t]={};this._mServices[t].promise=new Promise(function(n,a){sap.ui.require(["sap/ui/core/service/ServiceFactoryRegistry"],function(r){var i=this.getManifestEntry("/sap.ui5/services/"+t);var o=i&&i.factoryName;if(!o){a(new Error("Service "+t+" not declared!"));return}var s=r.get(o);if(s){s.createInstance({scopeObject:this,scopeType:"component",settings:i.settings||{}}).then(function(e){if(!this.bIsDestroyed){this._mServices[t].instance=e;this._mServices[t].interface=e.getInterface();n(this._mServices[t].interface)}else{a(new Error("Service "+t+" could not be loaded as its Component was destroyed."))}}.bind(this)).catch(a)}else{var u="The ServiceFactory "+o+" for Service "+t+" not found in ServiceFactoryRegistry!";var f=this.getManifestEntry("/sap.ui5/services/"+t+"/optional");if(!f){e.sap.log.error(u)}a(new Error(u))}}.bind(this))}.bind(this))}return this._mServices[t].promise};function g(e){var t=e.getManifestEntry("/sap.ui5/services");for(var n in t){if(t[n].lazy===false){e.getService(n)}}}l.prototype.createComponent=function(t){e.sap.assert(typeof t==="string"&&t||typeof t==="object"&&typeof t.usage==="string"&&t.usage,"vUsage either must be a non-empty string or an object with a non-empty usage id");var n={async:true};if(t&&typeof t==="object"){n.usage=t.usage;["id","async","settings","componentData"].forEach(function(e){if(t[e]!==undefined){n[e]=t[e]}})}else if(typeof t==="string"){n.usage=t}return this._createComponent(n)};l.prototype._createComponent=function(t){if(t&&t.usage){var n=t.usage;var a=this.getManifestEntry("/sap.ui5/componentUsages/"+n);if(!a){throw new Error('Component usage "'+n+'" not declared in Component "'+this.getManifestObject().getComponentName()+'"!')}t=e.extend(true,a,t)}return this.runAsOwner(function(){if(t.async===true){return l.create(t)}else{return sap.ui.component(t)}})};l._createManifestModelConfigurations=function(t){var a=t.component;var r=t.manifest||a.getManifestObject();var i=t.mergeParent;var s=t.cacheTokens||{};var p=a?a.toString():r.getComponentName();var c=sap.ui.getCore().getConfiguration();if(!t.models){return null}var d={models:t.models,dataSources:t.dataSources||{},origin:{dataSources:{},models:{}}};if(a&&i){var l=a.getMetadata();while(l instanceof n){var g=l.getManifestObject();var m=l.getManifestEntry("/sap.app/dataSources");f(d.dataSources,d.origin.dataSources,m,g);var y=l.getManifestEntry("/sap.ui5/models");f(d.models,d.origin.models,y,g);l=l.getParent()}}var h={};for(var v in d.models){var M=d.models[v];var S=false;var C=null;if(typeof M==="string"){M={dataSource:M}}if(M.dataSource){var w=d.dataSources&&d.dataSources[M.dataSource];if(typeof w==="object"){if(w.type===undefined){w.type="OData"}if(!M.type){switch(w.type){case"OData":if(w.settings&&w.settings.odataVersion==="4.0"){M.type="sap.ui.model.odata.v4.ODataModel"}else{M.type="sap.ui.model.odata.v2.ODataModel"}break;case"JSON":M.type="sap.ui.model.json.JSONModel";break;case"XML":M.type="sap.ui.model.xml.XMLModel";break;default:}}if(M.type==="sap.ui.model.odata.v4.ODataModel"&&w.settings&&w.settings.odataVersion){M.settings=M.settings||{};M.settings.odataVersion=w.settings.odataVersion}if(!M.uri){M.uri=w.uri;S=true}if(w.type==="OData"&&w.settings&&typeof w.settings.maxAge==="number"){M.settings=M.settings||{};M.settings.headers=M.settings.headers||{};M.settings.headers["Cache-Control"]="max-age="+w.settings.maxAge}if(w.type==="OData"&&w.settings&&w.settings.annotations){var _=w.settings.annotations;for(var b=0;b<_.length;b++){var O=d.dataSources[_[b]];if(!O){e.sap.log.error('Component Manifest: ODataAnnotation "'+_[b]+'" for dataSource "'+M.dataSource+'" could not be found in manifest','["sap.app"]["dataSources"]["'+_[b]+'"]',p);continue}if(O.type!=="ODataAnnotation"){e.sap.log.error('Component Manifest: dataSource "'+_[b]+'" was expected to have type "ODataAnnotation" but was "'+O.type+'"','["sap.app"]["dataSources"]["'+_[b]+'"]',p);continue}if(!O.uri){e.sap.log.error('Component Manifest: Missing "uri" for ODataAnnotation "'+_[b]+'"','["sap.app"]["dataSources"]["'+_[b]+'"]',p);continue}var P=new o(O.uri);if(M.type==="sap.ui.model.odata.v2.ODataModel"){["sap-language","sap-client"].forEach(function(e){if(!P.hasQuery(e)&&c.getSAPParam(e)){P.setQuery(e,c.getSAPParam(e))}});var E=s.dataSources&&s.dataSources[O.uri];if(E){var x=function(){if(!P.hasQuery("sap-language")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for ODataAnnotation "'+_[b]+'" ('+P.toString()+"). "+'Missing "sap-language" URI parameter','["sap.app"]["dataSources"]["'+_[b]+'"]',p);return}if(!P.hasQuery("sap-client")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for ODataAnnotation "'+_[b]+'" ('+P.toString()+"). "+'Missing "sap-client" URI parameter','["sap.app"]["dataSources"]["'+_[b]+'"]',p);return}if(!P.hasQuery("sap-client",c.getSAPParam("sap-client"))){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for ODataAnnotation "'+_[b]+'" ('+P.toString()+"). "+'URI parameter "sap-client='+P.query(true)["sap-client"]+'" must be identical with configuration "sap-client='+c.getSAPParam("sap-client")+'"','["sap.app"]["dataSources"]["'+_[b]+'"]',p);return}if(P.hasQuery("sap-context-token")&&!P.hasQuery("sap-context-token",E)){var t=P.query(true)["sap-context-token"];e.sap.log.warning('Component Manifest: Overriding existing "sap-context-token='+t+'" with provided value "'+E+'" for ODataAnnotation "'+_[b]+'" ('+P.toString()+").",'["sap.app"]["dataSources"]["'+_[b]+'"]',p)}P.setQuery("sap-context-token",E)};x()}}var U=d.origin.dataSources[_[b]]||r;var j=U.resolveUri(P).toString();M.settings=M.settings||{};M.settings.annotationURI=M.settings.annotationURI||[];M.settings.annotationURI.push(j)}}}else{e.sap.log.error('Component Manifest: dataSource "'+M.dataSource+'" for model "'+v+'" not found or invalid','["sap.app"]["dataSources"]["'+M.dataSource+'"]',p)}}if(!M.type){e.sap.log.error('Component Manifest: Missing "type" for model "'+v+'"','["sap.ui5"]["models"]["'+v+'"]',p);continue}if(M.type==="sap.ui.model.odata.ODataModel"&&(!M.settings||M.settings.json===undefined)){M.settings=M.settings||{};M.settings.json=true}if(M.uri){var k=new o(M.uri);var A=(S?d.origin.dataSources[M.dataSource]:d.origin.models[v])||r;k=A.resolveUri(k);if(M.dataSource){u(k);if(M.type==="sap.ui.model.odata.v2.ODataModel"){C=M.settings&&M.settings.metadataUrlParams;if((!C||typeof C["sap-language"]==="undefined")&&!k.hasQuery("sap-language")&&c.getSAPParam("sap-language")){M.settings=M.settings||{};C=M.settings.metadataUrlParams=M.settings.metadataUrlParams||{};C["sap-language"]=c.getSAPParam("sap-language")}if(s.dataSources){var E=s.dataSources[w.uri];if(E){var D=function(){if(k.hasQuery("sap-context-token")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for model "'+v+'" ('+k.toString()+"). "+'Model URI already contains parameter "sap-context-token='+k.query(true)["sap-context-token"]+'"','["sap.ui5"]["models"]["'+v+'"]',p);return}if((!C||typeof C["sap-language"]==="undefined")&&!k.hasQuery("sap-language")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for model "'+v+'" ('+k.toString()+"). "+'Missing "sap-language" parameter','["sap.ui5"]["models"]["'+v+'"]',p);return}if(!k.hasQuery("sap-client")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for model "'+v+'" ('+k.toString()+"). "+'Missing "sap-client" parameter','["sap.ui5"]["models"]["'+v+'"]',p);return}if(!k.hasQuery("sap-client",c.getSAPParam("sap-client"))){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for model "'+v+'" ('+k.toString()+"). "+'URI parameter "sap-client='+k.query(true)["sap-client"]+'" must be identical with configuration "sap-client='+c.getSAPParam("sap-client")+'"','["sap.ui5"]["models"]["'+v+'"]',p);return}if(C&&typeof C["sap-client"]!=="undefined"){if(C["sap-client"]!==c.getSAPParam("sap-client")){e.sap.log.warning('Component Manifest: Ignoring provided "sap-context-token='+E+'" for model "'+v+'" ('+k.toString()+"). "+'Parameter metadataUrlParams["sap-client"] = "'+C["sap-client"]+'" must be identical with configuration "sap-client='+c.getSAPParam("sap-client")+'"','["sap.ui5"]["models"]["'+v+'"]',p);return}}if(C&&C["sap-context-token"]&&C["sap-context-token"]!==E){e.sap.log.warning('Component Manifest: Overriding existing "sap-context-token='+C["sap-context-token"]+'" with provided value "'+E+'" for model "'+v+'" ('+k.toString()+").",'["sap.ui5"]["models"]["'+v+'"]',p)}if(!C){M.settings=M.settings||{};C=M.settings.metadataUrlParams=M.settings.metadataUrlParams||{}}C["sap-context-token"]=E};D()}}}}M.uri=k.toString()}if(M.uriSettingName===undefined){switch(M.type){case"sap.ui.model.odata.ODataModel":case"sap.ui.model.odata.v2.ODataModel":case"sap.ui.model.odata.v4.ODataModel":M.uriSettingName="serviceUrl";break;case"sap.ui.model.resource.ResourceModel":M.uriSettingName="bundleUrl";break;default:}}var N;var I;if(a){I=a.getComponentData()}else{I=t.componentData}N=I&&I.startupParameters&&I.startupParameters["sap-system"];if(!N){N=c.getSAPParam("sap-system")}var R=false;var T;if(N&&["sap.ui.model.odata.ODataModel","sap.ui.model.odata.v2.ODataModel"].indexOf(M.type)!=-1){R=true;T=sap.ui.requireSync("sap/ui/model/odata/ODataUtils")}if(M.uri){if(R){M.preOriginBaseUri=M.uri.split("?")[0];M.uri=T.setOrigin(M.uri,{alias:N});M.postOriginBaseUri=M.uri.split("?")[0]}if(M.uriSettingName!==undefined){M.settings=M.settings||{};if(!M.settings[M.uriSettingName]){M.settings[M.uriSettingName]=M.uri}}else if(M.settings){M.settings=[M.uri,M.settings]}else{M.settings=[M.uri]}}else{if(R&&M.uriSettingName!==undefined&&M.settings&&M.settings[M.uriSettingName]){M.preOriginBaseUri=M.settings[M.uriSettingName].split("?")[0];M.settings[M.uriSettingName]=T.setOrigin(M.settings[M.uriSettingName],{alias:N});M.postOriginUri=M.settings[M.uriSettingName].split("?")[0]}}if(R&&M.settings&&M.settings.annotationURI){var B=[].concat(M.settings.annotationURI);var H=[];for(var b=0;b<B.length;b++){H.push(T.setAnnotationOrigin(B[b],{alias:N,preOriginBaseUri:M.preOriginBaseUri,postOriginBaseUri:M.postOriginBaseUri}))}M.settings.annotationURI=H}if(M.type==="sap.ui.model.resource.ResourceModel"&&M.settings&&Array.isArray(M.settings.enhanceWith)){M.settings.enhanceWith.forEach(function(e){if(e.bundleUrl){e.bundleUrl=r.resolveUri(new o(e.bundleUrl),e.bundleUrlRelativeTo).toString()}})}if(M.settings&&!Array.isArray(M.settings)){M.settings=[M.settings]}h[v]=M}return h};l._createManifestModels=function(t,n){var a={};for(var r in t){var i=t[r];try{e.sap.require(i.type)}catch(t){e.sap.log.error('Component Manifest: Class "'+i.type+'" for model "'+r+'" could not be loaded. '+t,'["sap.ui5"]["models"]["'+r+'"]',n);continue}var o=e.sap.getObject(i.type);if(!o){e.sap.log.error('Component Manifest: Class "'+i.type+'" for model "'+r+'" could not be found','["sap.ui5"]["models"]["'+r+'"]',n);continue}var s=[null].concat(i.settings||[]);var u=o.bind.apply(o,s);var f=new u;a[r]=f}return a};function m(t,n,a){var r={afterManifest:{},afterPreload:{}};var i=e.extend(true,{},t.getEntry("/sap.app/dataSources"));var o=e.extend(true,{},t.getEntry("/sap.ui5/models"));var s=l._createManifestModelConfigurations({models:o,dataSources:i,manifest:t,componentData:n,cacheTokens:a});var u=e.sap.getUriParameters().get("sap-ui-xx-preload-component-models-"+t.getComponentName());var f=u&&u.split(",");for(var p in s){var c=s[p];if(!c.preload&&f&&f.indexOf(p)>-1){c.preload=true;e.sap.log.warning('FOR TESTING ONLY!!! Activating preload for model "'+p+'" ('+c.type+")",t.getComponentName(),"sap.ui.core.Component")}if(c.type==="sap.ui.model.resource.ResourceModel"&&Array.isArray(c.settings)&&c.settings.length>0&&c.settings[0].async!==true){r.afterPreload[p]=c}else if(c.preload){if(e.sap.isDeclared(c.type,true)){r.afterManifest[p]=c}else{e.sap.log.warning('Can not preload model "'+p+'" as required class has not been loaded: "'+c.type+'"',t.getComponentName(),"sap.ui.core.Component")}}}return r}function y(t,a){var r=[];var i=[];function o(t,a){if(!t._oManifest){var s=t.getComponentName();var u=e.sap.getModulePath(s,"/manifest.json");var f;if(a){f=Promise.resolve(JSON.parse(JSON.stringify(a.getRawJson())))}else{f=e.sap.loadResource({url:u,dataType:"json",async:true}).catch(function(t){e.sap.log.error('Failed to load component manifest from "'+u+'" (component '+s+")! Reason: "+t);return{}})}r.push(f);i.push(t)}var p=t.getParent();if(p&&p instanceof n&&!p.isBaseClass()){o(p)}}o(t,a);return Promise.all(r).then(function(e){for(var t=0;t<e.length;t++){if(e[t]){i[t]._applyManifest(e[t])}}})}l._fnLoadComponentCallback=null;l._fnOnInstanceCreated=null;l.create=function(e){if(e==null||typeof e!=="object"){throw new TypeError("Component.create() must be called with a configuration object.")}var t=r(true,{},e);t.async=true;if(t.manifest===undefined){t.manifest=true}return h(t)};sap.ui.component=function(t){if(!t){throw new Error("sap.ui.component cannot be called without parameter!")}if(typeof t==="string"){e.sap.log.warning("Do not use deprecated function 'sap.ui.component' for Component instance lookup. Use 'Component.get' instead");return sap.ui.getCore().getComponent(t)}if(t.async){e.sap.log.info("Do not use deprecated factory function 'sap.ui.component'. Use 'Component.create' instead")}else{e.sap.log.warning("Do not use synchronous component creation! Use the new asynchronous factory 'Component.create' instead")}return h(t)};function h(t){function n(n){var a=t.name,r=t.id,i=t.componentData,o=a+".Component",s=t.settings;var u=new n(e.extend({},s,{id:r,componentData:i,_cacheTokens:t.asyncHints&&t.asyncHints.cacheTokens}));e.sap.assert(u instanceof l,'The specified component "'+o+'" must be an instance of sap.ui.core.Component!');e.sap.log.info("Component instance Id = "+u.getId());var f=u.getMetadata().handleValidation()!==undefined||t.handleValidation;if(f){if(u.getMetadata().handleValidation()!==undefined){f=u.getMetadata().handleValidation()}else{f=t.handleValidation}sap.ui.getCore().getMessageManager().registerObject(u,f)}g(u);if(typeof l._fnOnInstanceCreated==="function"){var p=l._fnOnInstanceCreated(u,t);if(t.async&&p instanceof Promise){return p.then(function(){return u})}}return u}var a=v(t,{failOnError:true,createModels:true,waitFor:t.asyncHints&&t.asyncHints.waitFor});if(t.async){var r=i._sOwnerId;return a.then(function(e){return d(function(){return n(e)},r)})}else{return n(a)}}l.load=function(e){var t=r(true,{},e);t.async=true;if(t.manifest===undefined){t.manifest=true}return v(t,{preloadOnly:t.asyncHints&&t.asyncHints.preloadOnly})};l.get=function(e){return sap.ui.getCore().getComponent(e)};sap.ui.component.load=function(t,n){e.sap.log.warning("Do not use deprecated function 'sap.ui.component.load'! Use 'Component.load' instead");return v(t,{failOnError:n,preloadOnly:t.asyncHints&&t.asyncHints.preloadOnly})};function v(n,a){var r=n.name,i=n.url,o=sap.ui.getCore().getConfiguration(),u=/^(sync|async)$/.test(o.getComponentPreload()),f=n.manifest,p,d,g,h,v,M;function S(e){var a=new t(JSON.parse(JSON.stringify(e)));return n.async?Promise.resolve(a):a}if(f===undefined){p=n.manifestFirst===undefined?o.getManifestFirst():!!n.manifestFirst;d=n.manifestUrl}else{if(n.async===undefined){n.async=true}p=!!f;d=f&&typeof f==="string"?f:undefined;g=f&&typeof f==="object"?S(f):undefined}e.sap.interaction.setStepComponent(r);if(!g&&d){g=t.load({manifestUrl:d,componentName:r,async:n.async})}if(g&&!n.async){r=g.getComponentName()}if(!(g&&n.async)){if(!r){throw new Error("The name of the component is undefined.")}e.sap.assert(typeof r==="string","sName must be a string")}if(r&&i){e.sap.registerModulePath(r,i)}if(p&&!g){g=t.load({manifestUrl:e.sap.getModulePath(r,"/manifest.json"),componentName:r,async:n.async,failOnError:false})}function C(){return e.sap.getResourceName(r+".Component","")}function w(t){var n=r+".Component";if(!t){var i="The specified component controller '"+n+"' could not be found!";if(a.failOnError){throw new Error(i)}else{e.sap.log.warning(i)}}if(g){var o=c(t.getMetadata(),g);var s=function(){var e=Array.prototype.slice.call(arguments);var n;if(e.length===0||typeof e[0]==="object"){n=e[0]=e[0]||{}}else if(typeof e[0]==="string"){n=e[1]=e[1]||{}}n._metadataProxy=o;if(h){n._manifestModels=h}var a=Object.create(t.prototype);t.apply(a,e);return a};s.getMetadata=function(){return o};s.extend=function(){throw new Error("Extending Components created by Manifest is not supported!")};return s}else{return t}}function _(t,n){e.sap.assert(typeof t==="string"&&t||typeof t==="object"&&typeof t.name==="string"&&t.name,"reference either must be a non-empty string or an object with a non-empty 'name' and an optional 'url' property");if(typeof t==="object"){if(t.url){e.sap.registerModulePath(t.name,t.url)}return t.lazy&&n!==true?undefined:t.name}return t}function b(t,n){var a=t+".Component",r=sap.ui.getCore().getConfiguration().getDepCache(),i;if(u&&t!=null&&!e.sap.isDeclared(a,true)){if(n){i=e.sap.getResourceName(a,r?"-h2-preload.js":"-preload.js");return e.sap._loadJSResourceAsync(i,true)}try{i=a+"-preload";e.sap.require(i)}catch(t){e.sap.log.warning("couldn't preload component from "+i+": "+(t&&t.message||t))}}else if(n){return Promise.resolve()}}function O(t,n,a){var r=[];var i=a?function(e){r.push(e)}:e.noop;n.defineResourceRoots();var o=n.getEntry("/sap.ui5/dependencies/libs");if(o){var s=[];for(var u in o){if(!o[u].lazy){s.push(u)}}if(s.length>0){e.sap.log.info('Component "'+t+'" is loading libraries: "'+s.join(", ")+'"');i(sap.ui.getCore().loadLibraries(s,{async:a}))}}var f=n.getEntry("/sap.ui5/extends/component");if(f){i(b(f,a))}var p=[];var c=n.getEntry("/sap.ui5/dependencies/components");if(c){for(var t in c){if(!c[t].lazy){p.push(t)}}}var d=n.getEntry("/sap.ui5/componentUsages");if(d){for(var l in d){if(d[l].lazy===false&&p.indexOf(d[l].name)===-1){p.push(d[l].name)}}}if(p.length>0){p.forEach(function(e){i(b(e,a))})}return a?Promise.all(r):undefined}if(n.async){var P=n.asyncHints||{},E=[],x=function(e){e=e.then(function(e){return{result:e,rejected:false}},function(e){return{result:e,rejected:true}});return e},U=function(e){if(e){E.push(x(e))}},j=function(e){return e},k,A;if(g&&a.createModels){U(g.then(function(e){v=m(e,n.componentData,P.cacheTokens);return e}).then(function(e){if(Object.keys(v.afterManifest).length>0){h=l._createManifestModels(v.afterManifest,e.getComponentName())}return e}))}k=[];if(Array.isArray(P.preloadBundles)){P.preloadBundles.forEach(function(t){k.push(e.sap._loadJSResourceAsync(_(t,true),true))})}if(Array.isArray(P.libs)){A=P.libs.map(_).filter(j);k.push(sap.ui.getCore().loadLibraries(A,{preloadOnly:true}))}k=Promise.all(k);if(A&&!a.preloadOnly){k=k.then(function(){return sap.ui.getCore().loadLibraries(A)})}U(k);if(!g){U(b(r,true))}else{U(g.then(function(t){var n=t.getComponentName();if(i){e.sap.registerModulePath(n,i)}return b(n,true).then(function(){if(!a.createModels){return null}var r=Object.keys(v.afterPreload);if(r.length===0){return null}return new Promise(function(e){sap.ui.require(["sap/ui/model/resource/ResourceModel"],function(t){e(t)})}).then(function(a){function i(t){var r=v.afterPreload[t];if(Array.isArray(r.settings)&&r.settings.length>0){var i=r.settings[0];return a.loadResourceBundle(i,true).then(function(e){i.bundle=e},function(a){e.sap.log.error("Component Manifest: Could not preload ResourceBundle for ResourceModel. "+"The model will be skipped here and tried to be created on Component initialization.",'["sap.ui5"]["models"]["'+t+'"]',n);e.sap.log.error(a);delete v.afterPreload[t]})}else{return Promise.resolve()}}return Promise.all(r.map(i)).then(function(){if(Object.keys(v.afterPreload).length>0){var e=l._createManifestModels(v.afterPreload,t.getComponentName());if(!h){h={}}for(var n in e){h[n]=e[n]}}})})})}));M=function(t){if(typeof l._fnLoadComponentCallback==="function"){var a=e.extend(true,{},n);var r=e.extend(true,{},t);try{l._fnLoadComponentCallback(a,r)}catch(t){e.sap.log.error('Callback for loading the component "'+g.getComponentName()+'" run into an error. The callback was skipped and the component loading resumed.',t,"sap.ui.core.Component")}}}}if(P.components){e.each(P.components,function(e,t){U(b(_(t),true))})}return Promise.all(E).then(function(e){var t=[],n=false,a;n=e.some(function(e){if(e&&e.rejected){a=e.result;return true}t.push(e.result)});if(n){return Promise.reject(a)}return t}).then(function(e){if(g&&M){g.then(M)}return e}).then(function(t){e.sap.log.debug("Component.load: all promises fulfilled, then "+t);if(g){return g.then(function(e){g=e;r=g.getComponentName();return O(r,g,true)})}else{return t}}).then(function(){if(a.preloadOnly){return true}return new Promise(function(e,t){sap.ui.require([C()],function(t){e(t)})}).then(function(t){var n=t.getMetadata();var a=n.getComponentName();var r=e.sap.getModulePath(a,"/manifest.json");var i;if(g&&typeof f!=="object"&&(typeof d==="undefined"||d===r)){i=y(n,g)}else{i=y(n)}return i.then(function(){return w(t)})})}).then(function(t){if(!g){return t}var n=[];var a;var r=g.getEntry("/sap.ui5/rootView");if(typeof r==="string"){a="XML"}else if(r&&typeof r==="object"&&r.type){a=r.type}if(a&&s[a]){var i="sap/ui/core/mvc/"+s[a]+"View";n.push(i)}var o=g.getEntry("/sap.ui5/routing");if(o&&o.routes){var u=g.getEntry("/sap.ui5/routing/config/routerClass")||"sap.ui.core.routing.Router";var f=e.sap.getResourceName(u,"");n.push(f)}var p=e.extend(true,{},g.getEntry("/sap.ui5/models"));var c=e.extend(true,{},g.getEntry("/sap.app/dataSources"));var d=l._createManifestModelConfigurations({models:p,dataSources:c,manifest:g,cacheTokens:P.cacheTokens});for(var m in d){if(!d.hasOwnProperty(m)){continue}var y=d[m];if(!y.type){continue}var h=e.sap.getResourceName(y.type,"");if(n.indexOf(h)===-1){n.push(h)}}if(n.length>0){return Promise.all(n.map(function(t){return new Promise(function(n,a){var r=false;function i(a){if(r){return}e.sap.log.warning('Can not preload module "'+t+'". '+"This will most probably cause an error once the module is used later on.",g.getComponentName(),"sap.ui.core.Component");e.sap.log.warning(a);r=true;n()}sap.ui.require([t],n,i)})})).then(function(){return t})}else{return t}}).then(function(e){var t=a.waitFor;if(t){var n=Array.isArray(t)?t:[t];return Promise.all(n).then(function(){return e})}return e}).catch(function(e){if(h){for(var t in h){var n=h[t];if(n&&typeof n.destroy==="function"){n.destroy()}}}throw e})}if(g){O(r,g)}b(r);return w(sap.ui.requireSync(C()))}return l});