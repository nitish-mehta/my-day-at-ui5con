/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/model/TreeBinding","sap/ui/model/ClientTreeBinding","./TreeBindingAdapter","sap/ui/model/ChangeReason"],function(e,t,i,r,o){"use strict";var n=function(){if(!(this instanceof t)||this._bIsAdapted){return}r.apply(this);for(var e in n.prototype){if(n.prototype.hasOwnProperty(e)){this[e]=n.prototype[e]}}this._invalidTree=true;this.setNumberOfExpandedLevels(this.mParameters.numberOfExpandedLevels||0)};n.prototype.setNumberOfExpandedLevels=function(e){this._iNumberOfExpandedLevels=parseInt(e,10)};n.prototype.getNumberOfExpandedLevels=function(){return this._iNumberOfExpandedLevels};n.prototype.nodeHasChildren=function(t){e.sap.assert(t,"TreeBindingAdapter.nodeHasChildren: No node given!");if(!t){return false}else if(t.isArtificial){return true}else{return i.prototype.hasChildren.call(this,t.context)}};n.prototype.resetData=function(e,t){var r=i.prototype.resetData.call(this,e,t);this._aRowIndexMap=[];this._oRootNode=undefined;this._iPageSize=0;this._iThreshold=0;if(!t||t.reason!==o.Sort){this.clearSelection();this._createTreeState(true)}return r};n.prototype._calculateGroupID=function(t){var i=this.getPath();var r;if(t.context){var o=t.context.getPath();if(i!="/"){var n=o.match(i+"(.*)");if(n!=null&&n[1]){r=n[1]}else{e.sap.log.warning("CTBA: BindingPath/ContextPath matching problem!")}}if(!r){r=o}if(e.sap.startsWith(r,"/")){r=r.substring(1,r.length)}var p;if(!t.parent){p=this._calculateGroupID({context:t.context._parentContext||null})}else{p=t.parent.groupID}r=p+r.replace(/\//g,"_")+"/"}else if(t.context===null){r="/"}return r};n.prototype.expand=function(){this._buildTree();r.prototype.expand.apply(this,arguments)};n.prototype.collapse=function(){this._buildTree();r.prototype.collapse.apply(this,arguments)};n.prototype._buildTree=function(e,t){if(this._invalidTree){e=e||0;t=t||this.getRootContexts().length;this._invalidTree=false;this._aRowIndexMap=[];r.prototype._buildTree.call(this,e,t)}};n.prototype.findNode=function(){this._buildTree();return r.prototype.findNode.apply(this,arguments)};n.prototype.setSelectedIndex=function(){this._buildTree();return r.prototype.setSelectedIndex.apply(this,arguments)};n.prototype.setSelectionInterval=function(){this._buildTree();return r.prototype.setSelectionInterval.apply(this,arguments)};n.prototype.addSelectionInterval=function(){this._buildTree();r.prototype.addSelectionInterval.apply(this,arguments)};n.prototype.removeSelectionInterval=function(){this._buildTree();r.prototype.removeSelectionInterval.apply(this,arguments)};n.prototype.clearSelection=function(){this._buildTree();r.prototype.clearSelection.apply(this,arguments)};n.prototype.selectAll=function(){this._buildTree();r.prototype.selectAll.apply(this,arguments)};n.prototype._calculateRequestLength=function(e,t){return e};n.prototype.getLength=function(){this._buildTree();return r.prototype.getLength.apply(this,arguments)};n.prototype._fireChange=function(){this._invalidTree=true;this.constructor.prototype._fireChange.apply(this,arguments)};return n},true);