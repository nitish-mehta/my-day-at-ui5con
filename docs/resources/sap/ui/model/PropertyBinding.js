/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Binding","./SimpleType","./DataState"],function(t,e,a,i){"use strict";var o=e.extend("sap.ui.model.PropertyBinding",{constructor:function(t,a,i,o){e.apply(this,arguments)},metadata:{abstract:true,publicMethods:["getValue","setValue","setType","getType","setFormatter","getFormatter","getExternalValue","setExternalValue","getBindingMode"]}});o.prototype.getExternalValue=function(){return this._toExternalValue(this.getValue())};o.prototype._toExternalValue=function(t){if(this.oType){t=this.oType.formatValue(t,this.sInternalType)}if(this.fnFormatter){t=this.fnFormatter(t)}return t};o.prototype.setExternalValue=function(e){if(this.fnFormatter){t.sap.log.warning("Tried to use twoway binding, but a formatter function is used");return}var a=this.getDataState();try{if(this.oType){e=this.oType.parseValue(e,this.sInternalType);this.oType.validateValue(e)}}catch(t){a.setInvalidValue(e);this.checkDataState();throw t}a.setInvalidValue(undefined);this.setValue(e)};o.prototype.getInternalValue=function(){var e=this.getValue();var a;if(this.oType&&e!==null&&e!==undefined){a=this.oType.getModelFormat();t.sap.assert(a&&typeof a.parse==="function","The input format of "+this.oType+" should be an object with the 'parse' method");return a.parse(e)}return e};o.prototype.setInternalValue=function(e){var a;if(this.fnFormatter){t.sap.log.warning("Tried to use twoway binding, but a formatter function is used");return}var i=this.getDataState();try{if(this.oType&&e!==null&&e!==undefined){a=this.oType.getModelFormat();t.sap.assert(a&&typeof a.format==="function","The model format of "+this.oType+" should be an object with the 'format' method");e=a.format(e);this.oType.validateValue(e)}}catch(t){i.setInvalidValue(e);this.checkDataState();throw t}i.setInvalidValue(undefined);this.setValue(e)};o.prototype.setType=function(t,e){this.oType=t;this.sInternalType=e};o.prototype.getType=function(){return this.oType};o.prototype.setFormatter=function(t){this.fnFormatter=t};o.prototype.getFormatter=function(){return this.fnFormatter};o.prototype.getBindingMode=function(){return this.sMode};o.prototype.setBindingMode=function(t){this.sMode=t};o.prototype.resume=function(){this.bSuspended=false;this.checkUpdate(true)};o.prototype.checkDataState=function(t){var e=this.oModel?this.oModel.resolve(this.sPath,this.oContext):null,a=this.getDataState(),i=this;function o(){i.fireEvent("AggregatedDataStateChange",{dataState:a});a.changed(false);i._sDataStateTimout=null}if(!t||e&&e in t){if(e){a.setModelMessages(this.oModel.getMessagesByPath(e))}if(a&&a.changed()){if(this.mEventRegistry["DataStateChange"]){this.fireEvent("DataStateChange",{dataState:a})}if(this.bIsBeingDestroyed){o()}else if(this.mEventRegistry["AggregatedDataStateChange"]){if(!this._sDataStateTimout){this._sDataStateTimout=setTimeout(o,0)}}}}};return o});