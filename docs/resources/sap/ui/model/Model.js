/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/message/MessageProcessor","./BindingMode","./Context","./Filter"],function(t,e,i,r,n){"use strict";var s=e.extend("sap.ui.model.Model",{constructor:function(){e.apply(this,arguments);this.oData={};this.bDestroyed=false;this.aBindings=[];this.mContexts={};this.iSizeLimit=100;this.sDefaultBindingMode=i.TwoWay;this.mSupportedBindingModes={OneWay:true,TwoWay:true,OneTime:true};this.mUnsupportedFilterOperators={};this.bLegacySyntax=false;this.sUpdateTimer=null},metadata:{abstract:true,publicMethods:["bindProperty","bindList","bindTree","bindContext","createBindingContext","destroyBindingContext","getProperty","getDefaultBindingMode","setDefaultBindingMode","isBindingModeSupported","attachParseError","detachParseError","attachRequestCompleted","detachRequestCompleted","attachRequestFailed","detachRequestFailed","attachRequestSent","detachRequestSent","attachPropertyChange","detachPropertyChange","setSizeLimit","refresh","isList","getObject"]}});s.M_EVENTS={ParseError:"parseError",RequestFailed:"requestFailed",RequestSent:"requestSent",RequestCompleted:"requestCompleted",PropertyChange:"propertyChange"};s.prototype.attachRequestFailed=function(t,e,i){this.attachEvent("requestFailed",t,e,i);return this};s.prototype.detachRequestFailed=function(t,e){this.detachEvent("requestFailed",t,e);return this};s.prototype.fireRequestFailed=function(t){this.fireEvent("requestFailed",t);return this};s.prototype.attachParseError=function(t,e,i){this.attachEvent("parseError",t,e,i);return this};s.prototype.detachParseError=function(t,e){this.detachEvent("parseError",t,e);return this};s.prototype.fireParseError=function(t){this.fireEvent("parseError",t);return this};s.prototype.attachRequestSent=function(t,e,i){this.attachEvent("requestSent",t,e,i);return this};s.prototype.detachRequestSent=function(t,e){this.detachEvent("requestSent",t,e);return this};s.prototype.fireRequestSent=function(t){this.fireEvent("requestSent",t);return this};s.prototype.attachRequestCompleted=function(t,e,i){this.attachEvent("requestCompleted",t,e,i);return this};s.prototype.detachRequestCompleted=function(t,e){this.detachEvent("requestCompleted",t,e);return this};s.prototype.fireRequestCompleted=function(t){this.fireEvent("requestCompleted",t);return this};s.prototype.attachMessageChange=function(t,e,i){this.attachEvent("messageChange",t,e,i);return this};s.prototype.detachMessageChange=function(t,e){this.detachEvent("messageChange",t,e);return this};s.prototype.firePropertyChange=function(t){this.fireEvent("propertyChange",t);return this};s.prototype.attachPropertyChange=function(t,e,i){this.attachEvent("propertyChange",t,e,i);return this};s.prototype.detachPropertyChange=function(t,e){this.detachEvent("propertyChange",t,e);return this};s.prototype.getObject=function(t,e,i){return this.getProperty(t,e,i)};s.prototype.getContext=function(e){if(!t.sap.startsWith(e,"/")){throw new Error("Path "+e+" must start with a / ")}var i=this.mContexts[e];if(!i){i=new r(this,e);this.mContexts[e]=i}return i};s.prototype.resolve=function(e,i){var r=typeof e=="string"&&!t.sap.startsWith(e,"/"),n=e,s;if(r){if(i){s=i.getPath();n=s+(t.sap.endsWith(s,"/")?"":"/")+e}else{n=this.isLegacySyntax()?"/"+e:undefined}}if(!e&&i){n=i.getPath()}if(n&&n!=="/"&&t.sap.endsWith(n,"/")){n=n.substr(0,n.length-1)}return n};s.prototype.addBinding=function(t){this.aBindings.push(t)};s.prototype.removeBinding=function(t){for(var e=0;e<this.aBindings.length;e++){if(this.aBindings[e]==t){this.aBindings.splice(e,1);break}}};s.prototype.getDefaultBindingMode=function(){return this.sDefaultBindingMode};s.prototype.setDefaultBindingMode=function(t){if(this.isBindingModeSupported(t)){this.sDefaultBindingMode=t;return this}throw new Error("Binding mode "+t+" is not supported by this model.",this)};s.prototype.isBindingModeSupported=function(t){return t in this.mSupportedBindingModes};s.prototype.setLegacySyntax=function(t){this.bLegacySyntax=t};s.prototype.isLegacySyntax=function(){return this.bLegacySyntax};s.prototype.setSizeLimit=function(t){this.iSizeLimit=t};s.prototype.getInterface=function(){return this};s.prototype.refresh=function(t){this.checkUpdate(t);if(t){this.fireMessageChange({oldMessages:this.mMessages})}};s.prototype.checkUpdate=function(e,i){if(i){if(!this.sUpdateTimer){this.sUpdateTimer=t.sap.delayedCall(0,this,function(){this.checkUpdate(e)})}return}if(this.sUpdateTimer){t.sap.clearDelayedCall(this.sUpdateTimer);this.sUpdateTimer=null}var r=this.aBindings.slice(0);t.each(r,function(t,i){i.checkUpdate(e)})};s.prototype.setMessages=function(e){e=e||{};if(!t.sap.equal(this.mMessages,e)){this.mMessages=e;this.checkMessages()}};s.prototype.getMessagesByPath=function(t){if(this.mMessages){return this.mMessages[t]||[]}return null};s.prototype.checkMessages=function(){t.each(this.aBindings,function(t,e){if(e.checkDataState){e.checkDataState()}})};s.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);this.oData={};this.aBindings=[];this.mContexts={};if(this.sUpdateTimer){t.sap.clearDelayedCall(this.sUpdateTimer)}this.bDestroyed=true};s.prototype.getMetaModel=function(){return undefined};s.prototype.getOriginalProperty=function(t,e){return this.getProperty(t,e)};s.prototype.isLaundering=function(t,e){return false};s.prototype.checkFilterOperation=function(t){o(t,function(t){if(this.mUnsupportedFilterOperators[t.sOperator]){throw new Error("Filter instances contain an unsupported FilterOperator: "+t.sOperator)}}.bind(this))};function o(t,e){t=t||[];if(t instanceof n){t=[t]}for(var i=0;i<t.length;i++){var r=t[i];e(r);o(r.oCondition,e);o(r.aFilters,e)}}return s});