/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./DataState"],function(t,e){"use strict";var r=e.extend("sap.ui.model.CompositeDataState",{metadata:{},constructor:function(r){e.apply(this,arguments);this.mProperties.originalValue=[];this.mProperties.originalInternalValue=[];this.mProperties.value=[];this.mProperties.invalidValue=undefined;this.mProperties.internalValue=[];this.mChangedProperties=t.sap.extend({},this.mProperties);this.aDataStates=r}});r.prototype._hasInnerInvalidValues=function(){return this.aDataStates.reduce(function(t,e){if(e.getInvalidValue()!==undefined){return true}else{return t}},false)};r.prototype.getInternalProperty=function(t){var e;if(t==="invalidValue"&&this._hasInnerInvalidValues()){e=this.aDataStates.map(function(t){return t.getProperty("invalidValue")||t.getProperty("value")})}else{e=this.aDataStates.map(function(e){return e.getProperty(t)})}return e};r.prototype.getProperty=function(t){var r=e.prototype.getProperty.apply(this,arguments);var a=this.getInternalProperty(t);var s;switch(t){case"modelMessages":case"controlMessages":s=r;for(var i=0;i<a.length;++i){s=s.concat(a[i])}break;default:s=a||r}return s};r.prototype.getModelMessages=function(){return this.getProperty("modelMessages")};r.prototype.getControlMessages=function(){return this.getProperty("controlMessages")};r.prototype.getMessages=function(){return this.aDataStates.reduce(function(t,e){return t.concat(e.getMessages())},e.prototype.getMessages.apply(this,arguments))};r.prototype.containsValues=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]!==undefined){return true}}return false}else{return!!t}};r.prototype.isDirty=function(){return this.aDataStates.reduce(function(t,e){if(e.isDirty()){return true}else{return t}},e.prototype.isDirty.apply(this,arguments))};r.prototype.isControlDirty=function(){return this.aDataStates.reduce(function(t,e){if(e.isControlDirty()){return true}else{return t}},e.prototype.isControlDirty.apply(this,arguments))};r.prototype.isLaundering=function(){return this.aDataStates.reduce(function(t,e){if(e.isLaundering()){return true}else{return t}},e.prototype.isLaundering.apply(this,arguments))};r.prototype.getInvalidValue=function(){var t=this.mChangedProperties["invalidValue"];var e=this.getInternalProperty("invalidValue");if(e&&this.containsValues(e)){t=e;this.setInvalidValue(e)}return t};r.prototype.changed=function(e){if(e===false){this.mProperties=t.sap.extend({},this.mChangedProperties);this.aDataStates.forEach(function(t){t.changed(false)})}return this.aDataStates.reduce(function(t,e){if(t){return true}else{return e.changed()}},!t.sap.equal(this.mProperties,this.mChangedProperties))};r.prototype.getChanges=function(){var e={};var r,a,s;var i=[];for(r=0;r<this.aDataStates.length;++r){s=this.aDataStates[r].getChanges();for(a in s){e[a]=[]}i.push(s)}var n=this._hasInnerInvalidValues();var o={};for(a in e){for(r=0;r<i.length;++r){s=i[r][a];if(!o[a]){o[a]=[]}if(s){o[a].push(s.value)}else{var u=this.aDataStates[r].getProperty(a);if(a==="invalidValue"&&n&&!u){u=this.aDataStates[r].getProperty("value")}o[a].push(u)}}}t.each(this.mChangedProperties,function(e,r){if(this.mChangedProperties[e]&&!t.sap.equal(this.mChangedProperties[e],this.mProperties[e])){o[e]={};o[e].value=this.mChangedProperties[e];o[e].oldValue=this.mProperties[e]}}.bind(this));var p=this.getMessages();var l=this._getOldMessages();if(p.length>0||l.length>0){o["messages"]={};o["messages"].oldValue=l;o["messages"].value=p}return o};return r});