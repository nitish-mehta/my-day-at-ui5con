/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/format/NumberFormat","sap/ui/model/FormatException","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/type/ODataType","sap/ui/model/ParseException","sap/ui/model/ValidateException"],function(t,e,i,n,r,a,o){"use strict";var s=/^[-+]?(\d+)(?:\.(\d+))?$/;function u(i){var n,r;if(!i.oFormat){n={groupingEnabled:true,maxIntegerDigits:Infinity};r=l(i);if(r!==Infinity){n.minFractionDigits=n.maxFractionDigits=r}n=t.extend(n,i.oFormatOptions);n.parseAsString=true;i.oFormat=e.getFloatInstance(n)}return i.oFormat}function l(t){return t.oConstraints&&t.oConstraints.scale||0}function m(t,e){return sap.ui.getCore().getLibraryResourceBundle().getText(t,e)}function f(e,i){var n,r,a,o,u;function l(i,n){t.sap.log.warning("Illegal "+n+": "+i,null,e.getName())}function m(t,e,i,n){var r=typeof t==="string"?parseInt(t,10):t;if(r===undefined){return e}if(typeof r!=="number"||isNaN(r)||r<i){l(t,n);return e}return r}function f(t,e){if(t){if(t.match(s)){return t}l(t,e)}}function c(t,e){if(t===true||t==="true"){return true}if(t!==undefined&&t!==false&&t!=="false"){l(t,e)}}function p(t,i,n){if(i!==n){e.oConstraints=e.oConstraints||{};e.oConstraints[t]=i}}e.oConstraints=undefined;if(i){n=i.nullable;a=i.precision;u=i.scale;o=u==="variable"?Infinity:m(u,0,0,"scale");r=m(a,Infinity,1,"precision");if(o!==Infinity&&r<=o){t.sap.log.warning("Illegal scale: must be less than precision (precision="+a+", scale="+u+")",null,e.getName());o=Infinity}p("precision",r,Infinity);p("scale",o,0);if(n===false||n==="false"){p("nullable",false,true)}else if(n!==undefined&&n!==true&&n!=="true"){l(n,"nullable")}p("minimum",f(i.minimum,"minimum"));p("minimumExclusive",c(i.minimumExclusive,"minimumExclusive"));p("maximum",f(i.maximum,"maximum"));p("maximumExclusive",c(i.maximumExclusive,"maximumExclusive"))}e._handleLocalizationChange()}var c=r.extend("sap.ui.model.odata.type.Decimal",{constructor:function(t,e){r.apply(this,arguments);this.oFormatOptions=t;f(this,e)}});c.prototype.formatValue=function(t,e){if(t===null||t===undefined){return null}switch(this.getPrimitiveType(e)){case"any":return t;case"float":return parseFloat(t);case"int":return Math.floor(parseFloat(t));case"string":return u(this).format(t);default:throw new i("Don't know how to format "+this.getName()+" to "+e)}};c.prototype.parseValue=function(t,i){var n;if(t===null||t===""){return null}switch(this.getPrimitiveType(i)){case"string":n=u(this).parse(t);if(!n){throw new a(sap.ui.getCore().getLibraryResourceBundle().getText("EnterNumber"))}if(n.indexOf(".")>=0){n=n.replace(/0+$/,"").replace(/\.$/,"")}break;case"int":case"float":n=e.getFloatInstance({maxIntegerDigits:Infinity,decimalSeparator:".",groupingEnabled:false}).format(t);break;default:throw new a("Don't know how to parse "+this.getName()+" from "+i)}return n};c.prototype._handleLocalizationChange=function(){this.oFormat=null};c.prototype.validateValue=function(t){var e,i,r,a,u,f,c,p,h;if(t===null&&(!this.oConstraints||this.oConstraints.nullable!==false)){return}if(typeof t!=="string"){throw new o(m("EnterNumber"))}r=s.exec(t);if(!r){throw new o(m("EnterNumber"))}i=r[1].length;e=(r[2]||"").length;h=l(this);p=this.oConstraints&&this.oConstraints.precision||Infinity;f=this.oConstraints&&this.oConstraints.minimum;a=this.oConstraints&&this.oConstraints.maximum;if(e>h){if(h===0){throw new o(m("EnterInt"))}else if(i+h>p){throw new o(m("EnterNumberIntegerFraction",[p-h,h]))}throw new o(m("EnterNumberFraction",[h]))}if(h===Infinity){if(i+e>p){throw new o(m("EnterNumberPrecision",[p]))}}else if(i>p-h){throw new o(m("EnterNumberInteger",[p-h]))}if(f){c=this.oConstraints.minimumExclusive;if(n.compare(f,t,true)>=(c?0:1)){throw new o(m(c?"EnterNumberMinExclusive":"EnterNumberMin",[this.formatValue(f,"string")]))}}if(a){u=this.oConstraints.maximumExclusive;if(n.compare(a,t,true)<=(u?0:-1)){throw new o(m(u?"EnterNumberMaxExclusive":"EnterNumberMax",[this.formatValue(a,"string")]))}}};c.prototype.getName=function(){return"sap.ui.model.odata.type.Decimal"};return c});