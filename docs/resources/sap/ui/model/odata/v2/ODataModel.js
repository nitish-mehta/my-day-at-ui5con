/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/Model","sap/ui/model/odata/v2/ODataAnnotations","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/CountMode","sap/ui/model/odata/UpdateMethod","sap/ui/model/odata/OperationMode","./ODataContextBinding","./ODataListBinding","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataPropertyBinding","./ODataTreeBinding","sap/ui/model/odata/ODataMetaModel","sap/ui/core/message/MessageParser","sap/ui/model/odata/ODataMessageParser","sap/ui/thirdparty/datajs","jquery.sap.script"],function(e,t,a,r,s,i,n,o,u,d,h,f,c,p,l,g,_,y){"use strict";var m=r.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(e,a){r.apply(this,arguments);var d,h,c,p,l,g,_,y,v,b,q,R,C,E,M,P,S,A,x,T,D,U,I,O,H,k=this;if(typeof e==="object"){a=e;e=a.serviceUrl}if(a){d=a.user;h=a.password;c=a.headers;p=a.tokenHandling;l=a.withCredentials;g=a.maxDataServiceVersion;_=a.useBatch;y=a.refreshAfterChange;v=a.annotationURI;b=a.loadAnnotationsJoined;C=a.defaultBindingMode;q=a.defaultCountMode;R=a.preliminaryContext;E=a.defaultOperationMode;M=a.metadataNamespaces;P=a.serviceUrlParams;S=a.metadataUrlParams;A=a.json;x=a.messageParser;T=a.skipMetadataAnnotationParsing;D=a.defaultUpdateMethod;U=a.disableHeadRequestForToken;I=a.sequentializeRequests;O=a.disableSoftStateHeader;H=a.bindableResponseHeaders}this.mSupportedBindingModes={OneWay:true,OneTime:true,TwoWay:true};this.mUnsupportedFilterOperators={Any:true,All:true};this.sDefaultBindingMode=C||t.OneWay;this.bJSON=A!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=D||o.Merge;this.bTokenHandling=p!==false;this.bWithCredentials=l===true;this.bUseBatch=_!==false;this.bRefreshAfterChange=y!==false;this.sMaxDataServiceVersion=g;this.bLoadAnnotationsJoined=b!==false;this.sAnnotationURI=v;this.sDefaultCountMode=q||n.Request;this.sDefaultOperationMode=E||u.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!T;this.bDisableHeadRequestForToken=!!U;this.bSequentializeRequests=!!I;this.bDisableSoftStateHeader=!!O;this.aBindableResponseHeaders=H?H:null;this.bPreliminaryContext=R||false;this.mMetadataUrlParams=S||{};if(x){x.setProcessor(this)}this.oMessageParser=x;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=e;var L=e.split("?");if(L.length>1){this.sServiceUrl=L[0];if(L[1]){this.aUrlParams.push(L[1])}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=d;this.sPassword=h;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true")}this.oHeaders={};this.setHeaders(c);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header"}var B=this._createMetadataUrl("/$metadata");this.oServiceData=m.mServiceData[B];if(!this.oServiceData){m.mServiceData[B]={};this.oServiceData=m.mServiceData[B]}this.bUseCache=this._cacheSupported(B);if(!this.oServiceData.oMetadata||this.oServiceData.oMetadata.bFailed){this.oMetadata=new f(B,{async:true,cacheKey:this.bUseCache?B:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:M,withCredentials:this.bWithCredentials});this.oServiceData.oMetadata=this.oMetadata}else{this.oMetadata=this.oServiceData.oMetadata}this.oAnnotations=new s(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(B),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"]}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(P){this.aUrlParams=this.aUrlParams.concat(i._createUrlParamsArray(P))}this.onMetadataFailed=function(e){k.fireMetadataFailed(e.getParameters())};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed)}this.oMetadata.loaded().then(function(){k._initializeMetadata()});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata"}else{this.oHeaders["Accept"]="application/json"}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml"}if(this.bTokenHandling&&this.oServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oServiceData.securityToken}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});m.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};m.prototype.attachBatchRequestFailed=function(e,t,a){this.attachEvent("batchRequestFailed",e,t,a);return this};m.prototype.detachBatchRequestFailed=function(e,t){this.detachEvent("batchRequestFailed",e,t);return this};m.prototype.fireBatchRequestFailed=function(e){this.fireEvent("batchRequestFailed",e);return this};m.prototype.attachBatchRequestSent=function(e,t,a){this.attachEvent("batchRequestSent",e,t,a);return this};m.prototype.detachBatchRequestSent=function(e,t){this.detachEvent("batchRequestSent",e,t);return this};m.prototype.fireBatchRequestSent=function(e){this.fireEvent("batchRequestSent",e);return this};m.prototype.attachBatchRequestCompleted=function(e,t,a){this.attachEvent("batchRequestCompleted",e,t,a);return this};m.prototype.detachBatchRequestCompleted=function(e,t){this.detachEvent("batchRequestCompleted",e,t);return this};m.prototype.fireBatchRequestCompleted=function(e){this.fireEvent("batchRequestCompleted",e);return this};m.mServiceData={};m.prototype._initializeMetadata=function(){if(this.bDestroyed){return}var t=function(){this.fireMetadataLoaded({metadata:this.oMetadata});e.sap.log.debug(this+" - metadataloaded fired")}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(t,this.fireMetadataFailed.bind(this))}else{t()}};m.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh()}};m.prototype.fireAnnotationsLoaded=function(e){this.fireEvent("annotationsLoaded",e);return this};m.prototype.attachAnnotationsLoaded=function(e,t,a){this.attachEvent("annotationsLoaded",e,t,a);return this};m.prototype.detachAnnotationsLoaded=function(e,t){this.detachEvent("annotationsLoaded",e,t);return this};m.prototype.fireAnnotationsFailed=function(t){this.fireEvent("annotationsFailed",t);e.sap.log.debug(this+" - annotationsfailed fired");return this};m.prototype.attachAnnotationsFailed=function(e,t,a){this.attachEvent("annotationsFailed",e,t,a);return this};m.prototype.detachAnnotationsFailed=function(e,t){this.detachEvent("annotationsFailed",e,t);return this};m.prototype.fireMetadataLoaded=function(e){this.fireEvent("metadataLoaded",e);return this};m.prototype.attachMetadataLoaded=function(e,t,a){this.attachEvent("metadataLoaded",e,t,a);return this};m.prototype.detachMetadataLoaded=function(e,t){this.detachEvent("metadataLoaded",e,t);return this};m.prototype.fireMetadataFailed=function(e){this.fireEvent("metadataFailed",e);return this};m.prototype.attachMetadataFailed=function(e,t,a){this.attachEvent("metadataFailed",e,t,a);return this};m.prototype.detachMetadataFailed=function(e,t){this.detachEvent("metadataFailed",e,t);return this};m.prototype._createEventInfo=function(e,t,a){var r={};r.url=e.requestUri;r.method=e.method;r.async=e.async;r.headers=e.headers;if(a){r.requests=[];for(var s=0;s<a.length;s++){var i={};if(Array.isArray(a[s])){var n=a[s];for(var o=0;o<n.length;o++){var e=n[o].request;var u=a[s][o].response;i={};i.url=e.requestUri;i.method=e.method;i.headers=e.headers;if(u){i.response={};if(e._aborted){i.success=false;i.response.statusCode=0;i.response.statusText="abort"}else{i.success=true;if(u.message){i.response.message=u.message;u=u.response;i.response.responseText=u.body;i.success=false}i.response.headers=u.headers;i.response.statusCode=u.statusCode;i.response.statusText=u.statusText}}r.requests.push(i)}}else{var e=a[s].request;var u=a[s].response;i.url=e.requestUri;i.method=e.method;i.headers=e.headers;if(u){i.response={};if(e._aborted){i.success=false;i.response.statusCode=0;i.response.statusText="abort"}else{i.success=true;if(u.message){i.response.message=u.message;u=u.response;i.response.responseText=u.body;i.success=false}i.response.headers=u.headers;i.response.statusCode=u.statusCode;i.response.statusText=u.statusText}}r.requests.push(i)}}}if(t){r.response={};r.success=true;if(t.message){r.response.message=t.message;r.success=false}if(t.response){t=t.response}if(t&&t.statusCode!=undefined){r.response.headers=t.headers;r.response.statusCode=t.statusCode;r.response.statusText=t.statusText;r.response.responseText=t.body!==undefined?t.body:t.responseText}}r.ID=e.requestID;return r};m.prototype._createRequestID=function(){var t;t=e.sap.uid();return t};m.prototype._createMetadataUrl=function(t){if(t.indexOf(this.sServiceUrl)==-1){if(!t.startsWith("/")){t="/"+t}t=this.sServiceUrl+t}var a=e.sap.getUriParameters(t).mParams||{};Object.keys(a).forEach(function(e){a[e]=a[e][0]});var r=e.extend({},this.mMetadataUrlParams,a);var s=i._createUrlParamsArray(r);var n=t.split("?");if(n.length>1){t=n[0]}return this._addUrlParams(t,s)};m.prototype._addUrlParams=function(e,t){var a=[];if(this.aUrlParams){a=a.concat(this.aUrlParams)}if(t){a=a.concat(t)}if(a&&a.length>0){e+="?"+a.join("&")}return e};m.prototype._createRequestUrl=function(e,t,a,r){var s,i="";s=this._normalizePath(e,t);if(!r){i=this.sServiceUrl+s}else{i=s.substr(s.indexOf("/")+1)}return this._addUrlParams(i,a)};m.prototype._importData=function(t,a,r){var s=this,i,n,o,u;if(t.results){i=[];e.each(t.results,function(e,t){var n=s._importData(t,a,r);if(n){i.push(n)}});return i}else{n=this._getKey(t);if(!n){return n}u=this._getEntity(n);if(!u||u.__metadata&&u.__metadata.invalid){u=t;this._addEntity(u)}if(this.aBindableResponseHeaders){var d={};for(var h in r.headers){var f=h.toLowerCase();if(this.aBindableResponseHeaders.indexOf(f)>-1){d[f]=r.headers[h]}}if(!e.isEmptyObject(d)){if(!t.__metadata){t.__metadata={}}t.__metadata.headers=d}}e.each(t,function(e,t){if(t&&(t.__metadata&&t.__metadata.uri||t.results)&&!t.__deferred){o=s._importData(t,a,r);if(Array.isArray(o)){u[e]={__list:o}}else{u[e]={__ref:o}}}else if(!t||!t.__deferred){u[e]=t}});var c={};c[n]=u;this._updateChangedEntities(c);a[n]=true;return n}};m.prototype._removeReferences=function(t){var a=this,r;if(!t){return t}if(t.results){r=[];e.each(t.results,function(e,t){r.push(a._removeReferences(t))});return r}else{e.each(t,function(e,a){if(a){if(a["__ref"]||a["__list"]){delete t[e]}}});return t}};m.prototype._restoreReferences=function(t,a){var r=this,s,i,n;function o(t){var s=a[t];if(!s){s=r._getObject("/"+t);e.sap.assert(s,"ODataModel inconsistent: "+t+" not found!");if(s){s=e.sap.extend(true,{},s);a[t]=s;r._restoreReferences(s,a)}}return s}if(!a){a={}}e.each(t,function(a,r){if(r){if(r.__ref){s=r.__ref;i=o(s);if(i){t[a]=i}delete r.__ref}else if(r.__list){n=[];e.each(r.__list,function(e,t){i=o(t);if(i){n.push(i)}});delete r.__list;r.results=n}}});return t};m.prototype.removeData=function(){this.oData={}};m.prototype.initialize=function(){var e=this.aBindings.slice(0);e.forEach(function(e){e.initialize()})};m.prototype.invalidate=function(e){var t;for(var a in this.oData){t=this.oData[a];if(!e||e(a,t)){t.__metadata.invalid=true}}};m.prototype.invalidateEntry=function(e){var t;if(typeof e==="string"){if(e.indexOf("/")===0){t=this._getObject(e)}else{t=this.oData[e]}}else if(e instanceof a){t=this._getObject(e.getPath())}if(t&&t.__metadata){t.__metadata.invalid=true}};m.prototype.invalidateEntityType=function(e){var t;for(var a in this.oData){t=this.oData[a];if(t.__metadata.type===e){t.__metadata.invalid=true}}};m.prototype.refresh=function(e,t,a){if(typeof e==="string"){a=e;e=false;t=false}if(t){this.removeData()}this._refresh(e,a)};m.prototype._refresh=function(e,t,a,r){var s=this.aBindings.slice(0);this.sRefreshGroupId=t;s.forEach(function(t){t._refresh(e,a,r)});this.sRefreshGroupId=undefined};m.prototype.checkUpdate=function(t,a,r,s){if(a){if(!this.sUpdateTimer){this.sUpdateTimer=e.sap.delayedCall(0,this,function(){this.checkUpdate(t,false,r)})}return}if(this.sUpdateTimer){e.sap.clearDelayedCall(this.sUpdateTimer);this.sUpdateTimer=null}var i=this.aBindings.slice(0);i.forEach(function(e){if(!s||this.isMetaModelPath(e.getPath())){e.checkUpdate(t,r)}}.bind(this));this._processAfterUpdate()};m.prototype.checkDataState=function(e){var t=this.aBindings.slice(0);t.forEach(function(t){if(t.checkDataState){t.checkDataState(e)}})};m.prototype.bindProperty=function(e,t,a){var r=new c(this,e,t,a);return r};m.prototype.bindList=function(e,t,a,r,s){var i=new h(this,e,t,a,r,s);return i};m.prototype.bindTree=function(e,t,a,r,s){var i=new p(this,e,t,a,r,s);return i};m.prototype.createBindingContext=function(t,a,r,s,i){var n,o,u,d,h=this;if(a!==null&&typeof a==="object"&&!(a instanceof sap.ui.model.Context)){i=s;s=r;r=a;a=undefined}if(typeof a=="function"){i=r;s=a;r=undefined;a=undefined}if(typeof a=="boolean"){i=a;s=undefined;r=undefined;a=undefined}if(typeof r=="function"){i=s;s=r;r=undefined}if(typeof r=="boolean"){i=r;s=undefined;r=undefined}if(typeof s=="boolean"){i=s;s=undefined}n=this.resolve(t,a);if(!n){if(s){s(null)}return null}if(i===undefined){i=this._isReloadNeeded(n,r)}if(!i){o=this.resolve(t,a,true);u=this.getContext(o);if(s){s(u)}return u}function f(e){var r=e?h._getKey(e):null,i=!(t===""||t.indexOf("/")>0),n=null,o,d;u=null;if(r){u=h.getContext("/"+r);n={__ref:r}}if(a&&p&&i){o=a.getPath();o=o.substr(1);d=h._getEntity(o);if(d){d[t]=n}}s(u)}function c(e){var r;if(e.statusCode=="404"&&a&&p){var i=a.getPath();i=i.substr(1);r=h._getEntity(i);if(r){r[t]={__ref:null}}}s(null)}if(s){var p=!e.sap.startsWith(t,"/");if(n){var l=[],g=this.createCustomParams(r);if(g){l.push(g)}if(r&&(r.batchGroupId||r.groupId)){d=r.groupId||r.batchGroupId}this.read(n,{groupId:d,urlParameters:l,success:f,error:c})}else{s(null)}}if(r&&r.createPreliminaryContext){n=this.resolve(t,a);u=this.getContext(n);return u}};m.prototype._updateContext=function(t,a){if(!e.sap.startsWith(a,"/")){throw new Error("Path "+a+" must start with a / ")}t.sPath=a;this.mContexts[a]=t};m.prototype._splitEntries=function(e){return e.replace(/\s/g,"").split(",").map(function(e){return e.split("/")})};m.prototype._filterOwnSelect=function(e,t){var a,r;if(!t){return[]}r=t.map(function(e){return e.name});a=e.filter(function(e){return e.length===1}).map(function(e){return e[0]});if(e.length===0||a.indexOf("*")!==-1||a.indexOf("**")!==-1){return r}else{return a.filter(function(e){return r.indexOf(e)!==-1})}};m.prototype._filterOwnExpand=function(e,t){return e.map(function(e){return e[0]}).filter(function(e,t,a){return a.indexOf(e)===t}).filter(function(e){return t.length===0||t.some(function(t){return t.indexOf(e)===0||t.indexOf("**")===0})})};m.prototype._filterSelectByNavProp=function(e,t){return e.filter(function(e){return e[0]===t}).map(function(e){return e.length>1?e.slice(1):["**"]})};m.prototype._filterExpandByNavProp=function(e,t){return e.filter(function(e){return e.length>1&&e[0]===t}).map(function(e){return e.slice(1)})};m.prototype._isReloadNeeded=function(e,t){var a=this,r=this.oMetadata,s,i=this._getObject(e),n=[],o=[];if(!this.oMetadata.isLoaded()){return true}s=this.oMetadata._getEntityTypeByPath(e);if(this._isCreatedEntity(i)){return false}function u(e,t,s,i){var n,o,d,h,f,c,p,l,g;if(!e){return false}if(t===null){return false}if(!t){return true}if(t.__metadata&&t.__metadata.invalid){return true}n=a._filterOwnSelect(s,e.property);for(var _=0;_<n.length;_++){g=n[_];if(t[g]===undefined){return true}}o=a._filterOwnExpand(i,s);for(var _=0;_<o.length;_++){l=o[_];d=t[l];if(d===null){continue}if(d===undefined||d.__deferred){return true}h=r._getEntityTypeByNavProperty(e,l);c=a._filterSelectByNavProp(s,l);p=a._filterExpandByNavProp(i,l);if(d.__ref){f=a._getEntity(d.__ref);if(u(h,f,c,p)){return true}}if(d.__list){for(var y=0;y<d.__list.length;y++){f=a._getEntity(d.__list[y]);if(u(h,f,c,p)){return true}}}}return false}if(t){if(t.select){o=this._splitEntries(t.select)}if(t.expand){n=this._splitEntries(t.expand)}}return u(s,i,o,n)};m.prototype.createCustomParams=function(t){var a=[],r,s={expand:true,select:true};for(var i in t){if(i in s){a.push("$"+i+"="+e.sap.encodeURL(t[i]))}if(i==="custom"){r=t[i];for(i in r){if(i.indexOf("$")===0){e.sap.log.warning(this+" - Trying to set OData parameter '"+i+"' as custom query option!")}else if(typeof r[i]==="string"){a.push(i+"="+e.sap.encodeURL(r[i]))}else{a.push(i)}}}}return a.join("&")};m.prototype.bindContext=function(e,t,a){var r=new d(this,e,t,a);return r};m.prototype.setDefaultCountMode=function(e){this.sDefaultCountMode=e};m.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode};m.prototype._addEntity=function(e){var t=this._getKey(e);this.oData[t]=e};m.prototype._removeEntity=function(e){e=e&&i._normalizeKey(e);delete this.oData[e];delete this.mChangedEntities[e];delete this.mContexts["/"+e]};m.prototype._getEntity=function(e){var t=this.oData[e];if(!t){e=e&&i._normalizeKey(e);t=this.oData[e]}return t};m.prototype._getKey=function(e){var t,r;if(e instanceof a){t=e.getPath().substr(1)}else if(e&&e.__metadata&&e.__metadata.uri){r=e.__metadata.uri;t=r.substr(r.lastIndexOf("/")+1)}else if(typeof e==="string"){t=e.substr(e.lastIndexOf("/")+1)}if(!this.oData[t]){t=t&&i._normalizeKey(t)}return t};m.prototype.getKey=function(e){return this._getKey(e)};m.prototype.createKey=function(t,a){var r=this.oMetadata._getEntityTypeByPath(t),s=t,n=this,o,u;e.sap.assert(r,'Could not find entity type of collection "'+t+'" in service metadata!');s+="(";if(r.key.propertyRef.length===1){o=r.key.propertyRef[0].name;e.sap.assert(o in a,'Key property "'+o+'" is missing in object!');u=this.oMetadata._getPropertyMetadata(r,o);s+=encodeURIComponent(i.formatValue(a[o],u.type))}else{e.each(r.key.propertyRef,function(t,d){if(t>0){s+=","}o=d.name;e.sap.assert(o in a,'Key property "'+o+'" is missing in object!');u=n.oMetadata._getPropertyMetadata(r,o);s+=o;s+="=";s+=encodeURIComponent(i.formatValue(a[o],u.type))})}s+=")";return s};m.prototype.getProperty=function(t,a,r){var s=this._getObject(t,a);if(!r){return s}if(!e.isPlainObject(s)){return s}s=e.sap.extend(true,{},s);if(r===true){return this._restoreReferences(s)}else{return this._removeReferences(s)}};m.prototype.getObject=function(t,a,r){if(e.isPlainObject(a)){r=a;a=undefined}var s=this,i=this.resolve(t,a),n=this._getObject(i),o=this.oMetadata._getEntityTypeByPath(i),u=[],d=[];if(!o||!e.isPlainObject(n)||!n.__metadata||!n.__metadata.uri){return n}if(!r||!(r.select||r.expand)){return e.sap.extend(true,{},n)}function h(t,a,r,i){var n,o,u,d,f,c,p,l,g,_,y,m,v;if(!a){return undefined}if(!t){return undefined}u=s._filterOwnSelect(r,t.property);o={};for(var b=0;b<u.length;b++){m=u[b];if(a[m]!==undefined){o[m]=a[m]}else{e.sap.log.fatal("No data loaded for select property: "+m+" of entry: "+s.getKey(a));return undefined}}if(a.__metadata){o.__metadata=a.__metadata}n=s._filterOwnExpand(i,r);for(var b=0;b<n.length;b++){y=n[b];f=a[y];c=s.oMetadata._getEntityTypeByNavProperty(t,y);g=s._filterSelectByNavProp(r,y);_=s._filterExpandByNavProp(i,y);if(f&&f.__ref){l=s._getObject("/"+f.__ref);p=h(c,l,g,_);if(p!==undefined){o[y]=p}else{e.sap.log.fatal("No data loaded for expand property: "+y+" of entry: "+s.getKey(p));return undefined}}if(f&&f.__list){v=[];for(var q=0;q<f.__list.length;q++){l=s._getObject("/"+f.__list[q]);p=h(c,l,g,_);if(p!==undefined){v.push(p)}else{e.sap.log.fatal("No data loaded for expand property: "+y+" of entry: "+s.getKey(p));return undefined}}o[y]=v}}d=s._filterOwnSelect(r,t.navigationProperty);for(var R=0;R<d.length;R++){y=d[R];if(n.indexOf(y)===-1){var C=o.__metadata.uri+"/"+y;o[y]={__deferred:{uri:C}}}}return o}if(r.select){d=this._splitEntries(r.select)}if(r.expand){u=this._splitEntries(r.expand)}n=h(o,n,d,u);return n};m.prototype._getObject=function(t,a,r){var s=this.isLegacySyntax()?this.oData:null,i,n,o=this.resolve(t,a),u,d,h,f,c,p;if(!o){return s}if(this._isMetadataPath(o)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(o)){u=o.indexOf("/##");p=this.getMetaModel();if(!this.bMetaModelLoaded){return null}d=o.substr(0,u);h=o.substr(u+3);f=p.getMetaContext(d);s=p.getProperty(h,f)}else{s=this.oMetadata._getAnnotation(o)}}}else{if(o==="/"){return this.oData}var l=o.split("/"),g=0;c=l[1];l.splice(0,2);i=this.mChangedEntities[c];n=this._getEntity(c);s=r?n:i||n;while(s&&l[g]){var _=i&&i.hasOwnProperty(l[g]);i=i&&i[l[g]];n=n&&n[l[g]];s=r||!_?n:i;if(s){if(s.__ref){i=this.mChangedEntities[s.__ref];n=this._getEntity(s.__ref);s=r?n:i||n}else if(s.__list){s=s.__list}else if(s.__deferred){s=undefined}}g++}}if(e.isPlainObject(i)){s=r?n:e.sap.extend(true,{},n,i)}return s};m.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oServiceData.securityToken){this.refreshSecurityToken()}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oServiceData.securityToken}}};m.prototype.resetSecurityToken=function(){delete this.oServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken};m.prototype.getSecurityToken=function(){var e=this.oServiceData.securityToken;if(!e){this.refreshSecurityToken();e=this.oServiceData.securityToken}return e};m.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oServiceData.securityToken)}else{this.pSecurityToken=new Promise(function(e,t){this.refreshSecurityToken(function(){e(this.oServiceData.securityToken)}.bind(this),function(){t()},true)}.bind(this))}}return this.pSecurityToken};m.prototype.refreshSecurityToken=function(e,t,a){var r;var s=this;var i=this._createRequestUrl("/");var n={abort:function(){this.request.abort()}};function o(t,a){if(a){r=s._getHeader("x-csrf-token",a.headers);s._setSessionContextIdHeader(s._getHeader("sap-contextid",a.headers));if(r){s.oServiceData.securityToken=r;s.pSecurityToken=Promise.resolve(r);s.oHeaders["x-csrf-token"]=r}else{s.resetSecurityToken();s.bTokenHandling=false}}if(e){e(t,a)}}function u(e){s.resetSecurityToken();s.bTokenHandling=false;s._handleError(e);if(t){t(e)}}function d(e){n.request=h("GET",u)}function h(e,t){var r=s._createRequest(i,e,s._getHeaders(false,true),null,null,!!a);r.headers["x-csrf-token"]="Fetch";return s._request(r,o,t,undefined,undefined,s.getServiceMetadata())}if(this.bDisableHeadRequestForToken){n.request=h("GET",u)}else{n.request=h("HEAD",d)}return n};m.prototype._submitRequest=function(t,a,r){var s=this,i,n,o,u,d;u=new Promise(function(e,t){d=e});function h(e,t){if(a){a(e,t)}d()}function f(e){if(s.bTokenHandling&&e.response){var a=s._getHeader("x-csrf-token",e.response.headers);if(!t.bTokenReset&&e.response.statusCode=="403"&&a&&a.toLowerCase()==="required"){s.resetSecurityToken();t.bTokenReset=true;p();return}}if(r){r(e)}d()}function c(e){if(s.bTokenHandling&&e.method!=="GET"){s.pReadyForRequest=s.securityTokenAvailable()}return s.pReadyForRequest}function p(){c(t).then(function(e){if(s.bTokenHandling&&t.method!=="GET"){t.headers["x-csrf-token"]=e}g()},function(){g()})}function l(t,a,r){var i,n=a.eventInfo.requests;if(n){e.each(n,function(a,r){if(Array.isArray(r)){r.forEach(function(a){e.each(a.parts,function(e,r){i=s._createEventInfo(a.request,r.fnError);s["fireRequest"+t](i)})})}else{if(r.parts){e.each(r.parts,function(e,a){i=s._createEventInfo(r.request,a.fnError);s["fireRequest"+t](i)})}else{i=s._createEventInfo(r.request,r.fnError);s["fireRequest"+t](i)}}});if(a.eventInfo.batch){i=s._createEventInfo(a,r,n);s["fireBatchRequest"+t](i)}}}function g(){if(s.sSessionContextId){t.headers["sap-contextid"]=s.sSessionContextId}n=s._request(t,h,f,i,undefined,s.getServiceMetadata());if(t.eventInfo){l("Sent",t,null);delete t.eventInfo}if(o){n.abort()}}i=s._getODataHandler(t.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){p()});this.pSequentialRequestCompleted=u}else{p()}return{abort:function(){if(n){n.abort()}o=true}}};m.prototype._setSessionContextIdHeader=function(e){if(e){this.sSessionContextId=e}};m.prototype._submitSingleRequest=function(e){var t=this,a,r={},s={},i={};function n(a,n){if(a===undefined&&n.statusCode===200){o({message:"Response did not contain a valid OData result",response:n});return}function u(a,n){for(var o=0;o<e.parts.length;o++){if(e.parts[o].request._aborted){t._processAborted(e.parts[o].request,n)}else if(e.parts[o].fnSuccess){e.parts[o].fnSuccess(a,n)}}if(e.request.requestUri.indexOf("$count")===-1){t.checkUpdate(false,false,s);if(e.bRefreshAfterChange){t._refresh(false,undefined,r,i)}}}t._processSuccess(e.request,n,u,s,r,i);t._setSessionContextIdHeader(t._getHeader("sap-contextid",n.headers))}function o(a){if(a.message=="Request aborted"){for(var r=0;r<e.parts.length;r++){t._processAborted(e.parts[r].request,a)}}else{for(var r=0;r<e.parts.length;r++){t._processError(e.parts[r].request,a,e.parts[r].fnError)}}t._processAfterUpdate()}e.request.eventInfo={requests:e.parts,batch:false};a=this._submitRequest(e.request,n,o);return a};m.prototype._submitBatchRequest=function(t,a,r,s){var i=this,n={},o={},u={};function d(e,t,a){for(var r=0;r<e.parts.length;r++){if(a||e.parts[r].request._aborted){i._processAborted(e.parts[r].request,t)}else if(t.message){i._processError(e.parts[r].request,t,e.parts[r].fnError)}else{i._processSuccess(e.parts[r].request,t,e.parts[r].fnSuccess,o,n,u)}}}function h(e,s){if(e===undefined&&s.statusCode===200){f({message:"Response did not contain a valid OData batch result",response:s});return}var h,c,p,l=e.__batchResponses;if(l){var g,_;for(g=0;g<l.length;g++){h=l[g];if(Array.isArray(a[g])){if(h.message){for(_=0;_<a[g].length;_++){c=a[g][_];d(c,h);c.response=h}}else{p=h.__changeResponses;for(_=0;_<p.length;_++){var y=p[_];c=a[g][_];d(c,y);c.response=y}}}else{c=a[g];d(c,h);c.response=h}}i.checkUpdate(false,false,o)}i._processSuccess(t,s,r,o,n,u,true,a);i._setSessionContextIdHeader(i._getHeader("sap-contextid",s.headers))}function f(r){var n=r.message=="Request aborted";e.each(a,function(e,t){if(Array.isArray(t)){t.forEach(function(e){d(e,r,n)})}else{d(t,r,n)}});i._processAfterUpdate();if(n){i._processAborted(t,r,true)}else{i._processError(t,r,s,true,a)}}t.eventInfo={requests:a,batch:true};var c=this._submitRequest(t,h,f);function p(e){var t;for(var a=0;a<e.parts.length;a++){t=e.parts[a].fnError;if(!e.parts[a].request._aborted&&t){t(v)}}}var l={abort:function(){e.each(a,function(e,t){if(Array.isArray(t)){t.forEach(function(e){p(e)})}else{p(t)}});c.abort()}};return l};m.prototype._createBatchRequest=function(t){var a,r,s={},i={},n=true;i.__batchRequests=t;for(var o in t){if(t[o]&&t[o].__changeRequests||t[o]&&t[o].headers&&!t[o].headers["sap-cancel-on-close"]){n=false;break}}a=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){a+="?"+this.aUrlParams.join("&")}e.extend(s,this.mCustomHeaders,this.oHeaders);s["Accept"]="multipart/mixed";delete s["Content-Type"];s["sap-cancel-on-close"]=n;r={headers:s,requestUri:a,method:"POST",data:i,user:this.sUser,password:this.sPassword,async:true};r.withCredentials=this.bWithCredentials;return r};m.prototype.abortInternalRequest=function(e,t){var a=this.mRequests;if(t in this.mDeferredGroups){a=this.mDeferredRequests}var r=a[t];if(r&&e in r.map){var s=r.map[e];for(var i=0;i<s.parts.length;i++){s.parts[i].requestHandle.abort()}}};m.prototype._pushToRequestQueue=function(e,t,a,r,s,i,n,o){var u=e[t],d=r.key?r.key:r.method+":"+r.requestUri;if(!u){u={};u.map={};u.requests=[];e[t]=u}if(d in u.map&&(r.key||r.method==="GET")){var h=u.map[d];var f=h.request;if(h.bRefreshAfterChange===undefined){h.bRefreshAfterChange=o}if(!r.key){h.parts.push({request:r,fnSuccess:s,fnError:i,requestHandle:n})}if(r.method==="GET"){delete f.data}else{f.method=r.method;f.headers=r.headers;f.data=r.data;f.requestUri=r.requestUri;if(r.method==="PUT"){delete f.headers["x-http-method"]}if(f._aborted){delete f._aborted}}}else{var h={request:r,bRefreshAfterChange:o,parts:[{request:r,fnSuccess:s,fnError:i,requestHandle:n}]};if(r.method==="GET"){u.requests.push(h)}else{if(!u.changes){u.changes={}}var c=u.changes[a];if(!c){c=[];u.changes[a]=c}h.changeSetId=a;c.push(h)}u.map[d]=h}};m.prototype._collectChangedEntities=function(t,a,r){var s=this;if(t.changes){e.each(t.changes,function(e,t){for(var i=0;i<t.length;i++){if(t[i].bRefreshAfterChange){var n=t[i].request,o="/"+n.requestUri.split("?")[0],u,d;if(n.method==="POST"||n.method==="DELETE"){var h=s.oMetadata._getEntityTypeByPath(o);if(h){r[h.entityType]=true}}else{u=s._getObject(o);if(u){d=s._getKey(u)}else if(o.lastIndexOf("/")===0){d=s._getKey(o)}if(d){a[d]=true}}}}})}};m.prototype._processRequestQueue=function(t,a,r,s){var i=this,n,o=[];function u(e,t){for(var a=0;a<e.parts.length;a++){var r=e.parts[a];if(r.request._aborted){i._processAborted(e.request,null);e.parts.splice(a,1);a--}else if(t){r.request._handle=t;t.iRelevantRequests++}}}function d(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort()}}}}if(this.bUseBatch){e.each(t,function(e,t){if(e===a||!a){var r={},s={};i._collectChangedEntities(t,r,s);if(Object.keys(r).length||Object.keys(s).length){i.bIncludeInCurrentBatch=true;i._refresh(false,e,r,s);i.bIncludeInCurrentBatch=false}}});e.each(t,function(h,f){if(h===a||!a){var c=[],p=[],l,g;var _=d();if(f.changes){e.each(f.changes,function(e,t){l={__changeRequests:[]};g=[];for(var a=0;a<t.length;a++){n="/"+i.getKey(t[a].request.data);i.increaseLaundering(n,t[a].request.data);u(t[a],_);if(t[a].parts.length>0){if(t[a].request.data&&t[a].request.data.__metadata){delete t[a].request.data.__metadata.created}l.__changeRequests.push(t[a].request);g.push(t[a])}}if(l.__changeRequests&&l.__changeRequests.length>0){c.push(l);p.push(g)}})}if(f.requests){var y=f.requests;for(var m=0;m<y.length;m++){u(y[m],_);if(y[m].parts.length>0){c.push(y[m].request);p.push(y[m])}}}if(c.length>0){var v=i._createBatchRequest(c);_.oRequestHandle=i._submitBatchRequest(v,p,r,s);o.push(_.oRequestHandle)}delete t[h]}})}else{e.each(t,function(r,s){if(r===a||!a){if(s.changes){e.each(s.changes,function(e,t){for(var a=0;a<t.length;a++){var r=d();n="/"+i.getKey(t[a].request.data);i.increaseLaundering(n,t[a].request.data);u(t[a],r);if(t[a].parts.length>0){r.oRequestHandle=i._submitSingleRequest(t[a]);o.push(r.oRequestHandle)}}})}if(s.requests){var h=s.requests;for(var f=0;f<h.length;f++){var c=d();u(h[f],c);if(h[f].parts.length>0){c.oRequestHandle=i._submitSingleRequest(h[f]);o.push(c.oRequestHandle)}}}delete t[r]}})}this.checkDataState(this.mLaunderingState);return o.length==1?o[0]:o};m.prototype._processRequestQueueAsync=function(e){var t=this;if(!this.pCallAsnyc){this.pCallAsnyc=new Promise(function(e,a){t.oMetadata.loaded().then(function(){e()})});this.pCallAsnyc.then(function(){t._processRequestQueue(e);t.pCallAsnyc=undefined})}};m.prototype._processSuccess=function(t,a,r,s,i,n,o,u){var d=a.data,h,f,c,p,l,g,_,y={},m={},v=this;if(!o){f=!(a.statusCode===204||a.statusCode==="204");c=t.requestUri;p=c.replace(this.sServiceUrl,"");if(!e.sap.startsWith(p,"/")){p="/"+p}p=this._normalizePath(p);this.decreaseLaundering(p,t.data);if(f&&d===undefined&&a){this._parseResponse(a,t);e.sap.log.fatal(this+" - No data was retrieved by service: '"+a.requestUri+"'");v.fireRequestCompleted({url:a.requestUri,type:"GET",async:a.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false}if(d&&d.results&&!Array.isArray(d.results)){d=d.results}if(!a._imported&&d&&(Array.isArray(d)||typeof d=="object")){h=e.sap.extend(true,{},d);v._importData(h,y,a);a._imported=true}g=this._getEntity(t.key);if(y&&g&&g.__metadata.created&&g.__metadata.created.functionImport){var b=[];var q=g["$result"];if(q&&q.__list){e.each(y,function(e){b.push(e)});q.__list=b}else if(q&&q.__ref){e.each(y,function(e){q.__ref=e})}}if(!f){l=p.split("/");if(l[1]){m[l[1]]=t;var R={};R[l[1]]=t.data;this._updateChangedEntities(R)}if(t.method==="DELETE"&&l[2]!=="$links"){this._removeEntity(l[1])}}if(f&&t.method==="POST"){_=this.oMetadata._getEntityTypeByPath(p);if(_){n[_.entityType]=true}if(t.key){var C=this._getKey(d);var E=this.getContext("/"+t.key);E.sPath="/"+C;E.bCreated=false;this.mContexts[C]=E;this._removeEntity(t.key);g=this._getEntity(C);if(g){delete g.__metadata.created}}}this._parseResponse(a,t,y,m);e.extend(s,y);e.extend(i,m);this._updateETag(t,a)}if(r){r(d,a)}var M=this._createEventInfo(t,a,u);if(o){this.fireBatchRequestCompleted(M)}else{this.fireRequestCompleted(M)}return true};m.prototype._processError=function(e,t,a,r,s){var i,n=this._handleError(t,e);if(!r){i="/"+this.getKey(e.data);this.decreaseLaundering(i,e.data)}if(a){a(n)}var o=this._createEventInfo(e,n,s);if(r){this.fireBatchRequestCompleted(o);this.fireBatchRequestFailed(o)}else{this.fireRequestCompleted(o);this.fireRequestFailed(o)}};var v={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};m.prototype._processAborted=function(e,t,a){var r;if(!a){r="/"+this.getKey(e.data);this.decreaseLaundering(r,e.data)}if(t){var s=this._createEventInfo(e,v);s.success=false;if(a){this.fireBatchRequestCompleted(s)}else{this.fireRequestCompleted(s)}}};m.prototype._processAfterUpdate=function(){var e=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var t=0;t<e.length;t++){e[t]()}};m.prototype._processChange=function(t,a,r){var s,n,o,u,d,h,f,c,p,l,g,_=this;n=this.oMetadata._getEntityTypeByPath(t);if(!r){r="MERGE"}s=e.sap.extend(true,{},this._getObject("/"+t,true),a);if(a.__metadata&&a.__metadata.created){u=a.__metadata.created.method?a.__metadata.created.method:"POST";t=a.__metadata.created.key;f=true;o=a.__metadata.created;if(a.__metadata.created.functionImport){o.urlParameters=this._createFunctionImportParameters(a.__metadata.created.key,u,s);s=undefined}}else if(r==="MERGE"){u="MERGE";g=this._getEntity(t)}else{u="PUT"}if(s&&s.__metadata){for(var y in s.__metadata){if(y!=="type"&&y!=="uri"&&y!=="etag"&&y!=="content_type"&&y!=="media_src"){delete s.__metadata[y]}}}if(s&&n){var m=this.oMetadata._getNavigationPropertyNames(n);m.forEach(function(e){delete s[e]})}if(u==="MERGE"&&n&&g){e.each(s,function(a,r){if(a!=="__metadata"){if(e.sap.equal(g[a],r)&&!_.isLaundering("/"+t+"/"+a)){delete s[a]}}});var v="/"+t,b;e.each(s,function(e,t){if(e!=="__metadata"){b=_.getProperty(v+"/"+e+"/#@sap:unit");if(b){if(s[b]===undefined){s[b]=g[b]}}}})}s=this._removeReferences(s);p=o&&o.urlParameters?i._createUrlParamsArray(o.urlParameters):undefined;c=o&&o.headers?this._getHeaders(o.headers):this._getHeaders();d=o&&o.eTag?o.eTag:this.getETag(s);h=this._createRequestUrl("/"+t,null,p,this.bUseBatch);l=this._createRequest(h,u,c,s,d);if(f){l.created=true}if(this.bUseBatch){l.requestUri=l.requestUri.replace(this.sServiceUrl+"/","")}return l};m.prototype._resolveGroup=function(t){var a,r,s,i,n,o;r=this.oMetadata._getEntityTypeByPath(t);o=this._getObject("/"+t);if(o){s=o.__metadata.created;if(s){return{groupId:s.groupId,changeSetId:s.changeSetId}}}if(this.mChangeGroups[r.name]){a=this.mChangeGroups[r.name];i=a.groupId;n=a.single?e.sap.uid():a.changeSetId}else if(this.mChangeGroups["*"]){a=this.mChangeGroups["*"];i=a.groupId;n=a.single?e.sap.uid():a.changeSetId}return{groupId:i,changeSetId:n}};m.prototype._updateETag=function(t,a){var r,s,i;r=t.requestUri.replace(this.sServiceUrl+"/","");if(!e.sap.startsWith(r,"/")){r="/"+r}s=this._getObject(r.split("?")[0]);i=this._getHeader("etag",a.headers);if(s&&s.__metadata&&i){s.__metadata.etag=i}};m.prototype._handleError=function(t,a){var r={},s;var i="The following problem occurred: "+t.message;r.message=t.message;if(t.response){this._parseResponse(t.response,a);if(this.bTokenHandling){s=this._getHeader("x-csrf-token",t.response.headers);if(t.response.statusCode=="403"&&s&&s.toLowerCase()==="required"){this.resetSecurityToken()}}i+=t.response.statusCode+","+t.response.statusText+","+t.response.body;r.statusCode=t.response.statusCode;r.statusText=t.response.statusText;r.headers=t.response.headers;r.responseText=t.response.body}e.sap.log.fatal(i);return r};m.prototype.getData=function(e,t,a){return this.getProperty(e,t,a)};m.prototype._getODataHandler=function(e){if(e.indexOf("$batch")>-1){return y.batchHandler}else if(e.indexOf("$count")>-1){return undefined}else if(this.bJSON){return y.jsonHandler}else{return y.atomHandler}};m.prototype.getETag=function(e,t,a){if(typeof e=="object"){a=e;e=""}return this._getETag(e,t,a)};m.prototype._getETag=function(e,t,a){if(!a||!a.__metadata){a=this._getObject(e,t)}if(a&&a.__metadata){return a.__metadata.etag}return null};m.prototype.forceEntityUpdate=function(t){var a=this.mChangedEntities[t];if(a&&a.__metadata){a.__metadata.etag="*"}else{e.sap.log.error(this+" - Entity with key "+t+" does not exist or has no change")}};m.prototype._createRequest=function(e,t,a,r,s,i){i=i!==false;if(s&&t!=="GET"){a["If-Match"]=s}if(!a["Content-Type"]&&t!=="DELETE"&&t!=="GET"){if(this.bJSON){a["Content-Type"]="application/json"}else{a["Content-Type"]="application/atom+xml"}}if(e.indexOf("$count")>-1){a["Accept"]="text/plain, */*;q=0.5"}if(t==="MERGE"&&!this.bUseBatch){a["x-http-method"]="MERGE";t="POST"}var n={headers:a,requestUri:e,method:t,user:this.sUser,password:this.sPassword,async:i};if(r){n.data=r}if(this.bWithCredentials){n.withCredentials=this.bWithCredentials}n.requestID=this._createRequestID();return n};m.prototype._processRequest=function(e,t){var a,r,s=false,i=this;a={abort:function(){if(!s&&t){t(v)}if(r){r._aborted=true;if(r._handle){r._handle.abort()}}s=true}};this.oMetadata.loaded().then(function(){r=e(a);i._processRequestQueueAsync(i.mRequests);if(s){a.abort()}});return a};m.prototype.update=function(e,t,a){var r,s,n,o,u,d,h,f,c,p,l,g,_,y,m=this;if(a){f=a.groupId||a.batchGroupId;c=a.changeSetId;u=a.context;r=a.success;s=a.error;d=a.eTag;l=a.headers;p=a.urlParameters;y=a.refreshAfterChange;if(a.merge!==undefined){g=a.merge?"MERGE":"PUT"}}y=this._getRefreshAfterChange(y,f);h=i._createUrlParamsArray(p);l=this._getHeaders(l);g=g?g:this.sDefaultUpdateMethod;d=d||this._getETag(e,u,t);return this._processRequest(function(a){o=m._createRequestUrl(e,u,h,m.bUseBatch);n=m._createRequest(o,g,l,t,d);_=m.mRequests;if(f in m.mDeferredGroups){_=m.mDeferredRequests}m._pushToRequestQueue(_,f,c,n,r,s,a,y);return n},s)};m.prototype.create=function(e,t,a){var r,s,n,o,u,d,h,f,c,p,l,g,_,y,m,v=this;if(a){o=a.context;h=a.urlParameters;u=a.success;d=a.error;g=a.groupId||a.batchGroupId;y=a.changeSetId;l=a.eTag;c=a.headers;m=a.refreshAfterChange}m=this._getRefreshAfterChange(m,g);p=i._createUrlParamsArray(h);c=this._getHeaders(c);_="POST";return this._processRequest(function(a){s=v._createRequestUrl(e,o,p,v.bUseBatch);r=v._createRequest(s,_,c,t,l);e=v._normalizePath(e,o);n=v.oMetadata._getEntityTypeByPath(e);r.entityTypes={};if(n){r.entityTypes[n.entityType]=true}f=v.mRequests;if(g in v.mDeferredGroups){f=v.mDeferredRequests}v._pushToRequestQueue(f,g,y,r,u,d,a,m);return r},d)};m.prototype.remove=function(e,t){var a,r,s,n,o,u,d,h,f,c,p,l,g,_,y,m=this;if(t){d=t.groupId||t.batchGroupId;h=t.changeSetId;a=t.context;s=t.success;n=t.error;f=t.eTag;l=t.headers;p=t.urlParameters;c=t.refreshAfterChange}c=this._getRefreshAfterChange(c,d);g=i._createUrlParamsArray(p);l=this._getHeaders(l);_="DELETE";f=f||this._getETag(e,a);function v(e,t){r=u.substr(u.lastIndexOf("/")+1);if(r.indexOf("?")!==-1){r=r.substr(0,r.indexOf("?"))}m._removeEntity(r);if(s){s(e,t)}}return this._processRequest(function(t){u=m._createRequestUrl(e,a,g,m.bUseBatch);o=m._createRequest(u,_,l,undefined,f);y=m.mRequests;if(d in m.mDeferredGroups){y=m.mDeferredRequests}m._pushToRequestQueue(y,d,h,o,v,n,t,c);return o},n)};m.prototype.callFunction=function(t,a){var r,s,n,o,u,d,h,f,c="GET",p,l,g,_,y=this,m,v,b,q,R,C,E,M={};if(a){p=a.groupId||a.batchGroupId;l=a.changeSetId;c=a.method?a.method:c;u=e.extend({},a.urlParameters);_=a.eTag;h=a.success;f=a.error;g=a.headers;E=a.refreshAfterChange}E=this._getRefreshAfterChange(E,p);if(!e.sap.startsWith(t,"/")){e.sap.log.fatal(this+" callFunction: path '"+t+"' must be absolute!");return}g=this._getHeaders(g);R=new Promise(function(e,t){b=e;q=t});C=this._processRequest(function(a){n=y.oMetadata._getFunctionImportMetadata(t,c);e.sap.assert(n,y+": Function "+t+" not found in the metadata !");if(!n){q();return}var R=n.entitySet||n.entitySetPath;if(R){M.$result={__list:[]};if(n.returnType&&n.returnType.indexOf("Collection")==-1){M.$result={__ref:{}}}}if(n.parameter!=null){e.each(n.parameter,function(t,a){M[a.name]=y._createPropertyValue(a.type);if(u&&u[a.name]!==undefined){M[a.name]=u[a.name];u[a.name]=i.formatValue(u[a.name],a.type)}else{e.sap.log.warning(y+" - No value for parameter '"+a.name+"' found!'")}})}m=t.substring(1)+"('"+e.sap.uid()+"')";M.__metadata={uri:y.sServiceUrl+"/"+m,created:{key:t.substring(1),success:h,error:f,headers:g,method:c,groupId:p,changeSetId:l,eTag:_,functionImport:true}};y._addEntity(M);v=y.getContext("/"+m);b(v);d=i._createUrlParamsArray(u);s=y._createRequestUrl(t,null,d,y.bUseBatch);r=y._createRequest(s,c,g,undefined,_);r.key=m;o=y.mRequests;if(p in y.mDeferredGroups){o=y.mDeferredRequests}y._pushToRequestQueue(o,p,l,r,h,f,a,E);return r},f);C.contextCreated=function(){return R};return C};m.prototype._createFunctionImportParameters=function(t,a,r){var s=e.extend(true,{},r);delete s.__metadata;delete s["$result"];var n=this.oMetadata._getFunctionImportMetadata(t,a);e.sap.assert(n,this+": Function "+t+" not found in the metadata !");if(!n){return}if(n.parameter!=null){e.each(n.parameter,function(e,t){if(s&&s[t.name]!==undefined){s[t.name]=i.formatValue(s[t.name],t.type)}})}return s};m.prototype.read=function(e,t){var a,r,s,n,o,u,d,h,f,c,p,l,g,_,y,m,v,b,q=this;if(t){s=t.context;n=t.urlParameters;o=t.success;u=t.error;d=t.filters;h=t.sorters;m=t.groupId||t.batchGroupId;_=t.headers}if(this.sRefreshGroupId){m=this.sRefreshGroupId}g=i._createUrlParamsArray(n);_=this._getHeaders(_,true);y="GET";v=this._getETag(e,s);var R={abort:function(){if(a){a._aborted=true}}};function C(t){c=i.createSortParams(h);if(c){g.push(c)}var n=e;var R=e.indexOf("$count");if(R!==-1){n=e.substring(0,R-1)}l=q._normalizePath(n,s);p=q.oMetadata._getEntityTypeByPath(l);f=i.createFilterParams(d,q.oMetadata,p);if(f){g.push(f)}r=q._createRequestUrl(e,s,g,q.bUseBatch);a=q._createRequest(r,y,_,null,v);b=q.mRequests;if(m in q.mDeferredGroups){b=q.mDeferredRequests}q._pushToRequestQueue(b,m,null,a,o,u,t,false);return a}if(this.bUseBatch&&this.bIncludeInCurrentBatch){a=C(R);return R}else{return this._processRequest(C,u)}};m.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata()}};m.prototype.metadataLoaded=function(){var e=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var t=function(){return e};return this.pAnnotationsLoaded.then(t,t)}else{return e}};m.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded};m.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed()};m.prototype.getServiceAnnotations=function(){var t=this.oAnnotations.getData();return e.isEmptyObject(t)?null:t};m.prototype.onAnnotationsFailed=function(e){this.fireAnnotationsFailed(e.getParameters())};m.prototype.onAnnotationsLoaded=function(e){this.fireAnnotationsLoaded(e.getParameters())};m.prototype.addAnnotationUrl=function(t){var a=[].concat(t),r=[],s=[],i=[],n=this;a.forEach(function(e){var t=e.indexOf("$metadata");if(t>=0){e=n._createMetadataUrl(e);r.push(e)}else{s.push(e)}});return this.oMetadata._addUrl(r).then(function(t){return Promise.all(e.map(t,function(e){i=i.concat(e.entitySets);return n.oAnnotations.addSource({type:"xml",data:e["metadataString"]})}))}).then(function(){return n.oAnnotations.addSource(s)}).then(function(e){return{annotations:n.oAnnotations.getData(),entitySets:i}})};m.prototype.addAnnotationXML=function(e,t){return this.oAnnotations.addSource({type:"xml",data:e})};m.prototype.submitChanges=function(t){var a,r,s,i,n,o,u,d=false,h,f,c=this.bRefreshAfterChange,p,l=this;if(t){r=t.groupId||t.batchGroupId;i=t.success;n=t.error;if(t.merge!==undefined){h=t.merge?"MERGE":"PUT"}}if(r&&!this.mDeferredGroups[r]){e.sap.log.fatal(this+' submitChanges: "'+r+'" is not a deferred group!')}f=e.sap.extend(true,{},l.mChangedEntities);this.oMetadata.loaded().then(function(){e.each(f,function(e,t){s=l._resolveGroup(e);if(s.groupId===r||!r){a=l._processChange(e,t,h||l.sDefaultUpdateMethod);a.key=e;p=t.__metadata&&t.__metadata.created?t.__metadata.created:{};var i={abort:function(){a._aborted=true}};if(s.groupId in l.mDeferredGroups){l._pushToRequestQueue(l.mDeferredRequests,s.groupId,s.changeSetId,a,p.success,p.error,i,c)}}});var t,g,_,y,m,v;for(t in l.mDeferredRequests){_=l.mDeferredRequests[t];for(g in _.changes){y=_.changes[g];for(v=y.length-1;v>=0;v--){m=y[v];if(m.bRefreshAfterChange===undefined){m.bRefreshAfterChange=c}}}}u=l._processRequestQueue(l.mDeferredRequests,r,i,n);if(d){o.abort()}});o={abort:function(){if(u){if(Array.isArray(u)){u.forEach(function(e){e.abort()})}else{u.abort()}}else{if(!d&&n){n(v)}d=true}}};return o};m.prototype._updateChangedEntities=function(t){var a=this,r;function s(t,i){e.each(i,function(n){var o=r+"/"+n;if(e.isPlainObject(i[n])&&e.isPlainObject(t[n])){s(t[n],i[n]);if(e.isEmptyObject(i[n])){delete i[n]}}else if(e.sap.equal(i[n],t[n])&&!a.isLaundering(o)){delete i[n]}})}e.each(t,function(t,i){if(t in a.mChangedEntities){var n=a._getObject("/"+t,null,true);var o=a._getObject("/"+t);e.sap.extend(true,n,i);r="/"+t;s(n,o);if(e.isEmptyObject(o)){delete a.mChangedEntities[t];a.abortInternalRequest(t,a._resolveGroup(t).groupId)}else{a.mChangedEntities[t]=o;o.__metadata={};e.extend(o.__metadata,n.__metadata)}}})};m.prototype.resetChanges=function(t){var a=this,r,s={},i,n;if(t){e.each(t,function(t,o){a.getEntityByPath(o,null,s);r=s.propertyPath.split("/");var u=s.key;i=a.mChangedEntities[u];for(var d=0;d<r.length-1;d++){if(i.hasOwnProperty(r[d])){i=i[r[d]]}else{i=undefined}}if(i){delete i[r[r.length-1]]}if(a.mChangedEntities[u]){n=a.mChangedEntities[u].__metadata;delete a.mChangedEntities[u].__metadata;if(e.isEmptyObject(a.mChangedEntities[u])||!s.propertyPath){a.oMetadata.loaded().then(function(){a.abortInternalRequest(u,a._resolveGroup(u).groupId)});delete a.mChangedEntities[u];sap.ui.getCore().getMessageManager().removeMessages(a.getMessagesByEntity(u,true))}else{a.mChangedEntities[u].__metadata=n}}else{e.sap.log.warning(a+" - resetChanges: "+o+" is not changed")}})}else{e.each(this.mChangedEntities,function(e,t){a.oMetadata.loaded().then(function(){a.abortInternalRequest(e,a._resolveGroup(e).groupId)});delete a.mChangedEntities[e];sap.ui.getCore().getMessageManager().removeMessages(a.getMessagesByEntity(e,true))})}this.checkUpdate(true)};m.prototype.setProperty=function(t,a,r,s){var i,n,o,u,d,h,f,c,p,l,g,_,y={},m={},v,b,q,R=false,C=this,E;function M(t,a){e.each(a,function(r){if(e.isPlainObject(a[r])&&e.isPlainObject(t[r])){M(t[r],a[r]);if(e.isEmptyObject(a[r])){delete a[r]}}else if(e.sap.equal(a[r],t[r])){delete a[r]}})}f=this.resolve(t,r,true);h=this.getEntityByPath(f,null,m);if(!h){return false}n=f.substring(f.lastIndexOf("/")+1);p=m.key;d=this._getObject("/"+p,null,true);i=this._getObject(t,r,true);if(!this.mChangedEntities[p]){_=h.__metadata;h={};h.__metadata=e.extend({},_);this.mChangedEntities[p]=h}b=this.mChangedEntities[p];c=m.propertyPath.split("/");for(var P=0;P<c.length-1;P++){if(!b.hasOwnProperty(c[P])){b[c[P]]={}}b=b[c[P]]}R=d.__metadata.created&&d.__metadata.created.functionImport;b[n]=a;if(e.sap.equal(a,i)&&!this.isLaundering("/"+p)&&!R){_=this.mChangedEntities[p].__metadata;E=_&&_.created;delete this.mChangedEntities[p].__metadata;if(!E){M(d,this.mChangedEntities[p])}if(e.isEmptyObject(this.mChangedEntities[p])){delete this.mChangedEntities[p];y[p]=true;this.checkUpdate(false,s,y);C.oMetadata.loaded().then(function(){C.abortInternalRequest(p,C._resolveGroup(p).groupId)});return true}this.mChangedEntities[p].__metadata=_}l=this._resolveGroup(p);o=this.mRequests;if(l.groupId in this.mDeferredGroups){o=this.mDeferredRequests;u=this._processChange(p,{__metadata:h.__metadata})}else{u=this._processChange(p,this._getObject("/"+p))}u.key=p;v=b.__metadata&&b.__metadata.created?b.__metadata.created:{};q=this._getRefreshAfterChange(undefined,l.groupId);this.oMetadata.loaded().then(function(){g={abort:function(){u._aborted=true}};C._pushToRequestQueue(o,l.groupId,l.changeSetId,u,v.success,v.error,g,q);C._processRequestQueueAsync(C.mRequests)});y[p]=true;this.checkUpdate(false,s,y);return true};m.prototype._isHeaderPrivate=function(e){switch(e.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false}};m.prototype.setHeaders=function(t){var a={},r=this;this.mCustomHeaders={};if(t){e.each(t,function(t,s){if(r._isHeaderPrivate(t)){e.sap.log.warning(this+" - modifying private header: '"+t+"' not allowed!")}else{a[t]=s}});this.mCustomHeaders=a}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders)}};m.prototype._getHeaders=function(t,a){var r={},s=this;if(t){e.each(t,function(t,a){if(s._isHeaderPrivate(t)){e.sap.log.warning(this+" - modifying private header: '"+t+"' not allowed!")}else{r[t]=a}})}return e.extend({"sap-cancel-on-close":!!a},this.mCustomHeaders,r,this.oHeaders)};m.prototype.getHeaders=function(){return e.extend({},this.mCustomHeaders,this.oHeaders)};m.prototype._getHeader=function(e,t){var a;for(a in t){if(a.toLowerCase()===e.toLowerCase()){return t[a]}}return null};m.prototype.hasPendingChanges=function(){return!e.isEmptyObject(this.mChangedEntities)};m.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0};m.prototype.getPendingChanges=function(){return e.sap.extend(true,{},this.mChangedEntities)};m.prototype.updateBindings=function(e){this.checkUpdate(e)};m.prototype.setTokenHandlingEnabled=function(e){this.bTokenHandling=e};m.prototype.setUseBatch=function(e){this.bUseBatch=e};m.prototype.formatValue=function(e,t){return i.formatValue(e,t)};m.prototype.deleteCreatedEntry=function(e){var t=this,a,r;if(e){var a=e.getPath().substr(1);r=this._resolveGroup(a).groupId;t.oMetadata.loaded().then(function(){t.abortInternalRequest(a,r)});t._removeEntity(a);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(e.getPath(),true))}};m.prototype.createEntry=function(t,a){var r,s,n,o,u,d,h,f,c,p,l,g,_,y,m,v={},b,q="POST",R=this;if(a){m=a.properties;c=a.groupId||a.batchGroupId;p=a.changeSetId;d=a.context;r=a.success;s=a.error;b=a.created;u=a.eTag;_=a.headers;g=a.urlParameters;l=a.refreshAfterChange}l=this._getRefreshAfterChange(l,c);c=c?c:this.sDefaultChangeGroup;f=i._createUrlParamsArray(g);_=this._getHeaders(_);var C={abort:function(){if(n){n._aborted=true}}};function E(){var a;if(!e.sap.startsWith(t,"/")){t="/"+t}var i=R.oMetadata._getEntityTypeByPath(t);if(!i){e.sap.assert(i,"No Metadata for collection "+t+" found");return undefined}if(typeof m==="object"&&!Array.isArray(m)){v=e.sap.extend(true,{},m)}else{for(var b=0;b<i.property.length;b++){var E=i.property[b];var M=e.inArray(E.name,m)>-1;if(!m||M){v[E.name]=R._createPropertyValue(E.type);if(M){m.splice(m.indexOf(E.name),1)}}}if(m){e.sap.assert(m.length===0,"No metadata for the following properties found: "+m.join(","))}}var P=R.oMetadata._getEntitySetByType(i);h=P.name+"('"+e.sap.uid()+"')";v.__metadata={type:""+i.entityType,uri:R.sServiceUrl+"/"+h,created:{key:t.substring(1),success:r,error:s,headers:_,urlParameters:g,groupId:c,changeSetId:p,eTag:u}};R._addEntity(e.sap.extend(true,{},v));R.mChangedEntities[h]=v;o=R._createRequestUrl(t,d,f,R.bUseBatch);n=R._createRequest(o,q,_,v,u);a=R.getContext("/"+h);a.bCreated=true;n.key=h;n.created=true;y=R.mRequests;if(c in R.mDeferredGroups){y=R.mDeferredRequests}R.oMetadata.loaded().then(function(){R._pushToRequestQueue(y,c,p,n,r,s,C,l);R._processRequestQueueAsync(R.mRequests)});return a}if(b){this.oMetadata.loaded().then(function(){b(E())})}else if(this.oMetadata.isLoaded()){return E()}else{e.sap.log.error("Tried to use createEntry without created-callback, before metadata is available!")}};m.prototype._isCreatedEntity=function(e){return!!(e&&e.__metadata&&e.__metadata.created)};m.prototype._createPropertyValue=function(t){var a=this.oMetadata._splitName(t);var r=a.namespace;var s=a.name;if(r.toUpperCase()!=="EDM"){var i={};var n=this.oMetadata._getObjectMetadata("complexType",s,r);e.sap.assert(n,"Complex type "+t+" not found in the metadata !");for(var o=0;o<n.property.length;o++){var u=n.property[o];i[u.name]=this._createPropertyValue(u.type)}return i}else{return this._getDefaultPropertyValue(s,r)}};m.prototype._getDefaultPropertyValue=function(e,t){return undefined};m.prototype._normalizePath=function(t,a){if(t&&t.indexOf("?")!==-1){t=t.substr(0,t.indexOf("?"))}if(!a&&!e.sap.startsWith(t,"/")){e.sap.log.fatal(this+" path "+t+" must be absolute if no Context is set")}return this.resolve(t,a)};m.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange};m.prototype.setRefreshAfterChange=function(e){this.bRefreshAfterChange=e};m.prototype.isList=function(e,t){e=this.resolve(e,t);return e&&e.substr(e.lastIndexOf("/")).indexOf("(")===-1};m.prototype._isMetadataPath=function(e){var t=false;if(e&&e.indexOf("/#")>-1){t=true}return t};m.prototype.isMetaModelPath=function(e){return e.indexOf("##")==0||e.indexOf("/##")>-1};m.prototype._request=function(t,a,r,s,i,n){var o;if(this.bDestroyed){return{abort:function(){}}}var u=this;function d(t){return function(){var a=e.inArray(o,u.aPendingRequestHandles);if(a>-1){u.aPendingRequestHandles.splice(a,1)}if(!(o&&o.bSuppressErrorHandlerCall)){t.apply(this,arguments)}}}o=y.request(t,d(a||y.defaultSuccess),d(r||y.defaultError),s,i,n);if(t.async!==false){this.aPendingRequestHandles.push(o)}return o};m.prototype.destroy=function(){this.bDestroyed=true;r.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var t=this.aPendingRequestHandles.length-1;t>=0;t--){var a=this.aPendingRequestHandles[t];if(a&&a.abort){a.bSuppressErrorHandlerCall=true;a.abort()}}delete this.aPendingRequestHandles}if(this.sMetadataLoadEvent){e.sap.clearDelayedCall(this.sMetadataLoadEvent)}if(this.oMetadataFailedEvent){e.sap.clearDelayedCall(this.oMetadataFailedEvent)}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oServiceData.oMetadata}delete this.oMetadata}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations}};m.prototype.setDeferredBatchGroups=function(e){this.setDeferredGroups(e)};m.prototype.setDeferredGroups=function(t){var a=this;this.mDeferredGroups={};e.each(t,function(e,t){a.mDeferredGroups[t]=t})};m.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups()};m.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups)};m.prototype.setChangeBatchGroups=function(t){e.each(t,function(e,t){t.groupId=t.batchGroupId});this.setChangeGroups(t)};m.prototype.setChangeGroups=function(e){this.mChangeGroups=e};m.prototype.getChangeBatchGroups=function(){return this.getChangeGroups()};m.prototype.getChangeGroups=function(){return this.mChangeGroups};m.prototype.setMessageParser=function(t){if(!(t instanceof g)){e.sap.log.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this}t.setProcessor(this);this.oMessageParser=t;return this};m.prototype._parseResponse=function(t,a,r,s){try{if(!this.oMessageParser){this.oMessageParser=new _(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this)}this.oMessageParser.parse(t,a,r,s)}catch(t){e.sap.log.error("Error parsing OData messages: "+t)}};m.prototype.callAfterUpdate=function(e){this.aCallAfterUpdate.push(e)};m.prototype.getMetaModel=function(){var t=this;if(!this.oMetaModel){this.oMetaModel=new l(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){t.bMetaModelLoaded=true;t.checkUpdate(false,false,null,true)},function(t){var a=t.message,r;if(!a&&t.xmlDoc&&t.xmlDoc.parseError){a=t.xmlDoc.parseError.reason;r=t.xmlDoc.parseError.srcText}e.sap.log.error("error in ODataMetaModel.loaded(): "+a,r,"sap.ui.model.odata.v2.ODataModel")})}return this.oMetaModel};m.prototype.getOriginalProperty=function(e,t){return this._getObject(e,t,true)};m.prototype.getEntityByPath=function(t,a,s){var i=r.prototype.resolve.call(this,t,a);if(!i){return null}var n=i.split("/"),o=null,u=[];while(n.length>0){var d=n.join("/"),h=this._getObject(d);if(e.isPlainObject(h)){var f=this._getKey(h);if(f){o=h;break}}u.unshift(n.pop())}if(o){s.propertyPath=u.join("/");s.key=f;return o}return null};m.prototype.resolve=function(e,t,a){var s=r.prototype.resolve.call(this,e,t);if(!this._isMetadataPath(s)&&a){var i={},n=this.getEntityByPath(e,t,i);if(n){if(i.propertyPath){return"/"+i.key+"/"+i.propertyPath}else{return"/"+i.key}}else{return undefined}}return s};m.prototype.isLaundering=function(e,t){var a=this.resolve(e,t);return a in this.mLaunderingState&&this.mLaunderingState[a]>0};m.prototype.increaseLaundering=function(t,a){if(!a){return}for(var r in a){if(r==="__metadata"){continue}var s=a[r];if(e.isPlainObject(s)){this.increaseLaundering(t+"/"+r,s)}else{var i=t+"/"+r;if(!(i in this.mLaunderingState)){this.mLaunderingState[i]=0}this.mLaunderingState[i]++}}if(!(t in this.mLaunderingState)){this.mLaunderingState[t]=0}this.mLaunderingState[t]++};m.prototype.decreaseLaundering=function(t,a){if(!a){return}for(var r in a){if(r==="__metadata"){continue}var s=a[r],i=t+"/"+r;if(e.isPlainObject(s)){this.decreaseLaundering(i,s)}else{if(i in this.mLaunderingState){this.mLaunderingState[i]--;if(this.mLaunderingState[i]===0){delete this.mLaunderingState[i]}}}}this.mLaunderingState[t]--;if(this.mLaunderingState[t]===0){delete this.mLaunderingState[t]}};m.prototype._getRefreshAfterChange=function(e,t){if(e===undefined&&!(t in this.mDeferredGroups)){return this.bRefreshAfterChange}return e};m.prototype.getMessagesByEntity=function(t,a){var r=t,s=[],i;function n(e){var t=[];for(var r=0;r<e.length;r++){if(!a||a&&!e[r].persistent){t.push(e[r])}}return t}if(!e.sap.startsWith(r,"/")){r="/"+r}if(this.mMessages){for(i in this.mMessages){if(e.sap.startsWith(i,r)){s=s.concat(n(this.mMessages[i]))}}return s}return null};m.prototype._cacheSupported=function(e){var t=/\/~[\w\-]+~[A-Z0-9]?/;var a=[e];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}a=a.concat(this.sAnnotationURI)}a=a.filter(function(e){return e.indexOf("sap-context-token")===-1});a=a.filter(function(e){return!t.test(e)});return a.length===0?true:false};m.prototype._getAnnotationCacheKey=function(e){var t;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){t=e+"#annotations"}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}this.sAnnotationURI=this.sAnnotationURI.map(function(e){return e+"#annotations"});t=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):t+"_"+this.sAnnotationURI.join("_")}}return t};return m});