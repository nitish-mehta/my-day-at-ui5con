/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(e){"use strict";var n={POST:true,PUT:true,PATCH:true,DELETE:true},r,t=/\$\d+/,o=/(\S*?)=(?:"(.+)"|(\S+))/;function i(n){var r=a(n,"boundary"),t=n.trim().indexOf("multipart/mixed");if(t!==0||!r){throw new Error('Invalid $batch response header "Content-Type": '+n)}r=e.sap.escapeRegExp(r);return new RegExp("--"+r+"(?:[ \t]*\r\n|--)")}function a(e,n){var r,t=e.split(";"),i;n=n.toLowerCase();for(r=1;r<t.length;r++){i=o.exec(t[r]);if(i[1].toLowerCase()===n){return i[2]||i[3]}}}function s(e){var n=c(e,"content-type");return n.indexOf("multipart/mixed;")===0?n:undefined}function u(e){var n=c(e,"content-id"),r;if(!n){throw new Error("Content-ID MIME header missing for the change set response.")}r=parseInt(n,10);if(isNaN(r)){throw new Error("Invalid Content-ID value in change set response.")}return r}function c(e,n){var r,t,o=e.split("\r\n");for(r=0;r<o.length;r++){t=o[r].split(":");if(t[0].toLowerCase().trim()===n){return t[1].trim()}}}function f(e,n,r){var t=n.split(i(e)),o=[];t=t.slice(1,-1);t.forEach(function(e){var n,t,i,c,d,p,h,l,y,m,T={},E,w;w=e.split("\r\n\r\n");m=w[0];n=s(m);if(n){o.push(f(n,w.slice(1).join("\r\n\r\n"),true));return}h=w[1].split("\r\n");l=h[0].split(" ");T.status=parseInt(l[1],10);T.statusText=l.slice(2).join(" ");T.headers={};for(y=1;y<h.length;y++){c=h[y];i=c.indexOf(":");d=c.slice(0,i).trim();p=c.slice(i+1).trim();T.headers[d]=p;if(d.toLowerCase()==="content-type"){t=a(p,"charset");if(t&&t.toLowerCase()!=="utf-8"){throw new Error('Unsupported "Content-Type" charset: '+t)}}}T.responseText=w[2].slice(0,-2);if(r){E=u(m);o[E]=T}else{o.push(T)}});return o}function d(e){var n,r=[];for(n in e){r=r.concat(n,":",e[n],"\r\n")}return r}function p(r,o){var i=(o!==undefined?"changeset_":"batch_")+e.sap.uid(),a=o!==undefined,s=[];if(a){s=s.concat("Content-Type: multipart/mixed;boundary=",i,"\r\n\r\n")}r.forEach(function(e,r){var u="",c=e.url;if(a){u="Content-ID:"+r+"."+o+"\r\n"}s=s.concat("--",i,"\r\n");if(Array.isArray(e)){if(a){throw new Error("Change set must not contain a nested change set.")}s=s.concat(p(e,r).body)}else{if(a&&!n[e.method]){throw new Error("Invalid HTTP request method: "+e.method+". Change set must contain only POST, PUT, PATCH or DELETE requests.")}c=c.replace(t,"$&."+o);s=s.concat("Content-Type:application/http\r\n","Content-Transfer-Encoding:binary\r\n",u,"\r\n",e.method," ",c," HTTP/1.1\r\n",d(e.headers),"\r\n",JSON.stringify(e.body)||"","\r\n")}});s=s.concat("--",i,"--\r\n");return{body:s,batchBoundary:i}}r={deserializeBatchResponse:function(e,n){return f(e,n,false)},serializeBatchRequest:function(e){var n=p(e);return{body:n.body.join(""),headers:{"Content-Type":"multipart/mixed; boundary="+n.batchBoundary,"MIME-Version":"1.0"}}}};return r},false);