/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/thirdparty/URI"],function(e,t){"use strict";var r={max:"boolean",min:"boolean",name:"string",subtotals:"boolean",with:"string"},n={aggregate:"object",group:"object",groupLevels:"array"},i=/&/g,a=/\=/g,o=/%29/g,u=/%28/g,s=/%27/g,f=/#/g,c=/\([^/]*|\/-?\d+/g,l=/^-?\d+$/,d=/\+/g,g=/'/g,p;function h(e,t,r){var n;function i(e){if(r){e+=" at property: "+r}throw new Error(e)}function a(e){return Array.isArray(e)?"array":typeof e}for(n in e){if(!(t&&n in t)){i("Unsupported '"+n+"'")}else if(a(e[n])!==t[n]){i("Not a "+t[n]+" value for '"+n+"'")}}}function m(e,t){var r;for(r in e){h(e[r],t,r)}}p={buildApply:function(e,t){var i,a="",o,u=[];function s(t){var r=e.aggregate[t],n=r.name||t;if(r.with){n+=" with "+r.with+" as "+t}else if(r.name){n+=" as "+t}if(r.min){c(t,"min")}if(r.max){c(t,"max")}return n}function f(t){return e.groupLevels.indexOf(t)<0}function c(e,r){var n="UI5"+r+"__"+e;u.push(e+" with "+r+" as "+n);if(t){t[n]={measure:e,method:r}}}h(e,n);e.groupLevels=e.groupLevels||[];if(e.groupLevels.length>1){throw new Error("More than one group level: "+e.groupLevels)}e.group=e.group||{};m(e.group);o=e.groupLevels.concat(Object.keys(e.group).sort().filter(f));e.aggregate=e.aggregate||{};m(e.aggregate,r);i=Object.keys(e.aggregate).sort().map(s);if(i.length){a="aggregate("+i.join(",")+")"}if(o.length){a="groupby(("+o.join(",")+(a?"),"+a+")":"))")}return a+(u.length?"/concat(aggregate("+u.join(",")+"),identity)":"")},buildPath:function(){var e,t=[],r;for(e=0;e<arguments.length;e++){r=arguments[e];if(r||r===0){t.push(r==="/"?"":r)}}return t.join("/")},buildQuery:function(e){var t,r;if(!e){return""}t=Object.keys(e);if(t.length===0){return""}r=[];t.forEach(function(t){var n=e[t];if(Array.isArray(n)){n.forEach(function(e){r.push(p.encodePair(t,e))})}else{r.push(p.encodePair(t,n))}});return"?"+r.join("&")},clone:function e(t){return t===undefined||t===Infinity||t===-Infinity||t!==t?t:JSON.parse(JSON.stringify(t))},createError:function(t){var r=t.responseText,n=t.getResponseHeader("Content-Type"),i=new Error(t.status+" "+t.statusText);i.status=t.status;i.statusText=t.statusText;if(t.status===0){i.message="Network error";return i}if(n){n=n.split(";")[0]}if(t.status===412){i.isConcurrentModification=true}if(n==="application/json"){try{i.error=JSON.parse(r).error;i.message=i.error.message;if(typeof i.message==="object"){i.message=i.error.message.value}}catch(t){e.sap.log.warning(t.toString(),r,"sap.ui.model.odata.v4.lib._Helper")}}else if(n==="text/plain"){i.message=r}return i},createGetMethod:function(e,t){return function(){var r=this[e].apply(this,arguments);if(r.isFulfilled()){return r.getResult()}else if(t){if(r.isRejected()){r.caught();throw r.getResult()}else{throw new Error("Result pending")}}}},createRequestMethod:function(e){return function(){return Promise.resolve(this[e].apply(this,arguments))}},deletePrivateAnnotation:function(e,t){var r=e["@$ui5._"];if(r){delete r[t]}},drillDown:function(e,t){return t.reduce(function(e,t){return e&&t in e?e[t]:undefined},e)},encode:function(e,t){var r=encodeURI(e).replace(i,"%26").replace(f,"%23").replace(d,"%2B");if(t){r=r.replace(a,"%3D")}return r},encodePair:function(e,t){return p.encode(e,true)+"="+p.encode(t,false)},fireChange:function(e,t,r){var n=e[t],i;if(n){for(i=0;i<n.length;i++){n[i].onChange(r)}}},fireChanges:function(e,t,r,n){Object.keys(r).forEach(function(i){var a=p.buildPath(t,i),o=r[i];if(o&&typeof o==="object"){p.fireChanges(e,a,o,n)}else{p.fireChange(e,a,n?undefined:o)}})},formatLiteral:function(e,t){if(e===undefined){throw new Error("Illegal value: undefined")}if(e===null){return"null"}switch(t){case"Edm.Binary":return"binary'"+e+"'";case"Edm.Boolean":case"Edm.Byte":case"Edm.Double":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":case"Edm.Single":return String(e);case"Edm.Date":case"Edm.DateTimeOffset":case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.TimeOfDay":return e;case"Edm.Duration":return"duration'"+e+"'";case"Edm.String":return"'"+e.replace(g,"''")+"'";default:throw new Error("Unsupported type: "+t)}},getKeyPredicate:function(e,t,r){var n=[],i=p.getKeyProperties(e,t,r,true);if(!i){return undefined}n=Object.keys(i).map(function(e,t,r){var n=encodeURIComponent(i[e]);return r.length===1?n:encodeURIComponent(e)+"="+n});return"("+n.join(",")+")"},getKeyProperties:function(e,t,r,n){var i,a={};i=r[t].$Key.some(function(i){var o,u,s,f,c,l;if(typeof i==="string"){o=u=i}else{o=Object.keys(i)[0];u=i[o];if(!n){o=u}}s=u.split("/");l=p.drillDown(e,s);if(l===undefined){return true}f=s.pop();c=r[p.buildPath(t,s.join("/"))];l=p.formatLiteral(l,c[f].$Type);a[o]=l});return i?undefined:a},getMetaPath:function(e){return e.replace(c,"")},getPrivateAnnotation:function(e,t){var r=e["@$ui5._"];return r&&r[t]},getSelectForPath:function(e,t){if(t){t.split("/").some(function(t){if(!l.test(t)){e=e&&e.$expand&&e.$expand[t]}})}return e&&e.$select},hasMinOrMax:function(e){return!!e&&Object.keys(e).some(function(t){var r=e[t];return r.min||r.max})},hasPrivateAnnotation:function(e,t){var r=e["@$ui5._"];return r?t in r:false},isSafeInteger:function(e){if(typeof e!=="number"||!isFinite(e)){return false}e=Math.abs(e);return e<=9007199254740991&&Math.floor(e)===e},makeAbsolute:function(e,r){return new t(e).absoluteTo(r).toString().replace(s,"'").replace(u,"(").replace(o,")")},namespace:function(e){var t=e.indexOf("/");if(t>=0){e=e.slice(0,t)}t=e.lastIndexOf(".");return t<0?"":e.slice(0,t)},parseLiteral:function(e,t,r){function n(n){if(!isFinite(n)){throw new Error(r+": Not a valid "+t+" literal: "+e)}return n}if(e==="null"){return null}switch(t){case"Edm.Boolean":return e==="true";case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":return n(parseInt(e,10));case"Edm.Date":case"Edm.DateTimeOffset":case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.TimeOfDay":return e;case"Edm.Double":case"Edm.Single":return e==="INF"||e==="-INF"||e==="NaN"?e:n(parseFloat(e));default:throw new Error(r+": Unsupported type: "+t)}},publicClone:function(e){var t=p.clone(e);if(t){delete t["@$ui5._"]}return t},setPrivateAnnotation:function(e,t,r){var n=e["@$ui5._"];if(!n){n=e["@$ui5._"]={}}n[t]=r},toArray:function(e){if(e===undefined||e===null){return[]}if(Array.isArray(e)){return e}return[e]},updateCache:function(e,t,r,n){if(!n){return}Object.keys(r).forEach(function(i){var a=p.buildPath(t,i),o=r[i],u;if(i in n){u=n[i];if(u&&typeof u==="object"){if(o){p.updateCache(e,a,o,u)}else{r[i]=u;p.fireChanges(e,a,u,false)}}else if(o&&typeof o==="object"){r[i]=u;p.fireChanges(e,a,o,true)}else{r[i]=u;if(o!==u){p.fireChange(e,a,u)}}}})},updateCacheAfterPost:function(e,t,r,n,i){function a(t,r,n,i){var a=r.split("/");a.every(function(o,u){if(i[o]===null){n[o]=null;if(u<a.length-1){return false}p.fireChange(e,p.buildPath(t,r),n[o])}else if(typeof i[o]==="object"){n[o]=n[o]||{}}else{if(n[o]!==i[o]){n[o]=i[o];p.fireChange(e,p.buildPath(t,r),n[o])}return false}n=n[o];i=i[o];return true})}function o(e,t){Object.keys(e).forEach(function(r){var n=t?t+"/"+r:r,a=e[r];if(a!==null&&typeof a==="object"){o(a,n)}else{i.push(n)}})}if(!i||i.indexOf("*")>=0){i=[];o(n)}else{i=i.concat("@odata.etag")}i.forEach(function(e){a(t,e,r,n)})}};return p},false);