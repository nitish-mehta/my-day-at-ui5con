/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/BindingParser"],function(e,t){"use strict";var a="sap.ui.model.odata.AnnotationHelper",n=/[\\\{\}:]/,r,i=/^(\/dataServices\/schema\/\d+\/entityContainer\/\d+\/entitySet\/\d+)(?:\/|$)/,o=[a],u=a+"/followPath",s=/^(\/dataServices\/schema\/\d+\/(?:complex|entity)Type\/\d+)(?:\/|$)/,d={"Edm.Boolean":"sap.ui.model.odata.type.Boolean","Edm.Byte":"sap.ui.model.odata.type.Byte","Edm.DateTime":"sap.ui.model.odata.type.DateTime","Edm.DateTimeOffset":"sap.ui.model.odata.type.DateTimeOffset","Edm.Decimal":"sap.ui.model.odata.type.Decimal","Edm.Double":"sap.ui.model.odata.type.Double","Edm.Float":"sap.ui.model.odata.type.Single","Edm.Guid":"sap.ui.model.odata.type.Guid","Edm.Int16":"sap.ui.model.odata.type.Int16","Edm.Int32":"sap.ui.model.odata.type.Int32","Edm.Int64":"sap.ui.model.odata.type.Int64","Edm.SByte":"sap.ui.model.odata.type.SByte","Edm.Single":"sap.ui.model.odata.type.Single","Edm.String":"sap.ui.model.odata.type.String","Edm.Time":"sap.ui.model.odata.type.Time"};r={descend:function(t,a,n){var i=e.extend({},t);r.expectType(t,typeof a==="number"?"array":"object");i.path=t.path+"/"+a;i.value=t.value[a];if(n===true){i.asExpression=true}else if(n){r.expectType(i,n)}return i},error:function(t,n,i){n=t.path+": "+n;e.sap.log.error(n,r.toErrorString(t.value),i||a);throw new SyntaxError(n)},expectType:function(e,t){var a,n=e.value;if(t==="array"){a=!Array.isArray(n)}else{a=typeof n!==t||n===null||Array.isArray(n)}if(a){r.error(e,"Expected "+t)}},followPath:function(t,a){var n,i,s,d,p=t.getModel(),l,f={associationSetEnd:undefined,navigationAfterMultiple:false,isMultiple:false,navigationProperties:[],resolvedPath:undefined},y,c;e.sap.measure.average(u,"",o);i=r.getPath(a);s=i!==undefined&&r.getStartingPoint(t,i);if(!s){e.sap.measure.end(u);return undefined}l=i.split("/");while(i&&l.length&&s){y=l[0];d=y.indexOf("@");if(d===0){s+="/"+y.slice(1);l.shift();continue}c=p.getObject(s);n=p.getODataAssociationEnd(c,y);if(n){f.associationSetEnd=p.getODataAssociationSetEnd(c,y);f.navigationProperties.push(y);if(f.isMultiple){f.navigationAfterMultiple=true}f.isMultiple=n.multiplicity==="*";s=p.getODataEntityType(n.type,true);l.shift();continue}s=p.getODataProperty(c,l,true)}f.resolvedPath=s;e.sap.measure.end(u);return f},getPath:function(e){if(e){if(e.hasOwnProperty("AnnotationPath")){return e.AnnotationPath}if(e.hasOwnProperty("Path")){return e.Path}if(e.hasOwnProperty("PropertyPath")){return e.PropertyPath}if(e.hasOwnProperty("NavigationPropertyPath")){return e.NavigationPropertyPath}}return undefined},getStartingPoint:function(e,t){var a,n=s.exec(e.getPath()),r;if(n){return n[1]}n=i.exec(e.getPath());if(n){if(!t){return n[1]}r=e.getModel();a=r.getObject(n[1]);return r.getODataEntityType(a.entityType,true)}return undefined},property:function(e,t,a){return r.descend(e,t,a).value},resultToString:function(e,a,i){var o=e.value;function u(t){var a,i;t=t&&!e.ignoreTypeInPath&&e.type;if(t||n.test(o)){i="{path:"+r.toJSON(o);if(t){i+=",type:'"+d[e.type]+"'";a=r.toJSON(e.constraints);if(a&&a!=="{}"){i+=",constraints:"+a}}return i+"}"}return"{"+o+"}"}function s(e){switch(e.type){case"Edm.Boolean":case"Edm.Double":case"Edm.Int32":return String(e.value);default:return r.toJSON(e.value)}}switch(e.result){case"binding":return(a?"$":"")+u(i);case"composite":if(a){throw new Error("Trying to embed a composite binding into an expression binding")}return o;case"constant":if(e.type==="edm:Null"){return a?"null":null}if(a){return s(e)}return typeof o==="string"?t.complexParser.escape(o):String(o);case"expression":return a?o:"{="+o+"}"}},toErrorString:function(e){var t;if(typeof e!=="function"){try{t=r.toJSON(e);if(t!==undefined&&t!=="null"){return t}}catch(e){}}return String(e)},toJSON:function(e){var t,a=false,n="",r,i;t=JSON.stringify(e);if(t===undefined){return undefined}for(r=0;r<t.length;r+=1){switch(i=t.charAt(r)){case"'":n+="\\'";break;case'"':if(a){n+=i;a=false}else{n+="'"}break;case"\\":if(a){n+="\\\\"}a=!a;break;default:if(a){n+="\\";a=false}n+=i}}return n}};return r},false);