/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/Log","sap/base/strings/formatMessage","sap/base/util/extend","sap/ui/Properties"],function(e,r,n,t,i){"use strict";var s=/^((?:[A-Z]{2,3}(?:-[A-Z]{3}){0,3})|[A-Z]{4}|[A-Z]{5,8})(?:-([A-Z]{4}))?(?:-([A-Z]{2}|[0-9]{3}))?((?:-[0-9A-Z]{5,8}|-[0-9][0-9A-Z]{3})*)((?:-[0-9A-WYZ](?:-[0-9A-Z]{2,8})+)*)(?:-(X(?:-[0-9A-Z]{1,8})+))?$/i;var u={he:"iw",yi:"ji",id:"in",sr:"sh"};var o={iw:"he",ji:"yi",in:"id",sh:"sr"};var a={en_US_saptrc:"1Q",en_US_sappsd:"2Q"};var l=/(?:^|-)(saptrc|sappsd)(?:-|$)/i;function f(e){var r;if(typeof e==="string"&&(r=s.exec(e.replace(/_/g,"-")))){var n=r[1].toLowerCase();n=u[n]||n;var t=r[2]?r[2].toLowerCase():undefined;var i=r[3]?r[3].toUpperCase():undefined;var o=r[4]?r[4].slice(1):undefined;var a=r[6];if(a&&(r=l.exec(a))||o&&(r=l.exec(o))){return"en_US_"+r[1].toLowerCase()}if(n==="zh"&&!i){if(t==="hans"){i="CN"}else if(t==="hant"){i="TW"}}return n+(i?"_"+i+(o?"_"+o.replace("-","_"):""):"")}}function c(){var e;if(window.sap&&window.sap.ui&&sap.ui.getCore){e=sap.ui.getCore().getConfiguration().getLanguage();e=f(e)}return e||"en"}function p(e){if(!e){return null}if(e==="zh_HK"){return"zh_TW"}var r=e.lastIndexOf("_");if(r>=0){return e.slice(0,r)}return e!=="en"?"en":""}function h(e){var r;if(typeof e==="string"&&(r=s.exec(e.replace(/_/g,"-")))){var n=r[1].toLowerCase();n=o[n]||n;return n+(r[3]?"-"+r[3].toUpperCase()+(r[4]?"-"+r[4].slice(1).replace("_","-"):""):"")}}var d=/^((?:[^?#]*\/)?[^\/?#]*)(\.[^.\/?#]+)((?:\?([^#]*))?(?:#(.*))?)$/;var g=[".properties",".hdbtextbundle"];function v(e){var r=d.exec(e);if(!r||g.indexOf(r[2])<0){throw new Error("resource URL '"+e+"' has unknown type (should be one of "+g.join(",")+")")}return{url:e,prefix:r[1],ext:r[2],query:r[4],hash:r[5]||"",suffix:r[2]+(r[3]||"")}}function y(e,r,n,t){this.sLocale=this._sNextLocale=f(r)||c();this.oUrlInfo=v(e);this.bIncludeInfo=n;this.aCustomBundles=[];this.aPropertyFiles=[];this.aLocales=[];if(t){var i=function(){return this}.bind(this);return x(this).then(i,i)}_(this)}y.prototype._enhance=function(e){if(e instanceof y){this.aCustomBundles.push(e)}else{r.error("Custom resource bundle is either undefined or not an instanceof sap/ui/Resources/Bundle. Therefore this custom resource bundle will be ignored!")}};y.prototype.getText=function(r,t,i){var s=null,u;for(u=this.aCustomBundles.length-1;u>=0;u--){s=this.aCustomBundles[u].getText(r,t,true);if(s!=null){return s}}for(u=0;u<this.aPropertyFiles.length;u++){s=this.aPropertyFiles[u].getProperty(r);if(typeof s==="string"){break}}while(typeof s!=="string"&&this._sNextLocale!=null){var o=_(this);if(o){s=o.getProperty(r)}}if(!i&&typeof s!=="string"){e(false,"could not find any translatable text for key '"+r+"' in bundle '"+this.oUrlInfo.url+"'");s=r}if(typeof s==="string"){if(t){s=n(s,t)}if(this.bIncludeInfo){s=new String(s);s.originInfo={source:"Resource Bundle",url:this.oUrlInfo.url,locale:this.sLocale,key:r}}}return s};y.prototype.hasText=function(e){return this.aPropertyFiles.length>0&&typeof this.aPropertyFiles[0].getProperty(e)==="string"};function x(e){if(e._sNextLocale!=null){return L(e,true).then(function(r){return r||x(e)})}return Promise.resolve(null)}function _(e){while(e._sNextLocale!=null){var r=L(e,false);if(r){return r}}return null}function w(e,r){return!r||r.length===0||r.indexOf(e)>=0}function L(e,r){var n=e._sNextLocale;e._sNextLocale=p(n);var t=window.sap&&window.sap.ui&&sap.ui.getCore&&sap.ui.getCore().getConfiguration().getSupportedLanguages();if(n!=null&&w(n,t)){var s=e.oUrlInfo,u,o;if(s.ext===".hdbtextbundle"){if(a[n]){u=s.prefix+s.suffix+"?"+(s.query?s.query+"&":"")+"sap-language="+a[n]+(s.hash?"#"+s.hash:"")}else{u=s.url}o={"Accept-Language":h(n)||""}}else{u=s.prefix+(n?"_"+n:"")+s.suffix}var l=i({url:u,headers:o,async:!!r,returnNullIfMissing:true});var f=function(r){if(r){e.aPropertyFiles.push(r);e.aLocales.push(n)}return r};return r?l.then(f):f(l)}return r?Promise.resolve(null):null}var b=function e(r){r=t({url:"",locale:undefined,includeInfo:false},r);return new y(r.url,r.locale,r.includeInfo,!!r.async)};b.isBundle=function(e){return e instanceof y};b._getFallbackLocales=function(e,r){var n=f(e),t=[];while(n!=null){if(w(n,r)){t.push(n)}n=p(n)}return t};return b});