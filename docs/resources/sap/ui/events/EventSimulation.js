/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Version","sap/base/events/PseudoEvents","sap/base/events/checkMouseEnterOrLeave","sap/ui/events/ControlEvents","sap/ui/Device","sap/ui/events/MapTouchToMouse","sap/ui/thirdparty/jquery","sap/ui/thirdparty/jquery-mobile-custom","sap/ui/dom/jquery/control","sap/ui/events/jqueryEvent"],function(e,t,n,o,a,s,i){"use strict";var r={};r.aAdditionalControlEvents=[];r.aAdditionalPseudoEvents=[];r._createSimulatedEvent=function(e,t,n){var o="__"+e+"Handler";var a="sap"+e;this.aAdditionalControlEvents.push(a);this.aAdditionalPseudoEvents.push({sName:e,aTypes:[a],fnCheck:function(e){return true}});i.event.special[a]={add:function(o){var s=this,r=i(this),u={domRef:s,eventName:e,sapEventName:a,eventHandle:o};var c=function(e){n(e,u)};o.__sapSimulatedEventHandler=c;for(var d=0;d<t.length;d++){r.on(t[d],c)}},remove:function(e){var n=i(this);var a=e.__sapSimulatedEventHandler;n.removeData(o+e.guid);for(var s=0;s<t.length;s++){i.event.remove(this,t[s],a)}}}};r._fnMouseToTouchHandler=function(e,t){var o=i(t.domRef);if(e.isMarked("delayedMouseEvent")){return}if(!(e.type!="mouseout"||e.type==="mouseout"&&n(e,t.domRef))){var a=true;var s=o.data("__touchstart_control");if(s){var r=window.document.getElementById(s);if(r&&n(e,r)){a=false}}if(a){return}}var u=i.event.fix(e.originalEvent||e);u.type=t.sapEventName;if(u.isMarked("firstUIArea")){u.setMark("handledByUIArea",false)}var c=[{identifier:1,pageX:u.pageX,pageY:u.pageY,clientX:u.clientX,clientY:u.clientY,screenX:u.screenX,screenY:u.screenY,target:u.target,radiusX:1,radiusY:1,rotationAngle:0}];switch(t.eventName){case"touchstart":case"touchmove":u.touches=u.changedTouches=u.targetTouches=c;break;case"touchend":u.changedTouches=c;u.touches=u.targetTouches=[];break}if(t.eventName==="touchstart"||o.data("__touch_in_progress")){o.data("__touch_in_progress","X");var d=i.fn.control?i(e.target).control(0):null;if(d){o.data("__touchstart_control",d.getId())}if(e.type==="mouseout"){u.setMarked("fromMouseout")}if(e.type!=="dragstart"){t.eventHandle.handler.call(t.domRef,u)}if((t.eventName==="touchend"||e.type==="dragstart")&&!u.isMarked("fromMouseout")){o.removeData("__touch_in_progress");o.removeData("__touchstart_control")}}};r._initTouchEventSimulation=function(){this._createSimulatedEvent("touchstart",["mousedown"],this._fnMouseToTouchHandler);this._createSimulatedEvent("touchend",["mouseup","mouseout"],this._fnMouseToTouchHandler);this._createSimulatedEvent("touchmove",["mousemove","dragstart"],this._fnMouseToTouchHandler)};r._initContextMenuSimulation=function(){var e=function(e,t){var n=i.event.fix(e.originalEvent||e);n.type=t.sapEventName;if(!window.getSelection||!window.getSelection()||window.getSelection().toString()===""){t.eventHandle.handler.call(t.domRef,n)}};this._createSimulatedEvent("contextmenu",["taphold"],e)};r._initMouseEventSimulation=function(e){var t=false,n=i.vmouse.moveDistanceThreshold,o,a,s,r,u;var c=function(e,t,n){var o=i.event.fix(e.originalEvent||e);o.type=t.sapEventName;delete o.touches;delete o.changedTouches;delete o.targetTouches;o.screenX=n.screenX;o.screenY=n.screenY;o.clientX=n.clientX;o.clientY=n.clientY;o.ctrlKey=n.ctrlKey;o.altKey=n.altKey;o.shiftKey=n.shiftKey;o.button=0;return o};var d=function(s,i){if(s.isMarked("handledByTouchToMouse")){return}s.setMarked("handledByTouchToMouse");if(!t){var r=s.originalEvent.touches[0];t=Math.abs(r.pageX-o)>n||Math.abs(r.pageY-a)>n}if(e){if(u&&s.timeStamp-u<50){return}u=s.timeStamp}var d=c(s,i,s.touches[0]);setTimeout(function(){d.setMark("handledByUIArea",false);i.eventHandle.handler.call(i.domRef,d)},0)};var l=function(e,n){if(e.isMarked("handledByTouchToMouse")){return}e.setMarked("handledByTouchToMouse");var d,l,h;function v(){return c(e,n,n.eventName==="mouseup"?e.changedTouches[0]:e.touches[0])}if(e.type==="touchstart"){var f=e.originalEvent.touches[0];t=false;u=0;o=f.pageX;a=f.pageY;s=Math.round(f.pageX-i(e.target).offset().left);r=Math.round(f.pageY-i(e.target).offset().top);d=v();setTimeout(function(){d.setMark("handledByUIArea",false);n.eventHandle.handler.call(n.domRef,d)},0)}else if(e.type==="touchend"){l=v();h=!t;setTimeout(function(){l.setMark("handledByUIArea",false);n.eventHandle.handler.call(n.domRef,l);if(h){l.type="click";l.getPseudoTypes=i.Event.prototype.getPseudoTypes;l.setMark("handledByUIArea",false);l.offsetX=s;l.offsetY=r;n.eventHandle.handler.call(n.domRef,l)}},0)}};this._createSimulatedEvent("mousedown",["touchstart"],l);this._createSimulatedEvent("mousemove",["touchmove"],d);this._createSimulatedEvent("mouseup",["touchend","touchcancel"],l)};r._init=function(n){this.aAdditionalControlEvents.push("swipe","tap","swipeleft","swiperight","scrollstart","scrollstop");this.aAdditionalPseudoEvents.push({sName:"swipebegin",aTypes:["swipeleft","swiperight"],fnCheck:function(e){var t=sap.ui.getCore().getConfiguration().getRTL();return t&&e.type==="swiperight"||!t&&e.type==="swipeleft"}});this.aAdditionalPseudoEvents.push({sName:"swipeend",aTypes:["swipeleft","swiperight"],fnCheck:function(e){var t=sap.ui.getCore().getConfiguration().getRTL();return!t&&e.type==="swiperight"||t&&e.type==="swipeleft"}});if(e(i.fn.jquery).compareTo("1.9.1")<0){n=n.concat(this.aAdditionalControlEvents)}else{n=this.aAdditionalControlEvents.concat(n)}for(var o=0;o<this.aAdditionalPseudoEvents.length;o++){t.addEvent(this.aAdditionalPseudoEvents[o])}return n};if(a.browser.webkit&&/Mobile/.test(navigator.userAgent)&&a.support.touch){s.init(window.document);r.disableTouchToMouseHandling=s.disableTouchToMouseHandling}if(!r.disableTouchToMouseHandling){r.disableTouchToMouseHandling=i.noop}if(a.support.touch){o.events.push("touchstart","touchend","touchmove","touchcancel")}(function e(){r.touchEventMode="SIM";if(a.support.touch){r.touchEventMode="ON";i.event.props.push("touches","targetTouches","changedTouches")}var t=!(a.os.windows_phone&&a.os.version<10);if(t){r._initTouchEventSimulation()}if(a.os.ios){r._initContextMenuSimulation()}if(a.support.touch&&t){r.disableTouchToMouseHandling();r._initMouseEventSimulation(a.os.blackberry)}o.events=r._init(o.events)})();return r});