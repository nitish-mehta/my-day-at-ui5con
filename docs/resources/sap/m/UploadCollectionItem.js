/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Element","sap/m/ObjectAttribute","sap/ui/core/util/File","sap/ui/Device"],function(e,t,r,i,a,s){"use strict";var l=r.extend("sap.m.UploadCollectionItem",{metadata:{library:"sap.m",properties:{contributor:{type:"string",group:"Data",defaultValue:null},documentId:{type:"string",group:"Misc",defaultValue:null},fileName:{type:"string",group:"Misc",defaultValue:null},fileSize:{type:"float",group:"Misc",defaultValue:null},mimeType:{type:"string",group:"Misc",defaultValue:null},thumbnailUrl:{type:"string",group:"Misc",defaultValue:null},uploadedDate:{type:"string",group:"Misc",defaultValue:null},url:{type:"string",group:"Misc",defaultValue:null},enableEdit:{type:"boolean",group:"Behavior",defaultValue:true},enableDelete:{type:"boolean",group:"Behavior",defaultValue:true},visibleEdit:{type:"boolean",group:"Behavior",defaultValue:true},visibleDelete:{type:"boolean",group:"Behavior",defaultValue:true},ariaLabelForPicture:{type:"string",group:"Accessibility",defaultValue:null},selected:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"attributes",aggregations:{attributes:{type:"sap.m.ObjectAttribute",multiple:true,bindable:"bindable"},_propertyAttributes:{type:"sap.m.ObjectAttribute",multiple:true,visibility:"hidden"},statuses:{type:"sap.m.ObjectStatus",multiple:true,bindable:"bindable"},markers:{type:"sap.m.ObjectMarker",multiple:true,bindable:"bindable"}},associations:{fileUploader:{type:"sap.ui.unified.FileUploader",multiple:false}},events:{press:{},deletePress:{}}}});l.prototype.init=function(){this._mDeprecatedProperties={};this._aManagedInstances=[]};l.prototype.exit=function(){for(var e=0;e<this._aManagedInstances.length;e++){this._aManagedInstances[e].destroy()}};l.prototype.setContributor=function(e){if(this.getContributor()!==e){this.setProperty("contributor",e,true);this._updateDeprecatedProperties()}return this};l.prototype.setUploadedDate=function(e){if(this.getUploadedDate()!==e){this.setProperty("uploadedDate",e,true);this._updateDeprecatedProperties()}return this};l.prototype.setFileSize=function(e){if(this.getFileSize()!==e){this.setProperty("fileSize",e,true);this._updateDeprecatedProperties()}return this};l.prototype.setSelected=function(e){if(this.getSelected()!==e){this.setProperty("selected",e,true);this.fireEvent("selected")}return this};l.prototype.download=function(r){if(s.browser.name==="sf"){r=false}if(!this.getUrl()){e.sap.log.warning("Items to download do not have a URL.");return false}else if(r){var i=null;var l=new window.XMLHttpRequest;l.open("GET",this.getUrl());l.responseType="blob";l.onload=function(){var e=this.getFileName();var t=this._splitFileName(e,false);var r=t.extension;e=t.name;i=l.response;a.save(i,e,r,this.getMimeType(),"utf-8")}.bind(this);l.send();return true}else{t.URLHelper.redirect(this.getUrl(),true);return true}};l.prototype._splitFileName=function(e,t){var r={};var i=/(?:\.([^.]+))?$/;var a=i.exec(e);r.name=e.slice(0,e.indexOf(a[0]));if(t){r.extension=a[0]}else{r.extension=a[1]}return r};l.prototype._updateDeprecatedProperties=function(){var t=["uploadedDate","contributor","fileSize"];this.removeAllAggregation("_propertyAttributes",true);e.each(t,function(t,r){var a=this.getProperty(r),s=this._mDeprecatedProperties[r];if(e.type(a)==="number"&&!!a||!!a){if(!s){s=new i({active:false});this._mDeprecatedProperties[r]=s;this.addAggregation("_propertyAttributes",s,true);s.setText(a)}else{s.setText(a);this.addAggregation("_propertyAttributes",s,true)}}else if(s){s.destroy();delete this._mDeprecatedProperties[r]}}.bind(this));this.invalidate()};l.prototype.getAllAttributes=function(){return this.getAggregation("_propertyAttributes",[]).concat(this.getAttributes())};l.prototype._getControl=function(t,r,i){var a=e.sap.getObject(t),s=new a(r);this._aManagedInstances.push(s);if(i){this["_get"+i]=e.sap.getter(s)}return s};l.prototype._getPressEnabled=function(){return this.hasListeners("press")||!!e.trim(this.getUrl())};return l});