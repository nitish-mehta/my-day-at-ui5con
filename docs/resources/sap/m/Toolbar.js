/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./BarInPageEnabler","./ToolbarLayoutData","./ToolbarSpacer","./library","sap/ui/core/Control","sap/ui/core/EnabledPropagator","sap/ui/core/ResizeHandler","./ToolbarRenderer"],function(t,e,o,i,n,r,s,a,p){"use strict";var l=n.ToolbarDesign,h=n.ToolbarStyle;var g=r.extend("sap.m.Toolbar",{metadata:{interfaces:["sap.ui.core.Toolbar","sap.m.IBar"],library:"sap.m",properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},active:{type:"boolean",group:"Behavior",defaultValue:false},enabled:{type:"boolean",group:"Behavior",defaultValue:true},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""},design:{type:"sap.m.ToolbarDesign",group:"Appearance",defaultValue:l.Auto},style:{type:"sap.m.ToolbarStyle",group:"Appearance",defaultValue:h.Standard}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{parameters:{srcControl:{type:"sap.ui.core.Control"}}}},designtime:"sap/m/designtime/Toolbar.designtime"}});s.call(g.prototype);g.shrinkClass="sapMTBShrinkItem";g.isRelativeWidth=function(t){return/^([-+]?\d+%|auto|inherit|)$/i.test(t)};g.getOrigWidth=function(t){var e=sap.ui.getCore().byId(t);if(!e||!e.getWidth){return""}return e.getWidth()};g.checkShrinkable=function(t,e){if(t instanceof i){return this.isRelativeWidth(t.getWidth())}e=e||this.shrinkClass;t.removeStyleClass(e);var n=this.getOrigWidth(t.getId());if(!this.isRelativeWidth(n)){return}var r=t.getLayoutData();if(r instanceof o){return r.getShrinkable()&&t.addStyleClass(e)}if(n.indexOf("%")>0||t.getMetadata().isInstanceOf("sap.ui.core.IShrinkable")){return t.addStyleClass(e)}var s=t.getDomRef();if(s&&(s.firstChild||{}).nodeType==3){return t.addStyleClass(e)}};g.prototype.init=function(){this.data("sap-ui-fastnavgroup","true",true);this._oContentDelegate={onAfterRendering:this._onAfterContentRendering}};g.prototype.onBeforeRendering=function(){this._cleanup()};g.prototype.onAfterRendering=function(){if(!this._checkContents()){return}this._doLayout()};g.prototype.exit=function(){this._cleanup()};g.prototype.onLayoutDataChange=function(){this.rerender()};g.prototype.addContent=function(t){this.addAggregation("content",t);this._onContentInserted(t);return this};g.prototype.insertContent=function(t,e){this.insertAggregation("content",t,e);this._onContentInserted(t);return this};g.prototype.removeContent=function(t){t=this.removeAggregation("content",t);this._onContentRemoved(t);return t};g.prototype.removeAllContent=function(){var t=this.removeAllAggregation("content")||[];t.forEach(this._onContentRemoved,this);return t};g.prototype.ontap=function(t){if(this.getActive()&&!t.isMarked()){t.setMarked();this.firePress({srcControl:t.srcControl})}};g.prototype.onsapenter=function(t){if(this.getActive()&&t.srcControl===this&&!t.isMarked()){t.setMarked();this.firePress({srcControl:this})}};g.prototype.onsapspace=g.prototype.onsapenter;g.prototype.ontouchstart=function(t){this.getActive()&&t.setMarked()};g.prototype._checkContents=function(){var t=0;this.getContent().forEach(function(e){if(g.checkShrinkable(e)){t++}});return t};g.prototype._doLayout=function(){if(p.hasNewFlexBoxSupport){return}this._resetOverflow()};g.prototype._resetOverflow=function(){this._deregisterResize();var t=this.$();var e=t[0]||{};t.removeClass("sapMTBOverflow");var o=e.scrollWidth>e.clientWidth;o&&t.addClass("sapMTBOverflow");this._iEndPoint=this._getEndPoint();this._registerResize()};g.prototype._onContentInserted=function(t){if(t){t.attachEvent("_change",this._onContentPropertyChanged,this);t.addEventDelegate(this._oContentDelegate,t)}};g.prototype._onContentRemoved=function(t){if(t){t.detachEvent("_change",this._onContentPropertyChanged,this);t.removeEventDelegate(this._oContentDelegate,t)}};g.prototype._onAfterContentRendering=function(){var t=this.getLayoutData();if(t instanceof o){t.applyProperties()}};g.prototype._onContentPropertyChanged=function(t){if(t.getParameter("name")!="width"){return}var e=t.getSource();var o=e.getWidth().indexOf("%")>0;e.toggleStyleClass(g.shrinkClass,o)};g.prototype._registerContentResize=function(){sap.ui.getCore().attachIntervalTimer(this._handleContentResize,this)};g.prototype._deregisterContentResize=function(){sap.ui.getCore().detachIntervalTimer(this._handleContentResize,this)};g.prototype._registerToolbarResize=function(){if(g.isRelativeWidth(this.getWidth())){var e=t.proxy(this._handleToolbarResize,this);this._sResizeListenerId=a.register(this,e)}};g.prototype._deregisterToolbarResize=function(){sap.ui.getCore().detachIntervalTimer(this._handleContentResize,this);if(this._sResizeListenerId){a.deregister(this._sResizeListenerId);this._sResizeListenerId=""}};g.prototype._registerResize=function(){this._registerToolbarResize();this._registerContentResize()};g.prototype._deregisterResize=function(){this._deregisterToolbarResize();this._deregisterContentResize()};g.prototype._cleanup=function(){this._deregisterResize()};g.prototype._getEndPoint=function(){var t=(this.getDomRef()||{}).lastElementChild;if(t){var e=t.offsetLeft;if(!sap.ui.getCore().getConfiguration().getRTL()){e+=t.offsetWidth}}return e||0};g.prototype._handleToolbarResize=function(){this._handleResize(false)};g.prototype._handleContentResize=function(){this._handleResize(true)};g.prototype._handleResize=function(t){if(t&&this._iEndPoint==this._getEndPoint()){return}this._doLayout()};g.prototype._getAccessibilityRole=function(){var t=this.getContent(),e=this._getRootAccessibilityRole();if(this.getActive()&&(!t||t.length===0)){e="button"}return e};g.prototype.setDesign=function(t,e){if(!e){return this.setProperty("design",t)}this._sAutoDesign=this.validateProperty("design",t);return this};g.prototype.setStyle=function(t){var e,o;if(this.getStyle()===t){return this}this.setProperty("style",t,true);if(this.getDomRef()){Object.keys(h).forEach(function(i){e="sapMTB"+i;o=i===t;this.$().toggleClass(e,o)},this)}return this};g.prototype.getActiveDesign=function(){var t=this.getDesign();if(t!=l.Auto){return t}return this._sAutoDesign||t};g.prototype.getTitleControl=function(){if(!sap.m.Title){return}var t=this.getContent();for(var e=0;e<t.length;e++){var o=t[e];if(o instanceof sap.m.Title&&o.getVisible()){return o}}};g.prototype.getTitleId=function(){var t=this.getTitleControl();return t?t.getId():""};g.prototype.isContextSensitive=e.prototype.isContextSensitive;g.prototype.setHTMLTag=e.prototype.setHTMLTag;g.prototype.getHTMLTag=e.prototype.getHTMLTag;g.prototype.applyTagAndContextClassFor=e.prototype.applyTagAndContextClassFor;g.prototype._applyContextClassFor=e.prototype._applyContextClassFor;g.prototype._applyTag=e.prototype._applyTag;g.prototype._getContextOptions=e.prototype._getContextOptions;g.prototype._setRootAccessibilityRole=e.prototype._setRootAccessibilityRole;g.prototype._getRootAccessibilityRole=e.prototype._getRootAccessibilityRole;return g});