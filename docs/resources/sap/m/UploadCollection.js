/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/m/library","sap/m/MessageBox","sap/m/Dialog","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/IconPool","sap/m/Image","sap/m/Text","sap/m/Title","sap/m/Button","sap/m/List","sap/m/StandardListItem","sap/ui/unified/FileUploaderParameter","sap/ui/unified/FileUploader","sap/ui/core/format/FileSizeFormat","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/ObjectAttribute","sap/m/UploadCollectionItem","sap/m/UploadCollectionParameter","sap/m/UploadCollectionToolbarPlaceholder","sap/ui/core/HTML","sap/m/CustomListItem","sap/ui/core/ResizeHandler","sap/ui/Device","./UploadCollectionRenderer","jquery.sap.keycodes"],function(e,t,i,a,r,s,o,n,l,d,p,h,g,u,m,_,f,c,I,U,y,D,F,b,C,v,T,L){"use strict";var P=s.extend("sap.m.UploadCollection",{constructor:function(i,a){var r;if(a&&a.instantUpload===false){r=a.instantUpload;delete a.instantUpload}else if(i&&i.instantUpload===false){r=i.instantUpload;delete i.instantUpload}if(a&&a.mode===t.ListMode.MultiSelect&&r===false){a.mode=t.ListMode.None;e.sap.log.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'")}else if(i&&i.mode===t.ListMode.MultiSelect&&r===false){i.mode=t.ListMode.None;e.sap.log.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'")}try{s.apply(this,arguments);if(r===false){this.bInstantUpload=r;this._oFormatDecimal=f.getInstance({binaryFilesize:false,maxFractionDigits:1,maxIntegerDigits:3})}}catch(e){this.destroy();throw e}},metadata:{library:"sap.m",properties:{fileType:{type:"string[]",group:"Data",defaultValue:null},maximumFilenameLength:{type:"int",group:"Data",defaultValue:null},maximumFileSize:{type:"float",group:"Data",defaultValue:null},mimeType:{type:"string[]",group:"Data",defaultValue:null},multiple:{type:"boolean",group:"Behavior",defaultValue:false},noDataText:{type:"string",group:"Appearance",defaultValue:null},noDataDescription:{type:"string",group:"Appearance",defaultValue:null},sameFilenameAllowed:{type:"boolean",group:"Behavior",defaultValue:false},showSeparators:{type:"sap.m.ListSeparators",group:"Appearance",defaultValue:"All"},uploadEnabled:{type:"boolean",group:"Behavior",defaultValue:true},uploadUrl:{type:"string",group:"Data",defaultValue:"../../../upload"},instantUpload:{type:"boolean",group:"Behavior",defaultValue:true},numberOfAttachmentsText:{type:"string",group:"Appearance",defaultValue:null},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:"None"},uploadButtonInvisible:{type:"boolean",group:"Appearance",defaultValue:false},terminationEnabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.UploadCollectionItem",multiple:true,singularName:"item",bindable:"bindable"},headerParameters:{type:"sap.m.UploadCollectionParameter",multiple:true,singularName:"headerParameter"},parameters:{type:"sap.m.UploadCollectionParameter",multiple:true,singularName:"parameter"},toolbar:{type:"sap.m.OverflowToolbar",multiple:false},infoToolbar:{type:"sap.m.Toolbar",multiple:false,forwarding:{idSuffix:"-list",aggregation:"infoToolbar"}},_list:{type:"sap.m.List",multiple:false,visibility:"hidden"},_noDataIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_dragDropIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_dragDropText:{type:"sap.m.Text",multiple:false,visibility:"hidden"}},events:{change:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileDeleted:{parameters:{documentId:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},filenameLengthExceed:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileRenamed:{parameters:{documentId:{type:"string"},fileName:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},fileSizeExceed:{parameters:{documentId:{type:"string"},fileSize:{type:"string"},files:{type:"object[]"}}},typeMissmatch:{parameters:{documentId:{type:"string"},fileType:{type:"string"},mimeType:{type:"string"},files:{type:"object[]"}}},uploadComplete:{parameters:{readyStateXHR:{type:"string"},response:{type:"string"},status:{type:"string"},files:{type:"object[]"}}},uploadTerminated:{parameters:{fileName:{type:"string"},getHeaderParameter:{type:"function",parameters:{headerParameterName:{type:"string"}}}}},beforeUploadStarts:{parameters:{fileName:{type:"string"},addHeaderParameter:{type:"function",parameters:{headerParameter:{type:"sap.m.UploadCollectionParameter"}}},getHeaderParameter:{type:"function",parameters:{headerParameterName:{type:"string"}}}}},selectionChange:{parameters:{selectedItem:{type:"sap.m.UploadCollectionItem"},selectedItems:{type:"sap.m.UploadCollectionItem[]"},selected:{type:"boolean"}}}}}});P._uploadingStatus="uploading";P._displayStatus="display";P._toBeDeletedStatus="toBeDeleted";P._pendingUploadStatus="pendingUploadStatus";P._placeholderCamera="sap-icon://card";P._markerMargin=8;if(T.system.phone){P._resizeTimeoutInterval=500}else{P._resizeTimeoutInterval=100}P.prototype.init=function(){P.prototype._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._headerParamConst={requestIdName:"requestId"+e.now(),fileNameRequestIdName:"fileNameRequestId"+e.now()};this._requestIdValue=0;this._iFUCounter=0;this._oList=new g(this.getId()+"-list",{selectionChange:[this._handleSelectionChange,this]});this.setAggregation("_list",this._oList,true);this._oList.addStyleClass("sapMUCList");this.setAggregation("_noDataIcon",new o(this.getId()+"-no-data-icon",{src:"sap-icon://document",size:"6rem",noTabStop:true}),true);this.setAggregation("_dragDropIcon",new o(this.getId()+"-drag-drop-icon",{src:"sap-icon://upload-to-cloud",size:"4rem",noTabStop:true}),true);this.setAggregation("_dragDropText",new d(this.getId()+"-drag-drop-text",{text:this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR")}),true);this._iUploadStartCallCounter=0;this.aItems=[];this._aDeletedItemForPendingUpload=[];this._aFileUploadersForPendingUpload=[];this._aFilesFromDragAndDropForPendingUpload=[];this._iFileUploaderPH=null;this._oListEventDelegate=null;this._oItemToUpdate=null;this._sReziseHandlerId=null};P.prototype.setFileType=function(t){if(!t){return this}if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change fileType at runtime.")}else{var i=t.length;for(var a=0;a<i;a++){t[a]=t[a].toLowerCase()}if(this.getFileType()!==t){this.setProperty("fileType",t,true);this._getFileUploader().setFileType(t)}}return this};P.prototype.setMaximumFilenameLength=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change maximumFilenameLength at runtime.")}else if(this.getMaximumFilenameLength()!==t){this.setProperty("maximumFilenameLength",t,true);this._getFileUploader().setMaximumFilenameLength(t)}return this};P.prototype.setMaximumFileSize=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change maximumFileSize at runtime.")}else if(this.getMaximumFileSize()!==t){this.setProperty("maximumFileSize",t,true);this._getFileUploader().setMaximumFileSize(t)}return this};P.prototype.setMimeType=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change mimeType at runtime.")}else if(this.getMimeType()!==t){this.setProperty("mimeType",t,true);this._getFileUploader().setMimeType(t)}return this};P.prototype.setMultiple=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change multiple at runtime.")}else if(this.getMultiple()!==t){this.setProperty("multiple",t);this._getFileUploader().setMultiple(t)}return this};P.prototype.setShowSeparators=function(e){if(this.getShowSeparators()!==e){this.setProperty("showSeparators",e);this._oList.setShowSeparators(e)}return this};P.prototype.setUploadEnabled=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change uploadEnabled at runtime.")}else if(this.getUploadEnabled()!==t){this.setProperty("uploadEnabled",t);this._getFileUploader().setEnabled(t)}return this};P.prototype.setUploadUrl=function(t){if(!this.getInstantUpload()){e.sap.log.info("As property instantUpload is false it is not allowed to change uploadUrl at runtime.")}else if(this.getUploadUrl()!==t){this.setProperty("uploadUrl",t);this._getFileUploader().setUploadUrl(t)}return this};P.prototype.setInstantUpload=function(){e.sap.log.error("It is not supported to change the behavior at runtime.");return this};P.prototype.setMode=function(i){if(i===t.ListMode.Delete){this._oList.setMode(t.ListMode.None);e.sap.log.info("sap.m.ListMode.Delete is not supported by UploadCollection. Value has been resetted to 'None'")}else if(i===t.ListMode.MultiSelect&&!this.getInstantUpload()){this._oList.setMode(t.ListMode.None);e.sap.log.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Pending Upload. Value has been resetted to 'None'")}else{this._oList.setMode(i)}return this};P.prototype.getMode=function(){return this._oList.getMode()};P.prototype.getToolbar=function(){return this._oHeaderToolbar};P.prototype.getNoDataText=function(){var e=this.getProperty("noDataText");e=e||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_TEXT");return e};P.prototype.getNoDataDescription=function(){var e=this.getProperty("noDataDescription");e=e||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_DESCRIPTION");return e};P.prototype.setUploadButtonInvisible=function(e){if(this.getUploadButtonInvisible()===e){return this}this.setProperty("uploadButtonInvisible",e,true);if(this.getInstantUpload()){this._getFileUploader().setVisible(!e)}else{this._setFileUploaderVisibility(e)}if(this._bDragDropEnabled){this._unbindDragEnterLeave();this._bDragDropEnabled=false}else{this._bindDragEnterLeave()}return this};P.prototype.getInternalRequestHeaderNames=function(){return[this._headerParamConst.fileNameRequestIdName,this._headerParamConst.requestIdName]};P.prototype.upload=function(){if(this.getInstantUpload()){e.sap.log.error("Not a valid API call. 'instantUpload' should be set to 'false'.")}var t=this._aFileUploadersForPendingUpload.length;for(var i=0;i<t;i++){this._iUploadStartCallCounter=0;if(this._aFileUploadersForPendingUpload[i].getValue()){this._aFileUploadersForPendingUpload[i].upload()}}if(this._aFilesFromDragAndDropForPendingUpload.length>0){this._oFileUploader._sendFilesFromDragAndDrop(this._aFilesFromDragAndDropForPendingUpload);this._aFilesFromDragAndDropForPendingUpload=[]}};P.prototype.getSelectedItems=function(){var e=this._oList.getSelectedItems();return this._getUploadCollectionItemsByListItems(e)};P.prototype.getSelectedItem=function(){var e=this._oList.getSelectedItem();if(e){return this._getUploadCollectionItemByListItem(e)}return null};P.prototype.setSelectedItemById=function(e,t){this._oList.setSelectedItemById(e+"-cli",t);this._setSelectedForItems([this._getUploadCollectionItemById(e)],t);return this};P.prototype.setSelectedItem=function(e,t){return this.setSelectedItemById(e.getId(),t)};P.prototype.selectAll=function(){var t=this._oList.selectAll();if(t.getItems().length!==this.getItems().length){e.sap.log.info("Internal 'List' and external 'UploadCollection' are not in sync.")}this._setSelectedForItems(this.getItems(),true);return this};P.prototype.downloadItem=function(t,i){if(!this.getInstantUpload()){e.sap.log.info("Download is not possible on Pending Upload mode");return false}else{return t.download(i)}};P.prototype.openFileDialog=function(t){if(this._oFileUploader){if(t){if(!this._oFileUploader.getMultiple()){this._oItemToUpdate=t;this._oFileUploader.$().find("input[type=file]").trigger("click")}else{e.sap.log.warning("Version Upload cannot be used in multiple upload mode")}}else{this._oFileUploader.$().find("input[type=file]").trigger("click")}}return this};P.prototype.removeAggregation=function(t,i,a){var r,o,n;if(!this.getInstantUpload()&&t==="items"&&i){r=i._internalFileIdWithinDragDropArray;if(r){o=this._aFilesFromDragAndDropForPendingUpload.indexOf(r);if(o!==-1){this._aFilesFromDragAndDropForPendingUpload.splice(o,1)}}else if(e.isNumeric(i)){n=this.getItems();this._aDeletedItemForPendingUpload.push(n[i])}else{this._aDeletedItemForPendingUpload.push(i)}}return s.prototype.removeAggregation.apply(this,arguments)};P.prototype.removeAllAggregation=function(e,t){if(!this.getInstantUpload()&&e==="items"){if(this._aFileUploadersForPendingUpload){for(var i=0;i<this._aFileUploadersForPendingUpload.length;i++){this._aFileUploadersForPendingUpload[i].destroy();this._aFileUploadersForPendingUpload[i]=null}this._aFileUploadersForPendingUpload=[]}}return s.prototype.removeAllAggregation.apply(this,arguments)};P.prototype.onBeforeRendering=function(){this._RenderManager=this._RenderManager||sap.ui.getCore().createRenderManager();var t,i;if(this._oListEventDelegate){this._oList.removeEventDelegate(this._oListEventDelegate);this._oListEventDelegate=null}this._deregisterSizeHandler();this._unbindDragEnterLeave();r.bind(this)();if(!this.getInstantUpload()){this.aItems=this.getItems();this._getListHeader(this.aItems.length);this._clearList();this._fillList(this.aItems);this._oList.setHeaderToolbar(this._oHeaderToolbar);return}if(this.aItems.length>0){i=this.aItems.length;var a=[];for(t=0;t<i;t++){if(this.aItems[t]&&this.aItems[t]._status===P._uploadingStatus){a.push(this.aItems[t])}else if(this.aItems[t]&&this.aItems[t]._status!==P._uploadingStatus&&this.aItems[t]._percentUploaded===100&&this.getItems().length===0){a.push(this.aItems[t])}}if(a.length!==0){this.aItems=[];this.aItems=this.getItems();this.aItems=a.concat(this.aItems)}else{this.aItems=this.getItems()}}else{this.aItems=this.getItems()}this._getListHeader(this.aItems.length);this._clearList();this._fillList(this.aItems);this._oList.setAggregation("headerToolbar",this._oHeaderToolbar,true);if(this.sErrorState!=="Error"){if(this.getUploadEnabled()!==this._oFileUploader.getEnabled()){this._oFileUploader.setEnabled(this.getUploadEnabled())}}else{this._oFileUploader.setEnabled(false)}if(this.sDeletedItemId){e(document.activeElement).blur()}function r(){if(this.bInstantUpload===false){this.setProperty("instantUpload",this.bInstantUpload,true);delete this.bInstantUpload}}};P.prototype.onAfterRendering=function(){this._bindDragEnterLeave();if(this.getInstantUpload()){if(this.aItems||this.aItems===this.getItems()){if(this.editModeItem){var t=e.sap.byId(this.editModeItem+"-ta_editFileName-inner");if(t){var i=this.editModeItem;if(!T.os.ios){t.focus(function(){t.selectText(0,t.val().length)})}t.focus();this._oListEventDelegate={onclick:function(e){this._handleClick(e,i)}.bind(this)};this._oList.addDelegate(this._oListEventDelegate)}}else if(this.sFocusId){this._setFocusToLineItem(this.sFocusId);this.sFocusId=null}else if(this.sDeletedItemId){this._setFocusAfterDeletion()}}}else if(this.sFocusId){this._setFocusToLineItem(this.sFocusId);this.sFocusId=null}};P.prototype.exit=function(){var e,t,i;this._unbindDragEnterLeave();if(this._$RootNode){this._$RootNode=null}if(this._oFileUploader){this._oFileUploader.destroy();this._oFileUploader=null}if(this._oHeaderToolbar){this._oHeaderToolbar.destroy();this._oHeaderToolbar=null}if(this._oNumberOfAttachmentsTitle){this._oNumberOfAttachmentsTitle.destroy();this._oNumberOfAttachmentsTitle=null}if(this._RenderManager){this._RenderManager.destroy()}if(this._aFileUploadersForPendingUpload){t=this._aFileUploadersForPendingUpload.length;for(e=0;e<t;e++){this._aFileUploadersForPendingUpload[e].destroy();this._aFileUploadersForPendingUpload[e]=null}this._aFileUploadersForPendingUpload=null}for(e=0;e<this.aItems.length;e++){if(this.aItems[e]._status===P._uploadingStatus){i=this.aItems.splice(e,1)[0];if(i.destroy){i.destroy()}}}this._deregisterSizeHandler()};P.prototype._bindDragEnterLeave=function(){this._bDragDropEnabled=this._isDragAndDropAllowed();if(!this._bDragDropEnabled){return}if(!this._oDragDropHandler){this._oDragDropHandler={dragEnterUIArea:this._onDragEnterUIArea.bind(this),dragLeaveUIArea:this._onDragLeaveUIArea.bind(this),dragOverUIArea:this._onDragOverUIArea.bind(this),dropOnUIArea:this._onDropOnUIArea.bind(this),dragEnterUploadCollection:this._onDragEnterUploadCollection.bind(this),dragLeaveUploadCollection:this._onDragLeaveUploadCollection.bind(this),dragOverUploadCollection:this._onDragOverUploadCollection.bind(this),dropOnUploadCollection:this._onDropOnUploadCollection.bind(this)}}this._$RootNode=e(document.body);this._$RootNode.bind("dragenter",this._oDragDropHandler.dragEnterUIArea);this._$RootNode.bind("dragleave",this._oDragDropHandler.dragLeaveUIArea);this._$RootNode.bind("dragover",this._oDragDropHandler.dragOverUIArea);this._$RootNode.bind("drop",this._oDragDropHandler.dropOnUIArea);this._$DragDropArea=this.$("drag-drop-area");this.$().bind("dragenter",this._oDragDropHandler.dragEnterUploadCollection);this.$().bind("dragleave",this._oDragDropHandler.dragLeaveUploadCollection);this.$().bind("dragover",this._oDragDropHandler.dragOverUploadCollection);this.$().bind("drop",this._oDragDropHandler.dropOnUploadCollection)};P.prototype._unbindDragEnterLeave=function(){if(!this._bDragDropEnabled&&!this._oDragDropHandler){return}if(this._$RootNode){this._$RootNode.unbind("dragenter",this._oDragDropHandler.dragEnterUIArea);this._$RootNode.unbind("dragleave",this._oDragDropHandler.dragLeaveUIArea);this._$RootNode.unbind("dragover",this._oDragDropHandler.dragOverUIArea);this._$RootNode.unbind("drop",this._oDragDropHandler.dropOnUIArea)}this.$().unbind("dragenter",this._oDragDropHandler.dragEnterUploadCollection);this.$().unbind("dragleave",this._oDragDropHandler.dragLeaveUploadCollection);this.$().unbind("dragover",this._oDragDropHandler.dragOverUploadCollection);this.$().unbind("drop",this._oDragDropHandler.dropOnUploadCollection)};P.prototype._onDragEnterUIArea=function(e){if(!this._checkForFiles(e)){return}this._oLastEnterUIArea=e.target;this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide");this._adjustDragDropIcon()};P.prototype._onDragOverUIArea=function(e){e.preventDefault();if(!this._checkForFiles(e)){return}this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide")};P.prototype._onDragLeaveUIArea=function(e){if(this._oLastEnterUIArea===e.target){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide")}};P.prototype._onDropOnUIArea=function(e){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide")};P.prototype._onDragEnterUploadCollection=function(e){if(!this._checkForFiles(e)){return}if(e.target===this._$DragDropArea[0]){this._$DragDropArea.addClass("sapMUCDropIndicator");this._adjustDragDropIcon();this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DROP_FILE_INDICATOR"))}};P.prototype._onDragOverUploadCollection=function(e){e.preventDefault()};P.prototype._onDragLeaveUploadCollection=function(e){if(e.target===this._$DragDropArea[0]){this._$DragDropArea.removeClass("sapMUCDropIndicator");this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR"))}};P.prototype._checkForFiles=function(e){var t=e.originalEvent.dataTransfer.types;if(t){for(var i=0;i<t.length;i++){if(t[i]==="Files"){return true}}}return false};P.prototype._isDragAndDropAllowed=function(){return this.getUploadEnabled()&&!this.getUploadButtonInvisible()};P.prototype._onDropOnUploadCollection=function(e){if(!this._checkForFiles(e)){e.preventDefault();return}if(e.target===this._$DragDropArea[0]){e.preventDefault();this._$DragDropArea.removeClass("sapMUCDropIndicator");this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR"));var t=e.originalEvent.dataTransfer.files;if(t.length>1&&!this.getMultiple()){var i=this._oRb.getText("UPLOADCOLLECTION_MULTIPLE_FALSE");a.error(i);return}if(!this._oFileUploader._areFilesAllowed(t)){return}if(!this.getInstantUpload()){for(var r=0;r<t.length;r++){this._oFileUploader.fireChange({files:[t[r]],fromDragDrop:true});this._aFilesFromDragAndDropForPendingUpload.push(t[r])}}else{this._oFileUploader.fireChange({files:t});this._oFileUploader._sendFilesFromDragAndDrop(t)}}};P.prototype._adjustDragDropIcon=function(){if(this._$DragDropArea[0].offsetHeight<160){this.getAggregation("_dragDropIcon").$().hide()}};P.prototype._deregisterSizeHandler=function(){T.orientation.detachHandler(this._onResize,this);v.deregister(this._sReziseHandlerId)};P.prototype._hideFileUploaders=function(){var e,t;if(!this.getInstantUpload()){e=this._oHeaderToolbar.getContent().length;if(this._aFileUploadersForPendingUpload.length){for(t=0;t<e;t++){if(this._oHeaderToolbar.getContent()[t]instanceof _){if(t===this._iFileUploaderPH&&this._bFocusFileUploader){this._oHeaderToolbar.getContent()[t].$().find("button").focus()}else{this._oHeaderToolbar.getContent()[t].$().hide()}}}}}};P.prototype._truncateFileName=function(e){if(!e){return}if(e._status==="Edit"){var t=e.getId()+"-cli";this.$().find("#"+t).find(".sapMUCObjectMarkerContainer").attr("style","display: none");return}var i=0;var a=e.getMarkers();var r;for(var s=0;s<a.length;s++){i=i+a[s].$().width()+P._markerMargin}if(i>0){var o=this.$().find("#"+e.getId()+"-ta_filenameHL");if(o){r="max-width: calc(100% - "+i+"px)";if(o.attr("style")!==r){o.attr("style",r)}}}};P.prototype._getListHeader=function(t){var i,a;this._setNumberOfAttachmentsTitle(t);if(!this._oHeaderToolbar){if(!!this._oFileUploader&&!this.getInstantUpload()){this._oFileUploader.destroy()}i=this._getFileUploader();this._oHeaderToolbar=this.getAggregation("toolbar");if(!this._oHeaderToolbar){this._oHeaderToolbar=new c(this.getId()+"-toolbar",{content:[this._oNumberOfAttachmentsTitle,new I,i]}).addEventDelegate({onAfterRendering:this._hideFileUploaders},this);this._iFileUploaderPH=2}else{this._oHeaderToolbar.addEventDelegate({onAfterRendering:this._hideFileUploaders},this);this._iFileUploaderPH=this._getFileUploaderPlaceHolderPosition(this._oHeaderToolbar);if(this._oHeaderToolbar&&this._iFileUploaderPH>-1){this._setFileUploaderInToolbar(i)}else{e.sap.log.info("A place holder of type 'sap.m.UploadCollectionPlaceholder' needs to be provided.")}}}else if(!this.getInstantUpload()){var r=this._aFileUploadersForPendingUpload.length;for(a=r-1;a>=0;a--){if(this._aFileUploadersForPendingUpload[a].getId()===this._oFileUploader.getId()){i=this._getFileUploader();this._oHeaderToolbar.insertAggregation("content",i,this._iFileUploaderPH,true);break}}}};P.prototype._getFileUploaderPlaceHolderPosition=function(e){for(var t=0;t<e.getContent().length;t++){if(e.getContent()[t]instanceof F){return t}}return-1};P.prototype._setFileUploaderInToolbar=function(e){this._oHeaderToolbar.getContent()[this._iFileUploaderPH].setVisible(false);this._oHeaderToolbar.insertContent(e,this._iFileUploaderPH)};P.prototype._mapItemToListItem=function(t){if(!t||this._oItemToUpdate&&t.getId()===this._oItemToUpdate.getId()){return null}var i,a,r,s,o,n,l,d,p;i=t.getId();a=t._status;r=t.getFileName();if(a===P._uploadingStatus){s=t._getBusyIndicator?t._getBusyIndicator():t._getControl("sap.m.BusyIndicator",{id:i+"-ia_indicator"},"BusyIndicator").addStyleClass("sapMUCloadingIcon")}else{p=this._createIcon(t,i,r)}n=i+"-container";l=e.sap.byId(n);if(l){l.remove();l=null}d=new b({content:"<span id="+n+" class='sapMUCTextButtonContainer'></span>",afterRendering:this._renderContent.bind(this,t,n)});o=new C(i+"-cli",{content:[s,p,d],selected:t.getSelected()});o._oUploadCollectionItem=t;o._status=a;o.addStyleClass("sapMUCItem");o.setTooltip(t.getTooltip_Text());return o};P.prototype._renderContent=function(t,i){var a,r,s,o,n,l,d,p,h,g,u;l=t._percentUploaded;d=t.getAllAttributes();p=t.getStatuses();u=t.getMarkers();a=t.getId();s=d.length;o=p.length;n=u.length;g=t._status;h=this._RenderManager;h.write('<div class="sapMUCTextContainer ');if(g==="Edit"){h.write("sapMUCEditMode ")}h.write('" >');h.renderControl(this._getFileNameControl(t));if(g===P._uploadingStatus){h.renderControl(this._createProgressLabel(t,l))}else{if(n>0){h.write('<div class="sapMUCObjectMarkerContainer">');for(r=0;r<n;r++){h.renderControl(u[r].addStyleClass("sapMUCObjectMarker"))}h.write("</div>")}if(s>0){h.write('<div class="sapMUCAttrContainer">');for(r=0;r<s;r++){d[r].addStyleClass("sapMUCAttr");h.renderControl(d[r]);if(r+1<s){h.write('<div class="sapMUCSeparator">&nbsp&#x00B7&#160</div>')}}h.write("</div>")}if(o>0){h.write('<div class="sapMUCStatusContainer">');for(r=0;r<o;r++){p[r].detachBrowserEvent("hover");h.renderControl(p[r]);if(r+1<o){h.write('<div class="sapMUCSeparator">&nbsp&#x00B7&#160</div>')}}h.write("</div>")}}h.write("</div>");this._renderButtons(h,t,g,a);h.flush(e.sap.byId(i)[0],true);this._truncateFileName(t);this._sReziseHandlerId=v.register(this,this._onResize.bind(this));T.orientation.attachHandler(this._onResize,this)};P.prototype._renderButtons=function(e,t,i,a){var r,s;r=this._getButtons(t,i,a);if(r){s=r.length}if(s>0){e.write('<div class="sapMUCButtonContainer">');for(var o=0;o<s;o++){if(o+1<s){r[o].addStyleClass("sapMUCFirstButton")}e.renderControl(r[o])}e.write("</div>")}};P.prototype._getFileNameControl=function(e){var i,a,r,s,o,n,l,d,p,h,g;s=e.getFileName();o=e.getId();n=e._status;if(n!=="Edit"){i=e._getFileNameLink?e._getFileNameLink():e._getControl("sap.m.Link",{id:o+"-ta_filenameHL",press:[e,this._onItemPressed,this]},"FileNameLink");i.setEnabled(this._getItemPressEnabled(e));i.addStyleClass("sapMUCFileName");i.setModel(e.getModel());i.setText(s);return i}else{a=P._splitFilename(s);l=this.getMaximumFilenameLength();d="None";p=false;r=a.name;if(e.errorState==="Error"){p=true;d="Error";r=e.changedFileName;if(r.length===0){g=this._oRb.getText("UPLOADCOLLECTION_TYPE_FILENAME")}else{g=this._oRb.getText("UPLOADCOLLECTION_EXISTS")}}h=e._getFileNameEditBox?e._getFileNameEditBox():e._getControl("sap.m.Input",{id:o+"-ta_editFileName",type:t.InputType.Text},"FileNameEditBox");h.addStyleClass("sapMUCEditBox");h.setModel(e.getModel());h.setValue(r);h.setValueState(d);h.setFieldWidth("75%");h.setValueStateText(g);h.setDescription(a.extension);h.setShowValueStateMessage(p);if(l-a.extension.length>0){h.setProperty("maxLength",l-a.extension.length,true)}return h}};P.prototype._getItemPressEnabled=function(e){return e._getPressEnabled()&&this.sErrorState!=="Error"};P.prototype._onItemPressed=function(t,i){if(i.hasListeners("press")){i.firePress()}else if(this.sErrorState!=="Error"&&e.trim(i.getProperty("url"))){this._triggerLink(t)}};P.prototype._createProgressLabel=function(e,t){var i,a=e.getId();i=e._getProgressLabel?e._getProgressLabel():e._getControl("sap.m.Label",{id:a+"-ta_progress"},"ProgressLabel").addStyleClass("sapMUCProgress");i.setText(this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[t]));return i};P.prototype._createIcon=function(t,i,a){var r,s,d,p;r=t.getThumbnailUrl();if(r){d=n.createControlByURI({id:i+"-ia_imageHL",src:this._getThumbnail(r,a),decorative:false},l).addStyleClass("sapMUCItemImage sapMUCItemIcon");d.setAlt(this._getAriaLabelForPicture(t))}else{s=this._getThumbnail(undefined,a);d=new o(i+"-ia_iconHL",{src:s,decorative:false,useIconTooltip:false});d.setAlt(this._getAriaLabelForPicture(t));if(this.sErrorState!=="Error"&&e.trim(t.getProperty("url"))){p="sapMUCItemIcon"}else{p="sapMUCItemIconInactive"}if(s===P._placeholderCamera){if(this.sErrorState!=="Error"&&e.trim(t.getProperty("url"))){p=p+" sapMUCItemPlaceholder"}else{p=p+" sapMUCItemPlaceholderInactive"}}d.addStyleClass(p)}if(this._getItemPressEnabled(t)){d.attachPress(t,this._onItemPressed,this)}return d};P.prototype._getButtons=function(e,i,a){var r,s,o,n,l,d,p;r=[];if(!this.getInstantUpload()){n="deleteButton";l=this._createDeleteButton(a,n,e,this.sErrorState);r.push(l);return r}if(i==="Edit"){s=e._getOkButton?e._getOkButton():e._getControl("sap.m.Button",{id:a+"-okButton",text:this._oRb.getText("UPLOADCOLLECTION_RENAMEBUTTON_TEXT"),type:t.ButtonType.Transparent},"OkButton").addStyleClass("sapMUCOkBtn");o=e._getCancelButton?e._getCancelButton():e._getControl("sap.m.Button",{id:a+"-cancelButton",text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),type:t.ButtonType.Transparent},"CancelButton").addStyleClass("sapMUCCancelBtn");r.push(s);r.push(o)}else if(i===P._uploadingStatus){n="terminateButton";l=this._createDeleteButton(a,n,e,this.sErrorState);r.push(l)}else{d=e.getEnableEdit();if(this.sErrorState==="Error"){d=false}if(e.getVisibleEdit()){p=e._getEditButton?e._getEditButton():e._getControl("sap.m.Button",{id:a+"-editButton",icon:"sap-icon://edit",type:t.ButtonType.Standard,tooltip:this._oRb.getText("UPLOADCOLLECTION_EDITBUTTON_TEXT"),press:[e,this._handleEdit,this]},"EditButton").addStyleClass("sapMUCEditBtn");p.setEnabled(d);p.setVisible(e.getVisibleEdit());r.push(p)}n="deleteButton";if(e.getVisibleDelete()){l=this._createDeleteButton(a,n,e,this.sErrorState);r.push(l)}}return r};P.prototype._createDeleteButton=function(e,i,a,r){var s,o,n,l,d,p,h;s=a.getEnableDelete();if(r==="Error"){s=false}if(i==="deleteButton"){n="DeleteButton";d=a._getDeleteButton;l=this._oRb.getText("UPLOADCOLLECTION_DELETEBUTTON_TEXT");p=a.getVisibleDelete();h=[this,this._handleDelete,this]}else{n="TerminateButton";d=a._getTerminateButton;l=this._oRb.getText("UPLOADCOLLECTION_TERMINATEBUTTON_TEXT");p=this.getTerminationEnabled();h=[a,this._handleTerminate,this]}o=d?d():a._getControl("sap.m.Button",{id:e+"-"+i,icon:"sap-icon://sys-cancel",type:t.ButtonType.Standard,press:h},n).addStyleClass("sapMUCDeleteBtn");o.setVisible(p);o.setEnabled(s);o.setTooltip(l);return o};P.prototype._fillList=function(t){var i=this,a=t.length-1,r=this.getBinding("items"),s=false,o,n=this.getBindingInfo("items")?this.getBindingInfo("items").groupHeaderFactory:null;var l=function(e){return e.getBindingContext()?r.getGroup(e.getBindingContext()):null};var d=function(e){return l(e)&&l(e).key};e.each(t,function(e,t){if(r&&r.isGrouped()&&t){if(!s||o!==d(t)){if(n){i._oList.addItemGroup(l(t),n(l(t)),true)}else if(l(t)){i._oList.addItemGroup(l(t),null,true)}s=true;o=d(t)}}if(!t._status){t._status=P._displayStatus}else if(i.getInstantUpload()&&i._oItemForDelete&&i._oItemForDelete._status===P._toBeDeletedStatus&&t.getDocumentId()===i._oItemForDelete.documentId){return false}if(!t._percentUploaded&&t._status===P._uploadingStatus){t._percentUploaded=0}var p=i._mapItemToListItem(t);if(p){if(e===0&&a===0){p.addStyleClass("sapMUCListSingleItem")}else if(e===0){p.addStyleClass("sapMUCListFirstItem")}else if(e===a){p.addStyleClass("sapMUCListLastItem")}else{p.addStyleClass("sapMUCListItem")}i._oList.addAggregation("items",p,true);t.attachEvent("selected",i._handleItemSetSelected,i)}return true})};P.prototype._clearList=function(){if(this._oList){this._oList.destroyAggregation("items",true)}};P.prototype._setNumberOfAttachmentsTitle=function(e){var t=e||0;var i;if(this._oItemToUpdate){t--}if(this.getNumberOfAttachmentsText()){i=this.getNumberOfAttachmentsText()}else{i=this._oRb.getText("UPLOADCOLLECTION_ATTACHMENTS",[t])}if(!this._oNumberOfAttachmentsTitle){this._oNumberOfAttachmentsTitle=new p(this.getId()+"-numberOfAttachmentsTitle",{text:i})}else{this._oNumberOfAttachmentsTitle.setText(i)}};P.prototype._setFileUploaderVisibility=function(e){var t=this._oHeaderToolbar.getContent();if(t){var i=t[this._iFileUploaderPH];if(i instanceof _){i.setVisible(!e)}}};P.prototype._handleDelete=function(t){var i=t.getParameters();var r=this.getItems();var s=i.id.split("-deleteButton")[0];var o;var n;var l="";var d;var p;for(var h=0;h<r.length;h++){if(r[h].sId===s){n=h;o={documentId:r[h].getDocumentId(),_iLineNumber:n};break}}if(r[n].hasListeners("deletePress")){r[n].fireDeletePress();return}this.sDeletedItemId=s;if(e.sap.byId(this.sId).hasClass("sapUiSizeCompact")){l="sapUiSizeCompact"}if(this.editModeItem){this._handleOk(t,this.editModeItem,true);if(this.sErrorState==="Error"){return}}if(r[n]&&r[n].getEnableDelete()){d=r[n].getFileName();if(!d){p=this._oRb.getText("UPLOADCOLLECTION_DELETE_WITHOUT_FILENAME_TEXT")}else{p=this._oRb.getText("UPLOADCOLLECTION_DELETE_TEXT",d)}this._oItemForDelete=o;a.show(p,{title:this._oRb.getText("UPLOADCOLLECTION_DELETE_TITLE"),actions:[a.Action.OK,a.Action.CANCEL],onClose:this._onCloseMessageBoxDeleteItem.bind(this),dialogId:"messageBoxDeleteFile",styleClass:l})}};P.prototype._onCloseMessageBoxDeleteItem=function(e){var t=this.getItems();var i;if(this.getInstantUpload()){for(var r=0;r<t.length;r++){if(t[r].getDocumentId()===this._oItemForDelete.documentId){i=t[r]}}}else{i=t[this._oItemForDelete._iLineNumber]}if(e===a.Action.OK){this._oItemForDelete._status=P._toBeDeletedStatus;if(this.getInstantUpload()){this.fireFileDeleted({documentId:this._oItemForDelete.documentId,item:i});this._oItemForDelete=null}else{if(this.aItems.length===1){if(!this.getUploadButtonInvisible()){this.sFocusId=this._oFileUploader.$().find(":button")[0].id}}else if(this._oItemForDelete._iLineNumber<this.aItems.length-1){this.sFocusId=this.aItems[this._oItemForDelete._iLineNumber+1].getId()+"-cli"}else{this.sFocusId=this.aItems[0].getId()+"-cli"}this._aDeletedItemForPendingUpload.push(i);this.aItems.splice(this._oItemForDelete._iLineNumber,1);this.removeAggregation("items",i,false)}}};P.prototype._handleTerminate=function(e,t){var i,a;i=new g({items:[new u({title:t.getFileName(),icon:this._getIconFromFilename(t.getFileName())})]});a=new r({id:this.getId()+"deleteDialog",title:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TITLE"),content:[new d({text:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TEXT")}),i],buttons:[new h({text:this._oRb.getText("UPLOADCOLLECTION_OKBUTTON_TEXT"),press:[s,this]}),new h({text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),press:function(){a.close()}})],afterClose:function(){a.destroy()}}).open();function s(){var e=false;for(var i=0;i<this.aItems.length;i++){if(this.aItems[i]._status===P._uploadingStatus&&this.aItems[i]._requestIdName===t._requestIdName){this.aItems[i]._status=P._toBeDeletedStatus;this._oItemForDelete=this.aItems[i];e=true;break}else if(t.getFileName()===this.aItems[i].getFileName()&&this.aItems[i]._status===P._displayStatus){this.aItems[i]._status=P._toBeDeletedStatus;this._oItemForDelete=this.aItems[i];this.fireFileDeleted({documentId:this.aItems[i].getDocumentId(),item:this.aItems[i]});break}}if(e){this._getFileUploader().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(t.getFileName())+this._oItemForDelete._requestIdName)}a.close();this.invalidate()}};P.prototype._handleEdit=function(e,t){var i,a=t.getId(),r=this.aItems.length;if(this.editModeItem){this._handleOk(e,this.editModeItem,false)}if(this.sErrorState!=="Error"){for(i=0;i<r;i++){if(this.aItems[i].getId()===a){this.aItems[i]._status="Edit";break}}t._status="Edit";this.editModeItem=e.getSource().getId().split("-editButton")[0];this.invalidate()}};P.prototype._handleClick=function(t,i){var a=e(t.target).closest("button");var r="";if(a.length){r=a.prop("id")}if(r.lastIndexOf("editButton")===-1){if(r.lastIndexOf("cancelButton")!==-1){this._handleCancel(t,i)}else if(t.target.id.lastIndexOf("ia_imageHL")<0&&t.target.id.lastIndexOf("ia_iconHL")<0&&t.target.id.lastIndexOf("deleteButton")<0&&t.target.id.lastIndexOf("ta_editFileName-inner")<0){if(t.target.id.lastIndexOf("cli")>0){this.sFocusId=t.target.id}this._handleOk(t,i,true)}}};P.prototype._handleOk=function(e,t,i){var a=document.getElementById(t+"-ta_editFileName-inner");var r;var s=P._findById(t,this.aItems);var o=s.getProperty("fileName");var n=P._splitFilename(o);var l=sap.ui.getCore().byId(t+"-ta_editFileName");var d=s.errorState;var p=s.changedFileName;if(a!==null){r=a.value.replace(/^\s+/,"")}this.sFocusId=t+"-cli";if(!r||r.length===0){if(a!==null){this._setErrorStateOnItem(this,s,r,p,d)}return}s._status=P._displayStatus;if(n.name===r){this._removeErrorStateFromItem(this,s);if(i){this.invalidate()}return}if(this.getSameFilenameAllowed()){this._removeErrorStateFromItem(this,s);this._oItemForRename=s;this._onEditItemOk.bind(this)(r+n.extension);return}if(P._checkDoubleFileName(r+n.extension,this.aItems)){l.setProperty("valueState","Error",true);this._setErrorStateOnItem(this,s,r,p,d)}else{l.setProperty("valueState","None",true);s.changedFileName=null;this._removeErrorStateFromItem(this,s);if(i){this.invalidate()}this._oItemForRename=s;this._onEditItemOk.bind(this)(r+n.extension)}};P.prototype._setErrorStateOnItem=function(e,t,i,a,r){t._status="Edit";t.errorState="Error";e.sErrorState="Error";t.changedFileName=i;if(r!=="Error"||a!==i){e.invalidate()}};P.prototype._removeErrorStateFromItem=function(e,t){t.errorState=null;e.sErrorState=null;e.editModeItem=null};P.prototype._onEditItemOk=function(e){if(this._oItemForRename){this._oItemForRename.setFileName(e);this.fireFileRenamed({documentId:this._oItemForRename.getProperty("documentId"),fileName:e,item:this._oItemForRename})}delete this._oItemForRename};P.prototype._handleCancel=function(e,t){var i=P._findById(t,this.aItems);i._status=P._displayStatus;i.errorState=null;i.changedFileName=i._getFileNameEditBox().getValue();this.sFocusId=this.editModeItem+"-cli";this.sErrorState=null;this.editModeItem=null;this.invalidate()};P.prototype._onChange=function(t){if(t){var i,a=t.getParameter("files").length,r,s,o,n,l;if(a===0){return}this._oFileUploader.removeAllAggregation("headerParameters",true);this.removeAllAggregation("headerParameters",true);this._oFileUploader.removeAllAggregation("parameters",true);this.removeAllAggregation("parameters",true);this.fireChange({getParameter:function(e){if(e){return t.getParameter(e)}return null},getParameters:function(){return t.getParameters()},mParameters:t.getParameters(),files:t.getParameter("files")});var d=this.getAggregation("parameters");if(d){e.each(d,function(e,t){var i=new m({name:t.getProperty("name"),value:t.getProperty("value")});this._oFileUploader.addParameter(i)}.bind(this))}if(!this.getInstantUpload()){this._bFocusFileUploader=true;o=P._pendingUploadStatus}else{o=P._uploadingStatus}this._requestIdValue++;i=this._requestIdValue.toString();var p=this.getAggregation("headerParameters");if(!this.getInstantUpload()){this._aFileUploadersForPendingUpload.push(this._oFileUploader)}for(r=0;r<a;r++){s=new y({fileName:t.getParameter("files")[r].name});if(t.getParameter("fromDragDrop")){s._internalFileIdWithinDragDropArray=t.getParameter("files")[r]}s._status=o;s._internalFileIndexWithinFileUploader=r+1;s._requestIdName=i;if(!this.getInstantUpload()){s.setAssociation("fileUploader",this._oFileUploader,true);n=this._oFormatDecimal.format(t.getParameter("files")[r].size);l=new U({text:n});s.insertAggregation("attributes",l,true);this.insertItem(s)}else{s._percentUploaded=0}this.aItems.unshift(s)}if(p){e.each(p,function(e,t){this._oFileUploader.addHeaderParameter(new m({name:t.getProperty("name"),value:t.getProperty("value")}))}.bind(this))}this._oFileUploader.addHeaderParameter(new m({name:this._headerParamConst.requestIdName,value:i}))}};P.prototype._onFilenameLengthExceed=function(e){var t={name:e.getParameter("fileName")};var i=[t];this.fireFilenameLengthExceed({getParameter:function(t){if(t){return e.getParameter(t)}},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:i})};P.prototype._onFileSizeExceed=function(e){var t={name:e.getParameter("fileName"),fileSize:e.getParameter("fileSize")};this.fireFileSizeExceed({getParameter:function(t){if(t){return e.getParameter(t)}},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:[t]})};P.prototype._onTypeMissmatch=function(e){var t={name:e.getParameter("fileName"),fileType:e.getParameter("fileType"),mimeType:e.getParameter("mimeType")};var i=[t];this.fireTypeMissmatch({getParameter:function(t){if(t){return e.getParameter(t)}},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:i})};P.prototype._onUploadTerminated=function(e){var t;var i=this._getRequestId(e);var a=e.getParameter("fileName");var r=this.aItems.length;for(t=0;t<r;t++){if(this.aItems[t]&&this.aItems[t].getFileName()===a&&this.aItems[t]._requestIdName===i&&(this.aItems[t]._status===P._uploadingStatus||this.aItems[t]._status===P._toBeDeletedStatus)){this.aItems.splice(t,1);this.removeItem(t);break}}this.fireUploadTerminated({fileName:a,getHeaderParameter:this._getHeaderParameterWithinEvent.bind(e)})};P.prototype._onUploadComplete=function(e){if(e){var t,i=this._getRequestId(e),a=e.getParameter("fileName"),r,s,o,n=l();r=this.aItems.length;o=[P._uploadingStatus,P._pendingUploadStatus];for(t=0;t<r;t++){if((!i||this.aItems[t]._requestIdName===i)&&this.aItems[t].getProperty("fileName")===a&&o.indexOf(this.aItems[t]._status)>=0){if(n&&this.aItems[t]._status!==P._pendingUploadStatus){this.aItems[t]._percentUploaded=100;this.aItems[t]._status=P._displayStatus}s=this.aItems.splice(t,1)[0];if(s.destroy){s.destroy()}this._oItemToUpdate=null;break}}this.fireUploadComplete({getParameter:e.getParameter,getParameters:e.getParameters,mParameters:e.getParameters(),files:[{fileName:e.getParameter("fileName")||a,responseRaw:e.getParameter("responseRaw"),reponse:e.getParameter("response"),response:e.getParameter("response"),status:e.getParameter("status"),headers:e.getParameter("headers")}]})}this.invalidate();function l(){var t=e.getParameter("status").toString()||"200";return t[0]==="2"||t[0]==="3"}};P.prototype._onUploadProgress=function(t){if(!t||!this.getInstantUpload()){return}var i=t.getParameter("fileName"),a,r=Math.round(t.getParameter("loaded")/t.getParameter("total")*100),s=this._getRequestId(t),o=this.aItems.length,n,l,d;if(r===100){a=this._oRb.getText("UPLOADCOLLECTION_UPLOAD_COMPLETED")}else{a=this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[r])}for(var p=0;p<o;p++){d=this.aItems[p];if(d.getProperty("fileName")===i&&d._requestIdName===s&&d._status===P._uploadingStatus){n=d._getProgressLabel?d._getProgressLabel():d._getControl("sap.m.Label",{id:d.getId()+"-ta_progress"},"ProgressLabel");if(n){n.setText(a);d._percentUploaded=r;l=e.sap.byId(d.getId()+"-ia_indicator");if(r===100){l.attr("aria-label",a)}else{l.attr("aria-valuenow",r)}break}}}};P.prototype._getRequestId=function(e){var t;t=e.getParameter("requestHeaders");if(!t){return null}for(var i=0;i<t.length;i++){if(t[i].name===this._headerParamConst.requestIdName){return t[i].value}}return null};P.prototype._getFileUploader=function(){var e=this.getInstantUpload();if(!e||!this._oFileUploader){var t=this.getInstantUpload()?this._oRb.getText("UPLOADCOLLECTION_UPLOAD"):this._oRb.getText("UPLOADCOLLECTION_ADD");this._iFUCounter=this._iFUCounter+1;this._oFileUploader=new _(this.getId()+"-"+this._iFUCounter+"-uploader",{buttonOnly:true,buttonText:t,tooltip:t,iconOnly:true,enabled:this.getUploadEnabled(),fileType:this.getFileType(),icon:"sap-icon://add",iconFirst:false,style:"Transparent",maximumFilenameLength:this.getMaximumFilenameLength(),maximumFileSize:this.getMaximumFileSize(),mimeType:this.getMimeType(),multiple:this.getMultiple(),name:"uploadCollection",uploadOnChange:e,sameFilenameAllowed:true,uploadUrl:this.getUploadUrl(),useMultipart:false,sendXHR:true,change:[this._onChange,this],filenameLengthExceed:[this._onFilenameLengthExceed,this],fileSizeExceed:[this._onFileSizeExceed,this],typeMissmatch:[this._onTypeMissmatch,this],uploadAborted:[this._onUploadTerminated,this],uploadComplete:[this._onUploadComplete,this],uploadProgress:[this._onUploadProgress,this],uploadStart:[this._onUploadStart,this],visible:!this.getUploadButtonInvisible()})}return this._oFileUploader};P.prototype._onUploadStart=function(t){var i,a,r,s,o,n;this._iUploadStartCallCounter++;s=t.getParameter("requestHeaders").length;for(a=0;a<s;a++){if(t.getParameter("requestHeaders")[a].name===this._headerParamConst.requestIdName){r=t.getParameter("requestHeaders")[a].value;break}}o=t.getParameter("fileName");i={name:this._headerParamConst.fileNameRequestIdName,value:this._encodeToAscii(o)+r};t.getParameter("requestHeaders").push(i);for(a=0;a<this._aDeletedItemForPendingUpload.length;a++){if(this._aDeletedItemForPendingUpload[a].getAssociation("fileUploader")===t.oSource.sId&&this._aDeletedItemForPendingUpload[a].getFileName()===o&&this._aDeletedItemForPendingUpload[a]._internalFileIndexWithinFileUploader===this._iUploadStartCallCounter){t.getSource().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(o)+r);return}}this.fireBeforeUploadStarts({fileName:o,addHeaderParameter:l,getHeaderParameter:d.bind(this)});if(e.isArray(n)){for(a=0;a<n.length;a++){if(t.getParameter("requestHeaders")[a].name===n[a].getName()){t.getParameter("requestHeaders")[a].value=n[a].getValue()}}}else if(n instanceof D){for(a=0;a<t.getParameter("requestHeaders").length;a++){if(t.getParameter("requestHeaders")[a].name===n.getName()){t.getParameter("requestHeaders")[a].value=n.getValue();break}}}function l(e){var i={name:e.getName(),value:e.getValue()};t.getParameter("requestHeaders").push(i)}function d(e){n=this._getHeaderParameterWithinEvent.bind(t)(e);return n}};P.prototype._getIconFromFilename=function(t){var i=P._splitFilename(t).extension;if(e.type(i)==="string"){i=i.toLowerCase()}switch(i){case".bmp":case".jpg":case".jpeg":case".png":return P._placeholderCamera;case".csv":case".xls":case".xlsx":return"sap-icon://excel-attachment";case".doc":case".docx":case".odt":return"sap-icon://doc-attachment";case".pdf":return"sap-icon://pdf-attachment";case".ppt":case".pptx":return"sap-icon://ppt-attachment";case".txt":return"sap-icon://document-text";default:return"sap-icon://document"}};P.prototype._getThumbnail=function(e,t){if(e){return e}else{return this._getIconFromFilename(t)}};P.prototype._triggerLink=function(e){var t,a;if(this.editModeItem){this._handleOk(e,this.editModeItem,true);if(this.sErrorState==="Error"){return}this.sFocusId=e.getParameter("id")}a=e.oSource.getId().split("-");t=a[a.length-2];i.URLHelper.redirect(this.aItems[t].getProperty("url"),true)};P.prototype.onkeydown=function(t){switch(t.keyCode){case e.sap.KeyCodes.F2:this._handleF2(t);break;case e.sap.KeyCodes.ESCAPE:this._handleESC(t);break;case e.sap.KeyCodes.DELETE:this._handleDEL(t);break;case e.sap.KeyCodes.ENTER:this._handleENTER(t);break;default:return}t.setMarked()};P.prototype._setFocusAfterDeletion=function(){var e=this.aItems.length;var t;if(e===0){this._oFileUploader.focus()}else{var i=this.sDeletedItemId.split("-").pop();if(i<=e-1){t=this.sDeletedItemId+"-cli"}else{t=this.aItems[this.aItems.length-1].sId+"-cli"}this._setFocusToLineItem(t)}this.sDeletedItemId=null};P.prototype._setFocusToLineItem=function(t){e.sap.byId(t).focus()};P.prototype._handleENTER=function(e){var t,a,r,s;if(this.editModeItem){t=e.target.id.split(this.editModeItem).pop()}else{t=e.target.id.split("-").pop()}switch(t){case"-ta_editFileName-inner":case"-okButton":this._handleOk(e,this.editModeItem,true);break;case"-cancelButton":e.preventDefault();this._handleCancel(e,this.editModeItem);break;case"-ia_iconHL":case"-ia_imageHL":s=this.editModeItem.split("-").pop();i.URLHelper.redirect(this.aItems[s].getProperty("url"),true);break;case"ia_iconHL":case"ia_imageHL":case"cli":a=e.target.id.split(t)[0]+"ta_filenameHL";r=sap.ui.getCore().byId(a);if(r.getEnabled()){s=e.target.id.split("-")[2];i.URLHelper.redirect(this.aItems[s].getProperty("url"),true)}break;default:break}};P.prototype._handleDEL=function(e){if(!this.editModeItem){var t=e.target.id.slice(0,-4),i=sap.ui.getCore().byId(t),a=i&&i._getDeleteButton&&i._getDeleteButton();if(a){a.firePress()}}};P.prototype._handleESC=function(e){if(this.editModeItem){this.sFocusId=this.editModeItem+"-cli";this.aItems[this.editModeItem.split("-").pop()]._status=P._displayStatus;this._handleCancel(e,this.editModeItem)}};P.prototype._handleF2=function(t){var i=sap.ui.getCore().byId(t.target.id);if(i!==undefined){if(i._status===P._displayStatus){var a=e.sap.byId(t.target.id);var r=a.find("[id$='-editButton']");var s=sap.ui.getCore().byId(r[0].id);if(s.getEnabled()){if(this.editModeItem){this._handleClick(t,this.editModeItem)}if(this.sErrorState!=="Error"){s.firePress()}}}else{this._handleClick(t,this.editModeItem)}}else if(t.target.id.search(this.editModeItem)===0){this._handleOk(t,this.editModeItem,true)}};P._checkDoubleFileName=function(e,t){if(t.length===0||!e){return false}var i=t.length;e=e.replace(/^\s+/,"");for(var a=0;a<i;a++){if(e===t[a].getProperty("fileName")){return true}}return false};P._splitFilename=function(e){var t={};var i=e.split(".");if(i.length===1){t.extension="";t.name=i.pop();return t}t.extension="."+i.pop();t.name=i.join(".");return t};P.prototype._getAriaLabelForPicture=function(e){var t;t=e.getAriaLabelForPicture()||e.getFileName();return t};P.prototype._getHeaderParameterWithinEvent=function(e){var t=[];var i=this.getParameter("requestHeaders");var a=i.length;var r;if(i&&e){for(r=0;r<a;r++){if(i[r].name===e){return new D({name:i[r].name,value:i[r].value})}}return null}else if(i){for(r=0;r<a;r++){t.push(new D({name:i[r].name,value:i[r].value}))}return t}};P.prototype._encodeToAscii=function(e){var t="";for(var i=0;i<e.length;i++){t=t+e.charCodeAt(i)}return t};P.prototype._onResize=function(){var t=this._oList.getItems();for(var i=0;i<t.length;i++){e.sap.delayedCall(P._resizeTimeoutInterval,this,this._truncateFileName.bind(this),[t[i]._oUploadCollectionItem])}};P.prototype._getUploadCollectionItemByListItem=function(e){var t=this.getItems();for(var i=0;i<t.length;i++){if(t[i].getId()===e.getId().replace("-cli","")){return t[i]}}return null};P.prototype._getUploadCollectionItemById=function(e){var t=this.getItems();for(var i=0;i<t.length;i++){if(t[i].getId()===e){return t[i]}}return null};P.prototype._getUploadCollectionItemsByListItems=function(e){var t=[];var i=this.getItems();if(e){for(var a=0;a<e.length;a++){for(var r=0;r<i.length;r++){if(e[a].getId().replace("-cli","")===i[r].getId()){t.push(i[r]);break}}}return t}return null};P.prototype._setSelectedForItems=function(e,i){if(this.getMode()!==t.ListMode.MultiSelect&&i){var a=this.getItems();for(var r=0;r<a.length;r++){a[r].setSelected(false)}}for(var s=0;s<e.length;s++){e[s].setSelected(i)}};P.prototype._handleItemSetSelected=function(e){var t=e.getSource();if(t instanceof y){var i=this._getListItemById(t.getId()+"-cli");if(i){i.setSelected(t.getSelected())}}};P.prototype._handleSelectionChange=function(e){var t=e.getParameter("listItem");var i=e.getParameter("selected");var a=this._getUploadCollectionItemsByListItems(e.getParameter("listItems"));var r=this._getUploadCollectionItemByListItem(t);if(r&&t&&a){this.fireSelectionChange({selectedItem:r,selectedItems:a,selected:i});r.setSelected(t.getSelected())}};P.prototype._getListItemById=function(e){var t=this._oList.getItems();return P._findById(e,t)};P._findById=function(e,t){for(var i=0;i<t.length;i++){if(t[i].getId()===e){return t[i]}}return null};return P});