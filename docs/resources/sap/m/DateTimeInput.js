/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","./library","sap/ui/model/type/Date","sap/ui/model/type/Time","sap/ui/model/type/DateTime","sap/ui/model/odata/type/ODataType","sap/ui/core/library","sap/ui/Device","./DateTimeInputRenderer"],function(e,t,a,r,i,s,l,o,u,n){"use strict";var p=a.DateTimeInputType;var h=o.TextDirection;var c=o.TextAlign;var y=o.ValueState;var g=t.extend("sap.m.DateTimeInput",{metadata:{library:"sap.m",designtime:"sap/m/designtime/DateTimeInput.designtime",properties:{value:{type:"string",group:"Data",defaultValue:null,bindable:"bindable"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},enabled:{type:"boolean",group:"Behavior",defaultValue:true},editable:{type:"boolean",group:"Behavior",defaultValue:true},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:y.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},showValueStateMessage:{type:"boolean",group:"Misc",defaultValue:true},name:{type:"string",group:"Misc",defaultValue:null},placeholder:{type:"string",group:"Misc",defaultValue:null},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:c.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:h.Inherit},type:{type:"sap.m.DateTimeInputType",group:"Data",defaultValue:p.Date},displayFormat:{type:"string",group:"Appearance",defaultValue:null},valueFormat:{type:"string",group:"Data",defaultValue:null},dateValue:{type:"object",group:"Data",defaultValue:null}},aggregations:{_picker:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{change:{parameters:{value:{type:"string"},dateValue:{type:"object"},valid:{type:"boolean"}}}}}});!function(e,t,r){var i=a.getLocaleData();t.extend(e,{_types:{Date:{valueFormat:i.getDatePattern("short"),displayFormat:i.getDatePattern("medium")},Time:{valueFormat:i.getTimePattern("short"),displayFormat:i.getTimePattern("short")},DateTime:{valueFormat:i.getDateTimePattern("short"),displayFormat:i.getDateTimePattern("short")}}});["Time","Date"].forEach(function(t,a){["valueFormat","displayFormat"].forEach(function(r){var i=e._types;i.DateTime[r]=i.DateTime[r].replace("{"+a+"}",i[t][r])})})}(g.prototype,e,u);g.prototype.init=function(){this.setType(p.Date)};g.prototype.onBeforeRendering=function(){f.call(this)};g.prototype.getFocusDomRef=function(){var e=m.call(this);return e.getFocusDomRef()};g.prototype.getIdForLabel=function(){var e=m.call(this);return e.getIdForLabel()};function d(t){var a;switch(t){case p.DateTime:e.sap.require("sap.m.DateTimePicker");a=new sap.m.DateTimePicker(this.getId()+"-Picker");break;case p.Time:e.sap.require("sap.m.TimePicker");a=new sap.m.TimePicker(this.getId()+"-Picker",{localeId:sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()});break;default:e.sap.require("sap.m.DatePicker");a=new sap.m.DatePicker(this.getId()+"-Picker");break}a.setDisplayFormat(this.getDisplayFormat()||this._types[t].displayFormat);a.setValueFormat(this.getValueFormat()||this._types[t].valueFormat);if(this.getDateValue()){a.setDateValue(this.getDateValue())}a.setEnabled(this.getEnabled());a.setEditable(this.getEditable());a.setValueState(this.getValueState());a.setValueStateText(this.getValueStateText());a.setShowValueStateMessage(this.getShowValueStateMessage());a.setName(this.getName());a.setPlaceholder(this.getPlaceholder());a.setTextAlign(this.getTextAlign());a.setTextDirection(this.getTextDirection());a.setWidth("100%");a.attachChange(v,this);var r=this.getAriaLabelledBy();for(var i=0;i<r.length;i++){a.addAriaLabelledBy(r[i])}return a}g.prototype.setType=function(e){if(e==this.getType()&&m.call(this)){return this}this.destroyAggregation("_picker");var t=d.call(this,e);this.setAggregation("_picker",t);this.setProperty("type",e);return this};g.prototype.setWidth=function(e){this.setProperty("width",e);if(this.getDomRef()){e=this.getWidth();this.$().css("width",e)}return this};g.prototype.setValue=function(e){f.call(this);e=this.validateProperty("value",e);if(e.toLowerCase()=="now"){return this.setDateValue(new Date)}if(e===this.getValue()){return this}this.setProperty("value",e,true);var t=m.call(this);t.setValue(e);var a=t.getDateValue();this.setProperty("dateValue",a,true);return this};g.prototype.setDateValue=function(e){if(this._isValidDate(e)){throw new Error("Date must be a JavaScript date object; "+this)}f.call(this);this.setProperty("dateValue",e,true);var t=m.call(this);t.setDateValue(e);var a=t.getValue();this.setProperty("value",a,true);return this};g.prototype.setDisplayFormat=function(e){this.setProperty("displayFormat",e,true);var t=m.call(this);t.setDisplayFormat(e||this._types[this.getType()].displayFormat);return this};g.prototype.setValueFormat=function(e){this.setProperty("valueFormat",e,true);var t=m.call(this);t.setValueFormat(e||this._types[this.getType()].ValueFormat);return this};g.prototype.setEnabled=function(e){this.setProperty("enabled",e,true);var t=m.call(this);t.setEnabled(e);return this};g.prototype.setEditable=function(e){this.setProperty("editable",e,true);var t=m.call(this);t.setEditable(e);return this};g.prototype.setValueState=function(e){this.setProperty("valueState",e,true);var t=m.call(this);t.setValueState(e);return this};g.prototype.setValueStateText=function(e){this.setProperty("valueStateText",e,true);var t=m.call(this);t.setValueStateText(e);return this};g.prototype.setShowValueStateMessage=function(e){this.setProperty("showValueStateMessage",e,true);var t=m.call(this);t.setShowValueStateMessage(e);return this};g.prototype.setName=function(e){this.setProperty("name",e,true);var t=m.call(this);t.setName(e);return this};g.prototype.setPlaceholder=function(e){this.setProperty("placeholder",e,true);var t=m.call(this);t.setPlaceholder(e);return this};g.prototype.setTextAlign=function(e){this.setProperty("textAlign",e,true);var t=m.call(this);t.setTextAlign(e);return this};g.prototype.setTextDirection=function(e){this.setProperty("textDirection",e,true);var t=m.call(this);t.setTextDirection(e);return this};g.prototype.addAriaLabelledBy=function(e){this.addAssociation("ariaLabelledBy",e,true);var t=m.call(this);t.addAriaLabelledBy(e);return this};g.prototype.removeAriaLabelledBy=function(e){this.removeAssociation("ariaLabelledBy",e,true);var t=m.call(this);t.removeAriaLabelledBy(e);return this};g.prototype.removeAllAriaLabelledBy=function(){this.removeAssociation("ariaLabelledBy",true);var e=m.call(this);e.removeAllAriaLabelledBy();return this};g.prototype.getAccessibilityInfo=function(){var e=m.call(this);return e&&e.getAccessibilityInfo?e.getAccessibilityInfo():null};g.prototype._getPickerByTypeAndPattern=function(e,t,a){var r=/[DdYyMLWwGQUur]/,i=/[HhKkmsa]/,s=i.test(a),l=r.test(a),o=s&&!l,u=l&&!s,n=l&&s,h,c;switch(e){case p.Time:case p.Date:case p.DateTime:if(o&&t.getMetadata().getName()!=="sap.m.TimePicker"){h=p.Time}else if(u&&t.getMetadata().getName()!=="sap.m.DatePicker"){h=p.Date}else if(n&&t.getMetadata().getName()!=="sap.m.DateTimePicker"){h=p.DateTime}break;default:{throw"Invalid type: "+e+". Expected is one of the sap.m.DateTimeInputType"}}if(h){this.destroyAggregation("_picker");c=d.call(this,h);this.setAggregation("_picker",c)}return c||t};g.prototype._getBoundValueTypePattern=function(){var e=this.getBinding("value"),t=e&&e.getType()&&e.getType();if(t instanceof r||t instanceof i||t instanceof s){return t.getOutputPattern()}if(t instanceof l&&t.oFormat){return t.oFormat.oFormatOptions.pattern}return undefined};function m(){return this.getAggregation("_picker")}g.prototype._isValidDate=function(t){return t&&e.type(t)!=="date"};function f(){if(this._getBoundValueTypePattern()){var e=this._getBoundValueTypePattern();var t=m.call(this);t=this._getPickerByTypeAndPattern(this.getType(),t,e);if(t.getValueFormat()!=e){t.setValueFormat(e)}if(t.getDisplayFormat()!=e){t.setDisplayFormat(e)}}}function v(e){var t=e.getParameter("value");var a;var r=e.getParameter("valid");this.setProperty("value",t,true);if(r){a=e.oSource.getDateValue();this.setProperty("dateValue",a,true)}this.fireChange({value:t,newValue:t,valid:r,dateValue:a,newDateValue:a})}return g});