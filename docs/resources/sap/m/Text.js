/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/library","sap/ui/Device","./TextRenderer"],function(e,t,i,r,n){"use strict";var a=i.TextAlign;var o=i.TextDirection;var s=t.extend("sap.m.Text",{metadata:{interfaces:["sap.ui.core.IShrinkable","sap.ui.core.IFormContent"],library:"sap.m",properties:{text:{type:"string",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:o.Inherit},wrapping:{type:"boolean",group:"Appearance",defaultValue:true},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:a.Begin},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxLines:{type:"int",group:"Appearance",defaultValue:null},renderWhitespace:{type:"boolean",group:"Appearance",defaultValue:false}},designtime:"sap/m/designtime/Text.designtime"}});s.prototype.normalLineHeight=1.2;s.prototype.cacheLineHeight=true;s.prototype.ellipsis="...";s.hasNativeLineClamp=function(){return typeof document.documentElement.style.webkitLineClamp!="undefined"&&r.browser.chrome}();s.setNodeValue=function(e,t){t=t||"";var i=e.childNodes;if(i.length===1&&i[0].nodeType===window.Node.TEXT_NODE){i[0].nodeValue=t}else{e.textContent=t}};s.prototype.setText=function(e){this.setProperty("text",e,true);var t=this.getTextDomRef();if(t){s.setNodeValue(t,this.getText(true));if(this.getWrapping()){if(e&&!/\s/.test(e)){this.$().addClass("sapMTextBreakWord")}else{this.$().removeClass("sapMTextBreakWord")}}}return this};s.prototype.getText=function(e){var t=this.getProperty("text");if(e){return t.replace(/\r\n|\n\r|\r/g,"\n")}return t};s.prototype.onAfterRendering=function(){if(this.getVisible()&&this.hasMaxLines()&&!this.canUseNativeLineClamp()){this.clampHeight()}};s.prototype.hasMaxLines=function(){return this.getWrapping()&&this.getMaxLines()>1};s.prototype.getTextDomRef=function(){if(!this.getVisible()){return null}if(this.hasMaxLines()){return this.getDomRef("inner")}return this.getDomRef()};s.prototype.canUseNativeLineClamp=function(){if(!s.hasNativeLineClamp){return false}if(this.getTextDirection()==o.RTL){return false}if(this.getTextDirection()==o.Inherit&&sap.ui.getCore().getConfiguration().getRTL()){return false}return true};s.prototype.getLineHeight=function(e){if(this.cacheLineHeight&&this._fLineHeight){return this._fLineHeight}e=e||this.getTextDomRef();if(!e){return 0}var t=window.getComputedStyle(e),i=t.lineHeight,n;if(/px$/i.test(i)){n=parseFloat(i)}else if(/^normal$/i.test(i)){n=parseFloat(t.fontSize)*this.normalLineHeight}else{n=parseFloat(t.fontSize)*parseFloat(i)}if(!r.browser.firefox){n=Math.floor(n)}if(this.cacheLineHeight&&n){this._fLineHeight=n}return n};s.prototype.getClampHeight=function(e){e=e||this.getTextDomRef();return this.getMaxLines()*this.getLineHeight(e)};s.prototype.clampHeight=function(e){e=e||this.getTextDomRef();if(!e){return 0}var t=this.getClampHeight(e);if(t){e.style.maxHeight=t+"px"}return t};s.prototype.clampText=function(e,t,i){e=e||this.getTextDomRef();if(!e){return}var r;var n=this.getText(true);var a=this.getClampHeight(e);t=t||0;i=i||n.length;s.setNodeValue(e,n.slice(0,i));if(e.scrollHeight>a){var o=e.style,p=o.height,l=this.ellipsis,u=l.length;o.height=a+"px";while(i-t>u){r=t+i>>1;s.setNodeValue(e,n.slice(0,r-u)+l);if(e.scrollHeight>a){i=r}else{t=r}}if(e.scrollHeight>a&&t>0){r=t;e.textContent=n.slice(0,r-u)+l}o.height=p}return r};s.prototype.getAccessibilityInfo=function(){return{description:this.getText()}};return s});