/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/ui/core/IconPool","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/ui/core/Item"],function(e,t,i,o,n,a,s,r,l,d,p){"use strict";var u=l.ValueState;var h=t.ButtonType;var f=t.ToolbarDesign;var g=l.TextAlign;var _=t.OverflowToolbarPriority;var c;var y=i.extend("sap.m.P13nConditionPanel",{metadata:{library:"sap.m",properties:{maxConditions:{type:"string",group:"Misc",defaultValue:"-1"},exclude:{type:"boolean",group:"Misc",defaultValue:false},containerQuery:{type:"boolean",group:"Misc",defaultValue:false},autoAddNewRow:{type:"boolean",group:"Misc",defaultValue:false},disableFirstRemoveIcon:{type:"boolean",group:"Misc",defaultValue:false},alwaysShowAddIcon:{type:"boolean",group:"Misc",defaultValue:true},usePrevConditionSetting:{type:"boolean",group:"Misc",defaultValue:true},autoReduceKeyFieldItems:{type:"boolean",group:"Misc",defaultValue:false},layoutMode:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Misc",defaultValue:false},displayFormat:{type:"string",group:"Misc",defaultValue:null},validationExecutor:{type:"object",group:"Misc",defaultValue:null}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content",visibility:"hidden"}},events:{dataChange:{}}},renderer:function(e,t){e.write("<section");e.writeControlData(t);e.addClass("sapMConditionPanel");e.writeClasses();e.writeStyles();e.write(">");e.write("<div");e.addClass("sapMConditionPanelContent");e.addClass("sapMConditionPanelBG");e.writeClasses();e.write(">");var i=t.getAggregation("content");var o=i.length;for(var n=0;n<o;n++){e.renderControl(i[n])}e.write("</div>");e.write("</section>")}});y.prototype.setConditions=function(t){if(!t){e.sap.log.error("sap.m.P13nConditionPanel : aCondition is not defined")}if(this._bIgnoreSetConditions){return}this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;for(var i=0;i<t.length;i++){this._addCondition2Map(t[i])}this._clearConditions();this._fillConditions()};y.prototype.removeAllConditions=function(){this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;this._clearConditions();this._fillConditions()};y.prototype.addCondition=function(e){if(this._bIgnoreSetConditions){return}e.index=this._iConditions;this._addCondition2Map(e);this._addCondition(e)};y.prototype.insertCondition=function(e,t){if(this._bIgnoreSetConditions){return}if(t!==undefined){e.index=t}this._addCondition2Map(e);this._addCondition(e)};y.prototype.removeCondition=function(e){this._clearConditions();if(typeof e=="string"){this._removeConditionFromMap(e)}if(typeof e=="object"){this._removeConditionFromMap(e.key)}this._fillConditions()};y.prototype._addCondition2Map=function(e){if(!e.key){e.key="condition_"+this._iConditions;if(this.getExclude()){e.key="x"+e.key}}this._iConditions++;this._oConditionsMap[e.key]=e;this._aConditionKeys.push(e.key)};y.prototype._removeConditionFromMap=function(e){this._iConditions--;delete this._oConditionsMap[e];var t=this._aConditionKeys.indexOf(e);if(t>=0){this._aConditionKeys.splice(t,1)}};y.prototype.getConditions=function(){var e;var t=[];if(this._oConditionsMap){for(var i in this._oConditionsMap){e=this._oConditionsMap[i];var o=e.value;if(!o){o=this._getFormatedConditionText(e.operation,e.value1,e.value2,e.exclude,e.keyField,e.showIfGrouped)}if(!e._oGrid||e._oGrid.select.getSelected()){t.push({key:i,text:o,exclude:e.exclude,operation:e.operation,keyField:e.keyField,value1:e.value1,value2:e.operation===sap.m.P13nConditionOperation.BT?e.value2:null,showIfGrouped:e.showIfGrouped})}}}return t};y.prototype.setOperations=function(e,t){t=t||"default";this._oTypeOperations[t]=e;this._updateAllOperations()};y.prototype.setValues=function(e,t){t=t||"default";this._oTypeValues[t]=e};y.prototype.addOperation=function(e,t){t=t||"default";this._oTypeOperations[t].push(e);this._updateAllOperations()};y.prototype.removeAllOperations=function(e){e=e||"default";this._oTypeOperations[e]=[];this._updateAllOperations()};y.prototype.getOperations=function(e){e=e||"default";return this._oTypeOperations[e]};y.prototype.setKeyFields=function(e){this._aKeyFields=e;this._updateKeyFieldItems(this._oConditionsGrid,true);this._updateAllConditionsEnableStates();this._createAndUpdateAllKeyFields();this._updateAllOperations()};y.prototype.addKeyField=function(e){this._aKeyFields.push(e);this._updateKeyFieldItems(this._oConditionsGrid,true,true);this._updateAllConditionsEnableStates();this._createAndUpdateAllKeyFields();this._updateAllOperations()};y.prototype.removeAllKeyFields=function(){this._aKeyFields=[];this._updateKeyFieldItems(this._oConditionsGrid,true)};y.prototype.getKeyFields=function(){return this._aKeyFields};y.prototype.setAlwaysShowAddIcon=function(e){this.setProperty("alwaysShowAddIcon",e);if(this._oConditionsGrid){this._oConditionsGrid.toggleStyleClass("conditionRootGrid",this.getLayoutMode()!=="Desktop")}return this};y.prototype.setLayoutMode=function(e){this.setProperty("layoutMode",e);if(this._oConditionsGrid){this._oConditionsGrid.toggleStyleClass("conditionRootGrid",e!=="Desktop")}this._updateConditionFieldSpans(e);this._clearConditions();this._fillConditions();return this};y.prototype.setContainerQuery=function(e){this._unregisterResizeHandler();this.setProperty("containerQuery",e);this._registerResizeHandler();this._clearConditions();this._fillConditions();return this};y.prototype._updateConditionFieldSpans=function(e){if(this._aConditionsFields){var t=e==="Desktop";if(t){this._aConditionsFields[2].SpanFilter="L3 M3 S3";this._aConditionsFields[4].SpanFilter="L2 M2 S2";this._aConditionsFields[5].SpanFilter="L3 M3 S3";this._aConditionsFields[6].SpanFilter="L2 M2 S2";this._aConditionsFields[7].SpanFilter="L1 M1 S1"}var i=e==="Tablet";if(i){this._aConditionsFields[2].SpanFilter="L5 M5 S5";this._aConditionsFields[4].SpanFilter="L5 M5 S5";this._aConditionsFields[5].SpanFilter="L10 M10 S10";this._aConditionsFields[6].SpanFilter="L10 M10 S10";this._aConditionsFields[7].SpanFilter="L1 M1 S1"}}};y.prototype.init=function(){sap.ui.getCore().loadLibrary("sap.ui.layout");c=c||sap.ui.requireSync("sap/ui/layout/Grid");this.addStyleClass("sapMConditionPanel");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._sFromLabelText=this._oRb.getText("CONDITIONPANEL_LABELFROM");this._sToLabelText=this._oRb.getText("CONDITIONPANEL_LABELTO");this._sValueLabelText=this._oRb.getText("CONDITIONPANEL_LABELVALUE");this._sShowIfGroupedLabelText=this._oRb.getText("CONDITIONPANEL_LABELGROUPING");this._sValidationDialogFieldMessage=this._oRb.getText("CONDITIONPANEL_FIELDMESSAGE");this._oTypeOperations={default:[]};this._oTypeValues={default:[]};this._aKeyFields=[];this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;this._sLayoutMode="Desktop";this._sConditionType="Filter";this._sAddRemoveIconTooltip="FILTER";this._iBreakPointTablet=s.media._predefinedRangeSets[s.media.RANGESETS.SAP_STANDARD].points[0];this._iBreakPointDesktop=s.media._predefinedRangeSets[s.media.RANGESETS.SAP_STANDARD].points[1];this._oConditionsGrid=new c({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0}).toggleStyleClass("conditionRootGrid",this.getLayoutMode()!=="Desktop");this._iFirstConditionIndex=0;this._iConditionPageSize=10;this._oInvisibleTextField=new r({text:this._oRb.getText("CONDITIONPANEL_FIELD_LABEL")});this._oInvisibleTextOperator=new r({text:this._oRb.getText("CONDITIONPANEL_OPERATOR_LABEL")});this.addAggregation("content",this._oInvisibleTextField);this.addAggregation("content",this._oInvisibleTextOperator);this.addAggregation("content",this._oConditionsGrid);this._registerResizeHandler();this._aConditionsFields=[{ID:"select",Label:"",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"CheckBox",Value:""},{ID:"keyFieldLabel",Text:"Sort By",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"Label"},{ID:"keyField",Label:"",SpanFilter:"L3 M5 S10",SpanSort:"L5 M5 S12",SpanGroup:"L4 M4 S12",Control:"ComboBox"},{ID:"operationLabel",Text:"Sort Order",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"Label"},{ID:"operation",Label:"",SpanFilter:"L2 M5 S10",SpanSort:s.system.phone?"L5 M5 S8":"L5 M5 S9",SpanGroup:"L2 M5 S10",Control:"ComboBox"},{ID:"value1",Label:this._sFromLabelText,SpanFilter:"L3 M10 S10",SpanSort:"L3 M10 S10",SpanGroup:"L3 M10 S10",Control:"TextField",Value:""},{ID:"value2",Label:this._sToLabelText,SpanFilter:"L2 M10 S10",SpanSort:"L2 M10 S10",SpanGroup:"L2 M10 S10",Control:"TextField",Value:""},{ID:"showIfGrouped",Label:this._sShowIfGroupedLabelText,SpanFilter:"L1 M10 S10",SpanSort:"L1 M10 S10",SpanGroup:"L3 M4 S9",Control:"CheckBox",Value:"false"}];this._oButtonGroupSpan={SpanFilter:"L2 M2 S2",SpanSort:s.system.phone?"L2 M2 S4":"L2 M2 S3",SpanGroup:"L2 M2 S3"};this._updateConditionFieldSpans(this.getLayoutMode());this._fillConditions()};y.prototype._createPaginatorToolbar=function(){this._bPaginatorButtonsVisible=false;var e=this;this._oPrevButton=new sap.m.Button({icon:a.getIconURI("navigation-left-arrow"),tooltip:this._oRb.getText("WIZARD_FINISH"),visible:true,press:function(t){e._iFirstConditionIndex=Math.max(0,e._iFirstConditionIndex-e._iConditionPageSize);e._clearConditions();e._fillConditions()},layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.NeverOverflow})});this._oNextButton=new sap.m.Button({icon:a.getIconURI("navigation-right-arrow"),tooltip:this._oRb.getText("WIZARD_NEXT"),visible:true,press:function(t){e._iFirstConditionIndex+=e._iConditionPageSize;e._clearConditions();e._fillConditions()},layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.NeverOverflow})});this._oRemoveAllButton=new sap.m.Button({text:this._oRb.getText("CONDITIONPANEL_REMOVE_ALL"),visible:true,press:function(t){e._aConditionKeys.forEach(function(e,t){if(t>=0){this.fireDataChange({key:e,index:t,operation:"remove",newData:null})}},e);this._iFirstConditionIndex=0;e.removeAllConditions()},layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.Low})});this._oAddButton=new sap.m.Button({icon:a.getIconURI("add"),tooltip:this._oRb.getText("CONDITIONPANEL_ADD"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),visible:true,press:function(t){var i=e._createConditionRow(e._oConditionsGrid,undefined,null,0);e._changeField(i);setTimeout(function(){i.keyField.focus()});e._updatePaginatorToolbar()},layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.Low})});this._oHeaderText=new sap.m.Text({wrapping:false,layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.NeverOverflow})});this._oPageText=new sap.m.Text({wrapping:false,textAlign:g.Center,layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.NeverOverflow})});this._oFilterField=new sap.m.SearchField({width:"12rem",layoutData:new sap.m.OverflowToolbarLayoutData({priority:_.High})});this._oPaginatorToolbar=new sap.m.OverflowToolbar({height:"3rem",design:f.Transparent,content:[this._oHeaderText,new sap.m.ToolbarSpacer,this._oFilterField,this._oPrevButton,this._oPageText,this._oNextButton,this._oRemoveAllButton,this._oAddButton]})};y.prototype._updatePaginatorToolbar=function(){if(this._sConditionType!=="Filter"||this.getMaxConditions()!=="-1"){return}var e=this._aConditionKeys.length;var t=1+Math.floor(Math.max(0,e-1)/this._iConditionPageSize);var i=1+Math.floor(this._iFirstConditionIndex/this._iConditionPageSize);var o=this.getParent();if(!this._oPaginatorToolbar){if(e>this._iConditionPageSize){this._createPaginatorToolbar();this.insertAggregation("content",this._oPaginatorToolbar,0);this._onGridResize()}else{if(o&&o.setHeaderText){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=o.getHeaderText()}o.setHeaderText(this._sOrgHeaderText+(e>0?" ("+e+")":""))}return}}this._oPrevButton.setEnabled(this._iFirstConditionIndex>0);this._oNextButton.setEnabled(this._iFirstConditionIndex+this._iConditionPageSize<e);if(o&&o.setHeaderToolbar){if(!o.getHeaderToolbar()){this.removeAggregation("content",this._oPaginatorToolbar);o.setHeaderToolbar(this._oPaginatorToolbar);o.attachExpand(function(e){this._setToolbarElementVisibility(e.getSource().getExpanded()&&this._bPaginatorButtonsVisible)}.bind(this))}}if(o&&o.setHeaderText){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=o.getHeaderText()}var n=this._sOrgHeaderText+(e>0?" ("+e+")":"");o.setHeaderText(n);this._oHeaderText.setText(n)}else{this._oHeaderText.setText(e+" Conditions")}this._oPageText.setText(i+"/"+t);this._bPaginatorButtonsVisible=this._bPaginatorButtonsVisible||t>1;this._setToolbarElementVisibility(this._bPaginatorButtonsVisible);if(i>t){this._iFirstConditionIndex-=Math.max(0,this._iConditionPageSize);this._clearConditions();this._fillConditions()}var a=0;this._oConditionsGrid.getContent().forEach(function(e){if(e.select.getSelected()){a++}},this);if(t==i&&e-this._iFirstConditionIndex>a){this._clearConditions();this._fillConditions()}};y.prototype._setToolbarElementVisibility=function(e){this._oPrevButton.setVisible(e);this._oNextButton.setVisible(e);this._oPageText.setVisible(e);this._oFilterField.setVisible(false);this._oAddButton.setVisible(e);this._oRemoveAllButton.setVisible(e)};y.prototype.exit=function(){this._clearConditions();this._unregisterResizeHandler();this._aConditionsFields=null;this._aKeys=null;this._aKeyFields=null;this._oTypeOperations=null;this._oRb=null;this._sFromLabelText=null;this._sToLabelText=null;this._sValueLabelText=null;this._sValidationDialogFieldMessage=null;this._oConditionsMap=null;this._aConditionKeys=[]};y.prototype._clearConditions=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){for(var t in this._aConditionsFields){var i=this._aConditionsFields[t];if(e[i["ID"]]&&e.getContent().indexOf(e[i["ID"]])===-1){e[i["ID"]].destroy()}}},this);this._oConditionsGrid.destroyContent()};y.prototype._fillConditions=function(){var e,t;var i=0,o=this._getMaxConditionsAsNumber(),n=this._aConditionKeys.length;if(this._oConditionsMap){var a=this._sConditionType!=="Filter"||this.getMaxConditions()!=="-1"?9999:this._iConditionPageSize;n=Math.min(n,Math.min(o,this._iFirstConditionIndex+a));for(i=this._iFirstConditionIndex;i<n;i++){t=this._aConditionKeys[i];e=this._oConditionsMap[t];this._createConditionRow(this._oConditionsGrid,e,t)}}this._updatePaginatorToolbar();if((this.getAutoAddNewRow()||this._oConditionsGrid.getContent().length===0)&&this._oConditionsGrid.getContent().length<o){this._createConditionRow(this._oConditionsGrid)}};y.prototype._addCondition=function(e){var t=0;var i=this._getMaxConditionsAsNumber();if(this._oConditionsMap){for(var o in this._oConditionsMap){if(t<i&&e===this._oConditionsMap[o]){this._createConditionRow(this._oConditionsGrid,e,o,t)}t++}}this._updatePaginatorToolbar()};y.prototype._getMaxConditionsAsNumber=function(){return this.getMaxConditions()==="-1"?9999:parseInt(this.getMaxConditions(),10)};y.prototype.onAfterRendering=function(){if(this.getLayoutMode()){this._sLayoutMode=this.getLayoutMode();return}};y.prototype._handleMediaChange=function(e){this._sLayoutMode=e.name;this._updateLayout(e)};y.prototype._unregisterResizeHandler=function(){if(this._sContainerResizeListener){d.deregister(this._sContainerResizeListener);this._sContainerResizeListener=null}s.media.detachHandler(this._handleMediaChange,this,s.media.RANGESETS.SAP_STANDARD)};y.prototype._registerResizeHandler=function(){if(this.getContainerQuery()){this._sContainerResizeListener=d.register(this._oConditionsGrid,e.proxy(this._onGridResize,this));this._onGridResize()}else{s.media.attachHandler(this._handleMediaChange,this,s.media.RANGESETS.SAP_STANDARD)}};y.prototype._getKeyFromConditionGrid=function(e){var t=e.data("_key");if(!t){t=this._createConditionKey()}return t};y.prototype._createConditionKey=function(){var e=0;var t;do{t="condition_"+e;if(this.getExclude()){t="x"+t}e++}while(this._oConditionsMap[t]);return t};y.prototype._createConditionRow=function(t,i,s,r){var l=null;var d;var p=this;if(r===undefined){r=t.getContent().length}var u=new c({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:1,vSpacing:0,containerQuery:this.getContainerQuery()}).data("_key",s);for(var f in this._aConditionsFields){var g;var _=this._aConditionsFields[f];switch(_["Control"]){case"CheckBox":g=new sap.m.CheckBox({enabled:false,visible:false,layoutData:new sap.ui.layout.GridData({span:_["Span"+this._sConditionType]})});if(_["ID"]==="showIfGrouped"){g.setEnabled(true);g.setText(_["Label"]);g.attachSelect(function(){p._changeField(u)});g.setSelected(i?i.showIfGrouped:true)}else{if(i){g.setSelected(true);g.setEnabled(true)}}break;case"ComboBox":if(_["ID"]==="keyField"){g=new sap.m.ComboBox({width:"100%",ariaLabelledBy:this._oInvisibleTextField});var y=e.proxy(g.setSelectedKey,g);g.setSelectedKey=function(e){y(e);var t=p.getValidationExecutor();if(t){t()}};var C=e.proxy(g.setSelectedItem,g);g.setSelectedItem=function(e){C(e);var t=p.getValidationExecutor();if(t){t()}};g.setLayoutData(new sap.ui.layout.GridData({span:_["Span"+this._sConditionType]}));this._fillKeyFieldListItems(g,this._aKeyFields);if(g.attachSelectionChange){g.attachSelectionChange(function(e){var i=p.getValidationExecutor();if(i){i()}p._handleSelectionChangeOnKeyField(t,u)})}if(g.attachChange){g.attachChange(function(e){u.keyField.close();p._handleChangeOnKeyField(t,u)})}if(g.setSelectedItem){if(i){g.setSelectedKey(i.keyField);this._aKeyFields.forEach(function(e,t){var o=e.key;if(o===undefined){o=e}if(i.keyField===o){g.setSelectedItem(g.getItems()[t])}},this)}else{if(this.getUsePrevConditionSetting()&&!this.getAutoReduceKeyFieldItems()){if(r>0&&!s){d=t.getContent()[r-1];if(d.keyField.getSelectedKey()){g.setSelectedKey(d.keyField.getSelectedKey())}else{if(!g.getSelectedItem()&&g.getItems().length>0){g.setSelectedItem(g.getItems()[0])}}}else{this._aKeyFields.some(function(e,t){if(e.isDefault){g.setSelectedItem(g.getItems()[t]);return true}if(!g.getSelectedItem()&&e.type!=="boolean"){g.setSelectedItem(g.getItems()[t])}},this);if(!g.getSelectedItem()&&g.getItems().length>0){g.setSelectedItem(g.getItems()[0])}}}else{this._aKeyFields.forEach(function(e,t){if(e.isDefault){g.setSelectedItem(g.getItems()[t])}},this)}}}}if(_["ID"]==="operation"){g=new sap.m.Select({width:"100%",ariaLabelledBy:this._oInvisibleTextOperator,layoutData:new sap.ui.layout.GridData({span:_["Span"+this._sConditionType]})});g.attachChange(function(){p._handleChangeOnOperationField(t,u)});u[_["ID"]]=g;this._updateOperationItems(t,u);if(i){var m=this._getCurrentKeyFieldItem(u.keyField);var v=this._oTypeOperations["default"];if(m){if(m.type&&this._oTypeOperations[m.type]){v=this._oTypeOperations[m.type]}if(m.operations){v=m.operations}}v.some(function(e,t){if(i.operation===e){g.setSelectedKey(e);return true}},this)}else{if(this.getUsePrevConditionSetting()){if(r>0&&s===null){var d=t.getContent()[r-1];g.setSelectedKey(d.operation.getSelectedKey())}}}}if(g.getSelectedItem&&g.getSelectedItem()){g.setTooltip(g.getSelectedItem().getTooltip()||g.getSelectedItem().getText())}break;case"TextField":var S=this._getCurrentKeyFieldItem(u.keyField);g=this._createValueField(S,_,u);g.oTargetGrid=t;if(i&&i[_["ID"]]!==undefined){var F=i[_["ID"]];var T;if(g instanceof sap.m.Select){if(typeof F==="string"&&S.type==="boolean"){F=F==="true"}if(typeof F==="boolean"){g.setSelectedIndex(F?2:1)}else{g.setSelectedItem(g.getItemByKey(F.toString()))}}else{if(typeof F==="string"&&u.oFormatter instanceof n){T=parseFloat(F);F=u.oFormatter.format(T);if(isNaN(T)){break}}if(typeof F==="string"&&u.oFormatter){T=u.oFormatter.parse(F)}else{T=F}if(!isNaN(T)&&T!==null&&u.oFormatter){F=u.oFormatter.format(T);g.setValue(F)}else{if(!T&&F&&u.oFormatter instanceof o){T=new Date(F);F=u.oFormatter.format(T);g.setValue(F)}else{g.setValue(T)}}}}break;case"Label":g=new sap.m.Label({text:_["Text"]+":",visible:this.getShowLabel(),layoutData:new sap.ui.layout.GridData({span:_["Span"+this._sConditionType]})}).addStyleClass("conditionLabel");g.oTargetGrid=t;break}u[_["ID"]]=g;u.addContent(g)}l=new sap.ui.layout.HorizontalLayout({layoutData:new sap.ui.layout.GridData({span:this.getLayoutMode()==="Desktop"?"L2 M2 S2":this._oButtonGroupSpan["Span"+this._sConditionType]})}).addStyleClass("floatRight");u.addContent(l);u["ButtonContainer"]=l;var b=new sap.m.Button({type:h.Transparent,icon:a.getIconURI("sys-cancel"),tooltip:this._oRb.getText("CONDITIONPANEL_REMOVE"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){p._handleRemoveCondition(this.oTargetGrid,u)},layoutData:new sap.ui.layout.GridData({span:this.getLayoutMode()==="Desktop"?"L1 M1 S1":"L1 M2 S2"})});b.oTargetGrid=t;l.addContent(b);u["remove"]=b;var I=new sap.m.Button({type:h.Transparent,icon:a.getIconURI("add"),tooltip:this._oRb.getText("CONDITIONPANEL_ADD"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){p._handleAddCondition(this.oTargetGrid,u)},layoutData:new sap.ui.layout.GridData({span:this.getLayoutMode()==="Desktop"?"L1 M1 S1":"L1 M10 S10"})});I.oTargetGrid=t;I.addStyleClass("conditionAddBtnFloatRight");l.addContent(I);u["add"]=I;t.insertContent(u,r);this._updateOperationItems(t,u);this._changeOperationValueFields(t,u);this._updateAllConditionsEnableStates();this._updateConditionButtons(t);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(t,false)}if(this._sLayoutMode){this._updateLayout({name:this._sLayoutMode})}if(i){var x=this._getFormatedConditionText(i.operation,i.value1,i.value2,i.exclude,i.keyField,i.showIfGrouped);i._oGrid=u;i.value=x;this._oConditionsMap[s]=i}return u};y.prototype._handleRemoveCondition=function(e,t){var i=e.getContent().indexOf(t);this._removeCondition(e,t);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(e,false)}if(i>=0){i=Math.min(i,e.getContent().length-1);var t=e.getContent()[i];setTimeout(function(){t.remove.focus()})}this._updatePaginatorToolbar()};y.prototype._handleAddCondition=function(e,t){var i=e.getContent().indexOf(t);var o=this._createConditionRow(e,undefined,null,i+1);this._changeField(o);setTimeout(function(){o.keyField.focus()});this._updatePaginatorToolbar()};y.prototype._getCurrentKeyFieldItem=function(e){if(e.getSelectedKey&&e.getSelectedKey()){var t=e.getSelectedKey();var i=this._aKeyFields;for(var o in i){var n=i[o];if(n.key===t){return n}}}return null};y.prototype._createValueField=function(t,i,a){var s;var r=t?t.type:"";var l=this;var d={value:i["Value"],width:"100%",placeholder:i["Label"],change:function(e){l._validateFormatFieldValue(e);l._changeField(a)},layoutData:new sap.ui.layout.GridData({span:i["Span"+this._sConditionType]})};switch(r){case"boolean":case"enum":var u=[];var h=t.values||this._oTypeValues[r]||["",false,true];h.forEach(function(e,t){u.push(new p({key:r==="boolean"?(t===h.length-1).toString():e.toString(),text:e.toString()}))});d={width:"100%",items:u,change:function(){l._changeField(a)},layoutData:new sap.ui.layout.GridData({span:i["Span"+this._sConditionType]})};a.oFormatter=null;s=new sap.m.Select(d);break;case"numeric":var f;if(t.precision||t.scale){f={};if(t.precision){f["maxIntegerDigits"]=parseInt(t.precision,10)}if(t.scale){f["maxFractionDigits"]=parseInt(t.scale,10)}}a.oFormatter=n.getFloatInstance(f);s=new sap.m.Input(d);break;case"date":a.oFormatter=o.getDateInstance(e.extend({},t.formatSettings,{strictParsing:true}));if(t.formatSettings&&t.formatSettings.style){d.displayFormat=t.formatSettings.style}s=new sap.m.DatePicker(d);break;case"time":a.oFormatter=o.getTimeInstance(e.extend({},t.formatSettings,{strictParsing:true}));s=new sap.m.TimePicker(d);break;case"datetime":a.oFormatter=o.getDateTimeInstance(e.extend({},t.formatSettings,{strictParsing:true}));if(t.formatSettings&&t.formatSettings.style){d.displayFormat=t.formatSettings.style}s=new sap.m.DateTimePicker(d);break;case"stringdate":a.oFormatter=new sap.m.P13nConditionStringDateFormatter(e.extend({},t.formatSettings,{strictParsing:true}));if(t.formatSettings&&t.formatSettings.style){d.displayFormat=t.formatSettings.style}s=new sap.m.DatePicker(d);break;default:if(r=="numc"){a.oFormatter={format:function(e){return this.oType.formatValue(e,"string")},parse:function(e){try{if(e===""){return""}this.oType.validateValue(e,"string")}catch(e){return NaN}return this.oType.parseValue(e,"string")},oType:new sap.ui.model.odata.type.String({},t.formatSettings)}}else{a.oFormatter=null}s=new sap.m.Input(d);if(this._fSuggestCallback){var t=this._getCurrentKeyFieldItem(a.keyField);if(t&&t.key){var g=this._fSuggestCallback(s,t.key);if(g){s._oSuggestProvider=g}}}}if(r!=="boolean"&&r!=="enum"){s.onpaste=function(e){var t;if(window.clipboardData){t=window.clipboardData.getData("Text")}else{t=e.originalEvent.clipboardData.getData("text/plain")}var i=e.srcControl.getParent();var o=t.split(/\r\n|\r|\n/g);var n=i.operation;var a=n.getSelectedKey();if(o&&o.length>1&&a!=="BT"){setTimeout(function(){var e=o?o.length:0;var t=l._getCurrentKeyFieldItem(i.keyField);var n=i.operation;for(var a=0;a<e;a++){if(l._aConditionKeys.length>=l._getMaxConditionsAsNumber()){break}if(o[a]){var s={key:l._createConditionKey(),exclude:l.getExclude(),operation:n.getSelectedKey(),keyField:t.key,value1:o[a],value2:null};l._addCondition2Map(s);l.fireDataChange({key:s.key,index:s.index,operation:"add",newData:s})}}l._clearConditions();l._fillConditions()},0)}}}if(t&&t.maxLength&&s.setMaxLength){var _=-1;if(typeof t.maxLength==="string"){_=parseInt(t.maxLength,10)}if(typeof t.maxLength==="number"){_=t.maxLength}if(_>0&&(!s.getShowSuggestion||!s.getShowSuggestion())){s.setMaxLength(_)}}return s};y.prototype._fillOperationListItems=function(t,i,o){if(o==="_STRING_"){o=""}if(o==="_TIME_"||o==="_DATETIME_"){o="_DATE_"}if(o==="_BOOLEAN_"||o==="_NUMC_"){o=""}t.destroyItems();for(var n in i){var a=this._oRb.getText("CONDITIONPANEL_OPTION"+o+i[n]);if(e.sap.startsWith(a,"CONDITIONPANEL_OPTION")){a=this._oRb.getText("CONDITIONPANEL_OPTION"+i[n])}t.addItem(new sap.ui.core.ListItem({key:i[n],text:a,tooltip:a}))}};y.prototype._fillKeyFieldListItems=function(e,t){e.destroyItems();for(var i in t){var o=t[i];e.addItem(new sap.ui.core.ListItem({key:o.key,text:o.text,tooltip:o.tooltip?o.tooltip:o.text}))}e.setEditable(e.getItems().length>1)};y.prototype._handleChangeOnOperationField=function(e,t){this._changeOperationValueFields(e,t);this._changeField(t)};y.prototype._handleSelectionChangeOnKeyField=function(e,t){if(this._sConditionType==="Filter"){this._updateOperationItems(e,t);this._createAndUpdateValueFields(e,t);this._changeOperationValueFields(e,t)}this._changeField(t)};y.prototype._handleChangeOnKeyField=function(e,t){if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(e,false,false,t.keyField)}};y.prototype._createAndUpdateAllKeyFields=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){this._createAndUpdateValueFields(this._oConditionsGrid,e);this._changeOperationValueFields(this._oConditionsGrid,e)},this)};y.prototype._createAndUpdateValueFields=function(t,i){var o=this._getCurrentKeyFieldItem(i.keyField);var n=function(e,t,i){var n=t.getValue?t.getValue():"";var a=e.indexOfContent(t);e.removeContent(t);if(t._oSuggestProvider){t._oSuggestProvider.destroy();t._oSuggestProvider=null}t.destroy();var s=this._aConditionsFields[i];t=this._createValueField(o,s,e);e[s["ID"]]=t;e.insertContent(t,a===-1?0:a);var r,l;if(e.oFormatter&&n){r=e.oFormatter.parse(n);if(!isNaN(r)&&r!==null){l=e.oFormatter.format(r);t.setValue(l)}}if(!l&&!e.oFormatter&&n){t.setValue(n)}};e.proxy(n,this)(i,i.value1,5);e.proxy(n,this)(i,i.value2,6)};y.prototype._updateAllOperations=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){this._updateOperationItems(this._oConditionsGrid,e);this._changeOperationValueFields(this._oConditionsGrid,e)},this)};y.prototype._updateOperationItems=function(e,t){var i="";var o=this._getCurrentKeyFieldItem(t.keyField);var n=t.operation;var a=this._oTypeOperations["default"];var s=n.getSelectedItem();if(o&&!this.getExclude()){if(o.type&&o.type!==""&&this._oTypeOperations[o.type]){i=o.type;a=this._oTypeOperations[i]}if(o.operations){a=o.operations}}this._fillOperationListItems(n,a,i?"_"+i.toUpperCase()+"_":"");if(s&&n.getItemByKey(s.getKey())){n.setSelectedKey(s.getKey())}else{n.setSelectedItem(n.getItems()[0])}this._sConditionType="Filter";if(a[0]===sap.m.P13nConditionOperation.Ascending||a[0]===sap.m.P13nConditionOperation.Descending){this._sConditionType="Sort"}if(a[0]===sap.m.P13nConditionOperation.GroupAscending||a[0]===sap.m.P13nConditionOperation.GroupDescending){this._sConditionType="Group"}this._adjustValue1Span(t)};y.prototype._updateKeyFieldItems=function(e,t,i,o){var n=e.getContent().length;var a;var s={};if(!t){for(a=0;a<n;a++){var r=e.getContent()[a].keyField;var l=r.getSelectedKey();if(l!=null&&l!==""){s[l]=true}}}for(a=0;a<n;a++){var r=e.getContent()[a].keyField;var d=e.getContent()[a].select;var p=r.getSelectedKey();var u=0;var h=this._aKeyFields;if(r!==o){if(i){u=h.length-1}else{r.destroyItems()}for(u;u<h.length;u++){var f=h[u];if(f.key==null||f.key===""||!s[f.key]||f.key===p){r.addItem(new sap.ui.core.ListItem({key:f.key,text:f.text,tooltip:f.tooltip?f.tooltip:f.text}))}}r.setEditable(r.getItems().length>1)}if(p){r.setSelectedKey(p)}else if(r.getItems().length>0){r.setSelectedItem(r.getItems()[0])}if(!d.getSelected()){this._aKeyFields.some(function(e,t){if(e.isDefault){r.setSelectedItem(r.getItems()[t]);return true}if(!r.getSelectedItem()){if(e.type!=="boolean"){r.setSelectedItem(r.getItems()[t])}}},this)}if(r.getSelectedItem()){r.setTooltip(r.getSelectedItem().getTooltip()||r.getSelectedItem().getText())}}};y.prototype._changeOperationValueFields=function(e,t){var i=t.operation;var o=i.getSelectedKey();var n=t.value1;var a=t.value2;var s=t.showIfGrouped;if(!o){return}if(o===sap.m.P13nConditionOperation.BT){if(n.setPlaceholder&&n.getPlaceholder()!==this._sFromLabelText){n.setPlaceholder(this._sFromLabelText)}if(!n.getVisible()){n.setVisible(true);t.insertContent(n,t.getContent().length-1)}if(a.setPlaceholder&&a.getPlaceholder()!==this._sToLabelText){a.setPlaceholder(this._sToLabelText)}if(!a.getVisible()){a.setVisible(true);t.insertContent(a,t.getContent().length-1)}}else{if(o===sap.m.P13nConditionOperation.GroupAscending||o===sap.m.P13nConditionOperation.GroupDescending){if(n.getVisible()){n.setVisible(false);t.removeContent(n)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}if(i.getVisible()){i.setVisible(false);t.removeContent(i)}s.setVisible(this._getMaxConditionsAsNumber()!=1)}else{if(o===sap.m.P13nConditionOperation.NotEmpty||o===sap.m.P13nConditionOperation.Empty||o===sap.m.P13nConditionOperation.Initial||o===sap.m.P13nConditionOperation.Ascending||o===sap.m.P13nConditionOperation.Descending||o===sap.m.P13nConditionOperation.Total||o===sap.m.P13nConditionOperation.Average||o===sap.m.P13nConditionOperation.Minimum||o===sap.m.P13nConditionOperation.Maximum){if(n.getVisible()){n.setVisible(false);t.removeContent(n)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}t.removeContent(s)}else{if(n.setPlaceholder&&n.getPlaceholder()!==this._sValueLabelText){n.setPlaceholder(this._sValueLabelText)}if(!n.getVisible()){n.setVisible(true);t.insertContent(n,t.getContent().length-1)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}}}}this._adjustValue1Span(t)};y.prototype._adjustValue1Span=function(e){if(this._sConditionType==="Filter"&&e.value1&&e.operation){var t=e.operation;var i=this._aConditionsFields[5]["Span"+this._sConditionType];if(t.getSelectedKey()!=="BT"){i="L5 M10 S10"}var o=e.value1.getLayoutData();if(o.getSpan()!==i){o.setSpan(i)}}};y.prototype._getIndexOfCondition=function(e){var t=-1;e.getParent().getContent().some(function(i){if(i.select.getSelected()){t++}return i===e},this);return t+this._iFirstConditionIndex};y.prototype._makeFieldValid=function(e,t){if(t){e.setValueState(u.None);e.setValueStateText("")}else{e.setValueState(u.Warning);e.setValueStateText(this._sValidationDialogFieldMessage)}};y.prototype._validateFormatFieldValue=function(e){var t=e.oSource;var i=t.getParent();var o;if(t.getDateValue&&e){o=e.getParameter("value");var n=e.getParameter("valid");this._makeFieldValid(t,n);return}else{o=t.getValue&&t.getValue()}if(!i){return}if(this.getDisplayFormat()==="UpperCase"&&o){o=o.toUpperCase();t.setValue(o)}if(i.oFormatter&&o){var a=i.oFormatter.parse(o);var n=!isNaN(a)&&a!==null;this._makeFieldValid(t,n);if(n){o=i.oFormatter.format(a);t.setValue(o)}}else{this._makeFieldValid(t,true)}};y.prototype._changeField=function(e,t){var i=e.keyField.getSelectedKey();if(e.keyField.getSelectedItem()){e.keyField.setTooltip(e.keyField.getSelectedItem().getTooltip()||e.keyField.getSelectedItem().getText())}else{e.keyField.setTooltip(null)}var o=e.operation.getSelectedKey();if(e.operation.getSelectedItem()){e.operation.setTooltip(e.operation.getSelectedItem().getTooltip()||e.operation.getSelectedItem().getText())}else{e.operation.setTooltip(null)}var n=this._getValueTextFromField(e.value1,e.oFormatter);var a=n;if(e.oFormatter&&n){a=e.oFormatter.parse(n);if(isNaN(a)||a===null){n=""}}if(o==="BT"&&e.value1.setMinDate){if(e.value2&&e.value2.setMinDate){e.value2.setMinDate(a instanceof Date?a:null)}}var s=this._getValueTextFromField(e.value2,e.oFormatter);var r=s;if(e.oFormatter&&s){r=e.oFormatter.parse(s);if(isNaN(r)||r===null){s=""}}var l=this._getCurrentKeyFieldItem(e.keyField);var d=l?l.type:"";if(d==="boolean"){var p=l.values||this._oTypeValues[d]||["",false,true];var u=p[p.length-1].toString();a=n===u;r=null}if(l&&l.type==="numc"){if([sap.m.P13nConditionOperation.Contains,sap.m.P13nConditionOperation.EndsWith].indexOf(o)!=-1){a=e.oFormatter.format(a)}}var h=e.showIfGrouped.getSelected();var f=this.getExclude();var g=e.select;var _="";var c;if(i===""||i==null){i=null;c=this._getKeyFromConditionGrid(e);this._removeConditionFromMap(c);this._enableCondition(e,false);var y=this._getIndexOfCondition(e);if(g.getSelected()){g.setSelected(false);g.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:c,index:y,operation:"remove",newData:null});this._bIgnoreSetConditions=false}return}this._enableCondition(e,true);_=this._getFormatedConditionText(o,n,s,f,i,h);var C={value:_,exclude:f,operation:o,keyField:i,value1:a,value2:o===sap.m.P13nConditionOperation.BT?r:null,showIfGrouped:h};c=this._getKeyFromConditionGrid(e);if(_!==""){g.setSelected(true);g.setEnabled(true);var o="update";if(!this._oConditionsMap[c]){o="add"}this._oConditionsMap[c]=C;if(o==="add"){this._aConditionKeys.splice(this._getIndexOfCondition(e),0,c)}e.data("_key",c);this.fireDataChange({key:c,index:this._getIndexOfCondition(e),operation:o,newData:C})}else if(this._oConditionsMap[c]!==undefined){this._removeConditionFromMap(c);e.data("_key",null);var y=this._getIndexOfCondition(e);if(g.getSelected()){g.setSelected(false);g.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:c,index:y,operation:"remove",newData:null});this._bIgnoreSetConditions=false}}this._updatePaginatorToolbar()};y.prototype._getValueTextFromField=function(e,t){if(e.getDateValue&&e.getDateValue()){return t.format(e.getDateValue())}if(e instanceof sap.m.Select){return e.getSelectedItem()?e.getSelectedItem().getText():""}return e.getValue()};y.prototype._updateAllConditionsEnableStates=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){var t=this._getCurrentKeyFieldItem(e.keyField);var i=t&&t.key!==undefined?t.key:t;var o=i!==""&&i!==null;this._enableCondition(e,o)},this)};y.prototype._enableCondition=function(e,t){e.operation.setEnabled(t);e.value1.setEnabled(t);e.value2.setEnabled(t);e.showIfGrouped.setEnabled(t)};y.prototype._removeCondition=function(e,t){var i=this._getKeyFromConditionGrid(t);var o=-1;if(t.select.getSelected()){o=this._getIndexOfCondition(t)}this._removeConditionFromMap(i);t.destroy();if(e.getContent().length<1){this._createConditionRow(e)}else{this._updateConditionButtons(e)}if(o>=0){this.fireDataChange({key:i,index:o,operation:"remove",newData:null})}};y.prototype._updateConditionButtons=function(e){var t=this._getMaxConditionsAsNumber();var i=e.getContent().length;for(var o=0;o<i;o++){var n=e.getContent()[o].add;if(this.getAlwaysShowAddIcon()&&i<t||o===i-1&&o<t-1){n.removeStyleClass("displayNone")}else{n.addStyleClass("displayNone")}var a=e.getContent()[o].remove;if(t===1||o===0&&i===1&&this.getDisableFirstRemoveIcon()){a.addStyleClass("displayNone")}else{a.removeStyleClass("displayNone")}}};y.prototype.validateConditions=function(){var e=this;var t=function(t){var i=true;for(var o=0;o<t.length;o++){var n=t[o];var a=e._checkCondition(n,o===t.length-1);i=i&&a}return i};return t(this._oConditionsGrid.getContent())};y.prototype.removeValidationErrors=function(){this._oConditionsGrid.getContent().forEach(function(e){var t=e.value1;var i=e.value2;t.setValueState(u.None);t.setValueStateText("");i.setValueState(u.None);i.setValueStateText("")},this)};y.prototype.removeInvalidConditions=function(){var e=[];this._oConditionsGrid.getContent().forEach(function(t){if(t.value1.getValueState()!==u.None||t.value2.getValueState()!==u.None){e.push(t)}},this);e.forEach(function(e){this._removeCondition(this._oConditionsGrid,e);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(this._oConditionsGrid,false)}},this)};y.prototype._checkCondition=function(e,t){var i=true;var o=e.value1;var n=e.value2;var a=o&&(o.getVisible()&&!this._getValueTextFromField(o,e.oFormatter));var s=o&&o.getVisible()&&o.getValueState?o.getValueState():u.None;var r=n&&(n.getVisible()&&!this._getValueTextFromField(n,e.oFormatter));var l=n&&n.getVisible()&&n.getValueState?n.getValueState():u.None;var d=e.operation.getSelectedKey();if(d===sap.m.P13nConditionOperation.BT){if(!a?r:!r){if(a){o.setValueState(u.Warning);o.setValueStateText(this._sValidationDialogFieldMessage)}if(r){n.setValueState(u.Warning);n.setValueStateText(this._sValidationDialogFieldMessage)}i=false}else if(s!==u.None||l!==u.None){i=false}else{o.setValueState(u.None);o.setValueStateText("");n.setValueState(u.None);n.setValueStateText("")}}if(o.getVisible()&&o.getValueState&&o.getValueState()!==u.None||n.getVisible()&&n.getValueState&&n.getValueState()!==u.None){i=false}return i};y.prototype._getFormatedConditionText=function(e,t,i,o,n,a){var s="";var r=null;if(this._aKeyFields&&this._aKeyFields.length>1){for(var l=0;l<this._aKeyFields.length;l++){var d=this._aKeyFields[l];if(typeof d!=="string"){if(d.key===n&&d.text){r=d.text}}}}switch(e){case sap.m.P13nConditionOperation.EQ:if(t!==""&&t!==undefined){s="="+t}break;case sap.m.P13nConditionOperation.GT:if(t!==""&&t!==undefined){s=">"+t}break;case sap.m.P13nConditionOperation.GE:if(t!==""&&t!==undefined){s=">="+t}break;case sap.m.P13nConditionOperation.LT:if(t!==""&&t!==undefined){s="<"+t}break;case sap.m.P13nConditionOperation.LE:if(t!==""&&t!==undefined){s="<="+t}break;case sap.m.P13nConditionOperation.Contains:if(t!==""&&t!==undefined){s="*"+t+"*"}break;case sap.m.P13nConditionOperation.StartsWith:if(t!==""&&t!==undefined){s=t+"*"}break;case sap.m.P13nConditionOperation.EndsWith:if(t!==""&&t!==undefined){s="*"+t}break;case sap.m.P13nConditionOperation.BT:if(t!==""&&t!==undefined){if(i!==""){s=t+"..."+i}}break;case sap.m.P13nConditionOperation.Initial:s="=''";break;case sap.m.P13nConditionOperation.Empty:s="''";break;case sap.m.P13nConditionOperation.NotEmpty:s="!''";break;case sap.m.P13nConditionOperation.Ascending:s="ascending";break;case sap.m.P13nConditionOperation.GroupAscending:s="ascending";s+=" showIfGrouped:"+a;break;case sap.m.P13nConditionOperation.Descending:s="descending";break;case sap.m.P13nConditionOperation.GroupDescending:s="descending";s+=" showIfGrouped:"+a;break;case sap.m.P13nConditionOperation.Total:s="total";break;case sap.m.P13nConditionOperation.Average:s="average";break;case sap.m.P13nConditionOperation.Minimum:s="minimum";break;case sap.m.P13nConditionOperation.Maximum:s="maximum";break}if(o&&s!==""){s="!("+s+")"}if(r&&s!==""){s=r+": "+s}return s};y.prototype._updateLayout=function(e){if(!this._oConditionsGrid){return}var t=this._oConditionsGrid.getContent();var i=this._aConditionsFields.length;var o=i;if(e.name==="Tablet"){o=5}if(e.name==="Phone"){o=3}if(this._sConditionType==="Filter"){for(var n=0;n<t.length;n++){var a=t[n];a.ButtonContainer.removeStyleClass("floatRight");a.removeContent(a.ButtonContainer);a.insertContent(a.ButtonContainer,o);if(!this.getAlwaysShowAddIcon()){if(o!==i){a.ButtonContainer.removeContent(a.add);a.addContent(a.add)}else{a.removeContent(a.add);a.ButtonContainer.addContent(a.add)}}}}};y.prototype._onGridResize=function(){if(this._oPaginatorToolbar&&this._oConditionsGrid&&this._oConditionsGrid.getContent().length>0){var t=this._oConditionsGrid.getContent()[0];if(t.remove&&t.remove.$().position()){var i=0;if(this._oPaginatorToolbar.getParent()&&this._oPaginatorToolbar.getParent().getExpandable&&this._oPaginatorToolbar.getParent().getExpandable()){i=48-4}var o=t.remove.$().position().left-i+t.remove.$().width();this._oPaginatorToolbar.setWidth(o+"px")}}var n=this._oConditionsGrid.getDomRef();if(!n){return}if(!e(n).is(":visible")){return}var i=n.clientWidth;var a={};if(i<=this._iBreakPointTablet){a.name="Phone"}else if(i>this._iBreakPointTablet&&i<=this._iBreakPointDesktop){a.name="Tablet"}else{a.name="Desktop"}if(a.name==="Phone"&&this._sLayoutMode!==a.name){this._updateLayout(a);this._sLayoutMode=a.name}if(a.name==="Tablet"&&this._sLayoutMode!==a.name){this._updateLayout(a);this._sLayoutMode=a.name}if(a.name==="Desktop"&&this._sLayoutMode!==a.name){this._updateLayout(a);this._sLayoutMode=a.name}};sap.m.P13nConditionOperation={BT:"BT",EQ:"EQ",Contains:"Contains",StartsWith:"StartsWith",EndsWith:"EndsWith",LT:"LT",LE:"LE",GT:"GT",GE:"GE",Initial:"Initial",Empty:"Empty",NotEmpty:"NotEmpty",Ascending:"Ascending",Descending:"Descending",GroupAscending:"GroupAscending",GroupDescending:"GroupDescending",Total:"Total",Average:"Average",Minimum:"Minimum",Maximum:"Maximum"};sap.m.P13nConditionStringDateFormatter=function(t){t=e.extend({},t,{UTC:false});this.parseFormatter=o.getDateInstance({UTC:false,pattern:"yyyyMMdd"});this.displayFormatter=o.getDateInstance(t);this.format=function(e){if(e===null||e===undefined||e==""){return null}if(!(e instanceof Date)){e=this.parseFormatter.parse(e)}return this.displayFormatter.format(e)};this.parse=function(e){if(e!=null&&e!=""){var t=this.parseFormatter.parse(e,true);if(t){e=this.parseFormatter.format(t);return e}}return null}};return y});