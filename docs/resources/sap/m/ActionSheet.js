/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Dialog","./Popover","./library","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/core/InvisibleText","sap/ui/base/ManagedObject","sap/ui/Device","./ActionSheetRenderer"],function(t,e,n,i,o,s,a,r,p,l){"use strict";var h=i.ButtonType;var u=i.DialogType;var c=i.PlacementType;var f=o.extend("sap.m.ActionSheet",{metadata:{library:"sap.m",properties:{placement:{type:"sap.m.PlacementType",group:"Appearance",defaultValue:c.Bottom},showCancelButton:{type:"boolean",group:"Appearance",defaultValue:true},cancelButtonText:{type:"string",group:"Appearance",defaultValue:null},title:{type:"string",group:"Appearance",defaultValue:null}},aggregations:{buttons:{type:"sap.m.Button",multiple:true,singularName:"button"},_cancelButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_invisibleAriaTexts:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"}},defaultAggregation:"buttons",events:{cancelButtonTap:{deprecated:true},beforeOpen:{},afterOpen:{},beforeClose:{origin:{type:"sap.m.Button"}},afterClose:{origin:{type:"sap.m.Button"}},cancelButtonPress:{}},designtime:"sap/m/designtime/ActionSheet.designtime"}});f.prototype.init=function(){this._fnOrientationChange=this._orientationChange.bind(this)};f.prototype.exit=function(){p.resize.detachHandler(this._fnOrientationChange);if(this._parent){this._parent.destroy();this._parent=null}if(this._oCancelButton){this._oCancelButton.destroy();this._oCancelButton=null}this._clearItemNavigation()};f.prototype._clearItemNavigation=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation}};f.prototype._setItemNavigation=function(){var t=this._getAllButtons(),e=[],n=this.getDomRef();if(n){this._oItemNavigation.setRootDomRef(n);for(var i=0;i<t.length;i++){if(t[i].getEnabled()&&t[i].getVisible()){e.push(t[i].getFocusDomRef())}}if(this._oCancelButton){e.push(this._oCancelButton.getFocusDomRef())}this._oItemNavigation.setItemDomRefs(e);this._oItemNavigation.setSelectedIndex(0);this._oItemNavigation.setPageSize(5);this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"]})}};f.prototype.onBeforeRendering=function(){this._clearItemNavigation()};f.prototype.onAfterRendering=function(){this._oItemNavigation=new s;this._oItemNavigation.setCycling(false);this.addDelegate(this._oItemNavigation);this._setItemNavigation()};f.prototype.sapfocusleave=function(){this.close()};f.prototype.openBy=function(i){var o=this;if(!this._parent){var s=this.getParent();if(s){this.setParent(null)}if(!p.system.phone){this._parent=new n({placement:this.getPlacement(),showHeader:false,content:[this],beforeOpen:function(){o.fireBeforeOpen()},afterOpen:function(){o.focus();o.fireAfterOpen()},beforeClose:function(){o.fireBeforeClose()},afterClose:function(){if(o.getShowCancelButton()){o.fireCancelButtonTap();o.fireCancelButtonPress()}o.fireAfterClose()},ariaLabelledBy:this.getPopupHiddenLabelId()||undefined}).addStyleClass("sapMActionSheetPopover");if(p.browser.internet_explorer){this._parent._fnAdjustPositionAndArrow=t.proxy(function(){n.prototype._adjustPositionAndArrow.apply(this);var e=this.$(),i=e.children(".sapMPopoverCont")[0].getBoundingClientRect().width;t.each(e.find(".sapMActionSheet > .sapMBtn"),function(e,n){var o=t(n),s;o.css("width","");s=n.getBoundingClientRect().width;if(s<=i){o.css("width","100%")}})},this._parent)}}else{this._parent=new e({title:this.getTitle(),type:u.Standard,content:[this],beforeOpen:function(){o.fireBeforeOpen()},afterOpen:function(){o.focus();o.fireAfterOpen()},beforeClose:function(t){o.fireBeforeClose({origin:t.getParameter("origin")})},afterClose:function(t){o.fireAfterClose({origin:t.getParameter("origin")});p.resize.detachHandler(o._fnOrientationChange)}}).addStyleClass("sapMActionSheetDialog");if(this.getTitle()){this._parent.addStyleClass("sapMActionSheetDialogWithTitle")}else{this._parent.addAriaLabelledBy(this.getPopupHiddenLabelId()||undefined)}if(!p.system.phone){this._parent.setBeginButton(this._getCancelButton())}if(p.system.phone){this._parent.oPopup.setModal(true);this._parent._setDimensions=function(){e.prototype._setDimensions.apply(this);this.$("cont").css("max-height","")};this._parent._adjustScrollingPane=function(){var t=this.$().height();this.$("cont").css("max-height",t);if(this._oScroller){this._oScroller.refresh()}}}}if(s){s.addDependent(this._parent)}}if(!p.system.phone){this._parent.openBy(i)}else{this._parent.open();p.resize.attachHandler(this._fnOrientationChange)}};f.prototype.close=function(t){if(this._parent){this._parent.close()}};f.prototype.isOpen=function(t){return!!this._parent&&this._parent.isOpen()};f.prototype._createCancelButton=function(){if(!this._oCancelButton){var t=this.getCancelButtonText()?this.getCancelButtonText():sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("ACTIONSHEET_CANCELBUTTON_TEXT"),e=this;this._oCancelButton=new sap.m.Button(this.getId()+"-cancelBtn",{text:t,type:h.Reject,press:function(){if(p.system.phone&&e._parent){e._parent._oCloseTrigger=this}e.close();e.fireCancelButtonTap();e.fireCancelButtonPress()}}).addStyleClass("sapMActionSheetButton sapMActionSheetCancelButton sapMBtnTransparent sapMBtnInverted");if(p.system.phone){this.setAggregation("_cancelButton",this._oCancelButton,true)}}return this};f.prototype._getCancelButton=function(){if(p.system.phone&&this.getShowCancelButton()){this._createCancelButton();return this._oCancelButton}return null};f.prototype.setCancelButtonText=function(t){this.setProperty("cancelButtonText",t,true);if(this._oCancelButton){this._oCancelButton.setText(t)}return this};f.prototype._preProcessActionButton=function(t){var e=t.getType();if(e!==h.Accept&&e!==h.Reject){t.setType(h.Transparent)}t.addStyleClass("sapMBtnInverted");this._parent&&this._parent.invalidate();return this};f.prototype.setShowCancelButton=function(t){if(this._parent){if(p.system.phone){this.setProperty("showCancelButton",t,false)}}else{this.setProperty("showCancelButton",t,true)}return this};f.prototype.setTitle=function(t){this.setProperty("title",t,true);if(this._parent&&p.system.phone){this._parent.setTitle(t);this._parent.toggleStyleClass("sapMDialog-NoHeader",!t)}if(this._parent){if(t){this._parent.addStyleClass("sapMActionSheetDialogWithTitle")}else{this._parent.removeStyleClass("sapMActionSheetDialogWithTitle")}}return this};f.prototype.setPlacement=function(t){this.setProperty("placement",t,true);if(!p.system.phone){if(this._parent){this._parent.setPlacement(t)}}return this};f.prototype._buttonSelected=function(){if(p.system.phone&&this._parent){this._parent._oCloseTrigger=this}this.close()};f.prototype._orientationChange=function(){this._parent._adjustScrollingPane()};f.prototype._addAriaHiddenTexts=function(t){var e=t.getId(),n;if(sap.ui.getCore().getConfiguration().getAccessibility()){n=new a(e+"-actionSheetHiddenText");this.addAggregation("_invisibleAriaTexts",n,false);t.addAriaLabelledBy(n.getId())}};f.prototype._removeAriaHiddenTexts=function(t){t.getAriaLabelledBy().forEach(function(e){var n=sap.ui.getCore().byId(e);if(n instanceof a&&e.indexOf("actionSheetHiddenText")>-1){this.removeAggregation("_invisibleAriaTexts",n,false);t.removeAriaLabelledBy(n);n.destroy()}},this)};f.prototype.addButton=function(t){this.addAggregation("buttons",t,false);this._addAriaHiddenTexts(t);this._preProcessActionButton(t);t.attachPress(this._buttonSelected,this);return this};f.prototype.insertButton=function(t,e){this.insertAggregation("buttons",t,e,false);this._addAriaHiddenTexts(t);this._preProcessActionButton(t);t.attachPress(this._buttonSelected,this);return this};f.prototype.removeButton=function(t){var e=this.removeAggregation("buttons",t,false);if(e){e.detachPress(this._buttonSelected,this);this._removeAriaHiddenTexts(e)}return e};f.prototype.removeAllButtons=function(){var e=this.removeAllAggregation("buttons",false),n=this;t.each(e,function(t,e){e.detachPress(n._buttonSelected,n);n._removeAriaHiddenTexts(e)});return e};f.prototype.clone=function(){var t=this.getButtons();for(var e=0;e<t.length;e++){t[e].detachPress(this._buttonSelected,this)}var n=o.prototype.clone.apply(this,arguments);for(var i=0;i<t.length;i++){t[i].attachPress(this._buttonSelected,this)}return n};f.prototype._getAllButtons=function(){return this.getButtons()};f.prototype.getPopupHiddenLabelId=function(){return a.getStaticId("sap.m","ACTIONSHEET_AVAILABLE_ACTIONS")};f.prototype._applyContextualSettings=function(){r.prototype._applyContextualSettings.call(this,r._defaultContextualSettings)};return f});