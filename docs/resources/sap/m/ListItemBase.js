/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/base/events/KeyCodes","sap/ui/model/BindingMode","sap/ui/Device","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Icon","./library","./Button","./CheckBox","./RadioButton","./ListItemBaseRenderer"],function(t,e,i,s,o,n,r,a,l,c,h,u){"use strict";var p=a.ListKeyboardMode;var d=a.ListMode;var g=a.ListType;var f=a.ButtonType;var y=o.extend("sap.m.ListItemBase",{metadata:{library:"sap.m",properties:{type:{type:"sap.m.ListType",group:"Misc",defaultValue:g.Inactive},visible:{type:"boolean",group:"Appearance",defaultValue:true},unread:{type:"boolean",group:"Misc",defaultValue:false},selected:{type:"boolean",defaultValue:false},counter:{type:"int",group:"Misc",defaultValue:null},highlight:{type:"sap.ui.core.MessageType",group:"Appearance",defaultValue:"None"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{tap:{deprecated:true},detailTap:{deprecated:true},press:{},detailPress:{}},designtime:"sap/m/designtime/ListItemBase.designtime"}});y.getAccessibilityText=function(e,i){if(!e||!e.getVisible||!e.getVisible()){return""}var s;if(e.getAccessibilityInfo){s=e.getAccessibilityInfo()}if(!s||!e.getAccessibilityInfo){s=this.getDefaultAccessibilityInfo(e.getDomRef())}s=t.extend({type:"",description:"",children:[]},s);var o=sap.ui.getCore().getLibraryResourceBundle("sap.m"),n=s.type+" "+s.description+" ",r=e.getTooltip_AsString();if(s.enabled===false){n+=o.getText("CONTROL_DISABLED")+" "}if(s.editable===false){n+=o.getText("CONTROL_READONLY")+" "}if(!s.type&&r&&n.indexOf(r)==-1){n=r+" "+n}s.children.forEach(function(t){n+=y.getAccessibilityText(t)+" "});n=n.trim();if(i&&!n){n=o.getText("CONTROL_EMPTY")}return n};y.getDefaultAccessibilityInfo=function(t){if(!t){return null}var e=window.Node,i=window.NodeFilter,s=document.createTreeWalker(t,i.SHOW_TEXT+i.SHOW_ELEMENT,function(t){if(t.type===e.ELEMENT_NODE){if(t.classList.contains("sapUiInvisibleText")){return i.FILTER_SKIP}if(t.getAttribute("aria-hidden")=="true"||t.style.visibility=="hidden"||t.style.display=="none"){return i.FILTER_REJECT}return i.FILTER_SKIP}return i.FILTER_ACCEPT},false);var o=[];while(s.nextNode()){var n=s.currentNode;if(n.nodeType===e.TEXT_NODE){var r=(n.nodeValue||"").trim();if(r){o.push(r)}}}return{description:o.join(" ")}};y.prototype.DetailIconURI=n.getIconURI("edit");y.prototype.DeleteIconURI=n.getIconURI("sys-cancel");y.prototype.NavigationIconURI=n.getIconURI("slim-arrow-right");y.prototype.TagName="li";y.prototype.init=function(){this._active=false;this._bGroupHeader=false;this._bNeedsHighlight=false};y.prototype.onAfterRendering=function(){this.informList("DOMUpdate",true);this._checkHighlight()};y.prototype.getBindingContextPath=function(t){var e=this.getList();if(e&&!t){t=(e.getBindingInfo("items")||{}).model}var i=this.getBindingContext(t);if(i){return i.getPath()}};y.prototype.isSelectedBoundTwoWay=function(){var t=this.getBinding("selected");if(t&&t.getBindingMode()==i.TwoWay){return true}};y.prototype.getList=function(){var t=this.getParent();if(t&&t.isA("sap.m.ListBase")){return t}};y.prototype.getListProperty=function(e,i){var s=this.getList();if(s){e=t.sap.charToUpperCase(e);return s["get"+e]()}return i};y.prototype.informList=function(t,e,i){var s=this.getList();if(s){var o="onItem"+t;if(s[o]){s[o](this,e,i)}}};y.prototype.informSelectedChange=function(t){var e=this.getList();if(e){e.onItemSelectedChange(this,t);this.bSelectedDelayed=undefined}else{this.bSelectedDelayed=t}};y.prototype.getAccessibilityType=function(t){return t.getText("ACC_CTR_TYPE_OPTION")};y.prototype.getGroupAnnouncement=function(){return this.$().prevAll(".sapMGHLI:first").text()};y.prototype.getAccessibilityDescription=function(t){var e=[],i=this.getType(),s=this.getHighlight(),o=this.getTooltip_AsString();if(this.getSelected()){e.push(t.getText("LIST_ITEM_SELECTED"))}if(s!="None"){e.push(t.getText("LIST_ITEM_STATE_"+s.toUpperCase()))}if(this.getUnread()&&this.getListProperty("showUnread")){e.push(t.getText("LIST_ITEM_UNREAD"))}if(this.getCounter()){e.push(t.getText("LIST_ITEM_COUNTER",this.getCounter()))}if(i==g.Navigation){e.push(t.getText("LIST_ITEM_NAVIGATION"))}else{if(i==g.Detail||i==g.DetailAndActive){e.push(t.getText("LIST_ITEM_DETAIL"))}if(i==g.Active||i==g.DetailAndActive){e.push(t.getText("LIST_ITEM_ACTIVE"))}}e.push(this.getGroupAnnouncement()||"");if(this.getContentAnnouncement){e.push((this.getContentAnnouncement(t)||"").trim())}if(o){e.push(o)}return e.join(" ")};y.prototype.getAccessibilityInfo=function(){var t=sap.ui.getCore().getLibraryResourceBundle("sap.m");return{type:this.getAccessibilityType(t),description:this.getAccessibilityDescription(t),focusable:true}};y.prototype.getMode=function(){return this.getListProperty("mode","")};y.prototype.updateAccessibilityState=function(e){var i=this.$();if(!i.length){return}var s=i.parent().children(".sapMLIB");i.attr(t.extend({"aria-setsize":s.length,"aria-posinset":s.index(i)+1},e))};y.prototype.getDeleteControl=function(t){if(!t||this._oDeleteControl){return this._oDeleteControl}this._oDeleteControl=new l({id:this.getId()+"-imgDel",icon:this.DeleteIconURI,type:f.Transparent,tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("LIST_ITEM_DELETE")}).addStyleClass("sapMLIBIconDel sapMLIBSelectD").setParent(this,null,true).attachPress(function(t){this.informList("Delete")},this);this._oDeleteControl._bExcludeFromTabChain=true;return this._oDeleteControl};y.prototype.getDetailControl=function(t){if(!t||this._oDetailControl){return this._oDetailControl}this._oDetailControl=new l({id:this.getId()+"-imgDet",icon:this.DetailIconURI,type:f.Transparent,tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("LIST_ITEM_EDIT")}).addStyleClass("sapMLIBType sapMLIBIconDet").setParent(this,null,true).attachPress(function(){this.fireDetailTap();this.fireDetailPress()},this);this._oDetailControl._bExcludeFromTabChain=true;return this._oDetailControl};y.prototype.getNavigationControl=function(t){if(!t||this._oNavigationControl){return this._oNavigationControl}this._oNavigationControl=new r({id:this.getId()+"-imgNav",src:this.NavigationIconURI,useIconTooltip:false,noTabStop:true}).setParent(this,null,true).addStyleClass("sapMLIBType sapMLIBImgNav");return this._oNavigationControl};y.prototype.getSingleSelectControl=function(t){if(!t||this._oSingleSelectControl){t&&this._oSingleSelectControl.setSelected(this.getSelected());return this._oSingleSelectControl}this._oSingleSelectControl=new h({id:this.getId()+"-selectSingle",groupName:this.getListProperty("id")+"_selectGroup",activeHandling:false,selected:this.getSelected()}).addStyleClass("sapMLIBSelectS").setParent(this,null,true).setTabIndex(-1).attachSelect(function(t){var e=t.getParameter("selected");this.setSelected(e);this.informList("Select",e)},this);return this._oSingleSelectControl};y.prototype.getMultiSelectControl=function(t){if(!t||this._oMultiSelectControl){t&&this._oMultiSelectControl.setSelected(this.getSelected());return this._oMultiSelectControl}this._oMultiSelectControl=new c({id:this.getId()+"-selectMulti",activeHandling:false,selected:this.getSelected()}).addStyleClass("sapMLIBSelectM").setParent(this,null,true).setTabIndex(-1).attachSelect(function(t){var e=t.getParameter("selected");this.setSelected(e);this.informList("Select",e)},this);return this._oMultiSelectControl};y.prototype.getModeControl=function(t){var e=this.getMode();if(!e||e==d.None){return}if(e==d.Delete){return this.getDeleteControl(t)}if(e==d.MultiSelect){return this.getMultiSelectControl(t)}return this.getSingleSelectControl(t)};y.prototype.getTypeControl=function(t){var e=this.getType();if(e==g.Detail||e==g.DetailAndActive){return this.getDetailControl(t)}if(e==g.Navigation){return this.getNavigationControl(t)}};y.prototype.destroyControls=function(t){t.forEach(function(t){t="_o"+t+"Control";if(this[t]){this[t].destroy("KeepDom");this[t]=null}},this)};y.prototype.isActionable=function(){return this.getListProperty("includeItemInSelection")||this.getMode()==d.SingleSelectMaster||this.getType()!=g.Inactive&&this.getType()!=g.Detail};y.prototype.exit=function(){this._oLastFocused=null;this._checkHighlight(false);this.setActive(false);this.destroyControls(["Delete","SingleSelect","MultiSelect","Detail","Navigation"])};y.prototype.isSelectable=function(){var t=this.getMode();return!(t==d.None||t==d.Delete)};y.prototype.getSelected=function(){if(this.isSelectable()){return this.getProperty("selected")}return false};y.prototype.isSelected=y.prototype.getSelected;y.prototype.setSelected=function(t,e){t=this.validateProperty("selected",t);if(!this.isSelectable()||t==this.getSelected()){return this}if(!e){this.informSelectedChange(t)}var i=this.getModeControl();if(i){i.setSelected(t)}this.updateSelectedDOM(t,this.$());this.setProperty("selected",t,true);return this};y.prototype.updateSelectedDOM=function(t,e){e.toggleClass("sapMLIBSelected",t);e.attr("aria-selected",t)};y.prototype.setParent=function(t){o.prototype.setParent.apply(this,arguments);if(!t){this._bGroupHeader=false;return}this.informList("Inserted",this.bSelectedDelayed);return this};y.prototype.setBindingContext=function(){o.prototype.setBindingContext.apply(this,arguments);this.informList("BindingContextSet");return this};y.prototype.isGroupHeader=function(){return this._bGroupHeader};y.prototype.isIncludedIntoSelection=function(){var t=this.getMode();return t==d.SingleSelectMaster||this.getListProperty("includeItemInSelection")&&(t==d.SingleSelectLeft||t==d.SingleSelect||t==d.MultiSelect)};y.prototype._checkHighlight=function(t){if(t==undefined){t=this.getVisible()&&this.getHighlight()!="None"}if(this._bNeedsHighlight!=t){this._bNeedsHighlight=t;this.informList("HighlightChange",t)}};y.prototype.hasActiveType=function(){var t=this.getType();return t==g.Active||t==g.Navigation||t==g.DetailAndActive};y.prototype.setActive=function(t){if(t==this._active){return this}if(t&&this.getListProperty("activeItem")){return this}var e=this.$();this._active=t;this._activeHandling(e);if(this.getType()==g.Navigation){this._activeHandlingNav(e)}if(t){this._activeHandlingInheritor(e)}else{this._inactiveHandlingInheritor(e)}this.informList("ActiveChange",t)};y.prototype.ontap=function(e){if(this._eventHandledByControl){return e.setMarked()}var i=window.getSelection().toString().replace("\n","");if(i){return}if(this.isIncludedIntoSelection()){if(this.getMode()==d.MultiSelect){this.setSelected(!this.getSelected());this.informList("Select",this.getSelected())}else if(!this.getSelected()){this.setSelected(true);this.informList("Select",true)}}else if(this.hasActiveType()){window.clearTimeout(this._timeoutIdStart);window.clearTimeout(this._timeoutIdEnd);this.setActive(true);if(s.os.ios){this.focus()}t.sap.delayedCall(180,this,function(){this.setActive(false)});t.sap.delayedCall(0,this,function(){this.fireTap();this.firePress()})}this.informList("Press",e.srcControl)};y.prototype.ontouchstart=function(e){this._eventHandledByControl=e.isMarked();var i=e.targetTouches[0];this._touchedY=i.clientY;this._touchedX=i.clientX;if(this._eventHandledByControl||e.touches.length!=1||!this.hasActiveType()){return}this._timeoutIdStart=t.sap.delayedCall(100,this,function(){this.setActive(true)})};y.prototype.ontouchmove=function(t){if((this._active||this._timeoutIdStart)&&(Math.abs(this._touchedY-t.targetTouches[0].clientY)>10||Math.abs(this._touchedX-t.targetTouches[0].clientX)>10)){clearTimeout(this._timeoutIdStart);this._timeoutIdStart=null;this._timeoutIdEnd=null;this.setActive(false)}};y.prototype.ontouchend=function(e){if(e.targetTouches.length==0&&this.hasActiveType()){this._timeoutIdEnd=t.sap.delayedCall(100,this,function(){this.setActive(false)})}};y.prototype.ontouchcancel=y.prototype.ontouchend;y.prototype._activeHandlingNav=function(){};y.prototype._activeHandlingInheritor=function(){};y.prototype._inactiveHandlingInheritor=function(){};y.prototype._activeHandling=function(t){t.toggleClass("sapMLIBActive",this._active);if(s.system.desktop&&this.isActionable()){t.toggleClass("sapMLIBHoverable",!this._active)}};y.prototype.onsapspace=function(t){if(t.srcControl!==this){return}t.preventDefault();if(t.isMarked()||!this.isSelectable()){return}if(this.getMode()==d.MultiSelect){this.setSelected(!this.getSelected());this.informList("Select",this.getSelected())}else if(!this.getSelected()){this.setSelected(true);this.informList("Select",true)}t.setMarked()};y.prototype.onsapenter=function(e){var i=this.getList();if(e.isMarked()||!i){return}if(e.srcControl!==this&&i.getKeyboardMode()==p.Edit){i.setKeyboardMode(p.Navigation);this._switchFocus(e);return}if(e.srcControl!==this){return}if(this.isIncludedIntoSelection()){this.onsapspace(e)}else if(this.hasActiveType()){e.setMarked();this.setActive(true);t.sap.delayedCall(180,this,function(){this.setActive(false)});t.sap.delayedCall(0,this,function(){this.fireTap();this.firePress()})}i.onItemPress(this,e.srcControl)};y.prototype.onsapdelete=function(t){if(t.isMarked()||t.srcControl!==this||this.getMode()!=d.Delete){return}this.informList("Delete");t.preventDefault();t.setMarked()};y.prototype._switchFocus=function(t){var e=this.getList();if(!e){return}var i=this.getTabbables();if(t.srcControl!==this){e._iLastFocusPosOfItem=i.index(t.target);this.focus()}else if(i.length){var s=e._iLastFocusPosOfItem||0;s=i[s]?s:-1;i.eq(s).focus()}t.preventDefault();t.setMarked()};y.prototype.onkeydown=function(t){if(t.isMarked()){return}if(t.which==e.F7){this._switchFocus(t);return}if(t.which==e.F2){if(t.srcControl===this&&this.getType().indexOf("Detail")==0&&this.hasListeners("detailPress")||this.hasListeners("detailTap")){this.fireDetailTap();this.fireDetailPress();t.preventDefault();t.setMarked()}else{var i=this.getList();if(i){this.$().prop("tabIndex",-1);i.setKeyboardMode(i.getKeyboardMode()==p.Edit?p.Navigation:p.Edit);this._switchFocus(t)}}}};y.prototype.getTabbables=function(){return this.$().find(":sapTabbable")};y.prototype.onsaptabnext=function(t){var e=this.getList();if(!e||t.isMarked()||e.getKeyboardMode()==p.Edit){return}var i=this.getTabbables().get(-1)||this.getDomRef();if(t.target===i){e.forwardTab(true);t.setMarked()}};y.prototype.onsaptabprevious=function(t){var e=this.getList();if(!e||t.isMarked()||e.getKeyboardMode()==p.Edit){return}if(t.target===this.getDomRef()){e.forwardTab(false);t.setMarked()}};y.prototype.onfocusin=function(e){var i=this.getList();if(!i||e.isMarked()){return}this.informList("FocusIn",e.srcControl);if(e.srcControl===this){return}if(i.getKeyboardMode()==p.Edit||!t(e.target).is(":sapFocusable")){return}t.sap.delayedCall(0,i,"setItemFocusable",[this]);e.setMarked()};y.prototype.onsapup=function(t){if(t.isMarked()||t.srcControl===this||this.getListProperty("keyboardMode")===p.Navigation){return}this.informList("ArrowUpDown",t)};y.prototype.oncontextmenu=function(e){if(this._bGroupHeader){return}if(t(document.activeElement).is(":focusable")&&document.activeElement!==this.getDomRef()&&e.srcControl!==this.getModeControl()){return}this.informList("ContextMenu",e)};y.prototype.onsapdown=y.prototype.onsapup;return y});