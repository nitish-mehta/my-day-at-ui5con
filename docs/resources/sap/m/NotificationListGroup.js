/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","./NotificationListBase","sap/ui/core/InvisibleText","./ListItemBase","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/Device","sap/m/Button","./NotificationListGroupRenderer","jquery.sap.keycodes"],function(t,e,i,o,r,a,s,n,l,u){"use strict";var p=s.Priority;var g=e.ButtonType;var c=i.extend("sap.m.NotificationListGroup",{metadata:{library:"sap.m",properties:{collapsed:{type:"boolean",group:"Behavior",defaultValue:false},autoPriority:{type:"boolean",group:"Behavior",defaultValue:true},showEmptyGroup:{type:"boolean",group:"Behavior",defaultValue:false},enableCollapseButtonWhenEmpty:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.NotificationListItem",multiple:true,singularName:"item"},_ariaDetailsText:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}},events:{onCollapse:{parameters:{collapsed:{type:"boolean"}}}}}});c.prototype.init=function(){i.prototype.init.call(this);var t=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._closeText=t.getText("NOTIFICATION_LIST_BASE_CLOSE");var e=new l(this.getId()+"-closeButton",{type:g.Transparent,icon:a.getIconURI("decline"),tooltip:this._closeText,press:function(){this.close()}.bind(this)});this.setAggregation("_closeButton",e,true);var r=new l({type:g.Transparent,press:function(){this.setCollapsed(!this.getCollapsed())}.bind(this)});this.setAggregation("_collapseButton",r,true);this._maxNumberReached=false;this._ariaLabbeledByIds="";this.setAggregation("_ariaDetailsText",new o);this._resourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m")};c.prototype.setCollapsed=function(t){this._toggleCollapsed();this.setProperty("collapsed",t,true);this.fireOnCollapse({collapsed:t});return this};c.prototype.getPriority=function(){if(!this.getAutoPriority()){return this.getProperty("priority")}var t=this.getAggregation("items");var e=p.None;if(t){t.forEach(function(t){e=h(e,t.getPriority())})}else{e=this.getProperty("priority")}return e};c.prototype.getUnread=function(){var t=this.getItems();if(t.length){return t.some(function(t){return t.getUnread()})}return this.getProperty("unread")};c.prototype.onBeforeRendering=function(){var t=this.getItems();var e=t.length;var i=this.getAggregation("_collapseButton");this._maxNumberOfNotifications=n.system.desktop?400:100;i.setEnabled(this._getCollapseButtonEnabled(),true);this._maxNumberReached=e>this._maxNumberOfNotifications;t.forEach(function(t){t.addEventDelegate({onfocusin:this._notificationFocusHandler},this);t.addEventDelegate({onkeydown:this._notificationNavigationHandler},this)}.bind(this));this._updateAccessibilityInfo();this._updateCollapseButtonText(this.getCollapsed());this._maxNumberOfNotificationsTitle=this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_MAX_NOTIFICATIONS_TITLE",e-this._maxNumberOfNotifications);this._maxNumberOfNotificationsBody=this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_MAX_NOTIFICATIONS_BODY")};c.prototype.clone=function(){return i.prototype.clone.apply(this,arguments)};c.prototype._getHeaderTitle=function(){var t=i.prototype._getHeaderTitle.call(this);t.addStyleClass("sapMNLG-Title");if(this.getUnread()){t.addStyleClass("sapMNLGTitleUnread")}return t};c.prototype._getDateTimeText=function(){var t=i.prototype._getDateTimeText.call(this);t.setTextAlign("End");return t};c.prototype._toggleCollapsed=function(){var t=!this.getCollapsed();this._updateCollapseButtonText(t);this.$().toggleClass("sapMNLG-Collapsed",t);this.$().toggleClass("sapMNLG-NoNotifications",this._getVisibleItemsCount()<=0)};c.prototype._getVisibleItemsCount=function(){var t=this.getItems();var e=0;t.forEach(function(t){if(t.getVisible()){e+=1}});return e};c.prototype._getCollapseButtonEnabled=function(){if(this._getVisibleItemsCount()>0){return true}return this.getEnableCollapseButtonWhenEmpty()};c.prototype._notificationFocusHandler=function(t){r.prototype.onfocusin.call(this,t);var e=t.srcControl;if(e.getMetadata().getName()!="sap.m.NotificationListItem"){return}var i=e.getParent();var o=i.indexOfItem(e);var a=e.getDomRef();a.setAttribute("aria-posinset",o+1);a.setAttribute("aria-setsize",i.getItems().length)};c.prototype._notificationNavigationHandler=function(e){r.prototype.onkeydown.call(this,e);var i=e.srcControl;if(i.getMetadata().getName()!="sap.m.NotificationListItem"){return}var o=i.getParent();var a=o.indexOfItem(i);switch(e.which){case t.sap.KeyCodes.ARROW_UP:if(a==0){return}var s=a-1;o.getItems()[s].focus();break;case t.sap.KeyCodes.ARROW_DOWN:var n=a+1;if(n==o.getItems().length){return}o.getItems()[n].focus();break;default:return}};c.prototype._updateAccessibilityInfo=function(){var t=this.getAuthorName();var e=this._resourceBundle.getText("NOTIFICATION_LIST_ITEM_DATETIME_PRIORITY",[this.getDatetime(),this.getPriority()]);var i=this.getUnread()?this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_UNREAD"):this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_READ");var o="";var r=this.getAggregation("_ariaDetailsText");if(t){o+=this._resourceBundle.getText("NOTIFICATION_LIST_ITEM_CREATED_BY")+" "+t+" "}o+=e+" "+i;r.setText(o);this._ariaLabbeledByIds=this._getHeaderTitle().getId()+" "+r.getId()};c.prototype._updateCollapseButtonText=function(t){var e=t?this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_EXPAND"):this._resourceBundle.getText("NOTIFICATION_LIST_GROUP_COLLAPSE");this.getAggregation("_collapseButton").setText(e,true)};function h(t,e){if(t==e){return t}if(t=="None"){return e}if(t=="Low"&&e!="None"){return e}if(t=="Medium"&&(e!="None"&&e!="Low")){return e}return t}return c});