/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","./FormattedTextAnchorGenerator","./FormattedTextRenderer"],function(e,t,s,r,a){"use strict";var i=t.LinkConversion;var n=s.extend("sap.m.FormattedText",{metadata:{library:"sap.m",properties:{htmlText:{type:"string",group:"Misc",defaultValue:""},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},convertLinksToAnchorTags:{type:"sap.m.LinkConversion",group:"Behavior",defaultValue:i.None},convertedLinksDefaultTarget:{type:"string",group:"Behavior",defaultValue:"_blank"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}}});var l={ATTRIBS:{style:1,class:1,"a::href":1,"a::target":1},ELEMENTS:{a:{cssClass:"sapMLnk"},abbr:1,blockquote:1,br:1,cite:1,code:1,em:1,h1:{cssClass:"sapMTitle sapMTitleStyleH1"},h2:{cssClass:"sapMTitle sapMTitleStyleH2"},h3:{cssClass:"sapMTitle sapMTitleStyleH3"},h4:{cssClass:"sapMTitle sapMTitleStyleH4"},h5:{cssClass:"sapMTitle sapMTitleStyleH5"},h6:{cssClass:"sapMTitle sapMTitleStyleH6"},p:1,pre:1,strong:1,span:1,u:1,dl:1,dt:1,dd:1,ol:1,ul:1,li:1}},o={ATTRIBS:{"a::href":1,"a::target":1},ELEMENTS:{a:{cssClass:"sapMLnk"},em:1,strong:1,u:1}};n.prototype._renderingRules=l;n.prototype.init=function(){};function p(t,s){var r;var a,i,n=t==="a";var l=this._renderingRules.ELEMENTS[t].cssClass||"";for(var o=0;o<s.length;o+=2){a=s[o];i=s[o+1];if(!this._renderingRules.ATTRIBS[a]&&!this._renderingRules.ATTRIBS[t+"::"+a]){r="FormattedText: <"+t+"> with attribute ["+a+'="'+i+'"] is not allowed';e.sap.log.warning(r,this);s[o+1]=null;continue}if(a=="href"){if(!e.sap.validateUrl(i)){e.sap.log.warning("FormattedText: incorrect href attribute:"+i,this);s[o+1]="#";n=false}}if(a=="target"){n=false}if(l&&a.toLowerCase()=="class"){s[o+1]=l+" "+i;l=""}}if(n){s.push("target");s.push("_blank")}if(l){s.push("class");s.push(l)}return s}function u(t,s){if(this._renderingRules.ELEMENTS[t]){return p.call(this,t,s)}else{var r="<"+t+"> is not allowed";e.sap.log.warning(r,this)}}function c(t){return e.sap._sanitizeHTML(t,{tagPolicy:u.bind(this),uriRewriter:function(t){if(e.sap.validateUrl(t)){return t}}})}function h(e){var t=window.open();t.opener=null;t.location=e.currentTarget.href;e.preventDefault()}n.prototype.onAfterRendering=function(){this.$().find('a[target="_blank"]').on("click",h)};n.prototype._getDisplayHtml=function(){var e=this.getHtmlText(),s=this.getConvertLinksToAnchorTags();if(s===t.LinkConversion.None){return e}e=r.generateAnchors(e,s,this.getConvertedLinksDefaultTarget());return c.call(this,e)};n.prototype.setHtmlText=function(e){return this.setProperty("htmlText",c.call(this,e))};n.prototype._setUseLimitedRenderingRules=function(e){this._renderingRules=e?o:l};return n});