/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./InstanceManager","sap/ui/core/Popup","sap/ui/core/library","sap/ui/core/Control","sap/ui/Device"],function(e,t,o,i,n,a){"use strict";var s=i.Dock;var l=i.CSSSize;var r={};var f="0 -64",u="sapMMessageToast",d="sapUiSelectable",p="sapContrast",c="sapContrastPlus";r._mSettings={duration:3e3,width:"15em",my:"center bottom",at:"center bottom",of:document.defaultView,offset:"0 0",collision:"fit fit",onClose:null,animationTimingFunction:"ease",animationDuration:1e3,autoClose:true,closeOnBrowserNavigation:true};r._aPopups=[];r._iOpenedPopups=0;r._bBoundedEvents=false;r._validateSettings=function(e){r._isFiniteInteger(e.duration);r._validateWidth(e.width);r._validateDockPosition(e.my);r._validateDockPosition(e.at);r._validateOf(e.of);r._validateOffset(e.offset);r._validateCollision(e.collision);r._validateOnClose(e.onClose);r._validateAutoClose(e.autoClose);r._validateAnimationTimingFunction(e.animationTimingFunction);r._isFiniteInteger(e.animationDuration)};r._isFiniteInteger=function(t){if(typeof t!=="number"||!isFinite(t)||!(Math.floor(t)===t)||t<=0){e.sap.log.error('"iNumber" needs to be a finite positive nonzero integer on '+r+"._isFiniteInteger")}};r._validateWidth=function(t){if(!l.isValid(t)){e.sap.log.error(t+" is not of type "+'"sap.ui.core.CSSSize" for property "width" on '+r+"._validateWidth")}};r._validateDockPosition=function(t){if(!s.isValid(t)){e.sap.log.error('"'+t+'"'+" is not of type "+'"sap.ui.core.Popup.Dock" on '+r+"._validateDockPosition")}};r._validateOf=function(t){if(!(t instanceof e)&&!(t&&t.nodeType===1)&&!(t instanceof n)&&t!==window){e.sap.log.error('"of" needs to be an instance of sap.ui.core.Control or an Element or a jQuery object or the window on '+r+"._validateOf")}};r._validateOffset=function(t){if(typeof t!=="string"){e.sap.log.error(t+" is of type "+typeof t+', expected "string" for property "offset" on '+r+"._validateOffset")}};r._validateCollision=function(t){var o=/^(fit|flip|none|flipfit|flipflip|flip flip|flip fit|fitflip|fitfit|fit fit|fit flip)$/i;if(!o.test(t)){e.sap.log.error('"collision" needs to be a single value “fit”, “flip”, or “none”, or a pair for horizontal and vertical e.g. "fit flip”, "fit none", "flipfit" on '+r+"._validateOffset")}};r._validateOnClose=function(t){if(typeof t!=="function"&&t!==null){e.sap.log.error('"onClose" should be a function or null on '+r+"._validateOnClose")}};r._validateAutoClose=function(t){if(typeof t!=="boolean"){e.sap.log.error('"autoClose" should be a boolean on '+r+"._validateAutoClose")}};r._validateAnimationTimingFunction=function(t){var o=/^(ease|linear|ease-in|ease-out|ease-in-out)$/i;if(!o.test(t)){e.sap.log.error('"animationTimingFunction" should be a string, expected values: '+"ease, linear, ease-in, ease-out, ease-in-out on "+r+"._validateAnimationTimingFunction")}};function v(e){for(var t=["my","at","of","offset"],o=0;o<t.length;o++){if(e[t[o]]!==undefined){return false}}return true}function _(e){var t=document.createElement("div");t.className=u+" "+d+" "+p+" "+c;if(sap.ui.getCore().getConfiguration().getAccessibility()){t.setAttribute("role","alert");t.setAttribute("aria-label"," ")}t.style.width=e.width;t.appendChild(document.createTextNode(e.message));return t}function g(e){if(e){if(v(e)){e.offset=f}if(e.of&&e.of.nodeType===9){e.of=document.defaultView}}else{e={offset:f}}return e}r._handleResizeEvent=function(){if(a.system.phone||a.system.tablet){r._resetPosition(r._aPopups)}e.sap.delayedCall(0,r,"_applyPositions",[r._aPopups])};r._handleMouseDownEvent=function(e){var t=e.target.hasAttribute("class")&&e.target.getAttribute("class").indexOf(u)!==-1;if(t||e.isMarked("delayedMouseEvent")){return}r._aPopups.forEach(function(e){e&&e.__bAutoClose&&e.close()})};r._resetPosition=function(e){for(var t=0,o;t<e.length;t++){o=e[t]&&e[t].getContent();if(o){o.style.visibility="hidden";o.style.left=0}}};r._applyPositions=function(t){for(var o=0,i,n;o<t.length;o++){i=t[o];if(i){n=i._oPosition;if(a.system.phone||a.system.tablet){e.sap.delayedCall(0,r,"_applyPosition",[i,n])}else{i.setPosition(n.my,n.at,n.of,n.offset)}}}};r._applyPosition=function(e,t){t=t||e._oPosition;var o=e.getContent();e.setPosition(t.my,t.at,t.of,t.offset);o.style.visibility="visible"};r._setCloseAnimation=function(e,t,o,i){var n="opacity "+i.animationTimingFunction+" "+i.animationDuration+"ms",a="webkitTransitionEnd."+u+" transitionend."+u;if(sap.ui.getCore().getConfiguration().getAnimation()&&i.animationDuration>0){e[0].style.webkitTransition=n;e[0].style.transition=n;e[0].style.opacity=0;e.on(a,function t(){e.off(a);o()})}else{o()}};r.show=function(i,n){var s=r,l=e.extend({},r._mSettings,{message:i}),f=new o,d,p,c="mousedown."+u+" touchstart."+u,v,m;n=g(n);e.extend(l,n);r._validateSettings(l);p=_(l);d=r._aPopups.push(f)-1;f.setContent(p);f.setPosition(l.my,l.at,l.of,l.offset,l.collision);if(e.support.cssTransitions){f.setAnimations(function e(t,o,i){i()},function e(t,o,i){s._setCloseAnimation(t,o,i,l)})}f.setShadow(false);f.__bAutoClose=l.autoClose;if(l.closeOnBrowserNavigation){t.addPopoverInstance(f)}if(!r._bBoundedEvents){e(window).on("resize."+u,r._handleResizeEvent.bind(r));e(document).on(c,r._handleMouseDownEvent.bind(r));r._bBoundedEvents=true}f.open();r._iOpenedPopups++;function y(){t.removePopoverInstance(s._aPopups[d]);e(s._aPopups[d].getContent()).remove();s._aPopups[d].detachClosed(y);s._aPopups[d].destroy();s._aPopups[d]=null;s._iOpenedPopups--;if(s._iOpenedPopups===0){s._aPopups=[];e(window).off("resize."+u);e(document).off(c);s._bBoundedEvents=false}if(typeof l.onClose==="function"){l.onClose.call(s)}}f.attachClosed(y);v=e.sap.delayedCall(l.duration,f,"close");function C(){e.sap.clearDelayedCall(v);v=null;function t(){m=e.sap.delayedCall(l.duration,f,"close");f.getContent().removeEventListener("mouseleave",t)}f.getContent().addEventListener("mouseleave",t);e.sap.clearDelayedCall(m);m=null}f.getContent().addEventListener("touchstart",C);f.getContent().addEventListener("mouseover",C);if(a.system.desktop){f.getContent().addEventListener("mouseleave",function(){v=e.sap.delayedCall(l.duration,f,"close")})}};r.toString=function(){return"sap.m.MessageToast"};return r},true);