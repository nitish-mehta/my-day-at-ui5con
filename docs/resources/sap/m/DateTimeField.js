/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/model/type/Date","sap/ui/model/odata/type/ODataType","./InputBase","sap/ui/core/LocaleData","sap/ui/core/library","sap/ui/core/format/DateFormat","./DateTimeFieldRenderer"],function(t,e,a,r,i,s,o,u){"use strict";var l=s.CalendarType;var n=r.extend("sap.m.DateTimeField",{metadata:{abstract:true,library:"sap.m",properties:{displayFormat:{type:"string",group:"Appearance",defaultValue:null},valueFormat:{type:"string",group:"Data",defaultValue:null},dateValue:{type:"object",group:"Data",defaultValue:null},initialFocusedDateValue:{type:"object",group:"Data",defaultValue:null}}}});n.prototype.setValue=function(e){e=this.validateProperty("value",e);var a=this.getValue();if(e===a){return this}else{this._lastValue=e}this.setProperty("value",e);this._bValid=true;var r;if(e){r=this._parseValue(e);if(!r||r.getTime()<this._oMinDate.getTime()||r.getTime()>this._oMaxDate.getTime()){this._bValid=false;t.sap.log.warning("Value can not be converted to a valid date",this)}}this.setProperty("dateValue",r);if(this.getDomRef()){var i;if(r){i=this._formatValue(r)}else{i=e}if(this._$input.val()!==i){this._$input.val(i);this._curpos=this._$input.cursorPos()}}return this};n.prototype.setDateValue=function(e){if(this._isValidDate(e)){throw new Error("Date must be a JavaScript date object; "+this)}if(t.sap.equal(this.getDateValue(),e)){return this}e=this._dateValidation(e);var a=this._formatValue(e,true);if(a!==this.getValue()){this._lastValue=a}this.setProperty("value",a);if(this.getDomRef()){var r=this._formatValue(e);if(this._$input.val()!==r){this._$input.val(r);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};n.prototype.setValueFormat=function(t){this.setProperty("valueFormat",t,true);var e=this.getValue();if(e){this._handleDateValidation(this._parseValue(e))}return this};n.prototype.setDisplayFormat=function(t){this.setProperty("displayFormat",t,true);this.updateDomValue(this._formatValue(this.getDateValue()));this._updateDomPlaceholder(this._getPlaceholder());return this};n.prototype.getDisplayFormatType=function(){return null};n.prototype._dateValidation=function(t){this._bValid=true;this.setProperty("dateValue",t);return t};n.prototype._handleDateValidation=function(t){this._bValid=true;this.setProperty("dateValue",t)};n.prototype._getPlaceholder=function(){var t=this.getPlaceholder();if(!t){t=this._getDisplayFormatPattern();if(!t){t=this._getDefaultDisplayStyle()}if(this._checkStyle(t)){t=this._getLocaleBasedPattern(t)}}return t};n.prototype._getLocaleBasedPattern=function(t){return i.getInstance(sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()).getDatePattern(t)};n.prototype._parseValue=function(t,e){return this._getFormatter(e).parse(t)};n.prototype._formatValue=function(t,e){if(t){return this._getFormatter(!e).format(t)}return""};n.prototype._getDefaultDisplayStyle=function(){return"medium"};n.prototype._getDefaultValueStyle=function(){return"short"};n.prototype._getFormatter=function(t){var e=this._getBoundValueTypePattern(),a=false,r,i=this.getBinding("value"),s;if(i&&i.oType&&i.oType.oOutputFormat){a=!!i.oType.oOutputFormat.oFormatOptions.relative;s=i.oType.oOutputFormat.oFormatOptions.calendarType}if(!e){if(t){e=this.getDisplayFormat()||this._getDefaultDisplayStyle();s=this.getDisplayFormatType()}else{e=this.getValueFormat()||this._getDefaultValueStyle();s=l.Gregorian}}if(!s){s=sap.ui.getCore().getConfiguration().getCalendarType()}if(t){if(e===this._sUsedDisplayPattern&&s===this._sUsedDisplayCalendarType){r=this._oDisplayFormat}}else{if(e===this._sUsedValuePattern&&s===this._sUsedValueCalendarType){r=this._oValueFormat}}if(r){return r}return this._getFormatterInstance(r,e,a,s,t)};n.prototype._getFormatterInstance=function(t,e,a,r,i){if(this._checkStyle(e)){t=this._getFormatInstance({style:e,strictParsing:true,relative:a,calendarType:r},i)}else{t=this._getFormatInstance({pattern:e,strictParsing:true,relative:a,calendarType:r},i)}if(i){this._sUsedDisplayPattern=e;this._sUsedDisplayCalendarType=r;this._oDisplayFormat=t}else{this._sUsedValuePattern=e;this._sUsedValueCalendarType=r;this._oValueFormat=t}return t};n.prototype._getFormatInstance=function(t,e){return o.getInstance(t)};n.prototype._checkStyle=function(t){return t==="short"||t==="medium"||t==="long"||t==="full"};n.prototype._getDisplayFormatPattern=function(){var t=this._getBoundValueTypePattern();if(t){return t}t=this.getDisplayFormat();if(this._checkStyle(t)){t=this._getLocaleBasedPattern(t)}return t};n.prototype._getBoundValueTypePattern=function(){var t=this.getBinding("value"),r=t&&t.getType&&t.getType();if(r instanceof e){return r.getOutputPattern()}if(r instanceof a&&r.oFormat){return r.oFormat.oFormatOptions.pattern}return undefined};n.prototype._isValidDate=function(e){return e&&t.type(e)!=="date"};n.prototype._updateDomPlaceholder=function(t){if(this.getDomRef()){this._$input.attr("placeholder",t)}};return n});