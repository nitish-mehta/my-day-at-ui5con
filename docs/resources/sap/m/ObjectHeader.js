/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/Device","sap/m/Text","./ObjectHeaderRenderer"],function(t,e,i,r,s,a,o,n){"use strict";var l=e.BackgroundDesign;var u=s.TextAlign;var p=e.ImageHelper;var g=e.ObjectMarkerType;var h=s.TitleLevel;var d=s.TextDirection;var c=s.ValueState;var f=i.extend("sap.m.ObjectHeader",{metadata:{library:"sap.m",designtime:"sap/m/designtime/ObjectHeader.designtime",properties:{title:{type:"string",group:"Misc",defaultValue:null},number:{type:"string",group:"Misc",defaultValue:null},numberUnit:{type:"string",group:"Misc",defaultValue:null},intro:{type:"string",group:"Misc",defaultValue:null},introActive:{type:"boolean",group:"Misc",defaultValue:null},titleActive:{type:"boolean",group:"Misc",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconActive:{type:"boolean",group:"Misc",defaultValue:null},iconAlt:{type:"string",group:"Accessibility",defaultValue:null},iconTooltip:{type:"string",group:"Accessibility",defaultValue:null},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},markFavorite:{type:"boolean",group:"Misc",defaultValue:false,deprecated:true},markFlagged:{type:"boolean",group:"Misc",defaultValue:false,deprecated:true},showMarkers:{type:"boolean",group:"Misc",defaultValue:false,deprecated:true},showTitleSelector:{type:"boolean",group:"Misc",defaultValue:false},numberState:{type:"sap.ui.core.ValueState",group:"Misc",defaultValue:c.None},condensed:{type:"boolean",group:"Appearance",defaultValue:false},backgroundDesign:{type:"sap.m.BackgroundDesign",group:"Appearance"},responsive:{type:"boolean",group:"Behavior",defaultValue:false},fullScreenOptimized:{type:"boolean",group:"Appearance",defaultValue:false},titleHref:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},titleTarget:{type:"string",group:"Behavior",defaultValue:null},introHref:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},introTarget:{type:"string",group:"Behavior",defaultValue:null},titleTextDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:d.Inherit},introTextDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:d.Inherit},numberTextDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:d.Inherit},titleSelectorTooltip:{type:"string",group:"Misc",defaultValue:"Options"},titleLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:h.H1}},defaultAggregation:"attributes",aggregations:{attributes:{type:"sap.m.ObjectAttribute",multiple:true,singularName:"attribute"},firstStatus:{type:"sap.m.ObjectStatus",multiple:false,deprecated:true},secondStatus:{type:"sap.m.ObjectStatus",multiple:false,deprecated:true},statuses:{type:"sap.ui.core.Control",multiple:true,singularName:"status"},_objectNumber:{type:"sap.m.ObjectNumber",multiple:false,visibility:"hidden"},additionalNumbers:{type:"sap.m.ObjectNumber",multiple:true,singularName:"additionalNumber"},headerContainer:{type:"sap.m.ObjectHeaderContainer",multiple:false},markers:{type:"sap.m.ObjectMarker",multiple:true,singularName:"marker"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{titlePress:{parameters:{domRef:{type:"object"}}},introPress:{parameters:{domRef:{type:"object"}}},iconPress:{parameters:{domRef:{type:"object"}}},titleSelectorPress:{parameters:{domRef:{type:"object"}}}}}});f.prototype.init=function(){var t=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oTitleArrowIcon=r.createControlByURI({id:this.getId()+"-titleArrow",src:r.getIconURI("arrow-down"),decorative:false,visible:false,tooltip:t.getText("OH_SELECT_ARROW_TOOLTIP"),size:"1.375rem",press:function(t){}});this._fNumberWidth=undefined;this._titleText=new o(this.getId()+"-titleText");this._titleText.setMaxLines(3)};f.prototype.insertAttribute=function(t,e){var i=this.insertAggregation("attributes",t,e);this._registerControlListener(t);return i};f.prototype.addAttribute=function(t){var e=this.addAggregation("attributes",t);this._registerControlListener(t);return e};f.prototype.removeAttribute=function(t){var e=this.removeAggregation("attributes",t);this._deregisterControlListener(e);return e};f.prototype.removeAllAttributes=function(){var t=this.removeAllAggregation("attributes");t.forEach(this._deregisterControlListener,this);return t};f.prototype.destroyAttributes=function(){var t=this.getAggregation("attributes");if(t!==null){t.forEach(this._deregisterControlListener,this)}return this.destroyAggregation("attributes")};f.prototype.insertStatus=function(t,e){var i=this.insertAggregation("statuses",t,e);this._registerControlListener(t);return i};f.prototype.addStatus=function(t){var e=this.addAggregation("statuses",t);this._registerControlListener(t);return e};f.prototype.removeStatus=function(t){var e=this.removeAggregation("statuses",t);this._deregisterControlListener(e);return e};f.prototype.removeAllStatuses=function(){var t=this.removeAllAggregation("statuses");t.forEach(this._deregisterControlListener,this);return t};f.prototype.destroyStatuses=function(){var t=this.getAggregation("statuses");if(t!==null){t.forEach(this._deregisterControlListener,this)}return this.destroyAggregation("statuses")};f.prototype._registerControlListener=function(t){if(t){t.attachEvent("_change",this.invalidate,this)}};f.prototype._deregisterControlListener=function(t){if(t){t.detachEvent("_change",this.invalidate,this)}};f.prototype.setCondensed=function(t){this.setProperty("condensed",t);if(this.getCondensed()){this._oTitleArrowIcon.setSize("1rem")}else{this._oTitleArrowIcon.setSize("1.375rem")}return this};f.prototype.setNumber=function(t){this.setProperty("number",t);this._getObjectNumber().setNumber(t);return this};f.prototype.setNumberUnit=function(t){this.setProperty("numberUnit",t);this._getObjectNumber().setUnit(t);return this};f.prototype.setNumberState=function(t){this.setProperty("numberState",t,true);this._getObjectNumber().setState(t);return this};f.prototype.setTitleSelectorTooltip=function(t){this.setProperty("titleSelectorTooltip",t,false);this._oTitleArrowIcon.setTooltip(t);return this};f.prototype.setMarkFavorite=function(t){return this._setOldMarkers(g.Favorite,t)};f.prototype.setMarkFlagged=function(t){return this._setOldMarkers(g.Flagged,t)};f.prototype.setShowMarkers=function(t){var e,i=this.getMarkers(),r;this.setProperty("showMarkers",t,false);for(r=0;r<i.length;r++){e=i[r].getType();if(e===g.Flagged&&this.getMarkFlagged()||e===g.Favorite&&this.getMarkFavorite()){i[r].setVisible(t)}}return this};f.prototype._setOldMarkers=function(t,e){var i=this.getMarkers(),r=false,s,a={Flagged:"-flag",Favorite:"-favorite"};this.setProperty("mark"+t,e,false);if(!this.getShowMarkers()){e=false}for(s=0;s<i.length;s++){if(i[s].getType()===t){r=true;i[s].setVisible(e);break}}if(!r){this.insertAggregation("markers",new sap.m.ObjectMarker({id:this.getId()+a[t],type:t,visible:e}))}return this};f.prototype._getVisibleMarkers=function(){var t=this.getMarkers(),e=[],i;for(i=0;i<t.length;i++){if(t[i].getVisible()){e.push(t[i])}}return e};f.prototype._getObjectNumber=function(){var t=this.getAggregation("_objectNumber");if(!t){t=new sap.m.ObjectNumber(this.getId()+"-number",{emphasized:false});this.setAggregation("_objectNumber",t,true)}return t};f.prototype.getFocusDomRef=function(){if(this.getResponsive()){return this.$("txt")}else{return this.$("title")}};f.prototype.ontap=function(e){var i=e.target.id;if(this.getIntroActive()&&i===this.getId()+"-intro"){if(!this.getIntroHref()){this.fireIntroPress({domRef:t.sap.domById(i)})}}else if(!this.getResponsive()&&this.getTitleActive()&&(i===this.getId()+"-title"||t(e.target).parent().attr("id")===this.getId()+"-title"||i===this.getId()+"-titleText-inner")){if(!this.getTitleHref()){e.preventDefault();i=this.getId()+"-title";this.fireTitlePress({domRef:t.sap.domById(i)})}}else if(this.getResponsive()&&this.getTitleActive()&&(i===this.getId()+"-txt"||t(e.target).parent().attr("id")===this.getId()+"-txt")){if(!this.getTitleHref()){e.preventDefault();i=this.getId()+"-txt";this.fireTitlePress({domRef:t.sap.domById(i)})}}else if(this.getIconActive()&&(i===this.getId()+"-img"||i===this.getId()+"-icon")){this.fireIconPress({domRef:t.sap.domById(i)})}else if(i===this.getId()+"-titleArrow"){this.fireTitleSelectorPress({domRef:t.sap.domById(i)})}else{e.setMarked();e.preventDefault()}};f.prototype._handleSpaceOrEnter=function(e){var i=e.target.id;e.setMarked();if(!this.getResponsive()&&this.getTitleActive()&&(i===this.getId()+"-title"||t(e.target).parent().attr("id")===this.getId()+"-title"||i===this.getId()+"-titleText-inner")){if(e.type==="sapspace"){e.preventDefault()}i=this.getId()+"-title";if(!this.getTitleHref()){e.preventDefault();this.fireTitlePress({domRef:t.sap.domById(i)})}else{if(e.type==="sapspace"){this._linkClick(e,i)}}}else if(this.getResponsive()&&this.getTitleActive()&&(i===this.getId()+"-txt"||t(e.target).parent().attr("id")===this.getId()+"-txt")){if(e.type==="sapspace"){e.preventDefault()}i=this.getId()+"-txt";if(!this.getTitleHref()){e.preventDefault();this.fireTitlePress({domRef:t.sap.domById(i)})}else{if(e.type==="sapspace"){this._linkClick(e,i)}}}else if(this.getIntroActive()&&i===this.getId()+"-intro"){if(e.type==="sapspace"){e.preventDefault()}if(!this.getIntroHref()){this.fireIntroPress({domRef:t.sap.domById(i)})}}else if(this.getIconActive()&&t(e.target).is(".sapMOHIcon,.sapMOHRIcon")){if(e.type==="sapspace"){e.preventDefault()}var r=t.sap.domById(this.getId()+"-icon");if(!r){r=t.sap.domById(this.getId()+"-img")}this.fireIconPress({domRef:r})}else if(i===this.getId()+"-titleArrow"){if(e.type==="sapspace"){e.preventDefault()}this.fireTitleSelectorPress({domRef:t.sap.domById(i)})}};f.prototype.onsapspace=f.prototype._handleSpaceOrEnter;f.prototype.onsapenter=f.prototype._handleSpaceOrEnter;f.prototype._linkClick=function(e,i){e.setMarked();var r=document.createEvent("MouseEvents");r.initEvent("click",false,true);t.sap.domById(i).dispatchEvent(r)};f.prototype._onOrientationChange=function(){var e=this.getId();if(a.system.tablet&&this.getFullScreenOptimized()&&(this._hasAttributes()||this._hasStatus())){this._rerenderStates()}if(a.system.phone){if(a.orientation.portrait){if(this.getTitle().length>50){this._rerenderTitle(50)}if(this.getIcon()){t.sap.byId(e+"-titlediv").removeClass("sapMOHRTitleIcon");t.sap.byId(e+"-titleIcon").addClass("sapMOHRHideIcon")}}else{if(a.orientation.landscape){if(this.getTitle().length>80){this._rerenderTitle(80)}if(this.getIcon()){t.sap.byId(e+"-titlediv").addClass("sapMOHRTitleIcon");t.sap.byId(e+"-titleIcon").removeClass("sapMOHRHideIcon")}}}this._adjustNumberDiv()}this._adjustIntroDiv()};f.prototype._rerenderTitle=function(t){var e=sap.ui.getCore().createRenderManager();this.getRenderer()._rerenderTitle(e,this,t);e.destroy()};f.prototype._rerenderStates=function(){var t=sap.ui.getCore().createRenderManager();this.getRenderer()._rerenderResponsiveStates(t,this);t.destroy()};f.prototype.exit=function(){if(!a.system.phone){this._detachMediaContainerWidthChange(this._rerenderOHR,this,a.media.RANGESETS.SAP_STANDARD)}if(a.system.tablet||a.system.phone){a.orientation.detachHandler(this._onOrientationChange,this)}if(this._oImageControl){this._oImageControl.destroy();this._oImageControl=undefined}if(this._oTitleArrowIcon){this._oTitleArrowIcon.destroy();this._oTitleArrowIcon=undefined}if(this._titleText){this._titleText.destroy();this._titleText=undefined}if(this._introText){this._introText.destroy();this._introText=undefined}};f.prototype._getImageControl=function(){var e=this.getId()+"-img";var i="2.5rem";var s=t.extend({src:this.getIcon(),tooltip:this.getIconTooltip(),alt:this.getIconAlt(),useIconTooltip:false,densityAware:this.getIconDensityAware()},r.isIconURI(this.getIcon())?{size:i}:{});this._oImageControl=p.getImageControl(e,this._oImageControl,this,s);return this._oImageControl};f.prototype.onBeforeRendering=function(){if(a.system.tablet||a.system.phone){a.orientation.detachHandler(this._onOrientationChange,this)}if(!a.system.phone){this._detachMediaContainerWidthChange(this._rerenderOHR,this,a.media.RANGESETS.SAP_STANDARD)}if(this._introText){this._introText.destroy();this._introText=undefined}};f.prototype.onAfterRendering=function(){var e=this.getAggregation("_objectNumber");var i=sap.ui.getCore().getConfiguration().getRTL();var r=this.$("titleArrow");r.attr("role","button");if(this.getResponsive()){this._adjustIntroDiv();if(e&&e.getNumber()){if(a.system.desktop&&t("html").hasClass("sapUiMedia-Std-Desktop")&&this.getFullScreenOptimized()&&this._iCountVisAttrStat>=1&&this._iCountVisAttrStat<=3){e.setTextAlign(i?u.Right:u.Left)}else{e.setTextAlign(i?u.Left:u.Right)}}this._adjustNumberDiv();if(a.system.tablet||a.system.phone){a.orientation.attachHandler(this._onOrientationChange,this)}if(!a.system.phone){this._attachMediaContainerWidthChange(this._rerenderOHR,this,a.media.RANGESETS.SAP_STANDARD)}}else{var s=i?u.Left:u.Right;if(e&&e.getNumber()){e.setTextAlign(s)}if(this.getAdditionalNumbers()){this._setTextAlignANum(s)}}};f.prototype._rerenderOHR=function(){this.invalidate()};f.prototype._adjustNumberDiv=function(){var e=this.getId();var i=this.getAggregation("_objectNumber");var r=sap.ui.getCore().getConfiguration().getRTL();if(i&&i.getNumber()){var s=t.sap.byId(e+"-number");var a=t.sap.byId(e+"-titlediv");if(this._isMediaSize("Phone")){if(s.hasClass("sapMObjectNumberBelowTitle")){i.setTextAlign(r?u.Left:u.Right);s.removeClass("sapMObjectNumberBelowTitle");a.removeClass("sapMOHRTitleDivFull")}var o=s.parent().width()*.4;if(s.outerWidth()>o){i.setTextAlign(r?u.Right:u.Left);s.addClass("sapMObjectNumberBelowTitle");a.addClass("sapMOHRTitleDivFull")}}}};f.prototype._adjustIntroDiv=function(){var e=this.getId();var i=t.sap.byId(e+"-txt");var r=t.sap.byId(e+"-titleArrow");var s=t.sap.byId(e+"-intro");if(s.parent().hasClass("sapMOHRIntroMargin")){s.parent().removeClass("sapMOHRIntroMargin")}if(r.height()!==null&&i.height()<r.height()){s.parent().addClass("sapMOHRIntroMargin")}};f._escapeId=function(t){return t?"#"+t.replace(/(:|\.)/g,"\\$1"):""};f.prototype._hasBottomContent=function(){return this._hasAttributes()||this._hasStatus()||this._hasMarkers()};f.prototype._hasIcon=function(){return!!this.getIcon().trim()};f.prototype._hasAttributes=function(){var t=this.getAttributes();if(t&&t.length>0){for(var e=0;e<t.length;e++){if(!t[e]._isEmpty()){return true}}}return false};f.prototype._hasStatus=function(){var t=this.getFirstStatus()&&!this.getFirstStatus()._isEmpty()||this.getSecondStatus()&&!this.getSecondStatus()._isEmpty();if(!t&&this.getStatuses()&&this.getStatuses().length>0){var e=this.getStatuses();for(var i=0;i<e.length;i++){if(e[i]instanceof sap.m.ObjectStatus&&!e[i]._isEmpty()){t=true;break}else if(e[i]instanceof sap.m.ProgressIndicator){t=true;break}}}return t};f.prototype._hasMarkers=function(){var t=this.getMarkers(),e=this.getShowMarkers()&&(this.getMarkFavorite()||this.getMarkFlagged()),i=t&&t.length;return e||i};f.prototype._getDefaultBackgroundDesign=function(){if(this.getCondensed()){return l.Solid}else{if(this.getResponsive()){return l.Translucent}else{return l.Transparent}}};f.prototype._getBackground=function(){if(this.getBackgroundDesign()===undefined){return this._getDefaultBackgroundDesign()}else{return this.getBackgroundDesign()}};f.prototype._setTextAlignANum=function(t){var e=this.getAdditionalNumbers();for(var i=0;i<e.length;i++){e[i].setTextAlign(t)}};f.prototype._isMediaSize=function(t){return this._getCurrentMediaContainerRange(a.media.RANGESETS.SAP_STANDARD).name===t};return f});