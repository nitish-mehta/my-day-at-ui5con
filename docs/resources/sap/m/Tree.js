/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./ListBase","./library","sap/ui/model/ClientTreeBindingAdapter","sap/ui/model/TreeBindingCompatibilityAdapter","./TreeRenderer"],function(e,t,i,n,r,o){"use strict";var s=t.extend("sap.m.Tree",{metadata:{library:"sap.m",events:{toggleOpenState:{parameters:{itemIndex:{type:"int"},itemContext:{type:"object"},expanded:{type:"boolean"}}}}}});s.prototype.isTreeBinding=function(e){return e=="items"};s.prototype.getBinding=function(i){i=i||"items";var o=t.prototype.getBinding.call(this,i);if(o&&i==="items"&&!o.getLength){if(o.isA("sap.ui.model.odata.v2.ODataTreeBinding")){o.applyAdapterInterface()}else if(o.isA("sap.ui.model.ClientTreeBinding")){n.apply(o)}else if(o.isA("sap.ui.model.odata.ODataTreeBinding")){r(o,this)}else{e.sap.log.error("TreeBinding is not supported for the "+this)}}return o};s.prototype.updateAggregation=function(e){if(e!="items"){return t.prototype.updateAggregation.apply(this,arguments)}var i=this.getBindingInfo("items"),n=this.getBinding("items"),r=i.factory,o;function s(e,t){var n=e.getItems()||[],o,s;if(n.length>t.length){for(var p=t.length;p<n.length;p++){e.removeItem(n[p]);n[p].destroy("KeepDom")}}for(var p=0;p<t.length;p++){o=t[p];s=n[p];if(s){s.setBindingContext(o,i.model)}else{s=r(e.getId()+"-"+p,o);s.setBindingContext(o,i.model);e.addItem(s)}}}o=n.getContexts(0);if(!i.template){this.destroyItems()}s(this,o)};s.prototype.validateAggregation=function(e,i,n){var r=t.prototype.validateAggregation.apply(this,arguments);if(e==="items"&&!i.isA("sap.m.TreeItemBase")){throw new Error(i+" is not a valid items aggregation of "+this+". Items aggregation in Tree control only supports TreeItemBase-based objects, e.g. StandardTreeItem.")}return r};s.prototype.onItemExpanderPressed=function(e,t){var i=this.indexOfItem(e);var n=this.getBindingInfo("items");var r=e&&e.getBindingContext(n.model);if(n&&r){var o=e.getExpanded();var s;if(t==undefined){this.getBinding("items").toggleIndex(i)}else if(t){this.getBinding("items").expand(i)}else{this.getBinding("items").collapse(i)}s=e.getExpanded();if(s&&e.getLevel()+1>this.getDeepestLevel()){this._iDeepestLevel=e.getLevel()+1}if(o!==s&&!e.isLeaf()){this.fireToggleOpenState({itemIndex:i,itemContext:r,expanded:s})}}};s.prototype.setGrowing=function(){e.sap.log.error("Growing feature of "+this+" is not supported!");return this};s.prototype.setGrowingThreshold=function(){e.sap.log.error("GrowingThreshold of "+this+" is not supported!");return this};s.prototype.setGrowingTriggerText=function(){e.sap.log.error("GrowingTriggerText of "+this+" is not supported!");return this};s.prototype.setGrowingScrollToLoad=function(){e.sap.log.error("GrowingScrollToLoad of "+this+" is not supported!");return this};s.prototype.setGrowingDirection=function(){e.sap.log.error("GrowingDirection of "+this+" is not supported!");return this};s.prototype.expandToLevel=function(t){var i=this.getBinding("items");e.sap.assert(i&&i.expandToLevel,"Tree.expandToLevel is not supported with your current Binding. Please check if you are running on an ODataModel V2.");if(i&&i.expandToLevel&&i.getNumberOfExpandedLevels){if(i.getNumberOfExpandedLevels()>t){i.collapseToLevel(0)}i.expandToLevel(t)}return this};s.prototype.getNumberOfExpandedLevel=function(){return this.getBinding("items").getNumberOfExpandedLevels()};s.prototype.getDeepestLevel=function(){if(this._iDeepestLevel===undefined){this._iDeepestLevel=this.getNumberOfExpandedLevel()}return this._iDeepestLevel};s.prototype.collapseAll=function(){var t=this.getBinding("items");e.sap.assert(t&&t.expandToLevel,"Tree.collapseAll is not supported with your current Binding. Please check if you are running on an ODataModel V2.");if(t){t.collapseToLevel(0)}return this};s.prototype._sortHelper=function(e){var t=[];if(typeof e==="number"){t.push(e)}else if(Array.isArray(e)){t=e.sort().reverse()}return t};s.prototype._removeLeaf=function(e){var t=null,i,n=[];for(var r=0;r<e.length;r++){i=e[r];t=this.getItems()[i];if(t&&!t.isLeaf()){n.push(i)}}return n};s.prototype._preExpand=function(e){var t=this._sortHelper(e);t=this._removeLeaf(t);return t};s.prototype.expand=function(e){var t=this.getBinding("items");if(t&&t.expand){var i=this._preExpand(e);for(var n=0;n<i.length-1;n++){t.expand(i[n],true)}t.expand(i[i.length-1],false)}return this};s.prototype.collapse=function(e){var t=this.getBinding("items");if(t&&t.collapse){var i=this._preExpand(e);for(var n=0;n<i.length-1;n++){t.collapse(i[n],true)}t.collapse(i[i.length-1],false)}return this};s.prototype.getAccessibilityType=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_TREE")};s.prototype.getAccessbilityPosition=function(e){var t,i,n=e.getItemNodeContext();if(n.parent){t=n.parent.children.length}if(n.positionInParent){i=n.positionInParent+1}return{setSize:t,posInset:i}};s.prototype.onItemLongDragOver=function(e){var t=this.indexOfItem(e);this.getBinding("items").expand(t)};s.prototype.isGrouped=function(){return false};return s});