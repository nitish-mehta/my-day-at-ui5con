/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Bar","./Dialog","./InputBase","./List","./Popover","sap/ui/core/Item","./ColumnListItem","./StandardListItem","./DisplayListItem","sap/ui/core/ListItem","./Table","./Toolbar","./ToolbarSpacer","./library","sap/ui/core/IconPool","sap/ui/core/InvisibleText","sap/ui/Device","sap/ui/core/ResizeHandler","sap/ui/core/Control","./InputRenderer"],function(e,t,i,s,o,n,u,r,a,l,g,p,h,f,c,d,_,S,y,m,I){"use strict";var b=c.ListMode;var v=c.PlacementType;var T=c.ListType;var L=c.InputTextFormatMode;var P=c.InputType;var w=s.extend("sap.m.Input",{metadata:{library:"sap.m",properties:{type:{type:"sap.m.InputType",group:"Data",defaultValue:P.Text},maxLength:{type:"int",group:"Behavior",defaultValue:0},dateFormat:{type:"string",group:"Misc",defaultValue:"YYYY-MM-dd",deprecated:true},showValueHelp:{type:"boolean",group:"Behavior",defaultValue:false},showSuggestion:{type:"boolean",group:"Behavior",defaultValue:false},valueHelpOnly:{type:"boolean",group:"Behavior",defaultValue:false},filterSuggests:{type:"boolean",group:"Behavior",defaultValue:true},maxSuggestionWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},startSuggestion:{type:"int",group:"Behavior",defaultValue:1},showTableSuggestionValueHelp:{type:"boolean",group:"Behavior",defaultValue:true},description:{type:"string",group:"Misc",defaultValue:null},fieldWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"50%"},valueLiveUpdate:{type:"boolean",group:"Behavior",defaultValue:false},selectedKey:{type:"string",group:"Data",defaultValue:""},textFormatMode:{type:"sap.m.InputTextFormatMode",group:"Misc",defaultValue:L.Value},textFormatter:{type:"any",group:"Misc",defaultValue:""},suggestionRowValidator:{type:"any",group:"Misc",defaultValue:""},enableSuggestionsHighlighting:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"suggestionItems",aggregations:{suggestionItems:{type:"sap.ui.core.Item",multiple:true,singularName:"suggestionItem"},suggestionColumns:{type:"sap.m.Column",multiple:true,singularName:"suggestionColumn",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"columns"}},suggestionRows:{type:"sap.m.ColumnListItem",multiple:true,singularName:"suggestionRow",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"items"}},_valueHelpIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false},selectedRow:{type:"sap.m.ColumnListItem",multiple:false}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},valueHelpRequest:{parameters:{fromSuggestions:{type:"boolean"}}},suggest:{parameters:{suggestValue:{type:"string"},suggestionColumns:{type:"sap.m.ListBase"}}},suggestionItemSelected:{parameters:{selectedItem:{type:"sap.ui.core.Item"},selectedRow:{type:"sap.m.ColumnListItem"}}},submit:{parameters:{value:{type:"string"}}}},designtime:"sap/m/designtime/Input.designtime"}});d.insertFontFaceStyle();w._wordStartsWithValue=function(t,i){var s;while(t){if(e.sap.startsWithIgnoreCase(t,i)){return true}s=t.indexOf(" ");if(s==-1){break}t=t.substring(s+1)}return false};w._DEFAULTFILTER=function(e,t){if(t instanceof g&&w._wordStartsWithValue(t.getAdditionalText(),e)){return true}return w._wordStartsWithValue(t.getText(),e)};w._DEFAULTFILTER_TABULAR=function(e,t){var i=t.getCells(),s=0;for(;s<i.length;s++){if(i[s].getText){if(w._wordStartsWithValue(i[s].getText(),e)){return true}}}return false};w._DEFAULTRESULT_TABULAR=function(e){var t=e.getCells(),i=0;for(;i<t.length;i++){if(t[i].getText){return t[i].getText()}}return""};w.prototype.init=function(){s.prototype.init.call(this);this._fnFilter=w._DEFAULTFILTER;this._bUseDialog=S.system.phone;this._bFullScreen=S.system.phone;this._iSetCount=0;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m")};w.prototype.exit=function(){this._deregisterEvents();this.cancelPendingSuggest();if(this._iRefreshListTimeout){e.sap.clearDelayedCall(this._iRefreshListTimeout);this._iRefreshListTimeout=null}if(this._oSuggestionPopup){this._oSuggestionPopup.destroy();this._oSuggestionPopup=null}if(this._oList){this._oList.destroy();this._oList=null}if(this._oSuggestionTable){this._oSuggestionTable.destroy();this._oSuggestionTable=null}if(this._oButtonToolbar){this._oButtonToolbar.destroy();this._oButtonToolbar=null}if(this._oShowMoreButton){this._oShowMoreButton.destroy();this._oShowMoreButton=null}};w.prototype._resizePopup=function(){var e=this;if(this._oList&&this._oSuggestionPopup){if(this.getMaxSuggestionWidth()){this._oSuggestionPopup.setContentWidth(this.getMaxSuggestionWidth())}else{this._oSuggestionPopup.setContentWidth(this.$().outerWidth()+"px")}setTimeout(function(){if(e._oSuggestionPopup&&e._oSuggestionPopup.isOpen()&&e._oSuggestionPopup.$().outerWidth()<e.$().outerWidth()){e._oSuggestionPopup.setContentWidth(e.$().outerWidth()+"px")}},0)}};w.prototype.onBeforeRendering=function(){var e=this.getSelectedKey();s.prototype.onBeforeRendering.call(this);this._deregisterEvents();if(e){this.setSelectedKey(e)}if(this.getShowSuggestion()){if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton()}else{this._removeShowMoreButton()}}};w.prototype.onAfterRendering=function(){s.prototype.onAfterRendering.call(this);if(this._bUseDialog&&this.getEditable()&&this.getEnabled()){this.$().on("click",e.proxy(function(e){if(this._onclick){this._onclick(e)}if(this.getShowSuggestion()&&this._oSuggestionPopup&&e.target.id!=this.getId()+"-vhi"){this._oSuggestionPopup.open()}},this))}};w.prototype._getDisplayText=function(e){var t=this.getTextFormatter();if(t){return t(e)}var i=e.getText(),s=e.getKey(),o=this.getTextFormatMode();switch(o){case L.Key:return s;case L.ValueKey:return i+" ("+s+")";case L.KeyValue:return"("+s+") "+i;default:return i}};w.prototype._onValueUpdated=function(e){if(this._bSelectingItem||e===this._sSelectedValue){return}var t=this.getSelectedKey(),i;if(t===""){return}if(this._hasTabularSuggestions()){i=this._oSuggestionTable&&!!this._oSuggestionTable.getSelectedItem()}else{i=this._oList&&!!this._oList.getSelectedItem()}if(i){return}this.setProperty("selectedKey","",true);this.setAssociation("selectedRow",null,true);this.setAssociation("selectedItem",null,true);this.fireSuggestionItemSelected({selectedItem:null,selectedRow:null})};w.prototype._updateSelectionFromList=function(){if(this._iPopupListSelectedIndex<0){return false}var e=this._oList.getSelectedItem();if(e){if(this._hasTabularSuggestions()){this.setSelectionRow(e,true)}else{this.setSelectionItem(e._oItem,true)}}return true};w.prototype.setSelectionItem=function(e,t){this._bSelectingItem=true;if(!e){this.setAssociation("selectedItem",null,true);return}var i=this._iSetCount,s;this.setAssociation("selectedItem",e,true);this.setProperty("selectedKey",e.getKey(),true);if(t){this.fireSuggestionItemSelected({selectedItem:e})}if(i!==this._iSetCount){s=this.getValue()}else{s=this._getDisplayText(e)}this._sSelectedValue=s;this.updateInputField(s);this._iPopupListSelectedIndex=-1;if(!(this._bUseDialog&&this instanceof sap.m.MultiInput&&this._isMultiLineMode)){this._closeSuggestionPopup()}if(!S.support.touch){this._doSelect()}this._bSelectingItem=false};w.prototype.setSelectedItem=function(e){if(typeof e==="string"){e=sap.ui.getCore().byId(e)}if(e!==null&&!(e instanceof u)){return this}this.setSelectionItem(e);return this};w.prototype.setSelectedKey=function(e){e=this.validateProperty("selectedKey",e);this.setProperty("selectedKey",e,true);if(this._hasTabularSuggestions()){return this}if(!e){this.setSelectionItem();return this}var t=this.getSuggestionItemByKey(e);this.setSelectionItem(t);return this};w.prototype.getSuggestionItemByKey=function(e){var t=this.getSuggestionItems()||[],i,s;for(s=0;s<t.length;s++){i=t[s];if(i.getKey()===e){return i}}};w.prototype.setSelectionRow=function(e,t){if(!e){this.setAssociation("selectedRow",null,true);return}this._bSelectingItem=true;var i,s=this.getSuggestionRowValidator();if(s){i=s(e);if(!(i instanceof u)){i=null}}var o=this._iSetCount,n="",r;this.setAssociation("selectedRow",e,true);if(i){n=i.getKey()}this.setProperty("selectedKey",n,true);if(t){this.fireSuggestionItemSelected({selectedRow:e})}if(o!==this._iSetCount){r=this.getValue()}else{if(i){r=this._getDisplayText(i)}else{r=this._fnRowResultFilter?this._fnRowResultFilter(e):w._DEFAULTRESULT_TABULAR(e)}}this._sSelectedValue=r;this.updateInputField(r);this._iPopupListSelectedIndex=-1;if(!(this._bUseDialog&&this instanceof sap.m.MultiInput&&this._isMultiLineMode)){this._closeSuggestionPopup()}if(!S.support.touch){this._doSelect()}this._bSelectingItem=false};w.prototype.setSelectedRow=function(e){if(typeof e==="string"){e=sap.ui.getCore().byId(e)}if(e!==null&&!(e instanceof r)){return this}this.setSelectionRow(e);return this};w.prototype._getValueHelpIcon=function(){var e=this,t=this.getAggregation("_valueHelpIcon"),i;if(t){return t}i=d.getIconURI("value-help");t=d.createControlByURI({id:this.getId()+"-vhi",src:i,useIconTooltip:false,noTabStop:true});t.addStyleClass("sapMInputValHelpInner");t.attachPress(function(t){if(!e.getValueHelpOnly()){this.getParent().focus();e.bValueHelpRequested=true;e.fireValueHelpRequest({fromSuggestions:false})}});this.setAggregation("_valueHelpIcon",t);return t};w.prototype._fireValueHelpRequestForValueHelpOnly=function(){if(this.getEnabled()&&this.getEditable()&&this.getShowValueHelp()&&this.getValueHelpOnly()){if(S.system.phone){this.focus()}this.fireValueHelpRequest({fromSuggestions:false})}};w.prototype.ontap=function(e){s.prototype.ontap.call(this,e);this._fireValueHelpRequestForValueHelpOnly()};w.prototype.setWidth=function(e){return s.prototype.setWidth.call(this,e||"100%")};w.prototype.getWidth=function(){return this.getProperty("width")||"100%"};w.prototype.setFilterFunction=function(t){if(t===null||t===undefined){this._fnFilter=w._DEFAULTFILTER;return this}e.sap.assert(typeof t==="function","Input.setFilterFunction: first argument fnFilter must be a function on "+this);this._fnFilter=t;return this};w.prototype.setRowResultFunction=function(t){var i;if(t===null||t===undefined){this._fnRowResultFilter=w._DEFAULTRESULT_TABULAR;return this}e.sap.assert(typeof t==="function","Input.setRowResultFunction: first argument fnFilter must be a function on "+this);this._fnRowResultFilter=t;i=this.getSelectedRow();if(i){this.setSelectedRow(i)}return this};w.prototype.closeSuggestions=function(){this._closeSuggestionPopup()};w.prototype._doSelect=function(e,t){if(S.support.touch){return}var i=this._$input[0];if(i){var s=this._$input;i.focus();s.selectText(e?e:0,t?t:s.val().length)}return this};w.prototype._scrollToItem=function(e){var t=this._oSuggestionPopup,i=this._oList,s,o,u,r,a;if(!(t instanceof n)||!i){return}s=t.getScrollDelegate();if(!s){return}var l=i.getItems()[e],g=l&&l.getDomRef();if(!g){return}o=t.getDomRef("cont").getBoundingClientRect();u=g.getBoundingClientRect();r=o.top-u.top;a=u.bottom-o.bottom;if(r>0){s.scrollTo(s._scrollX,Math.max(s._scrollY-r,0))}else if(a>0){s.scrollTo(s._scrollX,s._scrollY+a)}};w.prototype._isSuggestionItemSelectable=function(e){return e.getVisible()&&(this._hasTabularSuggestions()||e.getType()!==T.Inactive)};w.prototype._isIncrementalType=function(){var e=this.getType();if(e==="Number"||e==="Date"||e==="Datetime"||e==="Month"||e==="Time"||e==="Week"){return true}return false};w.prototype._onsaparrowkey=function(e,t,i){if(!this.getEnabled()||!this.getEditable()){return}if(t!=="up"&&t!=="down"){return}if(this._isIncrementalType()){e.setMarked()}if(!this._oSuggestionPopup||!this._oSuggestionPopup.isOpen()){return}e.preventDefault();e.stopPropagation();var s=false,o=this._oList,n=this.getSuggestionItems(),u=o.getItems(),a=this._iPopupListSelectedIndex,l,p=a;if(t==="up"&&a===0){return}if(t=="down"&&a===u.length-1){return}var h;if(i>1){if(t=="down"&&a+i>=u.length){t="up";i=1;u[a].setSelected(false);h=a;a=u.length-1;s=true}else if(t=="up"&&a-i<0){t="down";i=1;u[a].setSelected(false);h=a;a=0;s=true}}if(a===-1){a=0;if(this._isSuggestionItemSelectable(u[a])){p=a;s=true}else{t="down"}}if(t==="down"){while(a<u.length-1&&(!s||!this._isSuggestionItemSelectable(u[a]))){u[a].setSelected(false);a=a+i;s=true;i=1;if(h===a){break}}}else{while(a>0&&(!s||!u[a].getVisible()||!this._isSuggestionItemSelectable(u[a]))){u[a].setSelected(false);a=a-i;s=true;i=1;if(h===a){break}}}if(!this._isSuggestionItemSelectable(u[a])){if(p>=0){u[p].setSelected(true).updateAccessibilityState();this.$("inner").attr("aria-activedescendant",u[p].getId())}return}else{u[a].setSelected(true).updateAccessibilityState();this.$("inner").attr("aria-activedescendant",u[a].getId())}if(S.system.desktop){this._scrollToItem(a)}if(r&&u[a]instanceof r){l=this._getInputValue(this._fnRowResultFilter(u[a]))}else{var f=n[0]instanceof g?true:false;if(f){l=this._getInputValue(u[a].getLabel())}else{l=this._getInputValue(u[a].getTitle())}}this.setDOMValue(l);this._sSelectedSuggViaKeyboard=l;this._doSelect();this._iPopupListSelectedIndex=a};w.prototype.onsapup=function(e){this._onsaparrowkey(e,"up",1)};w.prototype.onsapdown=function(e){this._onsaparrowkey(e,"down",1)};w.prototype.onsappageup=function(e){this._onsaparrowkey(e,"up",5)};w.prototype.onsappagedown=function(e){this._onsaparrowkey(e,"down",5)};w.prototype.onsaphome=function(e){if(this._oList){this._onsaparrowkey(e,"up",this._oList.getItems().length)}};w.prototype.onsapend=function(e){if(this._oList){this._onsaparrowkey(e,"down",this._oList.getItems().length)}};w.prototype.onsapescape=function(e){var t;if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){e.originalEvent._sapui_handledByControl=true;this._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();if(this._sBeforeSuggest!==undefined){if(this._sBeforeSuggest!==this.getValue()){t=this._lastValue;this.setValue(this._sBeforeSuggest);this._lastValue=t}this._sBeforeSuggest=undefined}return}if(s.prototype.onsapescape){s.prototype.onsapescape.apply(this,arguments)}};w.prototype.onsapenter=function(e){this.cancelPendingSuggest();if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){if(!this._updateSelectionFromList()){this._closeSuggestionPopup()}}if(s.prototype.onsapenter){s.prototype.onsapenter.apply(this,arguments)}if(this.getEnabled()&&this.getEditable()&&!(this.getValueHelpOnly()&&this.getShowValueHelp())){this.fireSubmit({value:this.getValue()})}};w.prototype.onsapfocusleave=function(t){var i=this._oSuggestionPopup;if(i instanceof n){if(t.relatedControlId&&e.sap.containsOrEquals(i.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){this._bPopupHasFocus=true;this.focus()}else{if(this.getDOMValue()===this._sSelectedSuggViaKeyboard){this._sSelectedSuggViaKeyboard=null}}}var o=sap.ui.getCore().byId(t.relatedControlId);if(!(i&&o&&e.sap.containsOrEquals(i.getDomRef(),o.getFocusDomRef()))){s.prototype.onsapfocusleave.apply(this,arguments)}this.bValueHelpRequested=false};w.prototype.onmousedown=function(e){var t=this._oSuggestionPopup;if(t instanceof n&&t.isOpen()){e.stopPropagation()}};w.prototype._registerResize=function(){if(!this._bFullScreen){this._sPopupResizeHandler=y.register(this,this._resizePopup.bind(this))}};w.prototype._deregisterResize=function(){if(this._sPopupResizeHandler){this._sPopupResizeHandler=y.deregister(this._sPopupResizeHandler)}};w.prototype._deregisterEvents=function(){this._deregisterResize();if(this._bUseDialog&&this._oSuggestionPopup){this.$().off("click")}};w.prototype.updateSuggestionItems=function(){this._bSuspendInvalidate=true;this.updateAggregation("suggestionItems");this._synchronizeSuggestions();this._bSuspendInvalidate=false;return this};w.prototype.invalidate=function(){if(!this._bSuspendInvalidate){m.prototype.invalidate.apply(this,arguments)}};w.prototype.cancelPendingSuggest=function(){if(this._iSuggestDelay){e.sap.clearDelayedCall(this._iSuggestDelay);this._iSuggestDelay=null}};w.prototype._triggerSuggest=function(t){this.cancelPendingSuggest();this._bShouldRefreshListItems=true;if(!t){t=""}if(t.length>=this.getStartSuggestion()){this._iSuggestDelay=e.sap.delayedCall(300,this,function(){if(this._sPrevSuggValue!==t){this._bBindingUpdated=false;this.fireSuggest({suggestValue:t});if(!this._bBindingUpdated){this._refreshItemsDelayed()}this._sPrevSuggValue=t}})}else if(this._bUseDialog){if(this._oList instanceof p){this._oList.addStyleClass("sapMInputSuggestionTableHidden")}else if(this._oList&&this._oList.destroyItems){this._oList.destroyItems()}}else if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){e.sap.delayedCall(0,this,function(){var e=this.getDOMValue()||"";if(e<this.getStartSuggestion()){this._iPopupListSelectedIndex=-1;this._closeSuggestionPopup()}})}};(function(){w.prototype.setShowSuggestion=function(e){this.setProperty("showSuggestion",e,true);this._iPopupListSelectedIndex=-1;if(e){this._lazyInitializeSuggestionPopup(this)}else{c(this)}return this};w.prototype.setShowTableSuggestionValueHelp=function(e){this.setProperty("showTableSuggestionValueHelp",e,true);if(!this._oSuggestionPopup){return this}if(e){this._addShowMoreButton()}else{this._removeShowMoreButton()}return this};w.prototype._getShowMoreButton=function(){var e=this,t=this._oRb;return this._oShowMoreButton||(this._oShowMoreButton=new sap.m.Button({text:t.getText("INPUT_SUGGESTIONS_SHOW_ALL"),press:function(){if(e.getShowTableSuggestionValueHelp()){e.fireValueHelpRequest({fromSuggestions:true});e._iPopupListSelectedIndex=-1;e._closeSuggestionPopup()}}}))};w.prototype._getButtonToolbar=function(){var e=this._getShowMoreButton();return this._oButtonToolbar||(this._oButtonToolbar=new h({content:[new f,e]}))};w.prototype._addShowMoreButton=function(e){if(!this._oSuggestionPopup||!e&&!this._hasTabularSuggestions()){return}if(this._oSuggestionPopup instanceof i){var t=this._getShowMoreButton();this._oSuggestionPopup.setEndButton(t)}else{var s=this._getButtonToolbar();this._oSuggestionPopup.setFooter(s)}};w.prototype._removeShowMoreButton=function(){if(!this._oSuggestionPopup||!this._hasTabularSuggestions()){return}if(this._oSuggestionPopup instanceof i){this._oSuggestionPopup.setEndButton(null)}else{this._oSuggestionPopup.setFooter(null)}};w.prototype.oninput=function(e){s.prototype.oninput.call(this,e);if(e.isMarked("invalid")){return}var t=this.getDOMValue();if(this.getValueLiveUpdate()){this.setProperty("value",t,true);this._onValueUpdated(t)}this.fireLiveChange({value:t,newValue:t});if(this.getShowSuggestion()&&!this._bUseDialog){this._triggerSuggest(t)}};w.prototype.getValue=function(){return this.getDomRef("inner")&&this._$input?this.getDOMValue():this.getProperty("value")};w.prototype._refreshItemsDelayed=function(){e.sap.clearDelayedCall(this._iRefreshListTimeout);this._iRefreshListTimeout=e.sap.delayedCall(0,this,S,[this])};w.prototype.addSuggestionItem=function(e){this.addAggregation("suggestionItems",e,true);this._synchronizeSuggestions();r(this);return this};w.prototype.insertSuggestionItem=function(e,t){this.insertAggregation("suggestionItems",t,e,true);this._synchronizeSuggestions();r(this);return this};w.prototype.removeSuggestionItem=function(e){var t=this.removeAggregation("suggestionItems",e,true);this._synchronizeSuggestions();return t};w.prototype.removeAllSuggestionItems=function(){var e=this.removeAllAggregation("suggestionItems",true);this._synchronizeSuggestions();return e};w.prototype.destroySuggestionItems=function(){this.destroyAggregation("suggestionItems",true);this._synchronizeSuggestions();return this};w.prototype.addSuggestionRow=function(e){e.setType(T.Active);this.addAggregation("suggestionRows",e);this._synchronizeSuggestions();r(this);return this};w.prototype.insertSuggestionRow=function(e,t){e.setType(T.Active);this.insertAggregation("suggestionRows",e,t);this._synchronizeSuggestions();r(this);return this};w.prototype.removeSuggestionRow=function(e){var t=this.removeAggregation("suggestionRows",e);this._synchronizeSuggestions();return t};w.prototype.removeAllSuggestionRows=function(){var e=this.removeAllAggregation("suggestionRows");this._synchronizeSuggestions();return e};w.prototype.destroySuggestionRows=function(){this.destroyAggregation("suggestionRows");this._synchronizeSuggestions();return this};w.prototype.bindAggregation=function(){if(arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns"||arguments[0]==="suggestionItems"){r(this,arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns");this._bBindingUpdated=true}return s.prototype.bindAggregation.apply(this,arguments)};w.prototype._lazyInitializeSuggestionPopup=function(){if(!this._oSuggestionPopup){u(this)}};w.prototype._closeSuggestionPopup=function(){if(this._oSuggestionPopup){this._bShouldRefreshListItems=false;this.cancelPendingSuggest();this._oSuggestionPopup.close();if(!this._bUseDialog&&this.$().hasClass("sapMInputFocused")){this.openValueStateMessage()}this.$("SuggDescr").text("");this.$("inner").removeAttr("aria-haspopup");this.$("inner").removeAttr("aria-activedescendant");this._sPrevSuggValue=null}};w.prototype._synchronizeSuggestions=function(){this._bShouldRefreshListItems=true;this._refreshItemsDelayed();if(!this.getDomRef()||this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){return}this._synchronizeSelection()};w.prototype._synchronizeSelection=function(){var e=this.getSelectedKey();if(!e){return}if(this.getValue()&&!this.getSelectedItem()&&!this.getSelectedRow()){return}this.setSelectedKey(e)};function u(e){var s=e._oRb;if(e._bUseDialog){e._oPopupInput=new w(e.getId()+"-popup-input",{width:"100%",valueLiveUpdate:true,showValueHelp:e.getShowValueHelp(),valueHelpRequest:function(t){e.fireValueHelpRequest({fromSuggestions:true});e._iPopupListSelectedIndex=-1;e._closeSuggestionPopup()},liveChange:function(t){var i=t.getParameter("newValue");e.setDOMValue(e._getInputValue(e._oPopupInput.getValue()));e._triggerSuggest(i);e.fireLiveChange({value:i,newValue:i})}}).addStyleClass("sapMInputSuggInDialog")}e._oSuggestionPopup=!e._bUseDialog?new n(e.getId()+"-popup",{showArrow:false,showHeader:false,placement:v.Vertical,initialFocus:e,horizontalScrolling:true}).attachAfterClose(function(){e._updateSelectionFromList();if(e._oList instanceof p){e._oList.removeSelections(true)}else{e._oList.destroyItems()}e._deregisterResize()}).attachBeforeOpen(function(){e._sBeforeSuggest=e.getValue();e._resizePopup();e._registerResize()}):new i(e.getId()+"-popup",{beginButton:new sap.m.Button(e.getId()+"-popup-closeButton",{text:s.getText("MSGBOX_CLOSE"),press:function(){e._closeSuggestionPopup()}}),stretch:e._bFullScreen,contentHeight:e._bFullScreen?undefined:"20rem",customHeader:new t(e.getId()+"-popup-header",{contentMiddle:e._oPopupInput.addEventDelegate({onsapenter:function(){if(!(sap.m.MultiInput&&e instanceof sap.m.MultiInput)){e._closeSuggestionPopup()}}},this)}),horizontalScrolling:false,initialFocus:e._oPopupInput}).attachBeforeOpen(function(){e._oPopupInput.setPlaceholder(e.getPlaceholder());e._oPopupInput.setMaxLength(e.getMaxLength())}).attachBeforeClose(function(){e.setDOMValue(e._getInputValue(e._oPopupInput.getValue()));e.onChange();if(e instanceof sap.m.MultiInput&&e._bUseDialog){e._onDialogClose()}}).attachAfterClose(function(){if(e instanceof sap.m.MultiInput&&e._isMultiLineMode){e._showIndicator()}if(e._oList){if(p&&!(e._oList instanceof p)){e._oList.destroyItems()}else{e._oList.removeSelections(true)}}}).attachAfterOpen(function(){var t=e.getValue();e._oPopupInput.setValue(t);e._triggerSuggest(t);S(e)});e._oSuggestionPopup.addStyleClass("sapMInputSuggestionPopup");e._oSuggestionPopup.addAriaLabelledBy(_.getStaticId("sap.m","INPUT_AVALIABLE_VALUES"));e.addDependent(e._oSuggestionPopup);if(!e._bUseDialog){d(e._oSuggestionPopup,e)}if(e._oList){e._oSuggestionPopup.addContent(e._oList)}if(e.getShowTableSuggestionValueHelp()){e._addShowMoreButton()}}function r(e,t){if(e._bIsBeingDestroyed||e._oList){return}if(!e._hasTabularSuggestions()&&!t){e._oList=new o(e.getId()+"-popup-list",{showNoData:false,mode:b.SingleSelectMaster,rememberSelections:false,itemPress:function(t){var i=t.getParameter("listItem");e.setSelectionItem(i._oItem,true)}});e._oList.addEventDelegate({onAfterRendering:e._highlightListText.bind(e)})}else{if(e._fnFilter===w._DEFAULTFILTER){e._fnFilter=w._DEFAULTFILTER_TABULAR}if(!e._fnRowResultFilter){e._fnRowResultFilter=w._DEFAULTRESULT_TABULAR}e._oList=e._getSuggestionsTable();if(e.getShowTableSuggestionValueHelp()){e._addShowMoreButton(t)}}if(e._oSuggestionPopup){if(e._bUseDialog){e._oSuggestionPopup.addAggregation("content",e._oList,true);var i=e._oSuggestionPopup.$("scrollCont")[0];if(i){var s=sap.ui.getCore().createRenderManager();s.renderControl(e._oList);s.flush(i);s.destroy()}}else{e._oSuggestionPopup.addContent(e._oList)}}}function c(e){if(e._oSuggestionPopup){if(e._oList instanceof p){e._oSuggestionPopup.removeAllContent();e._removeShowMoreButton()}e._oSuggestionPopup.destroy();e._oSuggestionPopup=null}if(e._oList instanceof o){e._oList.destroy();e._oList=null}}function d(e,t){e.open=function(){this.openBy(t,false,true)};e.oPopup.setAnimations(function(e,t,i){i()},function(e,t,i){i()})}function S(e){var t=e.getShowSuggestion();var i=e._oRb;e._iPopupListSelectedIndex=-1;if(!t||!e._bShouldRefreshListItems||!e.getDomRef()||!e._bUseDialog&&!e.$().hasClass("sapMInputFocused")){return false}var s,o=e.getSuggestionItems(),n=e.getSuggestionRows(),u=e.getDOMValue()||"",r=e._oList,h=e.getFilterSuggests(),f=[],c=0,d=e._oSuggestionPopup,_={ontouchstart:function(e){(e.originalEvent||e)._sapui_cancelAutoClose=true}},S,y;if(e._oList){if(e._oList instanceof p){r.removeSelections(true)}else{r.destroyItems()}}if(u.length<e.getStartSuggestion()){if(!e._bUseDialog){e._iPopupListSelectedIndex=-1;this.cancelPendingSuggest();d.close()}else{if(e._hasTabularSuggestions()&&e._oList){e._oList.addStyleClass("sapMInputSuggestionTableHidden")}}e.$("SuggDescr").text("");e.$("inner").removeAttr("aria-haspopup");e.$("inner").removeAttr("aria-activedescendant");return false}if(e._hasTabularSuggestions()){if(e._bUseDialog&&e._oList){e._oList.removeStyleClass("sapMInputSuggestionTableHidden")}for(y=0;y<n.length;y++){if(!h||e._fnFilter(u,n[y])){n[y].setVisible(true);f.push(n[y])}else{n[y].setVisible(false)}}e._oSuggestionTable.invalidate()}else{var m=o[0]instanceof g?true:false;for(y=0;y<o.length;y++){s=o[y];if(!h||e._fnFilter(u,s)){if(m){S=new l(s.getId()+"-dli");S.setLabel(s.getText());S.setValue(s.getAdditionalText())}else{S=new a(s.getId()+"-sli");S.setTitle(s.getText())}S.setType(s.getEnabled()?T.Active:T.Inactive);S._oItem=s;S.addEventDelegate(_);f.push(S)}}}c=f.length;var I="";if(c>0){if(c==1){I=i.getText("INPUT_SUGGESTIONS_ONE_HIT")}else{I=i.getText("INPUT_SUGGESTIONS_MORE_HITS",c)}e.$("inner").attr("aria-haspopup","true");if(!e._hasTabularSuggestions()){for(y=0;y<c;y++){r.addItem(f[y])}}if(!e._bUseDialog){if(e._sCloseTimer){clearTimeout(e._sCloseTimer);e._sCloseTimer=null}if(!d.isOpen()&&!e._sOpenTimer&&this.getValue().length>=this.getStartSuggestion()){e._sOpenTimer=setTimeout(function(){e._sOpenTimer=null;d.open()},0)}}}else{I=i.getText("INPUT_SUGGESTIONS_NO_HIT");e.$("inner").removeAttr("aria-haspopup");e.$("inner").removeAttr("aria-activedescendant");if(!e._bUseDialog){if(d.isOpen()){e._sCloseTimer=setTimeout(function(){e._iPopupListSelectedIndex=-1;e.cancelPendingSuggest();d.close()},0)}}else{if(e._hasTabularSuggestions()&&e._oList){e._oList.addStyleClass("sapMInputSuggestionTableHidden")}}}e.$("SuggDescr").text(I)}})();w.prototype._createHighlightedText=function(t){var i=t.innerText,s=this.getValue().toLowerCase(),o=s.length,n=i.toLowerCase(),u,r="";if(!w._wordStartsWithValue(i,s)){return e.sap.encodeHTML(i)}var a=n.indexOf(s);if(a>0){a=n.indexOf(" "+s)+1}if(a>-1){r+=e.sap.encodeHTML(i.substring(0,a));u=i.substring(a,a+o);r+='<span class="sapMInputHighlight">'+e.sap.encodeHTML(u)+"</span>";r+=e.sap.encodeHTML(i.substring(a+o))}else{r=e.sap.encodeHTML(i)}return r};w.prototype._highlightListText=function(){if(!this.getEnableSuggestionsHighlighting()){return}var e,t,i=this._oList.$().find(".sapMDLILabel, .sapMSLITitleOnly, .sapMDLIValue");for(e=0;e<i.length;e++){t=i[e];t.innerHTML=this._createHighlightedText(t)}};w.prototype._highlightTableText=function(){if(!this.getEnableSuggestionsHighlighting()){return}var e,t,i=this._oSuggestionTable.$().find("tbody .sapMLabel");for(e=0;e<i.length;e++){t=i[e];t.innerHTML=this._createHighlightedText(t)}};w.prototype.onfocusin=function(e){s.prototype.onfocusin.apply(this,arguments);this.$().addClass("sapMInputFocused");if(!this._bUseDialog&&this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()){this.closeValueStateMessage()}if(!this._bPopupHasFocus&&!this.getStartSuggestion()&&!this.getValue()){this._triggerSuggest(this.getValue())}this._bPopupHasFocus=undefined;this._sPrevSuggValue=null};w.prototype.onsapshow=function(e){if(!this.getEnabled()||!this.getEditable()||!this.getShowValueHelp()){return}this.bValueHelpRequested=true;this.fireValueHelpRequest({fromSuggestions:false});e.preventDefault();e.stopPropagation()};w.prototype.onsaphide=w.prototype.onsapshow;w.prototype.onsapselect=function(e){this._fireValueHelpRequestForValueHelpOnly()};w.prototype.onfocusout=function(e){s.prototype.onfocusout.apply(this,arguments);this.$().removeClass("sapMInputFocused");this.closeValueStateMessage(this)};w.prototype._hasTabularSuggestions=function(){return!!(this.getAggregation("suggestionColumns")&&this.getAggregation("suggestionColumns").length)};w.prototype._getSuggestionsTable=function(){if(this._bIsBeingDestroyed){return}var e=this;if(!this._oSuggestionTable){this._oSuggestionTable=new p(this.getId()+"-popup-table",{mode:b.SingleSelectMaster,showNoData:false,showSeparators:"All",width:"100%",enableBusyIndicator:false,rememberSelections:false,selectionChange:function(t){var i=t.getParameter("listItem");e.setSelectionRow(i,true)}});this._oSuggestionTable.addEventDelegate({onAfterRendering:this._highlightTableText.bind(this)});if(this._bUseDialog){this._oSuggestionTable.addStyleClass("sapMInputSuggestionTableHidden")}this._oSuggestionTable.updateItems=function(){p.prototype.updateItems.apply(this,arguments);e._refreshItemsDelayed();return this}}return this._oSuggestionTable};w.prototype._fireSuggestionItemSelectedEvent=function(){if(this._iPopupListSelectedIndex>=0){var e=this._oList.getItems()[this._iPopupListSelectedIndex];if(e){if(r&&e instanceof r){this.fireSuggestionItemSelected({selectedRow:e})}else{this.fireSuggestionItemSelected({selectedItem:e._oItem})}}this._iPopupListSelectedIndex=-1}};w.prototype.clone=function(){var t=m.prototype.clone.apply(this,arguments),i;i=this.getBindingInfo("suggestionColumns");if(i){t.bindAggregation("suggestionColumns",e.extend({},i))}else{this.getSuggestionColumns().forEach(function(e){t.addSuggestionColumn(e.clone(),true)})}i=this.getBindingInfo("suggestionRows");if(i){t.bindAggregation("suggestionRows",e.extend({},i))}else{this.getSuggestionRows().forEach(function(e){t.addSuggestionRow(e.clone(),true)})}t.setRowResultFunction(this._fnRowResultFilter);return t};w.prototype.setValue=function(e){this._iSetCount++;s.prototype.setValue.call(this,e);this._onValueUpdated(e);return this};w.prototype.setDOMValue=function(e){this._$input.val(e)};w.prototype.getDOMValue=function(){return this._$input.val()};w.prototype.updateInputField=function(e){if(this._oSuggestionPopup&&this._oSuggestionPopup.isOpen()&&this._bUseDialog){this._oPopupInput.setValue(e);this._oPopupInput._doSelect()}else{e=this._getInputValue(e);this.setDOMValue(e);this.onChange(null,null,e)}};w.prototype.getAccessibilityInfo=function(){var e=s.prototype.getAccessibilityInfo.apply(this,arguments);e.description=((e.description||"")+" "+this.getDescription()).trim();return e};w.prototype.preventChangeOnFocusLeave=function(e){return this.bFocusoutDueRendering||this.bValueHelpRequested};return w});