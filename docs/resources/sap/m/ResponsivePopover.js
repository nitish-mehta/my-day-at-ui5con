/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Dialog","./Popover","./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/base/ManagedObject","sap/ui/Device","./ResponsivePopoverRenderer"],function(t,e,o,n,r,i,s,a,l){"use strict";var p=n.DialogType;var u=n.PlacementType;var g=r.extend("sap.m.ResponsivePopover",{metadata:{library:"sap.m",properties:{placement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:u.Right},showHeader:{type:"boolean",group:"Misc",defaultValue:true},title:{type:"string",group:"Misc",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},modal:{type:"boolean",group:"Misc",defaultValue:null},offsetX:{type:"int",group:"Misc",defaultValue:null},offsetY:{type:"int",group:"Misc",defaultValue:null},showArrow:{type:"boolean",group:"Appearance",defaultValue:true},contentWidth:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},contentHeight:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},horizontalScrolling:{type:"boolean",group:"Misc",defaultValue:true},verticalScrolling:{type:"boolean",group:"Misc",defaultValue:true},showCloseButton:{type:"boolean",group:"Misc",defaultValue:true},resizable:{type:"boolean",group:"Dimension",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"},customHeader:{type:"sap.m.IBar",multiple:false},subHeader:{type:"sap.m.IBar",multiple:false},beginButton:{type:"sap.m.Button",multiple:false},endButton:{type:"sap.m.Button",multiple:false},_popup:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{initialFocus:{type:"sap.ui.core.Control",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"}},events:{beforeOpen:{parameters:{openBy:{type:"sap.ui.core.Control"}}},afterOpen:{parameters:{openBy:{type:"sap.ui.core.Control"}}},beforeClose:{parameters:{openBy:{type:"sap.ui.core.Control"},origin:{type:"sap.m.Button"}}},afterClose:{parameters:{openBy:{type:"sap.ui.core.Control"},origin:{type:"sap.m.Button"}}}}}});g.prototype.init=function(){var t=this;this._bAppendedToUIArea=false;var n={resizable:t.getResizable(),beforeOpen:function(e){t.fireBeforeOpen({openBy:e.getParameter("openBy")})},afterOpen:function(e){t.fireAfterOpen({openBy:e.getParameter("openBy")})},beforeClose:function(e){t.fireBeforeClose({openBy:e.getParameter("openBy"),origin:e.getParameter("origin")})},afterClose:function(e){t.fireAfterClose({openBy:e.getParameter("openBy"),origin:e.getParameter("origin")})}};if(a.system.phone){this._aNotSupportedProperties=["placement","modal","offsetX","offsetY","showCloseButton"];n.stretch=true;n.type=p.Standard;this._oControl=new e(this.getId()+"-dialog",n)}else{this._aNotSupportedProperties=["icon","showCloseButton"];this._oControl=new o(this.getId()+"-popover",n)}this.setAggregation("_popup",this._oControl);this._oControl.addStyleClass("sapMResponsivePopover");this._oDelegate={onBeforeRendering:function(){var t=this.getShowCloseButton(),e=this._oControl._getAnyHeader(),o,n,r;if(!t||!a.system.phone){this._removeCloseButton(e);return}if(!this._bContentChanged){return}this._bContentChanged=false;if(e){this._insertCloseButton(e)}else{o=this._getSingleNavContent();if(!o){return}n=o.getCurrentPage();r=this._getRealPage(n);if(r&&(e=r._getAnyHeader())){this._insertCloseButton(e)}o.attachEvent("navigate",this._fnOnNavigate,this)}}};this._oPageDelegate={onAfterShow:function(){var e=t._getRealPage(this),o;if(e&&(o=e._getAnyHeader())){t._insertCloseButton(o)}}};this._fnOnNavigate=function(t){var e=t.getParameter("to");if(e){e.addEventDelegate(this._oPageDelegate,e)}};this._oControl.addEventDelegate(this._oDelegate,this);this._oControl._removeChild=function(e,o,n){var i,s;if(o==="content"&&e instanceof sap.m.NavContainer){i=e.getPages();for(s=0;s<i.length;s++){i[s].removeEventDelegate(t._oPageDelegate)}e.detachEvent("navigate",t._fnOnNavigate,t)}r.prototype._removeChild.apply(this,arguments)}};g.prototype.openBy=function(t){if(!this._bAppendedToUIArea&&!this.getParent()){var e=sap.ui.getCore().getStaticAreaRef();e=sap.ui.getCore().getUIArea(e);e.addContent(this,true);this._bAppendedToUIArea=true}if(a.system.phone){return this._oControl.open()}else{return this._oControl.openBy(t)}};g.prototype.exit=function(){if(this._oCloseButton){this._oCloseButton.destroy();this._oCloseButton=null}if(this._oControl){this._oControl.removeEventDelegate(this._oDelegate);this._oControl.destroy();this._oControl=null}};g.prototype._getCloseButton=function(){if(!this._oCloseButton){var t=this;this._oCloseButton=new sap.m.Button(this.getId()+"-closeButton",{icon:i.getIconURI("decline"),press:function(){t._oControl._oCloseTrigger=this;t.close()}})}return this._oCloseButton};g.prototype.addContent=function(t){this._bContentChanged=true;this.addAggregation("content",t)};g.prototype.clone=function(){var t=r.prototype.clone.apply(this,arguments),e=this.getAggregation("_popup").getContent();for(var o=0;o<e.length;o++){t.addContent(e[o].clone())}return t};g.prototype._getSingleNavContent=function(){var t=this.getContent();while(t.length===1&&t[0]instanceof sap.ui.core.mvc.View){t=t[0].getContent()}if(t.length===1&&t[0]instanceof sap.m.NavContainer){return t[0]}else{return null}};g.prototype._getRealPage=function(t){var e=t,o;while(e){if(e instanceof sap.m.Page){return e}if(e instanceof sap.ui.core.mvc.View){o=e.getContent();if(o.length===1){e=o[0];continue}}e=null}return e};g.prototype._insertCloseButton=function(t){var e=this._getCloseButton(),o;if(t&&t.addContentRight){o=t.getAggregation("contentRight",[]).length;t.insertAggregation("contentRight",e,o)}};g.prototype._removeCloseButton=function(t){var e=this._getCloseButton();if(t){t.removeAggregation("contentRight",e)}};g.prototype._firstLetterUpperCase=function(t){return t.charAt(0).toUpperCase()+t.slice(1)};g.prototype._lastIndexOfUpperCaseLetter=function(t){var e,o;for(e=t.length-1;e>=0;e--){o=t.charAt(e);if(o===o.toUpperCase()){return e}}return-1};g.prototype._oldSetProperty=g.prototype.setProperty;g.prototype.setProperty=function(e,o,n){this._oldSetProperty(e,o,true);var r="set"+this._firstLetterUpperCase(e);if(t.inArray(e,this._aNotSupportedProperties)===-1&&r in this._oControl){this._oControl[r](o)}return this};g.prototype._oldSetModel=g.prototype.setModel;g.prototype.setModel=function(t,e){this._oControl.setModel(t,e);return this._oldSetModel(t,e)};g.prototype._createButtonFooter=function(){if(this._oFooter){return this._oFooter}this._oFooter=new sap.m.Toolbar(this.getId()+"-footer",{content:[new sap.m.ToolbarSpacer]});return this._oFooter};g.prototype._setButton=function(t,e){if(this._oControl instanceof o){var n="get"+this._firstLetterUpperCase(t)+"Button",r=this[n](),i=this._createButtonFooter(),s="_o"+this._firstLetterUpperCase(t)+"Button",a=t.toLowerCase()==="begin"?0:1,l=t.toLowerCase()==="begin"?"getEndButton":"getBeginButton";if(r){i.removeContent(r)}if(e){if(!i.getParent()){this._oControl.setFooter(i)}i.insertContent(e,a+1)}else{var p=this[l]();if(!p){i.destroy();this._oFooter=null}}this[s]=e;return this}else{var u=t.toLowerCase()+"Button";return this.setAggregation(u,e)}};g.prototype._getButton=function(t){if(this._oControl instanceof o){var e="_o"+this._firstLetterUpperCase(t)+"Button";return this[e]}else{var n="get"+this._firstLetterUpperCase(t)+"Button";return this._oControl[n]()}};g.prototype.setBeginButton=function(t){this._oControl.setBeginButton(t);return this._setButton("begin",t)};g.prototype.setEndButton=function(t){this._oControl.setEndButton(t);return this._setButton("end",t)};g.prototype.setShowCloseButton=function(t){var e=this._oControl._getAnyHeader();if(t){this._insertCloseButton(e)}else{this._removeCloseButton(e)}this.setProperty("showCloseButton",t,true);return this};g.prototype.getBeginButton=function(){return this._getButton("begin")};g.prototype.getEndButton=function(){return this._getButton("end")};["bindAggregation","validateAggregation","setAggregation","getAggregation","indexOfAggregation","insertAggregation","addAggregation","removeAggregation","removeAllAggregation","destroyAggregation","setAssociation","getAssociation","addAssociation","removeAssociation","removeAllAssociation"].forEach(function(e){g.prototype[e]=function(){var o=this._lastIndexOfUpperCaseLetter(e),n,i;if(t.type(arguments[0])==="string"){if(o!==-1){n=e.substring(0,o)+this._firstLetterUpperCase(arguments[0]);if(this._oControl&&this._oControl[n]){i=this._oControl[n].apply(this._oControl,Array.prototype.slice.call(arguments,1));return i===this._oControl?this:i}else{return r.prototype[e].apply(this,arguments)}}}i=this._oControl[e].apply(this._oControl,arguments);return i===this._oControl?this:i}});["invalidate","close","isOpen","addStyleClass","removeStyleClass","toggleStyleClass","hasStyleClass","getDomRef","setBusy","getBusy","setBusyIndicatorDelay","getBusyIndicatorDelay","addEventDelegate"].forEach(function(t){g.prototype[t]=function(){if(this._oControl&&this._oControl[t]){var e=this._oControl[t].apply(this._oControl,arguments);return e===this._oControl?this:e}}});g.prototype._applyContextualSettings=function(){s.prototype._applyContextualSettings.call(this,s._defaultContextualSettings)};return g});