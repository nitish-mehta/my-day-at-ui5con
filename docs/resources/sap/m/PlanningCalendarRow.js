/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/core/Element","sap/ui/core/Control","./StandardListItem","./StandardListItemRenderer","sap/ui/core/Renderer","./library","sap/ui/unified/library","sap/ui/unified/DateRange","sap/ui/unified/CalendarRow","sap/ui/unified/CalendarRowRenderer","sap/m/ColumnListItem","sap/m/ColumnListItemRenderer","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragDropInfo"],function(e,t,a,n,r,o,i,s,g,l,p,d,u,D,f,m,c){"use strict";var h=g.CalendarIntervalType;var C="DragDropConfig";var w="ResizeConfig";var y="CreateConfig";var A=a.extend("sap.m.PlanningCalendarRow",{metadata:{library:"sap.m",properties:{title:{type:"string",group:"Data"},text:{type:"string",group:"Data"},icon:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},nonWorkingDays:{type:"int[]",group:"Misc",defaultValue:null},nonWorkingHours:{type:"int[]",group:"Misc",defaultValue:null},selected:{type:"boolean",group:"Data",defaultValue:false},key:{type:"string",group:"Data",defaultValue:null},enableAppointmentsDragAndDrop:{type:"boolean",group:"Misc",defaultValue:false},enableAppointmentsResize:{type:"boolean",group:"Misc",defaultValue:false},enableAppointmentsCreate:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{appointments:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"appointment",dnd:{draggable:true}},intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"intervalHeader"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},_nonWorkingDates:{type:"sap.ui.unified.DateRange",multiple:true,visibility:"hidden"}},events:{appointmentDrop:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},startDate:{type:"object"},endDate:{type:"object"},calendarRow:{type:"sap.m.PlanningCalendarRow"},copy:{type:"boolean"}}},appointmentDragEnter:{allowPreventDefault:true,parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},startDate:{type:"object"},endDate:{type:"object"},calendarRow:{type:"sap.m.PlanningCalendarRow"}}},appointmentResize:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},startDate:{type:"object"},endDate:{type:"object"}}},appointmentCreate:{parameters:{startDate:{type:"object"},endDate:{type:"object"},calendarRow:{type:"sap.m.PlanningCalendarRow"}}}}}});A.PC_FOREIGN_KEY_NAME="relatedToPCDateRange";A.AGGR_NONWORKING_DATES_NAME="_nonWorkingDates";var R=r.extend("CalenderRowHeader",{metadata:{associations:{parentRow:{type:"sap.m.PlanningCalendarRow",multiple:false}}},setParentRow:function(e){this.setAssociation("parentRow",e,true);if(!e){this._oRow=undefined}else if(typeof e=="string"){this._oRow=sap.ui.getCore().byId(e)}else{this._oRow=e}return this},renderer:i.extend(o)});CalenderRowHeaderRenderer.openItemTag=function(e,t){e.write("<div")};CalenderRowHeaderRenderer.closeItemTag=function(e,t){e.write("</div>")};CalenderRowHeaderRenderer.renderTabIndex=function(e,t){};var v=i.extend(d);v.getLegendItems=function(t){var a=[],n,r=t.getLegend();if(r){n=sap.ui.getCore().byId(r);if(n){a=n.getAppointmentItems?n.getAppointmentItems():n.getItems()}else{e.sap.log.error("PlanningCalendarLegend with id '"+r+"' does not exist!",t)}}return a};v.renderBeforeAppointments=function(e,t){var a;if(!t._oPlanningCalendarRow.getEnableAppointmentsDragAndDrop()&&!t._oPlanningCalendarRow.getEnableAppointmentsResize()&&!t._oPlanningCalendarRow.getEnableAppointmentsCreate()||t._isOneMonthIntervalOnSmallSizes()){return}a=t.getAggregation("_intervalPlaceholders");e.write('<div class="sapUiCalendarRowAppsOverlay">');if(a){for(var n=0;n<a.length;n++){var r=a[n];r.setWidth(100/a.length+"%");e.renderControl(r)}}e.write("</div>")};v.renderResizeHandle=function(e,t,a){if(!t._oPlanningCalendarRow.getEnableAppointmentsResize()||t._isOneMonthIntervalOnSmallSizes()||a._aAppointments&&a._aAppointments.length>0){return}e.write("<span");e.addClass("sapUiCalendarAppResizeHandle");e.writeClasses();e.write(">");e.write("</span>")};v.writeCustomAttributes=function(e,t){if(t._oPlanningCalendarRow.getEnableAppointmentsCreate()){e.writeAttribute("draggable","true")}};v.renderInterval=function(e,t,a,n,r,o,i,s,g,l,p,u,D){var f=t.getIntervalType();if(f===h.Day||f===h.Week||f===h.OneMonth){var m=t._oPlanningCalendarRow.getSpecialDates(),c=t.getAggregation("_nonWorkingDates"),C=t.getStartDate(),w,y,A;if(m){m.filter(function(e){return e.getType()===sap.ui.unified.CalendarDayType.NonWorking})}if(c&&m){c=c.concat(m)}else if(m){c=m}if(c&&c.length){var R=function(e){return e===w.getDay()};w=new Date(C.getTime());w.setHours(0,0,0);w.setDate(C.getDate()+a);for(var v=0;v<c.length;v++){if(c[v].getStartDate()){y=new Date(c[v].getStartDate().getTime())}if(c[v].getEndDate()){A=new Date(c[v].getEndDate().getTime())}else{A=new Date(c[v].getStartDate().getTime());A.setHours(23,59,59)}if(w.getTime()>=y.getTime()&&w.getTime()<=A.getTime()){var _=o.some(R);if(!_){e.addClass("sapUiCalendarRowAppsNoWork")}}}}}d.renderInterval(e,t,a,n,r,o,i,s,g,l,p,u,D)};var _=p.extend("CalendarRowInPlanningCalendar",{metadata:{aggregations:{_intervalPlaceholders:{type:"IntervalPlaceholder",multiple:true,visibility:"hidden",dnd:{droppable:true}},_nonWorkingDates:{type:"sap.ui.unified.DateRange",multiple:true,visibility:"hidden"}}},constructor:function(){p.apply(this,arguments)},renderer:v});_.PCROW_FOREIGN_KEY_NAME="relatedToPCRowDateRange";_.AGGR_NONWORKING_DATES_NAME="_nonWorkingDates";_.prototype._updatePlaceholders=function(){var e=this.getProperty("intervals");if(this.getIntervalType()===h.Hour){e*=2}this.removeAllAggregation("_intervalPlaceholders");for(var t=0;t<e;t++){this.addAggregation("_intervalPlaceholders",new I)}};_.prototype.onBeforeRendering=function(){p.prototype.onBeforeRendering.call(this);this._updatePlaceholders()};_.prototype.onmousedown=function(e){var t=e.target.classList;this._isResizeHandleMouseDownTarget=t.contains("sapUiCalendarAppResizeHandle");this._isRowAppsIntervalMouseDownTarget=t.contains("sapUiCalendarRowAppsInt")};_.prototype._isResizingPerformed=function(){return this._isResizeHandleMouseDownTarget};_.prototype._isDraggingPerformed=function(){return!this._isResizeHandleMouseDownTarget&&!this._isRowAppsIntervalMouseDownTarget};_.prototype._isCreatingPerformed=function(){return this._isRowAppsIntervalMouseDownTarget};var I=n.extend("IntervalPlaceholder",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}},renderer:function(e,t){e.write("<div");e.writeControlData(t);e.addStyle("width",t.getWidth());e.writeStyles();e.addClass("sapUiCalendarRowAppsPlaceholder");e.writeClasses();e.write("></div>")}});var P=u.extend("ColumnListItemInPlanningCalendar",{metadata:{associations:{planningCalendarRow:{type:"sap.m.PlanningCalendarRow",multiple:false,visibility:"hidden"}}},renderer:D});P.prototype.getCustomData=function(){return sap.ui.getCore().byId(this.getAssociation("planningCalendarRow")).getCustomData()};A.prototype._addDragDropInfo=function(t){this.addDragDropConfig(new f({groupName:C,sourceAggregation:"appointments",dragStart:function(a){var n=function(){var t=e(".sapUiCalendarRowAppsOverlay");setTimeout(function(){t.addClass("sapUiCalendarRowAppsOverlayDragging")});e(document).one("dragend",function(){t.removeClass("sapUiCalendarRowAppsOverlayDragging")})};if(t._isOneMonthIntervalOnSmallSizes()||!t._isDraggingPerformed()){a.preventDefault();return}n()}}));t.addDragDropConfig(new m({groupName:C,targetAggregation:"_intervalPlaceholders",dragEnter:function(a){var n=a.getParameter("dragSession"),r=n.getDragControl(),o=t.getIntervalType(),i=t.getStartDate(),s=t.indexOfAggregation("_intervalPlaceholders",n.getDropControl()),g=t.getId(),l,p=function(){var t=e(n.getIndicator()),a=n.getDropControl().getDomRef().getBoundingClientRect(),r=sap.ui.getCore().byId(g).getDomRef().getBoundingClientRect(),o=n.getDragControl().$().outerWidth(),i=sap.ui.getCore().getConfiguration().getRTL(),s=i?Math.ceil(a.right)-r.left:r.right-Math.ceil(a.left);t.css("min-width",o<s?o:s).css(i?"border-left-width":"border-right-width",o>s?"0":"").css("margin-left",i?-(t.outerWidth()-parseFloat(t.context.style.width)):"")};if(this.hasListeners("appointmentDragEnter")){if(o===h.Hour){l=this._calcNewHoursAppPos(i,r.getStartDate(),r.getEndDate(),s)}else if(o===h.Day||o===h.Week||o===h.OneMonth&&!t._isOneMonthIntervalOnSmallSizes()){l=this._calcNewDaysAppPos(i,r.getStartDate(),r.getEndDate(),s)}else if(o===h.Month){l=this._calcNewMonthsAppPos(i,r.getStartDate(),r.getEndDate(),s)}var d=this.fireAppointmentDragEnter({appointment:r,startDate:l.startDate,endDate:l.endDate,calendarRow:t._oPlanningCalendarRow});if(!d){a.preventDefault();return}}else if(r.getParent().getCalendarRow()!==t){a.preventDefault();return}if(t.getIntervalType()!==h.Hour){return}if(!n.getIndicator()){setTimeout(function(){p()},0)}else{p()}}.bind(this),drop:function(e){var a=e.getParameter("dragSession"),n=a.getDragControl(),r=t.getIntervalType(),o=t.getStartDate(),i=t.indexOfAggregation("_intervalPlaceholders",a.getDropControl()),s,g=e.getParameter("browserEvent"),l=g.metaKey||g.ctrlKey;if(r===h.Hour){s=this._calcNewHoursAppPos(o,n.getStartDate(),n.getEndDate(),i)}else if(r===h.Day||r===h.Week||r===h.OneMonth&&!t._isOneMonthIntervalOnSmallSizes()){s=this._calcNewDaysAppPos(o,n.getStartDate(),n.getEndDate(),i)}else if(r===h.Month){s=this._calcNewMonthsAppPos(o,n.getStartDate(),n.getEndDate(),i)}t.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");if(n.getStartDate().getTime()===s.startDate.getTime()&&n.getParent()===t._oPlanningCalendarRow){return}this.fireAppointmentDrop({appointment:n,startDate:s.startDate,endDate:s.endDate,calendarRow:t._oPlanningCalendarRow,copy:l})}.bind(this)}))};A.prototype._calcNewHoursAppPos=function(e,t,a,n){var r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());r=new Date(r.getTime()+n*30*60*1e3);return{startDate:r,endDate:new Date(r.getTime()+a.getTime()-t.getTime())}};A.prototype._calcNewDaysAppPos=function(e,t,a,n){var r=new Date(e);r.setDate(r.getDate()+n);r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:r,endDate:new Date(r.getTime()+a.getTime()-t.getTime())}};A.prototype._calcNewMonthsAppPos=function(e,t,a,n){var r=new Date(e);r.setMonth(r.getMonth()+n);r=new Date(r.getFullYear(),r.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:r,endDate:new Date(r.getTime()+a.getTime()-t.getTime())}};A.prototype._calcResizeNewHoursAppPos=function(e,t,a,n){var r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),o=30*60*1e3;r=new Date(r.getTime()+(n+1)*o);if(r.getTime()<=t.getTime()){r=new Date(t.getTime()+o)}return{startDate:t,endDate:r}};A.prototype._calcResizeNewDaysAppPos=function(e,t,a,n){var r=new Date(e),o=r.getDate()+n+1;if(o<=t.getDate()){o=t.getDate()+1}r.setDate(o);r=new Date(r.getFullYear(),r.getMonth(),r.getDate());return{startDate:t,endDate:r}};A.prototype._calcResizeNewMonthsAppPos=function(e,t,a,n){var r=new Date(e),o=r.getMonth()+n+1;if(o<=t.getMonth()){o=t.getMonth()+1}r.setMonth(o);r=new Date(r.getFullYear(),r.getMonth(),1);return{startDate:t,endDate:r}};A.prototype._calcCreateNewAppHours=function(e,t,a){var n=30*60*1e3,r,o;if(t<=a){r=new Date(e.getTime()+t*n);o=new Date(e.getTime()+(a+1)*n)}else{r=new Date(e.getTime()+a*n);o=new Date(e.getTime()+t*n)}return{startDate:r,endDate:o}};A.prototype._calcCreateNewAppDays=function(e,t,a){var n=new Date(e),r=new Date(e);if(t<=a){n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);r=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a+1)}else{n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a);r=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)}return{startDate:n,endDate:r}};A.prototype._calcCreateNewAppMonths=function(e,t,a){var n=new Date(e),r=new Date(e);if(t<=a){n=new Date(e.getFullYear(),e.getMonth()+t,1);r=new Date(e.getFullYear(),e.getMonth()+a+1,1)}else{n=new Date(e.getFullYear(),e.getMonth()+a,1);r=new Date(e.getFullYear(),e.getMonth()+t,1)}return{startDate:n,endDate:r}};A.prototype.init=function(){var e=this.getId();var t=new R(e+"-Head",{parentRow:this,iconDensityAware:false});var a=new _(e+"-CalRow",{checkResize:false,updateCurrentTime:false,ariaLabelledBy:e+"-Head"});a._oPlanningCalendarRow=this;a.getAppointments=function(){if(this._oPlanningCalendarRow){return this._oPlanningCalendarRow.getAppointments()}else{return[]}};a.getIntervalHeaders=function(){if(this._oPlanningCalendarRow){return this._oPlanningCalendarRow.getIntervalHeaders()}else{return[]}};this._oColumnListItem=new P(this.getId()+"-CLI",{cells:[t,a],planningCalendarRow:this})};A.prototype.exit=function(){if(this._oColumnListItem.getCells()[1]){this._oColumnListItem.getCells()[1].destroy()}this._oColumnListItem.destroy();this._oColumnListItem=undefined};A.prototype.setEnableAppointmentsDragAndDrop=function(e){this.setProperty("enableAppointmentsDragAndDrop",e,true);if(e){var t=this.getDragDropConfig().some(function(e){return e.getGroupName()===C});if(!t){this._addDragDropInfo(this.getCalendarRow())}}else{this.getDragDropConfig().forEach(function(e){if(e.getGroupName()===C){this.removeDragDropConfig(e)}},this);this.getCalendarRow().getDragDropConfig().forEach(function(e){if(e.getGroupName()===C){this.getCalendarRow().removeDragDropConfig(e)}},this)}return this};A.prototype.setTooltip=function(e){this.setAggregation("tooltip",e,true);this._oColumnListItem.getCells()[0].setTooltip(e);return this};A.prototype.setTitle=function(e){this.setProperty("title",e,true);this._oColumnListItem.getCells()[0].setTitle(e);return this};A.prototype.setText=function(e){this.setProperty("text",e,true);this._oColumnListItem.getCells()[0].setDescription(e);if(e){this._oColumnListItem.getCells()[1].addStyleClass("sapMPlanCalRowLarge")}else{this._oColumnListItem.getCells()[1].removeStyleClass("sapMPlanCalRowLarge")}return this};A.prototype.setIcon=function(e){this.setProperty("icon",e,true);this._oColumnListItem.getCells()[0].setIcon(e);return this};A.prototype.setNonWorkingDays=function(e){this.setProperty("nonWorkingDays",e,true);this.getCalendarRow().setNonWorkingDays(e);return this};A.prototype.setNonWorkingHours=function(e){this.setProperty("nonWorkingHours",e,true);this.getCalendarRow().setNonWorkingHours(e);return this};A.prototype.setEnableAppointmentsResize=function(e){var t=this._getConfigFromDragDropConfigAggregation(this.getAggregation("dragDropConfig"),w),a=this._getResizeConfig();this.setProperty("enableAppointmentsResize",e,true);if(e&&!t){this.addAggregation("dragDropConfig",a,true)}if(!e){this.removeAggregation("dragDropConfig",t,true)}return this};A.prototype.setEnableAppointmentsCreate=function(e){var t=this.getCalendarRow(),a=this._getConfigFromDragDropConfigAggregation(t.getAggregation("dragDropConfig"),y),n=this._getAppointmentsCreateConfig();this.setProperty("enableAppointmentsCreate",e,true);if(e&&!a){t.addAggregation("dragDropConfig",n,true)}if(!e){t.removeAggregation("dragDropConfig",a,true)}return this};A.prototype.invalidate=function(e){if(!e||!(e instanceof sap.ui.unified.CalendarAppointment)){a.prototype.invalidate.apply(this,arguments)}else if(this._oColumnListItem){this.getCalendarRow().invalidate(e)}};A.prototype.removeAppointment=function(e){var t=this.removeAggregation("appointments",e,true);this.getCalendarRow().invalidate();return t};A.prototype.removeAllAppointments=function(){var e=this.removeAllAggregation("appointments",true);this.getCalendarRow().invalidate();return e};A.prototype.destroyAppointments=function(){var e=this.destroyAggregation("appointments",true);this.getCalendarRow().invalidate();return e};A.prototype.removeIntervalHeader=function(e){var t=this.removeAggregation("intervalHeaders",e,true);this.getCalendarRow().invalidate();return t};A.prototype.removeAllIntervalHeaders=function(){var e=this.removeAllAggregation("intervalHeaders",true);this.getCalendarRow().invalidate();return e};A.prototype.destroyIntervalHeaders=function(){var e=this.destroyAggregation("intervalHeaders",true);this.getCalendarRow().invalidate();return e};A.prototype.setSelected=function(e){this.setProperty("selected",e,true);this._oColumnListItem.setSelected(e);return this};A.prototype.getColumnListItem=function(){return this._oColumnListItem};A.prototype.getCalendarRow=function(){if(!this._oColumnListItem){return null}return this._oColumnListItem.getCells()[1]};A.prototype.applyFocusInfo=function(e){this.getCalendarRow().applyFocusInfo(e);return this};A.prototype.addAggregation=function(e,t,n){if(A.AGGR_NONWORKING_DATES_NAME===e){this.getCalendarRow().addAggregation(_.AGGR_NONWORKING_DATES_NAME,this._buildCalendarRowDateRange(t),n)}return a.prototype.addAggregation.apply(this,arguments)};A.prototype.insertAggregation=function(e,t,n,r){if(A.AGGR_NONWORKING_DATES_NAME===e){this.getCalendarRow().insertAggregation(_.AGGR_NONWORKING_DATES_NAME,this._buildCalendarRowDateRange(t),n,r)}return a.prototype.insertAggregation.apply(this,arguments)};A.prototype.removeAggregation=function(t,n,r){var o;if(A.AGGR_NONWORKING_DATES_NAME===t&&this.getAggregation(A.AGGR_NONWORKING_DATES_NAME)){o=this.getCalendarRow().getAggregation(_.AGGR_NONWORKING_DATES_NAME).filter(function(e){return e.data(_.PCROW_FOREIGN_KEY_NAME)===n.getId()});if(o.length){e.sap.assert(o.length==1,"Inconsistency between PlanningCalendarRow "+"_nonWorkingDate instance and CalendarRow _nonWorkingDates instance. For PCRow instance "+"there are more than one("+o.length+") nonWorkingDates in CalendarRow ");this.getCalendarRow().removeAggregation("_nonWorkingDates",o[0])}}return a.prototype.removeAggregation.apply(this,arguments)};A.prototype.removeAllAggregation=function(e,t){if(A.AGGR_NONWORKING_DATES_NAME===e){this.getCalendarRow().removeAllAggregation(_.AGGR_NONWORKING_DATES_NAME,t)}return a.prototype.removeAllAggregation.apply(this,arguments)};A.prototype.destroyAggregation=function(e,t){if(A.AGGR_NONWORKING_DATES_NAME===e){if(this.getCalendarRow()){this.getCalendarRow().destroyAggregation(_.AGGR_NONWORKING_DATES_NAME,t)}}return a.prototype.destroyAggregation.apply(this,arguments)};A.prototype._buildCalendarRowDateRange=function(e){var t=new l;if(e.getStartDate()){t.setStartDate(new Date(e.getStartDate().getTime()))}if(e.getEndDate()){t.setEndDate(new Date(e.getEndDate().getTime()))}t.data(_.PCROW_FOREIGN_KEY_NAME,e.getId());return t};A.prototype._getResizeConfig=function(){var a=this,n=this.getCalendarRow(),r=new c({sourceAggregation:"appointments",targetAggregation:"_intervalPlaceholders",targetElement:this.getCalendarRow(),dragStart:function(r){if(!a.getEnableAppointmentsResize()||n._isOneMonthIntervalOnSmallSizes()||!n._isResizingPerformed()){r.preventDefault();return}var o=r.getParameter("dragSession"),i=n.$().find(".sapUiCalendarRowAppsOverlay"),s=e(o.getIndicator()),g=o.getDragControl().$();s.addClass("sapUiDnDIndicatorHide");setTimeout(function(){i.addClass("sapUiCalendarRowAppsOverlayDragging")});e(document).one("dragend",function(){i.removeClass("sapUiCalendarRowAppsOverlayDragging");s.removeClass("sapUiDnDIndicatorHide");g.css({width:"auto","min-width":"auto","z-index":"auto",opacity:1})});if(!t.browser.msie&&!t.browser.edge){r.getParameter("browserEvent").dataTransfer.setDragImage(N(),0,0)}},dragEnter:function(t){var a=t.getParameter("dragSession"),n=this.getTargetElement(),r=function(){var t=e(a.getIndicator());t.addClass("sapUiDnDIndicatorHide")},o=a.getDropControl().getDomRef().getBoundingClientRect(),i=sap.ui.getCore().byId(n).getDomRef().getBoundingClientRect(),s={width:o.left+o.width-(a.getDragControl().$().position().left+i.left),"min-width":Math.min(a.getDragControl().$().outerWidth(),a.getDropControl().$().outerWidth()),"z-index":1,opacity:.8};a.getDragControl().$().css(s);if(!a.getIndicator()){e.sap.delayedCall(0,null,r)}else{r()}},drop:function(t){var n=a.getCalendarRow();var r=t.getParameter("dragSession"),o=r.getDragControl(),i=n.getIntervalType(),s=n.getStartDate(),g=n.indexOfAggregation("_intervalPlaceholders",r.getDropControl()),l;if(i===h.Hour){l=this._calcResizeNewHoursAppPos(s,o.getStartDate(),o.getEndDate(),g)}else if(i===h.Day||i===h.Week||i===h.OneMonth&&!n._isOneMonthIntervalOnSmallSizes()){l=this._calcResizeNewDaysAppPos(s,o.getStartDate(),o.getEndDate(),g)}else if(i===h.Month){l=this._calcResizeNewMonthsAppPos(s,o.getStartDate(),o.getEndDate(),g)}n.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");e(r.getIndicator()).removeClass("sapUiDnDIndicatorHide");o.$().css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});if(o.getEndDate().getTime()===l.endDate.getTime()){return}this.fireAppointmentResize({appointment:o,startDate:l.startDate,endDate:l.endDate,calendarRow:n._oPlanningCalendarRow})}.bind(this)});r.setProperty("groupName",w);return r};A.prototype._getConfigFromDragDropConfigAggregation=function(e,t){var a=e,n=a&&a.length;for(var r=0;r<n;r++){if(a[r].getGroupName()===t){return a[r]}}return null};A.prototype._getAppointmentsCreateConfig=function(){var a=this,n=this.getCalendarRow(),r=new c({targetAggregation:"_intervalPlaceholders",dragStart:function(r){if(!a.getEnableAppointmentsCreate()||n._isOneMonthIntervalOnSmallSizes()||!n._isCreatingPerformed()){r.preventDefault();return}var o=r.getParameter("dragSession"),i=n.$().find(".sapUiCalendarRowAppsOverlay"),s=e(o.getIndicator());setTimeout(function(){i.addClass("sapUiCalendarRowAppsOverlayDragging")});e(document).one("dragend",function(){i.removeClass("sapUiCalendarRowAppsOverlayDragging");s.html("");s.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")});if(!t.browser.msie&&!t.browser.edge){r.getParameter("browserEvent").dataTransfer.setDragImage(N(),0,0)}},dragEnter:function(t){var a=t.getParameter("dragSession"),r=a.getDropControl().getDomRef().getBoundingClientRect(),o=function(){var t=e(a.getIndicator());t.addClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")};var i=a.getData("text")?parseFloat(a.getData("text").split("|")[0]):0;if(i){if(i<=r.left){a.setIndicatorConfig({left:i,width:Math.max(r.left+r.width-i,r.width)})}else{a.setIndicatorConfig({left:r.left,width:i-r.left})}}else{a.setData("text",r.left+"|"+n.indexOfAggregation("_intervalPlaceholders",a.getDropControl()))}if(!a.getIndicator()){e.sap.delayedCall(0,null,o)}else{o()}},drop:function(t){var r=t.getParameter("dragSession"),o=e(r.getIndicator()),i=n.getIntervalType(),s=a.getCalendarRow().getStartDate(),g=parseInt(r.getData("text").split("|")[1],10),l=n.indexOfAggregation("_intervalPlaceholders",r.getDropControl()),p;if(i===h.Hour){p=this._calcCreateNewAppHours(s,g,l)}else if(i===h.Day||i===h.Week||i===h.OneMonth&&!n._isOneMonthIntervalOnSmallSizes()){p=this._calcCreateNewAppDays(s,g,l)}else if(i===h.Month){p=this._calcCreateNewAppMonths(s,g,l)}this.fireAppointmentCreate({startDate:p.startDate,endDate:p.endDate,calendarRow:n._oPlanningCalendarRow});o.html("");o.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")}.bind(this)});r.setProperty("groupName",y);return r};function N(){var t=e("<span></span>").addClass("sapUiCalAppResizeGhost");t.appendTo(document.body);e.sap.delayedCall(0,null,function(){t.remove()});return t.get(0)}return A});