/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/Device","sap/ui/core/delegate/ItemNavigation","sap/ui/core/library","sap/ui/base/ManagedObject","sap/ui/core/Icon","./HeaderContainerRenderer","jquery.sap.events"],function(t,e,r,i,o,s,a,n,l){"use strict";var h=s.Orientation;var g=r.extend("sap.m.HeaderContainerItemContainer",{metadata:{defaultAggregation:"item",aggregations:{item:{type:"sap.ui.core.Control",multiple:false}}},renderer:function(t,e){t.write("<div");t.writeControlData(e);t.addClass("sapMHdrCntrItemCntr");t.addClass("sapMHrdrCntrInner");t.writeClasses();t.write(">");t.renderControl(e.getAggregation("item"));t.write("</div>")}});var c=r.extend("sap.m.HeaderContainer",{metadata:{interfaces:["sap.m.ObjectHeaderContainer"],library:"sap.m",properties:{scrollStep:{type:"int",defaultValue:300,group:"Behavior"},scrollStepByItem:{type:"int",defaultValue:1,group:"Behavior"},scrollTime:{type:"int",defaultValue:500,group:"Behavior"},showOverflowItem:{type:"boolean",defaultValue:true,group:"Behavior"},showDividers:{type:"boolean",defaultValue:true,group:"Appearance"},orientation:{type:"sap.ui.core.Orientation",defaultValue:h.Horizontal,group:"Appearance"},backgroundDesign:{type:"sap.m.BackgroundDesign",defaultValue:e.BackgroundDesign.Transparent,group:"Appearance"},width:{type:"sap.ui.core.CSSSize",group:"Appearance"},height:{type:"sap.ui.core.CSSSize",group:"Appearance"}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true},_scrollContainer:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},_prevButton:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_nextButton:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}}});c.prototype.init=function(){this._aItemEnd=[];this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oScrollCntr=new e.ScrollContainer(this.getId()+"-scrl-cntnr",{width:"100%",height:"100%",horizontal:!i.system.desktop});this.setAggregation("_scrollContainer",this._oScrollCntr,true);if(i.system.desktop){this._oArrowPrev=new e.Button({id:this.getId()+"-scrl-prev-button",type:e.ButtonType.Transparent,tooltip:this._oRb.getText("HEADERCONTAINER_BUTTON_PREV_SECTION"),press:function(t){t.cancelBubble();this._scroll(this._getScrollValue(false),this.getScrollTime())}.bind(this)}).addStyleClass("sapMHdrCntrBtn").addStyleClass("sapMHdrCntrLeft");this._oArrowPrev._bExcludeFromTabChain=true;this.setAggregation("_prevButton",this._oArrowPrev,true);this._oArrowNext=new e.Button({id:this.getId()+"-scrl-next-button",type:e.ButtonType.Transparent,tooltip:this._oRb.getText("HEADERCONTAINER_BUTTON_NEXT_SECTION"),press:function(t){t.cancelBubble();this._scroll(this._getScrollValue(true),this.getScrollTime())}.bind(this)}).addStyleClass("sapMHdrCntrBtn").addStyleClass("sapMHdrCntrRight");this._oArrowNext._bExcludeFromTabChain=true;this.setAggregation("_nextButton",this._oArrowNext,true)}else if(i.system.phone||i.system.tablet){this._oArrowPrev=new n({id:this.getId()+"-scrl-prev-button"}).addStyleClass("sapMHdrCntrBtn").addStyleClass("sapMHdrCntrLeft");this.setAggregation("_prevButton",this._oArrowPrev,true);this._oArrowNext=new n({id:this.getId()+"-scrl-next-button"}).addStyleClass("sapMHdrCntrBtn").addStyleClass("sapMHdrCntrRight");this.setAggregation("_nextButton",this._oArrowNext,true)}this._oScrollCntr.addDelegate({onAfterRendering:function(){if(i.system.desktop){var t=this._oScrollCntr.getDomRef("scroll");var e=this._oScrollCntr.$("scroll");var r=e.find(".sapMHrdrCntrInner").attr("tabindex","0");if(!this._oItemNavigation){this._oItemNavigation=new o;this.addDelegate(this._oItemNavigation);this._oItemNavigation.attachEvent(o.Events.BorderReached,this._handleBorderReached,this);this._oItemNavigation.attachEvent(o.Events.AfterFocus,this._handleBorderReached,this);this._oItemNavigation.attachEvent(o.Events.BeforeFocus,this._handleBeforeFocus,this);if(i.browser.msie||i.browser.edge){this._oItemNavigation.attachEvent(o.Events.FocusAgain,this._handleFocusAgain,this)}}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(r);this._oItemNavigation.setTabIndex0();this._oItemNavigation.setCycling(false)}}.bind(this)});sap.ui.getCore().attachIntervalTimer(this._checkOverflow,this)};c.prototype.onBeforeRendering=function(){if(!this.getHeight()){t.sap.log.warning("No height provided",this)}if(!this.getWidth()){t.sap.log.warning("No width provided",this)}if(i.system.desktop){this._oArrowPrev.setIcon(this.getOrientation()===h.Horizontal?"sap-icon://slim-arrow-left":"sap-icon://slim-arrow-up");this._oArrowNext.setIcon(this.getOrientation()===h.Horizontal?"sap-icon://slim-arrow-right":"sap-icon://slim-arrow-down")}else if(i.system.phone||i.system.tablet){this._oArrowPrev.setSrc(this.getOrientation()===h.Horizontal?"sap-icon://slim-arrow-left":"sap-icon://slim-arrow-up");this._oArrowNext.setSrc(this.getOrientation()===h.Horizontal?"sap-icon://slim-arrow-right":"sap-icon://slim-arrow-down")}};c.prototype.onAfterRendering=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this._checkOverflow()};c.prototype.exit=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();this._oItemNavigation=null}sap.ui.getCore().detachIntervalTimer(this._checkOverflow,this)};c.prototype.onsaptabnext=function(t){var e=this.$().find(":focusable");var r=e.index(t.target);var i=e.eq(r+1).get(0);var o=this._getParentCell(t.target);var s;if(i){s=this._getParentCell(i)}if(o&&s&&o.id!==s.id||i&&i.id===this.getId()+"-after"||i&&i.id===this.getId()+"-scrl-prev-button"||i&&i.id===this.getId()+"-scrl-next-button"){var a=e.last().get(0);if(a){this._bIgnoreFocusIn=true;a.focus()}}};c.prototype.onsaptabprevious=function(t){this.$().find(".sapMHdrCntrItemCntr").css("border-color","");var e=this.$().find(":focusable");var r=e.index(t.target);var i=e.eq(r-1).get(0);var o=this._getParentCell(t.target);var s;if(i){s=this._getParentCell(i)}if(!s||o&&o.id!==s.id){var a=this.$().attr("tabindex");this.$().attr("tabindex","0");this.$().focus();if(!a){this.$().removeAttr("tabindex")}else{this.$().attr("tabindex",a)}}};c.prototype.setOrientation=function(t){this.setProperty("orientation",t);if(t===h.Horizontal&&!i.system.desktop){this._oScrollCntr.setHorizontal(true);this._oScrollCntr.setVertical(false)}else if(!i.system.desktop){this._oScrollCntr.setHorizontal(false);this._oScrollCntr.setVertical(true)}return this};c.prototype.validateAggregation=function(t,e,r){return this._callMethodInManagedObject("validateAggregation",t,e,r)};c.prototype.getAggregation=function(t,e,r){return this._callMethodInManagedObject("getAggregation",t,e,r)};c.prototype.setAggregation=function(t,e,r){return this._callMethodInManagedObject("setAggregation",t,e,r)};c.prototype.indexOfAggregation=function(t,e){return this._callMethodInManagedObject("indexOfAggregation",t,e)};c.prototype.insertAggregation=function(t,e,r,i){return this._callMethodInManagedObject("insertAggregation",t,e,r,i)};c.prototype.addAggregation=function(t,e,r){return this._callMethodInManagedObject("addAggregation",t,e,r)};c.prototype.removeAggregation=function(t,e,r){return this._callMethodInManagedObject("removeAggregation",t,e,r)};c.prototype.removeAllAggregation=function(t,e){return this._callMethodInManagedObject("removeAllAggregation",t,e)};c.prototype.destroyAggregation=function(t,e){return this._callMethodInManagedObject("destroyAggregation",t,e)};c.prototype._setScrollInProcess=function(t){this.bScrollInProcess=t};c.prototype._scroll=function(e,r){this._setScrollInProcess(true);t.sap.delayedCall(r+300,this,this._setScrollInProcess,[false]);if(this.getOrientation()===h.Horizontal){this._hScroll(e,r)}else{this._vScroll(e,r)}};c.prototype._vScroll=function(t,e){var r=this._oScrollCntr.getDomRef(),i=r.scrollTop,o=r.scrollHeight,s=i+t,a=r.clientHeight,n=parseFloat(this.$("scroll-area").css("padding-top")),l;if(s<=0){l=this._calculateRemainingScrolling(t,e,i);this.$("scroll-area").css("transition","padding "+l+"s");this.$().removeClass("sapMHrdrTopPadding")}else if(s+a+n>=o){l=this._calculateRemainingScrolling(t,e,o-a-i);this.$("scroll-area").css("transition","padding "+l+"s");if(a+t>o&&a!==o){this.$().removeClass("sapMHrdrBottomPadding");this.$().addClass("sapMHrdrTopPadding")}else{this.$().removeClass("sapMHrdrBottomPadding")}}else{this.$("scroll-area").css("transition","padding "+e/1e3+"s")}this._oScrollCntr.scrollTo(0,s,e)};c.prototype._hScroll=function(e,r){var o=this._oScrollCntr.getDomRef();var s,a,n,l,h,g;if(!this._bRtl){a=o.scrollLeft;l=o.scrollWidth;n=o.clientWidth+(i.browser.msie?1:0);s=a+e;h=parseFloat(this.$("scroll-area").css("padding-left"));if(s<=0){g=this._calculateRemainingScrolling(e,r,a);this.$("scroll-area").css("transition","padding "+g+"s");this.$().removeClass("sapMHrdrLeftPadding")}else if(s+o.clientWidth+h>=l){g=this._calculateRemainingScrolling(e,r,l-n-a);this.$("scroll-area").css("transition","padding "+g+"s");if(n+e>l&&n!==l){this.$().removeClass("sapMHrdrRightPadding");this.$().addClass("sapMHrdrLeftPadding")}else{this.$().removeClass("sapMHrdrRightPadding")}}else{this.$("scroll-area").css("transition","padding "+r/1e3+"s")}this._oScrollCntr.scrollTo(s,0,r)}else{s=t(o).scrollRightRTL()+e;this._oScrollCntr.scrollTo(s>0?s:0,0,r)}};c.prototype._collectItemSize=function(){var t=0,e=this.getContent(),r=this.getOrientation()===h.Horizontal?"outerWidth":"outerHeight";this._aItemEnd=[];e.forEach(function(e,i){t+=e.$().parent()[r](true);this._aItemEnd[i]=t},this)};c.prototype._getScrollValue=function(t){if(!this._oScrollCntr){return 0}var e=this.getOrientation()===h.Horizontal,r=this._oScrollCntr.$(),i=this.$("prev-button-container"),o=this.$("next-button-container"),s=e?r[0].scrollLeft:r[0].scrollTop,a=this.getContent(),n=0,l=0,g;var c=function(t){var r=0,s=0;var n=10;if(this._bRtl&&e){if(!i.is(":visible")){s=i.width()}if(!o.is(":visible")){s=o.width()}}for(var l=0;l<a.length&&l<t;l++){r+=d(a[l])}return r!==0?r+n-s:0}.bind(this);var d=function(t){return e?t.$().parent().outerWidth(true):t.$().parent().outerHeight(true)};var p=function(){var t=this._getSize(true),e,r=0;for(var i=n;i<a.length;i++){if(!a[i].$().is(":visible")){e=d(a[i])+c(i)-t-s;for(var o=n;o<a.length&&o<i;o++){if(g+r>e){break}n++;r+=d(a[o])}g+=r;break}}}.bind(this);if(this.getScrollStepByItem()>0){s=e&&this._bRtl?r.scrollRightRTL():s;for(var f=0;f<a.length;f++){l+=d(a[f]);if(l>=s){n=f;break}}n=(t?1:-1)*this.getScrollStepByItem()+n;if(n<0){n=0}if(n>=a.length){n=a.length-1}g=c(n)-s;if(t&&!this.getShowOverflowItem()){p()}return g}return t?this.getScrollStep():-this.getScrollStep()};c.prototype._calculateRemainingScrolling=function(t,e,r){return Math.abs(r*e/(1e3*t))};c.prototype._checkOverflow=function(){if(this.getOrientation()===h.Horizontal){this._checkHOverflow()}else{this._checkVOverflow()}};c.prototype._getFirstItemOffset=function(t){var e=this.getContent()[0]&&this.getContent()[0].$(),r=e&&e.parent(),i=r&&r[0]&&r[0][t];return i||0};c.prototype._checkVOverflow=function(){var t=this._oScrollCntr.getDomRef(),e,r;if(t){var i=this._getFirstItemOffset("offsetTop");var o=Math.ceil(t.scrollTop);var s=false;var a=false;var n=t.scrollHeight;var l=t.clientHeight;if(Math.abs(n-l)===1){n=l}if(o>i){s=true}if(n>l&&o+l<n){a=true}a=this._checkForOverflowItem(a);r=this.$("prev-button-container");e=r.is(":visible");if(e&&!s){r.hide();this.$().removeClass("sapMHrdrTopPadding")}if(!e&&s){r.show();this.$().addClass("sapMHrdrTopPadding")}r=this.$("next-button-container");var h=r.is(":visible");if(h&&!a){r.hide();this.$().removeClass("sapMHrdrBottomPadding")}if(!h&&a){r.show();this.$().addClass("sapMHrdrBottomPadding")}}};c.prototype._checkHOverflow=function(){var e=this._oScrollCntr.getDomRef(),r;if(e){var o=this._getFirstItemOffset("offsetLeft");var s=Math.ceil(e.scrollLeft);var a=false;var n=false;var l=e.scrollWidth;var h=e.clientWidth;if(Math.abs(l-h)===1){l=h}if(this._bRtl){var g=t(e).scrollLeftRTL();if(g>(i.browser.msie||i.browser.edge?1:0)){n=true}}else if(s>o){a=true}if(l-5>h){if(this._bRtl){if(t(e).scrollRightRTL()>1){a=true}}else if(s+h<l){n=true}}r=this.$("prev-button-container");n=this._checkForOverflowItem(n);var c=r.is(":visible");if(c&&!a){r.hide();this.$().removeClass("sapMHrdrLeftPadding")}if(!c&&a){r.show();this.$().addClass("sapMHrdrLeftPadding")}r=this.$("next-button-container");var d=r.is(":visible");if(d&&!n){r.hide();this.$().removeClass("sapMHrdrRightPadding")}if(!d&&n){r.show();this.$().addClass("sapMHrdrRightPadding")}}};c.prototype._getSize=function(t){var e=this._oScrollCntr.$(),r=this.getOrientation()===h.Horizontal,i=this.$("next-button-container"),o=!i.is(":visible")&&t,s=r?"width":"height";return e[s]()-(o?i[s]():0)};c.prototype._checkForOverflowItem=function(t){if(this._oScrollCntr&&!this.getShowOverflowItem()){var e=this._oScrollCntr.$(),r=this.getOrientation()===h.Horizontal,i=!r?e[0].scrollTop:this._bRtl?e.scrollRightRTL():e[0].scrollLeft,o=r?"width":"height",s=this._getSize(t),a=this.getContent();this._collectItemSize();this._aItemEnd.forEach(function(e,r){var n=a[r].$(),l=n.parent(),h=n.is(":visible");if(t&&e>i+s){if(r===0||this._aItemEnd[r-1]<=i){l.css(o,"auto");n.show()}else if(h){l[o](l[o]());n.hide();t=true}}else{if(!h){l.css(o,"auto");n.show()}}},this)}return t};c.prototype._handleBorderReached=function(t){if(i.browser.msie&&this.bScrollInProcess){return}var e=t.getParameter("index");if(e===0){this._scroll(this._getScrollValue(false),this.getScrollTime())}else if(e===this.getContent().length-1){this._scroll(this._getScrollValue(true),this.getScrollTime())}};c.prototype._handleFocusAgain=function(t){t.getParameter("event").preventDefault()};c.prototype._handleBeforeFocus=function(e){var r=e.getParameter("event");if(t(r.target).hasClass("sapMHdrCntrItemCntr")||t(r.target).hasClass("sapMScrollContScroll")||t.sap.PseudoEvents.sapprevious.fnCheck(r)||t.sap.PseudoEvents.sapnext.fnCheck(r)){this.$().find(".sapMHdrCntrItemCntr").css("border-color","")}else{this.$().find(".sapMHdrCntrItemCntr").css("border-color","transparent")}};c.prototype._unWrapHeaderContainerItemContainer=function(e){if(e instanceof g){e=e.getItem()}else if(t.isArray(e)){for(var r=0;r<e.length;r++){if(e[r]instanceof g){e[r]=e[r].getItem()}}}return e};c._AGGREGATION_FUNCTIONS=["validateAggregation","validateAggregation","getAggregation","setAggregation","indexOfAggregation","removeAggregation"];c._AGGREGATION_FUNCTIONS_FOR_INSERT=["insertAggregation","addAggregation"];c.prototype._callMethodInManagedObject=function(e,i){var o=Array.prototype.slice.call(arguments);if(i==="content"){var s=o[2];o[1]="content";if(s instanceof r){if(t.inArray(e,c._AGGREGATION_FUNCTIONS)>-1&&s.getParent()instanceof g){o[2]=s.getParent()}else if(t.inArray(e,c._AGGREGATION_FUNCTIONS_FOR_INSERT)>-1){o[2]=new g({item:s})}}return this._unWrapHeaderContainerItemContainer(this._oScrollCntr[e].apply(this._oScrollCntr,o.slice(1)))}else{return a.prototype[e].apply(this,o.slice(1))}};c.prototype._getParentCell=function(e){return t(e).parents(".sapMHrdrCntrInner").andSelf(".sapMHrdrCntrInner").get(0)};c.prototype.onfocusin=function(t){if(this._bIgnoreFocusIn){this._bIgnoreFocusIn=false;return}if(t.target.id===this.getId()+"-after"){this._restoreLastFocused()}};c.prototype._restoreLastFocused=function(){if(!this._oItemNavigation){return}var e=this._oItemNavigation.getItemDomRefs();var r=this._oItemNavigation.getFocusedIndex();var i=t(e[r]);var o=i.control(0)||{};var s=o.getTabbables?o.getTabbables():i.find(":sapTabbable");s.eq(-1).add(i).eq(-1).focus()};return c});