/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/m/GenericTile","sap/ui/Device","sap/ui/core/Icon","./SlideTileRenderer","jquery.sap.events","jquery.sap.keycodes"],function(e,i,t,s,o,n,r){"use strict";var a=i.TileSizeBehavior;var l=t.extend("sap.m.SlideTile",{metadata:{library:"sap.m",properties:{displayTime:{type:"int",group:"Appearance",defaultValue:5e3},transitionTime:{type:"int",group:"Appearance",defaultValue:500},scope:{type:"sap.m.GenericTileScope",group:"Misc",defaultValue:"Display"},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:a.Responsive}},defaultAggregation:"tiles",aggregations:{tiles:{type:"sap.m.GenericTile",multiple:true,singularName:"tile",bindable:"bindable"},_pausePlayIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"},domRef:{type:"any"}}}}}});l.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this.setAggregation("_pausePlayIcon",new n({id:this.getId()+"-pause-play-icon",src:"sap-icon://media-pause",color:"#ffffff",size:"1rem",noTabStop:true}),true)};l.prototype.onBeforeRendering=function(){s.prototype._initScopeContent.call(this,"sapMST");var e=this.getScope()===i.GenericTileScope.Actions;for(var t=0;t<this.getTiles().length;t++){this.getTiles()[t].showActionsView(e)}if(this._iCurrentTile>=0){this._iLastTile=this._iCurrentTile}this._bNeedInvalidate=false;this._stopAnimation();this._sWidth=this._sHeight=undefined;this._iCurrentTile=this._iPreviousTile=undefined};l.prototype.onAfterRendering=function(){this._setupResizeClassHandler();var e=this.getTiles().length,t=this.getScope();this._removeGTFocus();this._iCurrAnimationTime=0;this._bAnimationPause=false;if(this._iLastTile>=0&&e>1){this._scrollToTile(this._iLastTile)}else{this._scrollToNextTile()}if(e>1&&t===i.GenericTileScope.Display){this._startAnimation()}if(t===i.GenericTileScope.Actions&&this._iCurrentTile>=0&&this._hasNewsContent(this._iCurrentTile)){this.addStyleClass("sapMSTDarkBackground")}};l.prototype.exit=function(){this._stopAnimation();if(this._oMoreIcon){this._oMoreIcon.destroy()}if(this._oRemoveButton){this._oRemoveButton.destroy()}};l.prototype.ontap=function(e){var t=this.getScope();this.$().focus();if(t===i.GenericTileScope.Actions){var s=this._getEventParams(e);this.firePress(s);e.preventDefault()}};l.prototype.ontouchstart=function(t){if(this.getScope()===i.GenericTileScope.Display){if(e(t.target).hasClass("sapMSTIconClickTapArea")){this.addStyleClass("sapMSTIconPressed")}else{this.addStyleClass("sapMSTHvr")}}};l.prototype.ontouchend=function(e){this.removeStyleClass("sapMSTHvr")};l.prototype.ontouchcancel=function(e){if(this.hasStyleClass("sapMSTIconPressed")){this.removeStyleClass("sapMSTIconPressed")}else{this.removeStyleClass("sapMSTHvr")}};l.prototype.onkeydown=function(t){if(this.getScope()===i.GenericTileScope.Display){if(e.sap.PseudoEvents.sapenter.fnCheck(t)){var s=this.getTiles()[this._iCurrentTile];s.onkeydown(t)}}};l.prototype.onkeyup=function(t){var o;if(this.getScope()===i.GenericTileScope.Display){if(e.sap.PseudoEvents.sapenter.fnCheck(t)){var n=this.getTiles()[this._iCurrentTile];n.onkeyup(t);return}if(e.sap.PseudoEvents.sapspace.fnCheck(t)){this._toggleAnimation()}if(t.which===e.sap.KeyCodes.B&&this._bAnimationPause){this._scrollToNextTile(true,true)}if(t.which===e.sap.KeyCodes.F&&this._bAnimationPause){this._scrollToNextTile(true,false)}}else if(this.getScope()===i.GenericTileScope.Actions){if(e.sap.PseudoEvents.sapselect.fnCheck(t)){this.firePress(this._getEventParams(t));t.preventDefault()}else if(e.sap.PseudoEvents.sapdelete.fnCheck(t)||e.sap.PseudoEvents.sapbackspace.fnCheck(t)){o={scope:this.getScope(),action:s._Action.Remove,domRef:this._oRemoveButton.getPopupAnchorDomRef()};this.firePress(o);t.preventDefault()}}};l.prototype.onmouseup=function(e){if(this.getScope()===i.GenericTileScope.Display){if(this.hasStyleClass("sapMSTIconPressed")){this._toggleAnimation();this.removeStyleClass("sapMSTIconPressed")}else if(o.system.desktop){e.preventDefault();this.getTiles()[this._iCurrentTile].firePress()}}};l.prototype.onmousedown=function(i){if(e(i.target).hasClass("sapMSTIconClickTapArea")){this.addStyleClass("sapMSTIconPressed")}};l.prototype.onfocusout=function(e){if(this.getScope()===i.GenericTileScope.Actions){return}if(this.getTiles().length>1&&!this._isFocusInsideST()&&this._bAnimationPause){this._startAnimation();this._updatePausePlayIcon()}};l.prototype.setScope=function(e){if(this.getScope()!==e){if(e===i.GenericTileScope.Actions){this.setProperty("scope",e,true);this._bNeedInvalidate=true;this._stopAnimation(this._bNeedInvalidate)}else{this.setProperty("scope",e)}this._setTilePressState()}return this};l.prototype._setupResizeClassHandler=function(){var i=function(){if(this.getSizeBehavior()===a.Small||window.matchMedia("(max-width: 374px)").matches){this.$().addClass("sapMTileSmallPhone")}else{this.$().removeClass("sapMTileSmallPhone")}}.bind(this);e(window).resize(i);i()};l.prototype._isFocusInsideST=function(){return this.$()[0]===document.activeElement||this.$().find(document.activeElement).length};l.prototype._removeGTFocus=function(){for(var e=0;e<this.getTiles().length;e++){this.getTiles()[e].$().removeAttr("tabindex")}};l.prototype._toggleAnimation=function(){if(this.getTiles().length>1){if(this._bAnimationPause){this._startAnimation()}else{this._stopAnimation()}}this._updatePausePlayIcon()};l.prototype._stopAnimation=function(e){this._iCurrAnimationTime+=Date.now()-this._iStartTime;clearTimeout(this._sTimerId);if(this._iCurrentTile!=undefined){var i=this.$("wrapper-"+this._iCurrentTile);i.stop()}if(this._iPreviousTile!=undefined){var t=this.$("wrapper-"+this._iPreviousTile);t.stop()}this._bAnimationPause=true;if(this._iCurrAnimationTime>this.getDisplayTime()){this._scrollToNextTile(true)}else{if(this.getTiles()[this._iCurrentTile]){this._setAriaDescriptor()}if(e){this.invalidate()}}};l.prototype._startAnimation=function(){var e=this.getDisplayTime()-this._iCurrAnimationTime;clearTimeout(this._sTimerId);this._sTimerId=setTimeout(function(){this._scrollToNextTile()}.bind(this),e);this._iStartTime=Date.now();this._bAnimationPause=false};l.prototype._scrollToTile=function(e){if(e>=0){var i=this.$("wrapper-"+e);var t=sap.ui.getCore().getConfiguration().getRTL()?"right":"left";this._changeSizeTo(e);i.css(t,"0rem");this._iCurrentTile=e;if(this.getTiles()[e]){this._setAriaDescriptor()}this._updateTilesIndicator()}};l.prototype._scrollToNextTile=function(i,t){var s=this._iCurrAnimationTime-this.getDisplayTime(),o,n,r,a,l,p,h,c,u,T;s=this.getTransitionTime()-(s>0?s:0);o=s===this.getTransitionTime();if(o){if(t){n=this._getPreviousTileIndex(this._iCurrentTile)}else{n=this._getNextTileIndex(this._iCurrentTile)}this._iPreviousTile=this._iCurrentTile;this._iCurrentTile=n}a=this.$("wrapper-"+this._iCurrentTile);u=sap.ui.getCore().getConfiguration().getRTL()?"right":"left";if(e.isNumeric(this._iPreviousTile)){r=this.$("wrapper-"+this._iPreviousTile);l=r.css("width");p=parseFloat(a.css("width"));h=parseFloat(l);c=h<p;if(c){this._changeSizeTo(this._iCurrentTile)}if(o){a.css(u,l)}T={};if(t){T[u]=l}else{T[u]="-"+l}r.animate(T,{duration:s,done:function(){if(!c){this._changeSizeTo(this._iCurrentTile)}r.css(u,"")}.bind(this)});if(t){T[u]="-"+l;a.animate(T,0)}T[u]="0rem";a.animate(T,{duration:s,done:function(){this._iCurrAnimationTime=0;if(this._bNeedInvalidate){this.invalidate()}if(!i){this._startAnimation()}}.bind(this)})}else{this._changeSizeTo(this._iCurrentTile);a.css(u,"0rem")}if(this.getTiles()[this._iCurrentTile]){this._setAriaDescriptor()}this._updateTilesIndicator()};l.prototype._setAriaDescriptor=function(){var e,t,s,o;t=this.getScope();s=this.getTiles();o=s[this._iCurrentTile];e=o._getAriaText().replace(/\s/g," ");if(t===i.GenericTileScope.Actions){e=this._oRb.getText("GENERICTILE_ACTIONS_ARIA_TEXT")+"\n"+e}else if(s.length>1&&t===i.GenericTileScope.Display){e+="\n"+this._oRb.getText("SLIDETILE_MULTIPLE_CONTENT")+"\n"+this._oRb.getText("SLIDETILE_TOGGLE_SLIDING");if(this._bAnimationPause){e+="\n"+this._oRb.getText("SLIDETILE_SCROLL_BACK")+"\n"+this._oRb.getText("SLIDETILE_SCROLL_FORWARD")}}e+="\n"+this._oRb.getText("SLIDETILE_ACTIVATE");this.$().attr("aria-label",e)};l.prototype._changeSizeTo=function(e){var i=this.getTiles()[e];if(!i){return}if(this._sFrameType){this.$().removeClass(this._sFrameType)}if(this._sSize){this.$().removeClass(this._sSize)}this.$().addClass(i.getFrameType()).addClass(i.getSize());this._sFrameType=i.getFrameType();this._sSize=i.getSize()};l.prototype._getPreviousTileIndex=function(e){if(e>0){return e-1}else{return this.getTiles().length-1}};l.prototype._getNextTileIndex=function(e){if(e+1<this.getTiles().length){return e+1}else{return 0}};l.prototype._updateTilesIndicator=function(){var e;for(var i=0;i<this.getTiles().length;i++){e=this.$("tileIndicator-"+i);if(i===this._iCurrentTile){e.addClass("sapMSTActive")}else{e.removeClass("sapMSTActive")}}};l.prototype._updatePausePlayIcon=function(){if(this._bAnimationPause){this.getAggregation("_pausePlayIcon").setSrc("sap-icon://media-play");this.$().removeClass("sapMSTPauseIcon")}else{this.getAggregation("_pausePlayIcon").setSrc("sap-icon://media-pause");this.$().addClass("sapMSTPauseIcon")}};l.prototype._setTilePressState=function(){var e=this.getTiles(),t=this.getScope()===i.GenericTileScope.Display;for(var s=0;s<e.length;s++){e[s].setPressEnabled(t)}};l.prototype._hasNewsContent=function(e){var i=this.getTiles()[e].getTileContent();for(var t=0;t<i.length;t++){if(i[t]._getContentType()==="News"){return true}}return false};l.prototype._getEventParams=s.prototype._getEventParams;return l});