/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/theming/Parameters","./RatingIndicatorRenderer","jquery.sap.keycodes"],function(e,t,a,i,s){"use strict";var o=t.RatingIndicatorVisualMode;var n=a.extend("sap.m.RatingIndicator",{metadata:{interfaces:["sap.ui.core.IFormContent"],library:"sap.m",properties:{enabled:{type:"boolean",group:"Behavior",defaultValue:true},maxValue:{type:"int",group:"Behavior",defaultValue:5},value:{type:"float",group:"Behavior",defaultValue:0,bindable:"bindable"},iconSize:{type:"sap.ui.core.CSSSize",group:"Behavior",defaultValue:null},iconSelected:{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},iconUnselected:{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},iconHovered:{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},visualMode:{type:"sap.m.RatingIndicatorVisualMode",group:"Behavior",defaultValue:o.Half},displayOnly:{type:"boolean",group:"Behavior",defaultValue:false},editable:{type:"boolean",group:"Behavior",defaultValue:true}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{change:{parameters:{value:{type:"int"}}},liveChange:{parameters:{value:{type:"float"}}}},designtime:"sap/m/designtime/RatingIndicator.designtime"}});n.prototype.init=function(){this.allowTextSelection(false);this._iIconCounter=0;this._fHoverValue=0;this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m")};n.prototype.setValue=function(t){t=this.validateProperty("value",t);if(t<0){return this}if(isNaN(t)){e.sap.log.warning('Ignored new rating value "'+t+'" because it is NAN')}else if(this.$().length&&t>this.getMaxValue()){e.sap.log.warning('Ignored new rating value "'+t+'" because it is out  of range (0-'+this.getMaxValue()+")")}else{t=this._roundValueToVisualMode(t);this.setProperty("value",t,true);this._fHoverValue=t;if(this.$().length){this._updateUI(t)}}return this};n.prototype.setIconSize=function(e){if(this.$().length){this._iPxIconSize=this._toPx(e)||16}this.setProperty("iconSize",e,false);return this};n.prototype.onThemeChanged=function(e){this.invalidate()};n.prototype.onBeforeRendering=function(){var t=this.getValue(),a=this.getMaxValue(),s;if(t>a){this.setValue(a);e.sap.log.warning("Set value to maxValue because value is > maxValue ("+t+" > "+a+").")}else if(t<0){this.setValue(0);e.sap.log.warning("Set value to 0 because value is < 0 ("+t+" < 0).")}if(this.getIconSize()){this._iPxIconSize=this._toPx(this.getIconSize());s="sapUiRIIconPadding"+this._getIconSizeLabel(this._iPxIconSize);this._iPxPaddingSize=this._toPx(i.get(s))}else{if(this.getDisplayOnly()){this._iPxIconSize=this._toPx(i.get("sapUiRIIconSizeDisplayOnly"));this._iPxPaddingSize=this._toPx(i.get("sapUiRIIconPaddingDisplayOnly"))}else{var o=this._getDensityMode();this._iPxIconSize=this._toPx(i.get("sapUiRIIconSize"+o));this._iPxPaddingSize=this._toPx(i.get("sapUiRIIconPadding"+o))}}};n.prototype.onAfterRendering=function(){this._updateAriaValues()};n.prototype.exit=function(){this._iIconCounter=null;this._fStartValue=null;this._iPxIconSize=null;this._iPxPaddingSize=null;this._fHoverValue=null;this._oResourceBundle=null};n.prototype._getDensityMode=function(){var t=[{name:"Cozy",style:"sapUiSizeCozy"},{name:"Compact",style:"sapUiSizeCompact"},{name:"Condensed",style:"sapUiSizeCondensed"}],a,i,s;for(s in t){a=t[s].style;if(e("html").hasClass(a)||e("."+a).length>0){i=t[s].name}}return i||t[0].name};n.prototype._getIconSizeLabel=function(e){switch(true){case e>=32:return"L";case this._iPxIconSize>=22:return"M";case this._iPxIconSize>=16:return"S";case this._iPxIconSize>=12:return"XS";default:return"M"}};n.prototype._toPx=function(t){var a=Math.round(t),i;if(isNaN(a)){if(RegExp("^(auto|0)$|^[+-]?[0-9].?([0-9]+)?(px|em|rem|ex|%|in|cm|mm|pt|pc)$").test(t)){i=e('<div style="display: none; width: '+t+'; margin: 0; padding:0; height: auto; line-height: 1; font-size: 1; border:0; overflow: hidden">&nbsp;</div>').appendTo(sap.ui.getCore().getStaticAreaRef());a=i.width();i.remove()}else{return false}}return Math.round(a)};n.prototype._updateUI=function(t,a){var i=this.$("sel"),s=this.$("unsel-wrapper"),o=this.$("hov"),n=this._iPxIconSize,u=this._iPxPaddingSize,r="px",l=this.getMaxValue(),h=t*n+(Math.round(t)-1)*u,p=l*(n+u)-u;this._fHoverValue=t;if(h<0){h=0}this._updateAriaValues(t);s.width(p-h+r);if(a){o.width(h+r);i.hide();o.show()}else{i.width(h+r);o.hide();i.show()}e.sap.log.debug("Updated rating UI with value "+t+" and hover mode "+a)};n.prototype._updateAriaValues=function(e){var t=this.$();var a;if(e===undefined){a=this.getValue()}else{a=e}var i=this.getMaxValue();t.attr("aria-valuenow",a);t.attr("aria-valuemax",i);var s=this._oResourceBundle.getText("RATING_VALUEARIATEXT",[a,i]);t.attr("aria-valuetext",s)};n.prototype._calculateSelectedValue=function(e){var t=-1,a=0,i=this.$(),s=(i.innerWidth()-i.width())/2,o,n=sap.ui.getCore().getConfiguration().getRTL();if(e.targetTouches){o=e.targetTouches[0]}else{o=e}if(!o||!o.pageX){o=e;if((!o||!o.pageX)&&e.changedTouches){o=e.changedTouches[0]}}if(!o.pageX){return parseFloat(t)}if(o.pageX<i.offset().left){t=0}else if(o.pageX-i.offset().left>i.innerWidth()-s){t=this.getMaxValue()}else{a=(o.pageX-i.offset().left-s)/i.width();t=a*this.getMaxValue()}if(n){t=this.getMaxValue()-t}return this._roundValueToVisualMode(t,true)};n.prototype._roundValueToVisualMode=function(e,t){if(t){if(e<.25){e=0}else if(e<this.getMaxValue()-.4){e+=.4}e=Math.round(e)}else{if(this.getVisualMode()===o.Full){e=Math.round(e)}else if(this.getVisualMode()===o.Half){e=Math.round(e*2)/2}}return parseFloat(e)};n.prototype._getIncreasedValue=function(){var e=this.getMaxValue(),t=this.getValue()+this._getValueChangeStep();if(t>e){t=e}return t};n.prototype._getDecreasedValue=function(){var e=this.getValue()-this._getValueChangeStep();if(e<0){e=0}return e};n.prototype._getValueChangeStep=function(){var t=this.getVisualMode(),a;switch(t){case o.Full:a=1;break;case o.Half:if(this.getValue()%1===.5){a=.5}else{a=1}break;default:e.sap.log.warning("VisualMode not supported",t)}return a};n.prototype.ontouchstart=function(t){if(t.which==2||t.which==3||!this.getEnabled()||this.getDisplayOnly()||!this.getEditable()){return}t.setMarked();if(!this._touchEndProxy){this._touchEndProxy=e.proxy(this._ontouchend,this)}if(!this._touchMoveProxy){this._touchMoveProxy=e.proxy(this._ontouchmove,this)}e(document).on("touchend.sapMRI touchcancel.sapMRI mouseup.sapMRI",this._touchEndProxy);e(document).on("touchmove.sapMRI mousemove.sapMRI",this._touchMoveProxy);this._fStartValue=this.getValue();var a=this._calculateSelectedValue(t);if(a>=0&&a<=this.getMaxValue()){this._updateUI(a,true);if(this._fStartValue!==a){this.fireLiveChange({value:a})}}};n.prototype._ontouchmove=function(e){if(e.isMarked("delayedMouseEvent")){return}e.preventDefault();if(this.getEnabled()){var t=this._calculateSelectedValue(e);if(t>=0&&t<=this.getMaxValue()){this._updateUI(t,true);if(this._fStartValue!==t){this.fireLiveChange({value:t})}}}};n.prototype._ontouchend=function(t){if(t.isMarked("delayedMouseEvent")){return}if(this.getEnabled()){var a=this._calculateSelectedValue(t);if(this.getValue()===1&&a===1){a=0}this.setProperty("value",a,true);this._updateUI(a,false);if(this._fStartValue!==a){this.fireLiveChange({value:a});this.fireChange({value:a})}e(document).off("touchend.sapMRI touchcancel.sapMRI mouseup.sapMRI",this._touchEndProxy);e(document).off("touchmove.sapMRI mousemove.sapMRI",this._touchMoveProxy);delete this._fStartValue}};n.prototype.ontouchcancel=n.prototype.ontouchend;n.prototype.onsapincrease=function(e){var t=this._getIncreasedValue();this._handleKeyboardValueChange(e,t)};n.prototype.onsapdecrease=function(e){var t=this._getDecreasedValue();this._handleKeyboardValueChange(e,t)};n.prototype.onsaphome=function(e){var t=0;this._handleKeyboardValueChange(e,t)};n.prototype.onsapend=function(e){var t=this.getMaxValue();this._handleKeyboardValueChange(e,t)};n.prototype.onsapselect=function(e){var t;if(this.getValue()===this.getMaxValue()){t=0}else{t=this._getIncreasedValue()}this._handleKeyboardValueChange(e,t)};n.prototype.onkeyup=function(t){var a=this.getMaxValue();if(!this.getEnabled()||this.getDisplayOnly()||!this.getEditable()){return false}switch(t.which){case e.sap.KeyCodes.DIGIT_0:case e.sap.KeyCodes.NUMPAD_0:this.setValue(0);break;case e.sap.KeyCodes.DIGIT_1:case e.sap.KeyCodes.NUMPAD_1:this.setValue(1);break;case e.sap.KeyCodes.DIGIT_2:case e.sap.KeyCodes.NUMPAD_2:this.setValue(Math.min(2,a));break;case e.sap.KeyCodes.DIGIT_3:case e.sap.KeyCodes.NUMPAD_3:this.setValue(Math.min(3,a));break;case e.sap.KeyCodes.DIGIT_4:case e.sap.KeyCodes.NUMPAD_4:this.setValue(Math.min(4,a));break;case e.sap.KeyCodes.DIGIT_5:case e.sap.KeyCodes.NUMPAD_5:this.setValue(Math.min(5,a));break;case e.sap.KeyCodes.DIGIT_6:case e.sap.KeyCodes.NUMPAD_6:this.setValue(Math.min(6,a));break;case e.sap.KeyCodes.DIGIT_7:case e.sap.KeyCodes.NUMPAD_7:this.setValue(Math.min(7,a));break;case e.sap.KeyCodes.DIGIT_8:case e.sap.KeyCodes.NUMPAD_8:this.setValue(Math.min(8,a));break;case e.sap.KeyCodes.DIGIT_9:case e.sap.KeyCodes.NUMPAD_9:this.setValue(Math.min(9,a));break}};n.prototype._handleKeyboardValueChange=function(e,t){if(!this.getEnabled()||this.getDisplayOnly()||!this.getEditable()){return}if(t!==this.getValue()){this.setValue(t);this.fireLiveChange({value:t});this.fireChange({value:t})}if(e){e.preventDefault();e.stopPropagation()}};n.prototype.getAccessibilityInfo=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");return{role:"slider",type:e.getText("ACC_CTR_TYPE_RATING"),description:e.getText("ACC_CTR_STATE_RATING",[this.getValue(),this.getMaxValue()]),focusable:this.getEnabled()&&!this.getDisplayOnly(),enabled:this.getEnabled(),editable:this.getEditable()}};return n});